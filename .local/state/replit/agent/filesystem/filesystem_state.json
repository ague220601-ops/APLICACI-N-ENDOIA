{"file_contents":{"ENDOIA/client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"ENDOIA/client/src/pages/Tutor/ValidarCaso.tsx":{"content":"import { useState } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { ArrowLeft, CheckCircle2, Loader2, AlertCircle, Stethoscope, Activity, X } from \"lucide-react\";\nimport { useAuth } from \"@/auth/AuthContext\";\nimport { OPCIONES_PULPAR, OPCIONES_APICAL, getTutorTokenFromEmail } from \"@/lib/classifications\";\nimport { enviarLabelTutor } from \"@/lib/api\";\n\nfunction toNumber(value: number | string | null | undefined): number {\n  if (value === null || value === undefined || value === '') return 0;\n  if (typeof value === 'number') return value;\n  const parsed = Number(value);\n  return isNaN(parsed) ? 0 : parsed;\n}\n\nexport default function ValidarCaso() {\n  const { user } = useAuth();\n  const params = useParams();\n  const [, navigate] = useLocation();\n  \n  const case_id = params.case_id;\n  const casoStored = case_id ? sessionStorage.getItem(`caso_${case_id}`) : null;\n  const caso = casoStored ? JSON.parse(casoStored) : null;\n\n  const [pulparSeleccionado, setPulparSeleccionado] = useState<string>(\"\");\n  const [apicalSeleccionado, setApicalSeleccionado] = useState<string>(\"\");\n  const [guardando, setGuardando] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  if (!caso || !case_id) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"w-4 h-4\" />\n          <AlertDescription>\n            No se encontraron datos del caso. Vuelve a la lista de pendientes.\n          </AlertDescription>\n        </Alert>\n        <Button onClick={() => navigate('/tutor')} className=\"mt-4 gap-2\">\n          <ArrowLeft className=\"w-4 h-4\" />\n          Volver a casos pendientes\n        </Button>\n      </div>\n    );\n  }\n\n  async function handleEnviarValidacion() {\n    if (!pulparSeleccionado || !apicalSeleccionado) {\n      setError('Debes seleccionar ambas clasificaciones (pulpar y apical)');\n      return;\n    }\n\n    const token = getTutorTokenFromEmail(user?.email || '');\n    if (!token) {\n      setError('Tu email no está autorizado como tutor');\n      return;\n    }\n\n    const tutorType: 'JEN' | 'SEG' | 'INV' = token.includes('JEN') ? 'JEN' : \n                                              token.includes('SEG') ? 'SEG' : 'INV';\n\n    setGuardando(true);\n    setError(null);\n\n    try {\n      await enviarLabelTutor(\n        case_id!,\n        {\n          pulpar: pulparSeleccionado,\n          apical: apicalSeleccionado\n        },\n        tutorType\n      );\n\n      alert('✓ Validación registrada correctamente');\n      navigate('/tutor');\n    } catch (err) {\n      console.error('Error enviando validación:', err);\n      setError('No se pudo enviar la validación. Inténtalo de nuevo.');\n    } finally {\n      setGuardando(false);\n    }\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => navigate('/tutor')}\n          className=\"gap-2\"\n        >\n          <ArrowLeft className=\"w-4 h-4\" />\n          Volver\n        </Button>\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-bold\">Validar Caso</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Caso: <span className=\"font-mono\">{case_id}</span>\n          </p>\n        </div>\n      </div>\n\n      <Alert>\n        <AlertCircle className=\"w-4 h-4\" />\n        <AlertDescription>\n          <strong>Importante:</strong> Solo puedes ver datos clínicos sin diagnósticos IA. \n          Asigna las clasificaciones según tu criterio profesional y la clasificación AEDE/ESE 2025.\n        </AlertDescription>\n      </Alert>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Stethoscope className=\"w-5 h-5\" />\n                Datos del Diente\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Diente (FDI)</p>\n                <p className=\"text-lg font-bold\">{caso.tooth_fdi}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Fecha registro</p>\n                <p className=\"text-lg font-medium\">{caso.date || caso.registro_fecha || 'N/A'}</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"w-5 h-5\" />\n                Síntomas y Signos Clínicos\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Dolor espontáneo</p>\n                <p className=\"font-medium\">{toNumber(caso.spontaneous_pain_yesno) === 1 ? '✓ Sí' : '✗ No'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Respuesta al frío</p>\n                <p className=\"font-medium\">\n                  {toNumber(caso.thermal_cold_response) === 0 ? 'No responde' : \n                   toNumber(caso.thermal_cold_response) === 2 ? 'Aumentada' : 'Normal'}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Dolor persistente (seg)</p>\n                <p className=\"font-medium\">{toNumber(caso.lingering_pain_seconds)} seg</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Percusión dolorosa</p>\n                <p className=\"font-medium\">{caso.percussion_pain_yesno === 'yes' ? '✓ Sí' : '✗ No'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Palpación apical dolorosa</p>\n                <p className=\"font-medium\">{caso.apical_palpation_pain === 'si' || caso.apical_palpation_pain === 'yes' ? '✓ Sí' : '✗ No'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Tracto sinusal presente</p>\n                <p className=\"font-medium\">{caso.sinus_tract_present === 'si' || caso.sinus_tract_present === 'yes' ? '✓ Sí' : '✗ No'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Compromiso sistémico</p>\n                <p className=\"font-medium\">{caso.systemic_involvement === 'si' || caso.systemic_involvement === 'yes' ? '✓ Sí' : '✗ No'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Tratamiento previo</p>\n                <p className=\"font-medium\">{caso.previous_treatment === 'si' || caso.previous_treatment === 'yes' ? '✓ Sí' : '✗ No'}</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Hallazgos Radiográficos</CardTitle>\n            </CardHeader>\n            <CardContent className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Radiolucidez apical</p>\n                <p className=\"font-medium\">{toNumber(caso.radiolucency_yesno) === 1 ? '✓ Sí' : '✗ No'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">PAI (1-5)</p>\n                <p className=\"font-medium\">{caso.periapical_index_PAI_1_5 || 'N/A'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Ensanchamiento PDL</p>\n                <p className=\"font-medium\">{caso.pdl_widening || 'N/A'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Profundidad de caries</p>\n                <p className=\"font-medium capitalize\">{caso.depth_of_caries || 'N/A'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Sondaje máximo (mm)</p>\n                <p className=\"font-medium\">{caso.probing_max_depth_mm || 'N/A'} mm</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Control de sangrado</p>\n                <p className=\"font-medium\">{caso.bleeding_control_possible === 'yes' ? '✓ Sí' : '✗ No'}</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* BLOQUE DE IA RADIOLÓGICA */}\n          <Card className=\"bg-blue-50 border-blue-200\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-blue-900\">\n                <AlertCircle className=\"w-5 h-5\" />\n                Análisis Radiográfico IA (Vision GPT)\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">PAI inicial (IA)</p>\n                <p className=\"font-medium\">{caso.vision_PAI_baseline ?? \"No disponible\"}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">PAI seguimiento (IA)</p>\n                <p className=\"font-medium\">{caso.vision_PAI_followup ?? \"No disponible\"}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Radiolucidez detectada</p>\n                <p className=\"font-medium\">{caso.vision_radiolucency_detected ? \"Sí\" : \"No\"}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Diámetro lesión (baseline)</p>\n                <p className=\"font-medium\">{caso.vision_lesion_diam_mm_baseline ? `${caso.vision_lesion_diam_mm_baseline} mm` : \"No disponible\"}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Diámetro lesión (follow-up)</p>\n                <p className=\"font-medium\">{caso.vision_lesion_diam_mm_followup ? `${caso.vision_lesion_diam_mm_followup} mm` : \"No disponible\"}</p>\n              </div>\n              {caso.IA_flags && caso.IA_flags.length > 0 && (\n                <div className=\"md:col-span-2\">\n                  <p className=\"text-sm font-semibold text-blue-800 mb-2\">Alertas IA</p>\n                  <ul className=\"list-disc list-inside space-y-1\">\n                    {caso.IA_flags.map((flag: string, idx: number) => (\n                      <li key={idx} className=\"text-blue-700 text-sm\">{flag}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* BLOQUE DE COHERENCIA CLÍNICO – IA */}\n          <Card className=\"bg-orange-50 border-orange-200\">\n            <CardHeader>\n              <CardTitle className=\"text-orange-800\">Coherencia Clínico – IA</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Radiolucidez (Clínico)</p>\n                  <p className=\"font-medium\">\n                    {caso.radiolucency_yesno === \"si\" || caso.radiolucency_yesno === \"1\" || toNumber(caso.radiolucency_yesno) === 1 ? \"Sí\" : \"No\"}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Radiolucidez (IA)</p>\n                  <p className=\"font-medium\">{caso.vision_radiolucency_detected ? \"Sí\" : \"No\"}</p>\n                </div>\n              </div>\n              <div className=\"pt-2 border-t border-orange-200\">\n                <p className=\"text-sm text-muted-foreground\">Interpretación final</p>\n                <p className=\"font-medium\">\n                  {caso.vision_radiolucency_detected\n                    ? \"Radiolucidez presente (confirmada por IA)\"\n                    : (caso.radiolucency_yesno === \"si\" || caso.radiolucency_yesno === \"1\" || toNumber(caso.radiolucency_yesno) === 1)\n                      ? \"Radiolucidez presente (identificada por el clínico)\"\n                      : \"No se detecta radiolucidez\"}\n                </p>\n              </div>\n              {(caso.vision_radiolucency_detected &&\n                (caso.radiolucency_yesno === \"no\" ||\n                 caso.radiolucency_yesno === \"0\" ||\n                 toNumber(caso.radiolucency_yesno) === 0)) && (\n                <div className=\"bg-orange-100 p-3 rounded-lg\">\n                  <p className=\"text-orange-700 text-sm\">\n                    <strong>Aviso:</strong> Se detecta discrepancia entre el clínico y la IA.\n                    La interpretación final prioriza la detección de IA por seguridad diagnóstica.\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {caso.notes && caso.notes.trim() !== '' && (\n            <Card>\n              <CardHeader>\n                <CardTitle>Notas Clínicas</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"bg-muted p-4 rounded-lg\">\n                  <p className=\"text-sm\">{caso.notes}</p>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n\n        <div className=\"lg:col-span-1\">\n          <Card className=\"sticky top-6 border-2 border-primary/20\">\n            <CardHeader>\n              <CardTitle>Diagnóstico AEDE/ESE 2025</CardTitle>\n              <CardDescription>\n                Asigna las clasificaciones oficiales (Gold Standard)\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"pulpar\" className=\"font-semibold\">\n                  Clasificación Pulpar *\n                </Label>\n                <Select value={pulparSeleccionado} onValueChange={setPulparSeleccionado}>\n                  <SelectTrigger id=\"pulpar\">\n                    <SelectValue placeholder=\"Selecciona clasificación pulpar...\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {OPCIONES_PULPAR.map((opcion) => (\n                      <SelectItem key={opcion} value={opcion}>\n                        {opcion}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"apical\" className=\"font-semibold\">\n                  Clasificación Apical *\n                </Label>\n                <Select value={apicalSeleccionado} onValueChange={setApicalSeleccionado}>\n                  <SelectTrigger id=\"apical\">\n                    <SelectValue placeholder=\"Selecciona clasificación apical...\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {OPCIONES_APICAL.map((opcion) => (\n                      <SelectItem key={opcion} value={opcion}>\n                        {opcion}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {error && (\n                <Alert variant=\"destructive\">\n                  <X className=\"w-4 h-4\" />\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              {pulparSeleccionado && apicalSeleccionado && (\n                <div className=\"bg-green-50 border border-green-200 p-3 rounded-lg space-y-2\">\n                  <p className=\"text-xs font-medium text-green-700\">Clasificación seleccionada:</p>\n                  <div className=\"space-y-1\">\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">Pulpar:</p>\n                      <Badge variant=\"outline\" className=\"text-xs\">{pulparSeleccionado}</Badge>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">Apical:</p>\n                      <Badge variant=\"outline\" className=\"text-xs\">{apicalSeleccionado}</Badge>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              <Button\n                onClick={handleEnviarValidacion}\n                disabled={!pulparSeleccionado || !apicalSeleccionado || guardando}\n                className=\"w-full gap-2\"\n              >\n                {guardando ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    Enviando...\n                  </>\n                ) : (\n                  <>\n                    <CheckCircle2 className=\"w-4 h-4\" />\n                    Enviar Validación\n                  </>\n                )}\n              </Button>\n\n              <p className=\"text-xs text-muted-foreground text-center\">\n                * Ambas clasificaciones son obligatorias para completar la validación\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17816,"size_tokens":null},"ENDOIA/client/src/components/clinico/EnhancedCaseModal.tsx":{"content":"import { ClinicoCase } from './types';\nimport { getDiagnosisColor } from './helpers';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Lightbulb } from 'lucide-react';\n\ninterface DiagnosisBadgesProps {\n  caso: ClinicoCase;\n}\n\nexport function EnhancedDiagnosisBadges({ caso }: DiagnosisBadgesProps) {\n  const pulparColor = getDiagnosisColor(caso.AEDE_pulpar_IA);\n  const apicalColor = getDiagnosisColor(caso.AEDE_apical_IA);\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-3\">\n        <div>\n          <p className=\"text-sm font-medium mb-2\">Diagnóstico Pulpar IA:</p>\n          <Badge className={`${pulparColor} border text-base px-4 py-2 font-semibold`}>\n            {caso.AEDE_pulpar_IA || 'Sin diagnóstico'}\n          </Badge>\n        </div>\n        \n        <div>\n          <p className=\"text-sm font-medium mb-2\">Diagnóstico Apical IA:</p>\n          <Badge className={`${apicalColor} border text-base px-4 py-2 font-semibold`}>\n            {caso.AEDE_apical_IA || 'Sin diagnóstico'}\n          </Badge>\n        </div>\n      </div>\n\n      {caso.tto_propuesto && (\n        <Card className=\"bg-blue-50 border-blue-200\">\n          <CardContent className=\"pt-4 space-y-2\">\n            <div className=\"flex items-center gap-2 text-blue-900\">\n              <Lightbulb className=\"w-5 h-5\" />\n              <h4 className=\"font-semibold\">Orientación terapéutica sugerida</h4>\n            </div>\n            <p className=\"text-sm text-blue-800\">{caso.tto_propuesto}</p>\n            <p className=\"text-xs text-blue-600 italic pt-2 border-t border-blue-200\">\n              Recomendación basada en reglas objetivas ENDOIA (AAE/ESE 2025).\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":1810,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/ItemFAQ.tsx":{"content":"import { BibliotecaItem, TextoContent } from '@/data/bibliotecaClinica';\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from '@/components/ui/collapsible';\nimport { ChevronDown } from 'lucide-react';\nimport { useState } from 'react';\n\ninterface ItemFAQProps {\n  item: BibliotecaItem;\n  defaultOpen?: boolean;\n}\n\nexport function ItemFAQ({ item, defaultOpen = false }: ItemFAQProps) {\n  const [isOpen, setIsOpen] = useState(defaultOpen);\n  const content = item.content as TextoContent;\n  \n  return (\n    <Collapsible open={isOpen} onOpenChange={setIsOpen}>\n      <CollapsibleTrigger className=\"w-full flex items-center justify-between gap-4 py-1 hover:opacity-80 transition-opacity\">\n        <h3 className=\"text-left font-medium text-zinc-800 dark:text-zinc-100\">\n          {content.question || item.title}\n        </h3>\n        <ChevronDown\n          className={`w-5 h-5 text-zinc-400 transition-transform flex-shrink-0 ${isOpen ? 'rotate-180' : ''}`}\n        />\n      </CollapsibleTrigger>\n      \n      <CollapsibleContent className=\"pt-3 space-y-3\">\n        <p className=\"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed\">\n          {content.answer}\n        </p>\n        \n        {content.management && (\n          <div className=\"p-3 rounded-lg bg-zinc-50 dark:bg-zinc-800/50\">\n            <p className=\"text-sm text-zinc-600 dark:text-zinc-300\">\n              <span className=\"font-semibold text-zinc-700 dark:text-zinc-200\">Manejo: </span>\n              {content.management}\n            </p>\n          </div>\n        )}\n        \n        {content.alternatives && (\n          <div className=\"p-3 rounded-lg bg-zinc-50 dark:bg-zinc-800/50\">\n            <p className=\"text-sm text-zinc-600 dark:text-zinc-300\">\n              <span className=\"font-semibold text-zinc-700 dark:text-zinc-200\">Alternativas: </span>\n              {content.alternatives}\n            </p>\n          </div>\n        )}\n        \n        {content.note && (\n          <p className=\"text-sm text-zinc-500 dark:text-zinc-400 italic\">\n            {content.note}\n          </p>\n        )}\n      </CollapsibleContent>\n    </Collapsible>\n  );\n}\n","path":null,"size_bytes":2142,"size_tokens":null},"ENDOIA/client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"ENDOIA/client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"ENDOIA/client/src/components/radiographs/GraficaPAI.tsx":{"content":"import { LineChart, Line, XAxis, YAxis, Tooltip, CartesianGrid, ResponsiveContainer, Legend } from \"recharts\";\nimport { LongitudinalPAI } from \"@/lib/radiographs\";\n\ninterface GraficaPAIProps {\n  data: LongitudinalPAI[];\n}\n\nexport function GraficaPAI({ data }: GraficaPAIProps) {\n  if (data.length === 0) {\n    return (\n      <div className=\"text-center py-8 text-zinc-400\">\n        <p>No hay datos de PAI longitudinal disponibles</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white dark:bg-zinc-900 p-4 rounded-lg shadow\">\n      <h3 className=\"font-bold text-lg mb-4\">Evolución PAI: Baseline → Follow-up</h3>\n      <ResponsiveContainer width=\"100%\" height={300}>\n        <LineChart data={data}>\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#E5E7EB\" opacity={0.5} />\n          <XAxis \n            dataKey=\"case_id\" \n            tick={{ fontSize: 10, fill: '#A6A6A6' }}\n            angle={-45}\n            textAnchor=\"end\"\n            height={60}\n          />\n          <YAxis \n            domain={[0, 5]} \n            tick={{ fontSize: 11, fill: '#A6A6A6' }}\n            label={{ value: 'PAI', angle: -90, position: 'insideLeft', fontSize: 12 }}\n          />\n          <Tooltip \n            contentStyle={{ \n              backgroundColor: 'rgba(255, 255, 255, 0.95)', \n              border: 'none',\n              borderRadius: '8px',\n              boxShadow: '0 4px 12px rgba(0,0,0,0.1)'\n            }}\n            formatter={(value: number, name: string) => [\n              value, \n              name === 'baseline' ? 'PAI Baseline' : 'PAI Follow-up'\n            ]}\n          />\n          <Legend />\n          <Line \n            type=\"monotone\" \n            dataKey=\"baseline\" \n            stroke=\"#8884d8\" \n            name=\"PAI Baseline\" \n            strokeWidth={2}\n            dot={{ fill: '#8884d8', r: 4 }}\n          />\n          <Line \n            type=\"monotone\" \n            dataKey=\"followup\" \n            stroke=\"#82ca9d\" \n            name=\"PAI Follow-up\" \n            strokeWidth={2}\n            dot={{ fill: '#82ca9d', r: 4 }}\n          />\n        </LineChart>\n      </ResponsiveContainer>\n      \n      <div className=\"mt-4 grid grid-cols-3 gap-4 text-center text-sm\">\n        <div className=\"p-2 bg-green-50 dark:bg-green-900/20 rounded\">\n          <p className=\"font-medium text-green-700 dark:text-green-400\">Mejoría</p>\n          <p className=\"text-2xl font-bold text-green-600\">\n            {data.filter(d => d.delta > 0).length}\n          </p>\n        </div>\n        <div className=\"p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded\">\n          <p className=\"font-medium text-yellow-700 dark:text-yellow-400\">Sin cambio</p>\n          <p className=\"text-2xl font-bold text-yellow-600\">\n            {data.filter(d => d.delta === 0).length}\n          </p>\n        </div>\n        <div className=\"p-2 bg-red-50 dark:bg-red-900/20 rounded\">\n          <p className=\"font-medium text-red-700 dark:text-red-400\">Empeoramiento</p>\n          <p className=\"text-2xl font-bold text-red-600\">\n            {data.filter(d => d.delta < 0).length}\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3138,"size_tokens":null},"ENDOIA/client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"ENDOIA/client/src/lib/supabase.ts":{"content":"import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('❌ Faltan variables de entorno de Supabase');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport interface CaseRecord {\n  id?: number;\n  case_id: string;\n  date?: string;\n  fecha?: string;\n  clinicoEmail: string;\n  tooth_fdi: number | string;\n  tipo_dolor?: string;\n  spontaneous_pain_yesno?: number | string;\n  thermal_cold_response?: number | string;\n  lingering_pain_seconds?: string;\n  periapical_index_PAI_1_5?: number | string;\n  radiolucency_yesno?: string;\n  pdl_widening?: number | string;\n  probing_max_depth_mm?: number | string;\n  sondaje_max_mm?: number | null;\n  depth_of_caries?: string;\n  percussion_pain_yesno?: string;\n  bleeding_control_possible?: string;\n  sangrado_controlable?: string | null;\n  camara_abierta?: string | null;\n  pulpa_expuesta?: string | null;\n  sinus_tract_present?: string;\n  systemic_involvement?: string;\n  previous_treatment?: string;\n  apical_palpation_pain?: string;\n  notes?: string;\n  AEDE_pulpar_IA?: string;\n  AEDE_apical_IA?: string;\n  tto_propuesto?: string;\n  tto_realizado?: string;\n  fecha_tto?: string;\n  control_1m_exito?: number | string;\n  fecha_control_1m?: string;\n  control_3m_exito?: number | string;\n  fecha_control_3m?: string;\n  control_6m_exito?: number | string;\n  fecha_control_6m?: string;\n  AEDE_pulpar_JEN?: string;\n  AEDE_apical_JEN?: string;\n  validado_JEN?: string;\n  AEDE_pulpar_SEG?: string;\n  AEDE_apical_SEG?: string;\n  validado_SEG?: string;\n  AEDE_pulpar_INV?: string;\n  AEDE_apical_INV?: string;\n  validado_INV?: string;\n  AEDE_pulpar_FINAL?: string;\n  AEDE_apical_FINAL?: string;\n}\n","path":null,"size_bytes":1826,"size_tokens":null},"ENDOIA/client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"ENDOIA/client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider } from \"@/auth/AuthContext\";\nimport ProtectedRoute from \"@/components/ProtectedRoute\";\nimport Navbar from \"@/components/Navbar\";\nimport HomePage from \"@/pages/HomePage\";\nimport LoginPage from \"@/pages/LoginPage\";\nimport HomeClinico from \"@/pages/Clinico/HomeClinico\";\nimport RegistrarCaso from \"@/pages/Clinico/RegistrarCaso\";\nimport MisCasos from \"@/pages/Clinico/MisCasos\";\nimport HomeTutor from \"@/pages/Tutor/HomeTutor\";\nimport CasosPendientes from \"@/pages/Tutor/CasosPendientes\";\nimport ValidarCaso from \"@/pages/Tutor/ValidarCaso\";\nimport Dashboard from \"@/pages/Investigador/Dashboard\";\nimport BibliotecaPage from \"@/pages/BibliotecaPage\";\nimport AboutEndoia from \"@/pages/AboutEndoia\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/login\" component={LoginPage} />\n      \n      <Route path=\"/\">\n        <ProtectedRoute>\n          <HomePage />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/clinico\">\n        <ProtectedRoute allowedRoles={['clinico', 'tutor', 'investigador']}>\n          <Navbar />\n          <HomeClinico />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/clinico/registrar\">\n        <ProtectedRoute allowedRoles={['clinico', 'tutor', 'investigador']}>\n          <Navbar />\n          <RegistrarCaso />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/clinico/mis-casos\">\n        <ProtectedRoute allowedRoles={['clinico', 'tutor', 'investigador']}>\n          <Navbar />\n          <MisCasos />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/tutor\">\n        <ProtectedRoute allowedRoles={['tutor', 'investigador']}>\n          <Navbar />\n          <CasosPendientes />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/tutor/validar/:case_id\">\n        <ProtectedRoute allowedRoles={['tutor', 'investigador']}>\n          <Navbar />\n          <ValidarCaso />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/investigador\">\n        <ProtectedRoute allowedRoles={['investigador']}>\n          <Navbar />\n          <Dashboard />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/investigador/dashboard\">\n        <ProtectedRoute allowedRoles={['investigador']}>\n          <Navbar />\n          <Dashboard />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/biblioteca\">\n        <ProtectedRoute allowedRoles={['clinico', 'tutor', 'investigador']}>\n          <Navbar />\n          <BibliotecaPage />\n        </ProtectedRoute>\n      </Route>\n\n      <Route path=\"/sobre-endoia\">\n        <ProtectedRoute allowedRoles={['clinico', 'tutor', 'investigador']}>\n          <Navbar />\n          <AboutEndoia />\n        </ProtectedRoute>\n      </Route>\n\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3329,"size_tokens":null},"ENDOIA/client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"ENDOIA/client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"ENDOIA/drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"ENDOIA/client/src/components/clinico/FDIHeatmap.tsx":{"content":"import { useState } from 'react';\nimport { ClinicoCase } from './types';\nimport { Grid3x3 } from 'lucide-react';\n\ninterface FDIHeatmapProps {\n  casos: ClinicoCase[];\n  onFilterByTooth?: (fdi: string | null) => void;\n  onSelectFDI?: (fdi: string) => void;\n}\n\nexport function FDIHeatmap({ casos, onFilterByTooth, onSelectFDI }: FDIHeatmapProps) {\n  const [selectedTooth, setSelectedTooth] = useState<string | null>(null);\n  \n  const toothCounts = new Map<string, number>();\n  casos.forEach(caso => {\n    if (caso.tooth_fdi) {\n      const fdi = String(caso.tooth_fdi);\n      toothCounts.set(fdi, (toothCounts.get(fdi) || 0) + 1);\n    }\n  });\n  \n  const getToothColor = (count: number): { bg: string; text: string } => {\n    if (count === 0) return { bg: 'rgba(166, 166, 166, 0.2)', text: '#A6A6A6' };\n    if (count <= 2) return { bg: 'rgba(58, 122, 254, 0.3)', text: '#3A7AFE' };\n    if (count <= 5) return { bg: 'rgba(58, 122, 254, 0.6)', text: '#3A7AFE' };\n    return { bg: '#3A7AFE', text: '#ffffff' };\n  };\n  \n  const handleToothClick = (fdi: string) => {\n    if (onSelectFDI) {\n      onSelectFDI(fdi);\n    } else if (onFilterByTooth) {\n      if (selectedTooth === fdi) {\n        setSelectedTooth(null);\n        onFilterByTooth(null);\n      } else {\n        setSelectedTooth(fdi);\n        onFilterByTooth(fdi);\n      }\n    }\n  };\n  \n  const upperRight = [18, 17, 16, 15, 14, 13, 12, 11];\n  const upperLeft = [21, 22, 23, 24, 25, 26, 27, 28];\n  const lowerLeft = [31, 32, 33, 34, 35, 36, 37, 38];\n  const lowerRight = [48, 47, 46, 45, 44, 43, 42, 41];\n\n  return (\n    <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <div className=\"flex items-center gap-2 mb-1\">\n            <Grid3x3 className=\"w-5 h-5\" style={{ color: '#3A7AFE' }} />\n            <h3 className=\"text-lg font-semibold tracking-tight\">Mapa de dientes FDI</h3>\n          </div>\n          <p className=\"text-sm text-zinc-400\">\n            Haz clic en un diente para ver sus casos\n          </p>\n        </div>\n      </div>\n      <div>\n        <div className=\"space-y-6\">\n          <div className=\"grid grid-cols-8 gap-1\">\n            {upperRight.map(fdi => {\n              const count = toothCounts.get(String(fdi)) || 0;\n              const colors = getToothColor(count);\n              return (\n                <button\n                  key={fdi}\n                  onClick={() => handleToothClick(String(fdi))}\n                  className=\"aspect-square rounded-lg flex flex-col items-center justify-center text-xs font-semibold transition-all hover:scale-105\"\n                  style={{ \n                    backgroundColor: colors.bg, \n                    color: colors.text,\n                    ...(selectedTooth === String(fdi) ? { boxShadow: '0 0 0 2px #3A7AFE', transform: 'scale(1.05)' } : {})\n                  }}\n                >\n                  <span>{fdi}</span>\n                  <span className=\"text-[10px]\">{count}</span>\n                </button>\n              );\n            })}\n            {upperLeft.map(fdi => {\n              const count = toothCounts.get(String(fdi)) || 0;\n              const colors = getToothColor(count);\n              return (\n                <button\n                  key={fdi}\n                  onClick={() => handleToothClick(String(fdi))}\n                  className=\"aspect-square rounded-lg flex flex-col items-center justify-center text-xs font-semibold transition-all hover:scale-105\"\n                  style={{ \n                    backgroundColor: colors.bg, \n                    color: colors.text,\n                    ...(selectedTooth === String(fdi) ? { boxShadow: '0 0 0 2px #3A7AFE', transform: 'scale(1.05)' } : {})\n                  }}\n                >\n                  <span>{fdi}</span>\n                  <span className=\"text-[10px]\">{count}</span>\n                </button>\n              );\n            })}\n          </div>\n          \n          <div className=\"border-t border-dashed pt-6\"></div>\n          \n          <div className=\"grid grid-cols-8 gap-1\">\n            {lowerLeft.map(fdi => {\n              const count = toothCounts.get(String(fdi)) || 0;\n              const colors = getToothColor(count);\n              return (\n                <button\n                  key={fdi}\n                  onClick={() => handleToothClick(String(fdi))}\n                  className=\"aspect-square rounded-lg flex flex-col items-center justify-center text-xs font-semibold transition-all hover:scale-105\"\n                  style={{ \n                    backgroundColor: colors.bg, \n                    color: colors.text,\n                    ...(selectedTooth === String(fdi) ? { boxShadow: '0 0 0 2px #3A7AFE', transform: 'scale(1.05)' } : {})\n                  }}\n                >\n                  <span>{fdi}</span>\n                  <span className=\"text-[10px]\">{count}</span>\n                </button>\n              );\n            })}\n            {lowerRight.map(fdi => {\n              const count = toothCounts.get(String(fdi)) || 0;\n              const colors = getToothColor(count);\n              return (\n                <button\n                  key={fdi}\n                  onClick={() => handleToothClick(String(fdi))}\n                  className=\"aspect-square rounded-lg flex flex-col items-center justify-center text-xs font-semibold transition-all hover:scale-105\"\n                  style={{ \n                    backgroundColor: colors.bg, \n                    color: colors.text,\n                    ...(selectedTooth === String(fdi) ? { boxShadow: '0 0 0 2px #3A7AFE', transform: 'scale(1.05)' } : {})\n                  }}\n                >\n                  <span>{fdi}</span>\n                  <span className=\"text-[10px]\">{count}</span>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n        \n        <div className=\"flex items-center gap-6 mt-8 pt-6 border-t border-zinc-200/50 dark:border-zinc-700/50 text-xs\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-zinc-200 dark:bg-zinc-700 rounded\"></div>\n            <span className=\"text-zinc-500\">0 casos</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: 'rgba(58, 122, 254, 0.3)' }}></div>\n            <span className=\"text-zinc-500\">1-2</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: 'rgba(58, 122, 254, 0.6)' }}></div>\n            <span className=\"text-zinc-500\">3-5</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#3A7AFE' }}></div>\n            <span className=\"text-zinc-500\">{'>'}5</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6991,"size_tokens":null},"ENDOIA/client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"ENDOIA/shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":584,"size_tokens":null},"ENDOIA/client/src/lib/api-investigador.ts":{"content":"import type { User } from 'firebase/auth';\nimport { supabase } from './supabase';\n\nexport interface CasoInvestigacion {\n  case_id: string;\n  clinico_email: string;\n  clinicoEmail?: string;\n  tooth_fdi: string;\n  date?: string;\n  registro_fecha?: string;\n  \n  spontaneous_pain_yesno?: number;\n  thermal_cold_response?: number;\n  lingering_pain_seconds?: number;\n  percussion_pain_yesno?: string;\n  apical_palpation_pain?: string;\n  sinus_tract_present?: string;\n  systemic_involvement?: string;\n  previous_treatment?: string;\n  \n  radiolucency_yesno?: number;\n  periapical_index_PAI_1_5?: string;\n  pdl_widening?: string;\n  depth_of_caries?: string;\n  probing_max_depth_mm?: string;\n  bleeding_control_possible?: string;\n  \n  AEDE_pulpar_IA?: string;\n  AEDE_apical_IA?: string;\n  AEDE_pulpar_JEN?: string;\n  AEDE_apical_JEN?: string;\n  AEDE_pulpar_SEG?: string;\n  AEDE_apical_SEG?: string;\n  AEDE_pulpar_INV?: string;\n  AEDE_apical_INV?: string;\n  AEDE_pulpar_FINAL?: string;\n  AEDE_apical_FINAL?: string;\n  \n  discrepancia?: boolean | string;\n  \n  tto_realizado?: string;\n  fecha_tto?: string;\n  \n  control_1m_exito?: string;\n  control_3m_exito?: string;\n  control_6m_exito?: string;\n  \n  notes?: string;\n}\n\nexport async function obtenerDatosInvestigacion(user: User | null): Promise<CasoInvestigacion[]> {\n  if (!user) {\n    throw new Error('Usuario no autenticado');\n  }\n\n  console.log(\"🔬 Obteniendo todos los casos para investigación desde Supabase\");\n\n  const { data, error } = await supabase\n    .from('cases')\n    .select('*')\n    .order('date', { ascending: false });\n\n  if (error) {\n    console.error(\"Error obteniendo datos de investigación:\", error);\n    throw new Error('Error al obtener datos de investigación');\n  }\n  \n  console.log(\"✅ Datos de investigación obtenidos:\", data?.length || 0, \"casos\");\n  \n  return (data || []).map(caso => ({\n    ...caso,\n    clinico_email: caso.clinicoEmail || caso.clinico_email\n  }));\n}\n","path":null,"size_bytes":1944,"size_tokens":null},"ENDOIA/client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"ENDOIA/server/auth-middleware.ts":{"content":"import type { Request, Response, NextFunction } from 'express';\nimport { initializeApp, cert, getApps, getApp } from 'firebase-admin/app';\nimport { getAuth } from 'firebase-admin/auth';\n\nif (getApps().length === 0) {\n  initializeApp({\n    projectId: process.env.FIREBASE_PROJECT_ID || 'endoia',\n  });\n}\n\nconst ROLE_BY_EMAIL: Record<string, string> = {\n  'jennifer.endoia@gmail.com': 'tutor',\n  'segura.endoia@gmail.com': 'tutor',\n  'ague220601@gmail.com': 'tutor',\n  'investigador.endoia@gmail.com': 'investigador',\n  'ague2206@gmail.com': 'investigador',\n};\n\nconst EMAIL_TO_TOKEN: Record<string, string> = {\n  'jennifer.endoia@gmail.com': 'JEN_MARTIN_2025',\n  'segura.endoia@gmail.com': 'SEGURA_2025',\n  'ague220601@gmail.com': 'JEN_MARTIN_2025',\n  'investigador.endoia@gmail.com': 'INVESTIGADOR_2025',\n  'ague2206@gmail.com': 'INVESTIGADOR_2025',\n};\n\nexport interface AuthenticatedRequest extends Request {\n  userEmail?: string;\n  userRole?: string;\n  n8nToken?: string;\n}\n\nexport async function validateFirebaseToken(\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const authHeader = req.headers.authorization;\n    \n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\n      return res.status(401).json({ error: 'No autorizado: falta token' });\n    }\n\n    const token = authHeader.split('Bearer ')[1];\n\n    const decodedToken = await getAuth().verifyIdToken(token);\n    const email = decodedToken.email;\n\n    if (!email) {\n      return res.status(401).json({ error: 'Token no contiene email' });\n    }\n\n    req.userEmail = email.toLowerCase();\n    req.userRole = ROLE_BY_EMAIL[req.userEmail] || 'clinico';\n    req.n8nToken = EMAIL_TO_TOKEN[req.userEmail] || '';\n\n    next();\n  } catch (error) {\n    console.error('Error validando token Firebase:', error);\n    return res.status(401).json({ error: 'Token inválido o expirado' });\n  }\n}\n\nexport function requireRole(...allowedRoles: string[]) {\n  return (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n    if (!req.userRole) {\n      return res.status(401).json({ error: 'No autenticado' });\n    }\n\n    if (!allowedRoles.includes(req.userRole)) {\n      return res.status(403).json({ error: 'Acceso denegado: rol insuficiente' });\n    }\n\n    next();\n  };\n}\n","path":null,"size_bytes":2270,"size_tokens":null},"ENDOIA/client/src/auth/roles.ts":{"content":"export type UserRole = 'clinico' | 'tutor' | 'investigador';\n\nexport const ROLE_BY_EMAIL: Record<string, UserRole> = {\n  'jennifer.endoia@gmail.com': 'tutor',\n  'jenifer.margon@gmail.com': 'tutor',\n  'segura.endoia@gmail.com': 'tutor',\n  'sevillaendous@gmail.com': 'tutor',\n  'ague220601@gmail.com': 'tutor',\n  'investigador.endoia@gmail.com': 'investigador',\n  'ague2206@gmail.com': 'investigador',\n};\n\nexport function getRoleFromEmail(email: string | null | undefined): UserRole {\n  if (!email) return 'clinico';\n  const lower = email.toLowerCase();\n  return ROLE_BY_EMAIL[lower] ?? 'clinico';\n}\n","path":null,"size_bytes":598,"size_tokens":null},"ENDOIA/server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { validateFirebaseToken, requireRole, type AuthenticatedRequest } from \"./auth-middleware\";\nimport { openai } from \"./openaiClient\";\n\nasync function downloadImageAsBuffer(imageUrl: string): Promise<{ buffer: Buffer; contentType: string }> {\n  const response = await fetch(imageUrl);\n  if (!response.ok) {\n    throw new Error(\"No se pudo descargar la imagen\");\n  }\n  const arrayBuffer = await response.arrayBuffer();\n  const buffer = Buffer.from(arrayBuffer);\n  const contentType = response.headers.get('content-type') || 'image/jpeg';\n  return { buffer, contentType };\n}\n\nfunction bufferToBase64DataUrl(buffer: Buffer, contentType: string): string {\n  const base64 = buffer.toString('base64');\n  return `data:${contentType};base64,${base64}`;\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  app.get(\"/api/health\", (req, res) => {\n    res.json({ status: \"ok\", timestamp: new Date().toISOString() });\n  });\n\n  app.post(\"/api/vision-detect-teeth\", async (req, res) => {\n    try {\n      const { imageUrl, targetFdi } = req.body as {\n        imageUrl: string;\n        targetFdi: number;\n      };\n\n      if (!imageUrl) {\n        return res.status(400).json({ error: \"imageUrl requerido\" });\n      }\n\n      console.log(\"🦷 Verificando diente FDI:\", targetFdi);\n\n      let imageData: string;\n      try {\n        const { buffer, contentType } = await downloadImageAsBuffer(imageUrl);\n        imageData = bufferToBase64DataUrl(buffer, contentType);\n        console.log(\"✅ Imagen descargada, tamaño:\", buffer.length, \"bytes\");\n      } catch (fetchErr) {\n        console.error(\"❌ Error descargando imagen:\", fetchErr);\n        return res.status(500).json({ error: \"Error descargando imagen\" });\n      }\n\n      const detectPrompt = `You are a dental radiograph verification system using FDI (ISO 3950) notation.\n\nYour task: Check if tooth FDI ${targetFdi} is visible in this periapical radiograph.\nDO NOT crop or modify the image. Just verify presence.\n\n**FDI NUMBERING SYSTEM:**\n\nFirst digit = QUADRANT (1=upper right, 2=upper left, 3=lower left, 4=lower right)\nSecond digit = TOOTH POSITION (1-8 from midline outward):\n1=Central incisor, 2=Lateral incisor, 3=Canine, 4=1st premolar, 5=2nd premolar, 6=1st molar, 7=2nd molar, 8=3rd molar\n\n**Reference:**\nQ1 (upper right): 11-18 | Q2 (upper left): 21-28 | Q3 (lower left): 31-38 | Q4 (lower right): 41-48\n\nFor FDI ${targetFdi}: Quadrant ${Math.floor(targetFdi / 10)} (${['', 'upper right', 'upper left', 'lower left', 'lower right'][Math.floor(targetFdi / 10)]}), Tooth ${targetFdi % 10} (${['', 'central incisor', 'lateral incisor', 'canine', '1st premolar', '2nd premolar', '1st molar', '2nd molar', '3rd molar'][targetFdi % 10]})\n\nReturn ONLY valid JSON:\n\n{\n  \"detected\": true | false,\n  \"fdi\": ${targetFdi},\n  \"toothName\": \"name of tooth ${targetFdi}\",\n  \"confidence\": 0.0-1.0,\n  \"notes\": \"brief explanation\"\n}`;\n\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          { role: \"system\", content: detectPrompt },\n          {\n            role: \"user\",\n            content: [\n              {\n                type: \"text\",\n                text: `Is tooth FDI ${targetFdi} visible in this radiograph? Return JSON only.`,\n              },\n              {\n                type: \"image_url\",\n                image_url: { url: imageData },\n              },\n            ],\n          },\n        ],\n        max_tokens: 200,\n      });\n\n      const content = completion.choices[0]?.message?.content;\n      if (!content) {\n        return res.status(500).json({ error: \"Respuesta vacía del modelo\" });\n      }\n\n      let text = content.replace(/```json\\s*/gi, \"\").replace(/```\\s*/g, \"\").trim();\n      console.log(\"🦷 Respuesta verificación:\", text);\n\n      const firstBrace = text.indexOf(\"{\");\n      const lastBrace = text.lastIndexOf(\"}\");\n      if (firstBrace === -1 || lastBrace === -1) {\n        return res.json({\n          detected: false,\n          fdi: targetFdi,\n          confidence: 0,\n          notes: \"No se pudo verificar el diente\"\n        });\n      }\n\n      const parsed = JSON.parse(text.slice(firstBrace, lastBrace + 1));\n\n      return res.json({\n        detected: Boolean(parsed.detected),\n        fdi: parsed.fdi || targetFdi,\n        toothName: parsed.toothName || \"\",\n        confidence: parsed.confidence || 0,\n        notes: parsed.notes || \"\"\n      });\n\n    } catch (err) {\n      console.error(\"Error en /api/vision-detect-teeth:\", err);\n      return res.json({\n        detected: false,\n        fdi: req.body.targetFdi,\n        confidence: 0,\n        notes: \"Error verificando diente\"\n      });\n    }\n  });\n\n  app.post(\"/api/vision-analyze\", async (req, res) => {\n    try {\n      const { imageUrl, tipo, momento } = req.body as {\n        imageUrl: string;\n        tipo: \"periapical\" | \"cbct\";\n        momento: string;\n      };\n\n      if (!imageUrl) {\n        return res.status(400).json({ error: \"imageUrl requerido\" });\n      }\n\n      console.log(\"🔗 URL de imagen recibida:\", imageUrl);\n\n      // Descargar imagen y convertir a base64\n      let imageData: string;\n      try {\n        const imageResponse = await fetch(imageUrl);\n        if (!imageResponse.ok) {\n          return res.status(400).json({ error: \"No se pudo descargar la imagen\" });\n        }\n        const arrayBuffer = await imageResponse.arrayBuffer();\n        const base64 = Buffer.from(arrayBuffer).toString('base64');\n        const contentType = imageResponse.headers.get('content-type') || 'image/jpeg';\n        imageData = `data:${contentType};base64,${base64}`;\n        console.log(\"✅ Imagen convertida a base64, tamaño:\", base64.length, \"chars\");\n      } catch (fetchErr) {\n        console.error(\"❌ Error descargando imagen:\", fetchErr);\n        return res.status(500).json({ error: \"Error descargando imagen para análisis\" });\n      }\n\n      const systemPrompt = `You are ENDOIA Vision, an AI radiographic assistant designed for endodontists.\n\nYour job is to analyze periapical radiographs and extract objective findings ONLY.\nYour output must ALWAYS be a valid JSON object with no code block delimiters.\n\nBefore analyzing, apply these core rules:\n\n1. **Immature teeth rule (CRITICAL):**\n   If the tooth shows open apices due to root development (wide apical foramen, funnel-shaped apex, incomplete root formation), this is NORMAL anatomy.\n   - Do NOT classify this as periapical pathology.\n   - Do NOT mark radiolucency.\n   - Do NOT mark PDL widening.\n   - Do NOT say the lamina dura is lost if the tooth is immature.\n   - **PAI MUST be 1** unless there is a clear, discrete, well-demarcated periapical lesion beyond the area of normal root development.\n\n2. **PAI scoring rules (Ørstavik Index):**\n   Use ONLY these definitions:\n   - PAI 1: Normal periapical structures.\n   - PAI 2: Small changes in bone structure.\n   - PAI 3: Changes in bone structure with some mineral loss.\n   - PAI 4: Well-defined radiolucent area.\n   - PAI 5: Severe radiolucency with exacerbating features.\n\n   A tooth with an **open apex** CANNOT be assigned PAI > 1 unless the radiolucency is **separate from** the developing apex.\n\n3. **Report ONLY objective findings:**\n   - pai (integer 1–5)\n   - radiolucencyDetected (true/false)\n   - lesionDiameterMm (number or null)\n   - laminaDuraIntact (true/false/null)\n   - pdlWidening (\"normal\" | \"mild\" | \"moderate\" | \"severe\")\n   - borders (\"well-defined\" | \"ill-defined\" | null)\n   - comments (short explanation)\n\nIf immature root development is present:\n→ pai = 1\n→ radiolucencyDetected = false\n→ lesionDiameterMm = 0\n→ laminaDuraIntact = true\n→ pdlWidening = \"normal\"\n\nReturn ONLY valid JSON with no markdown:\n\n{\n  \"pai\": ...,\n  \"radiolucencyDetected\": ...,\n  \"lesionDiameterMm\": ...,\n  \"laminaDuraIntact\": ...,\n  \"pdlWidening\": \"...\",\n  \"borders\": \"...\",\n  \"comments\": \"...\"\n}`;\n\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          { role: \"system\", content: systemPrompt },\n          {\n            role: \"user\",\n            content: [\n              {\n                type: \"text\",\n                text: \"This is a dental periapical radiograph. Analyze the visible teeth and periapical structures. You MUST respond with ONLY a valid JSON object containing the analysis fields (pai, radiolucencyDetected, lesionDiameterMm, laminaDuraIntact, pdlWidening, borders, comments). No other text allowed.\",\n              },\n              {\n                type: \"image_url\",\n                image_url: { url: imageData, detail: \"high\" },\n              },\n            ],\n          },\n        ],\n        max_tokens: 400,\n      });\n\n      const content = completion.choices[0]?.message?.content;\n\n      if (!content) {\n        return res.status(500).json({ error: \"Respuesta vacía del modelo de visión\" });\n      }\n\n      let text: string = typeof content === \"string\" ? content : String(content);\n      \n      console.log(\"📸 Respuesta raw de GPT-4o Vision:\", text);\n\n      // Eliminar bloques de código markdown si existen\n      text = text.replace(/```json\\s*/gi, \"\").replace(/```\\s*/g, \"\").trim();\n\n      const firstBrace = text.indexOf(\"{\");\n      const lastBrace = text.lastIndexOf(\"}\");\n      if (firstBrace === -1 || lastBrace === -1) {\n        console.error(\"❌ No se encontró JSON en respuesta:\", text);\n        \n        // Si la IA no puede analizar la imagen, devolver valores por defecto\n        // en lugar de fallar completamente\n        if (text.toLowerCase().includes(\"unable to\") || \n            text.toLowerCase().includes(\"cannot\") ||\n            text.toLowerCase().includes(\"can't\")) {\n          console.log(\"⚠️ IA rechazó análisis, usando valores por defecto\");\n          return res.json({\n            pai: null,\n            radiolucencyDetected: false,\n            lesionDiameterMm: null,\n            laminaDuraIntact: null,\n            pdlWidening: null,\n            borders: null,\n            comments: \"Análisis automático no disponible - verificar imagen manualmente\"\n          });\n        }\n        \n        return res.status(500).json({\n          error: \"La IA no devolvió un JSON reconocible\",\n          raw: text,\n        });\n      }\n\n      const jsonText = text.slice(firstBrace, lastBrace + 1);\n      let parsed: any;\n\n      try {\n        parsed = JSON.parse(jsonText);\n      } catch (err) {\n        console.error(\"Error parseando JSON de OpenAI:\", err, jsonText);\n        return res.status(500).json({\n          error: \"No se pudo parsear el JSON devuelto por la IA\",\n          raw: jsonText,\n        });\n      }\n\n      const result = {\n        pai: typeof parsed.pai === \"number\" ? parsed.pai : null,\n        radiolucencyDetected: Boolean(parsed.radiolucencyDetected),\n        lesionDiameterMm:\n          typeof parsed.lesionDiameterMm === \"number\"\n            ? parsed.lesionDiameterMm\n            : null,\n        laminaDuraIntact:\n          typeof parsed.laminaDuraIntact === \"boolean\" ||\n          parsed.laminaDuraIntact === null\n            ? parsed.laminaDuraIntact\n            : null,\n        pdlWidening: parsed.pdlWidening ?? null,\n        borders: parsed.borders ?? null,\n        comments: typeof parsed.comments === \"string\" ? parsed.comments : \"\",\n      };\n\n      return res.json(result);\n    } catch (err) {\n      console.error(\"Error en /api/vision-analyze:\", err);\n      return res.status(500).json({ error: \"Error interno en análisis IA\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":11656,"size_tokens":null},"ENDOIA/client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"ENDOIA/client/src/pages/TutorPage.tsx":{"content":"import TutorView from '@/components/TutorView';\nimport Navbar from '@/components/Navbar';\n\nexport default function TutorPage() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navbar />\n      <main className=\"container mx-auto px-4 py-6\">\n        <TutorView />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":313,"size_tokens":null},"ENDOIA/server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":2210,"size_tokens":null},"ENDOIA/server/storage.ts":{"content":"import { type User, type InsertUser } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n\n  constructor() {\n    this.users = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n}\n\nexport const storage = new MemStorage();\n","path":null,"size_bytes":993,"size_tokens":null},"ENDOIA/replit.md":{"content":"# ENDOIA — Endodontic Diagnostic & Analytics Assistant\n\n## Overview\nENDOIA (Endodontic Diagnostic & Analytics Assistant) is an AI-powered diagnostic support tool for endodontic professionals. Its primary purpose is to assist in pulpal and apical diagnosis using an AI-driven analysis system based on the official AAE-ESE 2025 classification. The application aims to streamline clinical case management, facilitate expert validation by tutors, and provide research insights for investigators.\n\n## User Preferences\nI prefer the AI to be concise and to the point.\nI value clear architectural explanations over granular code details.\nI expect the AI to maintain the established design patterns and technology stack.\nI want the AI to understand and respect the defined user roles and their associated permissions.\nI prefer that major changes or new features are discussed before implementation, especially concerning the core AI diagnostic logic or external integrations.\nDo not make changes to the `attached_assets/` folder.\n\n## System Architecture\n\n### UI/UX Decisions\nThe frontend is built with React, styled using Tailwind CSS for a modern, responsive design. Radix UI components ensure accessibility and a consistent look and feel. The application incorporates a professional, responsive table design for desktop and card-based views for mobile in the \"My Cases\" section. Theming is role-based: clinicians get a dark theme, while tutors and investigators use a light theme. Mobile navigation is handled via a hamburger menu (Sheet component) that displays all role-specific navigation options, ensuring full accessibility across all device sizes.\n\n### Technical Implementations\nThe application follows a full-stack architecture:\n-   **Frontend**: React 18, Vite, Tailwind CSS, Radix UI, React Hook Form with Zod, Wouter for routing, and TanStack Query for state management.\n-   **Backend**: Node.js 20 with Express 4.x and TypeScript. Minimal backend serving static files and health check endpoint.\n-   **Authentication**: Firebase Authentication with Google login is used for user management. A robust role-based access control (RBAC) system is implemented, distinguishing between `clinico`, `tutor`, and `investigador` roles based on verified Firebase email claims.\n-   **Database**: **Supabase** (PostgreSQL) as the primary database. Direct client-side connection using `@supabase/supabase-js`. All CRUD operations are performed directly from the frontend.\n-   **PWA**: The application is configured as a Progressive Web App (PWA) with a manifest and service worker, enabling installability.\n\n### Feature Specifications\n-   **AI Diagnostic Module**: Integrates the AAE-ESE 2025 classification system for pulpal and apical diagnosis (`IA_AAE_ESE.js` and `IA_AAE_ESE_adapter.ts`). Includes automatic clinical recommendations system (`recomendacionesBiblioteca.ts`) that generates personalized guidance based on AAE/ESE 2025, IADT, and ADA/AAE 2024 protocols. Recommendations include: analgesia protocols, action plans, urgency levels (4 tiers), antibiotic indication, and additional clinical notes.\n-   **Case Registration**: Clinicians can register new cases with detailed clinical and radiographic data.\n-   **Enhanced Clinician Dashboard** (`MisCasos.tsx`): Comprehensive case management panel with advanced analytics (November 2025 upgrade):\n    - **Enhanced Statistics**: Top-level cards showing total cases, completed follow-ups, pending controls, and average success rate\n    - **Pending Follow-ups Widget**: Interactive cards for 1m, 3m, and 6m pending controls\n    - **Cases Table**: Responsive table with intelligent ordering by next pending control; supports filtering by follow-up type or FDI tooth number\n    - **Enhanced Case Modal**: Updated diagnosis display with prominent badges for pulpal/apical AI diagnoses and highlighted therapeutic guidance\n    - **Complex Cases Indicator**: Automatic detection and percentage of high-complexity cases (PAI≥3, radiolucency, probing>4mm, spontaneous pain)\n    - **Data Quality Metrics**: Progress bars tracking notes completion, key field completeness, and control registration rates\n    - **Personal Statistics** (Recharts graphs):\n      - Monthly case trend (12-month rolling window with line chart)\n      - Success rate by treatment type with horizontal bars\n      - Pulpal diagnosis distribution using official AAE/ESE 2025 categories (pie chart)\n    - **Tooth History**: Collapsible cards grouping cases by FDI tooth number with treatment chronology\n    - **Failed Teeth Ranking**: Top 5 teeth with most treatment failures\n    - **FDI Heatmap**: Interactive 32-tooth grid showing case distribution; clicking a tooth opens detailed modal\n    - **FDI Cases Modal**: Full-featured responsive modal (`CasosPorDienteModal.tsx`) displaying all cases for a specific FDI tooth with table (desktop) and card (mobile) views, showing ID, date, diagnoses, treatment, and status\n    - **Modular Architecture**: All dashboard components organized in `client/src/components/clinico/` with shared types (`ClinicoCase`), helpers (`toNumber`, `getDiagnosisColor`, `getCaseQualityScore`), and exports via barrel file (`index.ts`)\n    - **Note**: Dashboard does NOT include any IA vs clinician comparison analytics (as per user requirement)\n-   **Tutor Validation System**: Expert tutors have a complete validation panel (`CasosPendientes.tsx` and `ValidarCaso.tsx`) that shows ONLY clinical data without exposing AI diagnoses. Tutors view pending cases with statistics, review clinical/radiographic findings, and assign official AEDE/ESE 2025 classifications (Gold Standard) for both pulpal and apical conditions. AI diagnosis fields (`pulpalDxIA`, `apicalDxIA`) are sanitized from sessionStorage and UI to maintain validation integrity.\n-   **Investigator Analytics Dashboard**: Comprehensive research analytics panel (`Dashboard.tsx`) with proper validator hierarchy logic:\n    - **Validator Hierarchy**: JEN and SEG are primary validators (compared against each other), while INV is a third validator that ONLY intervenes when JEN ≠ SEG to resolve discrepancies\n    - **Key Performance Indicators**: Total cases, validated cases, JEN≠SEG discrepancies, complete follow-ups\n    - **Temporal Trends**: 12-month rolling window showing new cases, validations, and follow-ups\n    - **Diagnostic Distributions**: Pulpal and apical classifications using AEDE/ESE 2025 taxonomy\n    - **Primary Validator Agreement (JEN vs SEG)**: Cohen's Kappa, percentage agreement, and confusion matrices for both pulpar and apical diagnoses\n    - **Discrepancy Analysis**: Detailed table showing cases where JEN ≠ SEG, displaying all validator labels (JEN, SEG, INV) plus FINAL and IA diagnoses\n    - **INV Resolution Statistics**: Analysis of how INV aligns with JEN or SEG in discrepancy cases (counted separately for pulpar and apical)\n    - **Validators vs FINAL**: Individual comparison of each validator (JEN, SEG, INV) against the gold-standard FINAL diagnosis\n    - **IA Performance Analysis**: AI system compared against JEN, SEG, INV, and FINAL with Kappa coefficients and agreement percentages\n    - **Follow-up Success Rates**: Clinical outcomes at 1m, 3m, 6m including both successes and failures in denominators\n    - **FDI Tooth Analysis**: Top 10 treated teeth by position\n    - **Data Quality Metrics**: Missing field tracking (excluding valid zero values)\n    - **Export Functions**: Separate CSV exports for complete dataset and discrepancy table, plus PNG dashboard export\n-   **Biblioteca Clínica** (`BibliotecaPage.tsx`): Comprehensive clinical reference library accessible to all roles (clinico, tutor, investigador) added November 2025:\n    - **7 Categories**: Clasificación AAE/ESE 2025, Traumatología (IADT), Urgencias Endodónticas, Algoritmos Diagnósticos, Algoritmos de Tratamiento, Recursos Oficiales, FAQ Clínica\n    - **Global Search**: Client-side search filtering across all categories by title, subtitle, description, and tags\n    - **Tabbed Interface**: Clean, responsive tabs for category navigation with category-specific icons\n    - **Content Types**: Multiple content presentation formats (text, tables, lists, step-by-step algorithms, external resource links, collapsible FAQ)\n    - **Editable Data Structure**: All content stored in `client/src/data/bibliotecaClinica.ts` with strongly-typed TypeScript interfaces and TODO comments for clinical review\n    - **Modular Components**: Organized in `client/src/components/biblioteca/` with separate renderers for each content type (ItemTexto, ItemTabla, ItemLista, ItemAlgoritmo, ItemRecurso, ItemFAQ)\n    - **Apple Health Design**: Consistent visual styling with glassmorphic cards, professional color palette, and smooth animations matching clinician dashboard\n    - **Note**: Content is structured for easy editing and clinical validation; marked with TODO comments for review by endodontic specialists\n-   **Role-based Routing & Navigation**: The application dynamically adjusts navigation and page access based on the authenticated user's role. Current role mappings: ague2206@gmail.com (investigador principal), ague220601@gmail.com (tutor).\n-   **Secure API**: All backend endpoints are protected by Firebase token verification and role-based authorization middleware.\n\n### System Design Choices\n-   **Monorepo-like Structure**: `client/`, `server/`, and `shared/` folders organize frontend, backend, and common code.\n-   **Direct Database Access**: Frontend connects directly to Supabase for all CRUD operations, eliminating the need for backend proxies.\n-   **Automated Theming**: UI themes (dark/light) are automatically applied based on the user's role upon login.\n-   **Data Privacy for Validation**: Tutor panels use sessionStorage for navigation (due to wouter router limitations) but sanitize AI diagnosis fields to prevent exposure and maintain blind validation integrity.\n\n## External Dependencies\n\n-   **Firebase Authentication**: Used for user authentication via Google accounts.\n-   **Supabase**: PostgreSQL database with direct client-side access via `@supabase/supabase-js`. The `cases` table stores all clinical case data including:\n    -   Case registration data (case_id, date, clinicoEmail, tooth_fdi, clinical symptoms)\n    -   AI diagnoses (AEDE_pulpar_IA, AEDE_apical_IA)\n    -   Tutor validations (AEDE_pulpar_JEN/SEG/INV, AEDE_apical_JEN/SEG/INV, validado_JEN/SEG/INV)\n    -   Final diagnoses (AEDE_pulpar_FINAL, AEDE_apical_FINAL)\n    -   Treatment data (tto_realizado, fecha_tto)\n    -   Follow-up controls (control_1m/3m/6m_exito, fecha_control_1m/3m/6m)","path":null,"size_bytes":10616,"size_tokens":null},"ENDOIA/server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"ENDOIA/client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"ENDOIA/client/src/components/radiographs/BotonExitoRadiologico.tsx":{"content":"import { useState } from \"react\";\nimport { calcularExitoRadiologico, type ExitoRadiologico } from \"@/lib/radiographs\";\nimport { Calculator, Loader2, CheckCircle, AlertCircle, XCircle, HelpCircle } from \"lucide-react\";\n\ninterface BotonExitoRadiologicoProps {\n  caseId: string;\n  onCalculated?: (resultado: ExitoRadiologico) => void;\n}\n\nconst RESULTADO_CONFIG: Record<ExitoRadiologico, { \n  label: string; \n  color: string; \n  bgColor: string;\n  icon: typeof CheckCircle;\n}> = {\n  exito: { \n    label: 'Éxito', \n    color: 'text-green-700', \n    bgColor: 'bg-green-100 dark:bg-green-900/30',\n    icon: CheckCircle\n  },\n  parcial: { \n    label: 'Curación parcial', \n    color: 'text-yellow-700', \n    bgColor: 'bg-yellow-100 dark:bg-yellow-900/30',\n    icon: AlertCircle\n  },\n  fracaso: { \n    label: 'Fracaso', \n    color: 'text-red-700', \n    bgColor: 'bg-red-100 dark:bg-red-900/30',\n    icon: XCircle\n  },\n  indeterminado: { \n    label: 'Indeterminado', \n    color: 'text-zinc-500', \n    bgColor: 'bg-zinc-100 dark:bg-zinc-800',\n    icon: HelpCircle\n  },\n};\n\nexport function BotonExitoRadiologico({ caseId, onCalculated }: BotonExitoRadiologicoProps) {\n  const [loading, setLoading] = useState(false);\n  const [resultado, setResultado] = useState<ExitoRadiologico | null>(null);\n\n  async function handleCalcular() {\n    setLoading(true);\n    try {\n      const res = await calcularExitoRadiologico(caseId);\n      setResultado(res);\n      onCalculated?.(res);\n    } catch (err) {\n      console.error(\"Error calculando éxito radiológico:\", err);\n      alert(\"Error al calcular. Verifica que existan radiografías baseline y followup.\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (resultado) {\n    const config = RESULTADO_CONFIG[resultado];\n    const Icon = config.icon;\n    \n    return (\n      <div className={`p-3 rounded-lg ${config.bgColor} flex items-center gap-2`}>\n        <Icon className={`w-5 h-5 ${config.color}`} />\n        <div>\n          <p className=\"text-xs text-zinc-500\">Éxito radiológico</p>\n          <p className={`font-bold ${config.color}`}>{config.label}</p>\n        </div>\n        <button \n          onClick={handleCalcular}\n          className=\"ml-auto text-xs text-zinc-500 hover:text-zinc-700 underline\"\n        >\n          Recalcular\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <button \n      onClick={handleCalcular}\n      disabled={loading}\n      className=\"w-full mt-3 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white rounded-lg flex items-center justify-center gap-2 transition-colors\"\n    >\n      {loading ? (\n        <>\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n          Calculando...\n        </>\n      ) : (\n        <>\n          <Calculator className=\"w-4 h-4\" />\n          Calcular éxito radiológico\n        </>\n      )}\n    </button>\n  );\n}\n","path":null,"size_bytes":2856,"size_tokens":null},"ENDOIA/client/src/components/PWAInstallButton.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Download } from 'lucide-react';\n\nexport default function PWAInstallButton() {\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\n  const [visible, setVisible] = useState(false);\n\n  useEffect(() => {\n    const handler = (e: any) => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n      setVisible(true);\n    };\n\n    window.addEventListener('beforeinstallprompt', handler);\n\n    return () => window.removeEventListener('beforeinstallprompt', handler);\n  }, []);\n\n  const install = async () => {\n    if (!deferredPrompt) return;\n    deferredPrompt.prompt();\n    const result = await deferredPrompt.userChoice;\n    setDeferredPrompt(null);\n    setVisible(false);\n  };\n\n  if (!visible) return null;\n\n  return (\n    <Button\n      onClick={install}\n      variant=\"outline\"\n      size=\"sm\"\n      className=\"gap-2\"\n    >\n      <Download className=\"w-4 h-4\" />\n      <span className=\"hidden sm:inline\">Instalar ENDOIA</span>\n    </Button>\n  );\n}\n","path":null,"size_bytes":1063,"size_tokens":null},"ENDOIA/client/src/components/radiographs/index.ts":{"content":"export { SubirRadiografia } from './SubirRadiografia';\nexport { ListaRadiografias } from './ListaRadiografias';\nexport { GraficaPAI } from './GraficaPAI';\nexport { BotonExitoRadiologico } from './BotonExitoRadiologico';\n","path":null,"size_bytes":220,"size_tokens":null},"ENDOIA/client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"ENDOIA/client/src/components/clinico/SeguimientosPendientes.tsx":{"content":"import { ClinicoCase } from './types';\nimport { toNumber } from './helpers';\nimport { Bell, AlertCircle } from 'lucide-react';\n\ninterface SeguimientosPendientesProps {\n  casos: ClinicoCase[];\n  activeFilter: string | null;\n  onFilterClick: (filterType: string | null) => void;\n}\n\nexport function SeguimientosPendientes({ casos, activeFilter, onFilterClick }: SeguimientosPendientesProps) {\n  const pendientes = {\n    oneMonth: 0,\n    threeMonths: 0,\n    sixMonths: 0,\n    sinTratamiento: 0\n  };\n  \n  casos.forEach(caso => {\n    if (!caso.fecha_tto || caso.fecha_tto.trim() === '') {\n      pendientes.sinTratamiento++;\n    } else {\n      if (toNumber(caso.control_1m_exito) === 0) pendientes.oneMonth++;\n      if (toNumber(caso.control_3m_exito) === 0) pendientes.threeMonths++;\n      if (toNumber(caso.control_6m_exito) === 0) pendientes.sixMonths++;\n    }\n  });\n\n  return (\n    <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6\">\n      <div className=\"flex items-center gap-2 mb-6\">\n        <Bell className=\"w-5 h-5\" style={{ color: '#F5A623' }} />\n        <h3 className=\"text-lg font-semibold tracking-tight\">Seguimientos y tratamientos pendientes</h3>\n      </div>\n      \n      <div className=\"grid grid-cols-4 gap-4 mb-4\">\n        <button\n          onClick={() => onFilterClick(activeFilter === '1m' ? null : '1m')}\n          className={`text-center p-4 rounded-xl transition-all duration-300 hover:scale-[1.02] cursor-pointer ${\n            activeFilter === '1m' ? 'ring-2 ring-orange-500' : ''\n          }`}\n          style={{ backgroundColor: 'rgba(245, 166, 35, 0.08)' }}\n        >\n          <p className=\"text-3xl font-bold tracking-tight\" style={{ color: '#F5A623' }}>{pendientes.oneMonth}</p>\n          <p className=\"text-xs text-zinc-400 font-medium mt-2 tracking-wide\">Control 1m</p>\n        </button>\n        <button\n          onClick={() => onFilterClick(activeFilter === '3m' ? null : '3m')}\n          className={`text-center p-4 rounded-xl transition-all duration-300 hover:scale-[1.02] cursor-pointer ${\n            activeFilter === '3m' ? 'ring-2 ring-orange-500' : ''\n          }`}\n          style={{ backgroundColor: 'rgba(245, 166, 35, 0.08)' }}\n        >\n          <p className=\"text-3xl font-bold tracking-tight\" style={{ color: '#F5A623' }}>{pendientes.threeMonths}</p>\n          <p className=\"text-xs text-zinc-400 font-medium mt-2 tracking-wide\">Control 3m</p>\n        </button>\n        <button\n          onClick={() => onFilterClick(activeFilter === '6m' ? null : '6m')}\n          className={`text-center p-4 rounded-xl transition-all duration-300 hover:scale-[1.02] cursor-pointer ${\n            activeFilter === '6m' ? 'ring-2 ring-orange-500' : ''\n          }`}\n          style={{ backgroundColor: 'rgba(245, 166, 35, 0.08)' }}\n        >\n          <p className=\"text-3xl font-bold tracking-tight\" style={{ color: '#F5A623' }}>{pendientes.sixMonths}</p>\n          <p className=\"text-xs text-zinc-400 font-medium mt-2 tracking-wide\">Control 6m</p>\n        </button>\n        <button\n          onClick={() => onFilterClick(activeFilter === 'sin-tratamiento' ? null : 'sin-tratamiento')}\n          className={`text-center p-4 rounded-xl transition-all duration-300 hover:scale-[1.02] cursor-pointer ${\n            activeFilter === 'sin-tratamiento' ? 'ring-2 ring-red-500' : ''\n          }`}\n          style={{ backgroundColor: 'rgba(239, 68, 68, 0.08)' }}\n        >\n          <p className=\"text-3xl font-bold tracking-tight\" style={{ color: '#EF4444' }}>{pendientes.sinTratamiento}</p>\n          <p className=\"text-xs text-zinc-400 font-medium mt-2 tracking-wide\">Sin tratamiento</p>\n        </button>\n      </div>\n      \n      {activeFilter && (\n        <div className=\"mt-4 flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400\">\n          <AlertCircle className=\"w-4 h-4\" />\n          <span>\n            {activeFilter === '1m' && 'Mostrando casos con control de 1 mes pendiente'}\n            {activeFilter === '3m' && 'Mostrando casos con control de 3 meses pendiente'}\n            {activeFilter === '6m' && 'Mostrando casos con control de 6 meses pendiente'}\n            {activeFilter === 'sin-tratamiento' && 'Mostrando casos sin tratamiento registrado'}\n          </span>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":4314,"size_tokens":null},"ENDOIA/client/src/pages/InvestigadorPage.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { FlaskConical, Database, BarChart3, Download } from 'lucide-react';\nimport Navbar from '@/components/Navbar';\n\nexport default function InvestigadorPage() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navbar />\n      <main className=\"container mx-auto px-4 py-6\">\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FlaskConical className=\"w-5 h-5 text-primary\" />\n                Panel de Investigación\n              </CardTitle>\n              <CardDescription>\n                Acceso completo a datos, análisis y controles del estudio\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base flex items-center gap-2\">\n                      <Database className=\"w-4 h-4\" />\n                      Datos Completos\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-sm text-muted-foreground mb-3\">\n                      Accede a todos los casos clínicos del estudio\n                    </p>\n                    <Button variant=\"outline\" className=\"w-full gap-2\" disabled>\n                      <Download className=\"w-4 h-4\" />\n                      Descargar Dataset\n                    </Button>\n                    <Badge variant=\"secondary\" className=\"mt-2 w-full justify-center\">\n                      Próximamente\n                    </Badge>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base flex items-center gap-2\">\n                      <BarChart3 className=\"w-4 h-4\" />\n                      Análisis Estadístico\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-sm text-muted-foreground mb-3\">\n                      Métricas de concordancia IA vs Tutores\n                    </p>\n                    <Button variant=\"outline\" className=\"w-full gap-2\" disabled>\n                      Ver Análisis\n                    </Button>\n                    <Badge variant=\"secondary\" className=\"mt-2 w-full justify-center\">\n                      En desarrollo\n                    </Badge>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base flex items-center gap-2\">\n                      <FlaskConical className=\"w-4 h-4\" />\n                      Control de Calidad\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-sm text-muted-foreground mb-3\">\n                      Revisión de casos con discrepancia\n                    </p>\n                    <Button variant=\"outline\" className=\"w-full gap-2\" disabled>\n                      Ver Casos\n                    </Button>\n                    <Badge variant=\"secondary\" className=\"mt-2 w-full justify-center\">\n                      Próximamente\n                    </Badge>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"mt-6 p-4 bg-muted rounded-lg\">\n                <h3 className=\"font-semibold mb-2\">Acceso Completo del Investigador</h3>\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\n                  <li>✅ Vista de Casos Clínicos (crear y enviar casos)</li>\n                  <li>✅ Vista de Validación (validar como tutor)</li>\n                  <li>🔜 Dashboard de investigación con métricas</li>\n                  <li>🔜 Exportación de datos a CSV/Excel</li>\n                  <li>🔜 Análisis de concordancia Kappa</li>\n                </ul>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":4408,"size_tokens":null},"ENDOIA/client/src/lib/IA_AAE_ESE_adapter.ts":{"content":"// Adaptador para integrar el módulo AAE-ESE 2025 con el formulario existente\nimport { \n  diagnoseEndoAAE_ESE_2025, \n  type CaseData, \n  type PulpDiagnosis, \n  type ApicalDiagnosis \n} from \"./IA_AAE_ESE_2025\";\nimport { \n  generarRecomendacionesBiblioteca, \n  formatearRecomendaciones,\n  type RecomendacionesClinicas \n} from \"./recomendacionesBiblioteca\";\n\n/**\n * Mapeo de términos AAE/ESE 2025 (inglés → español)\n * El motor IA devuelve términos en inglés, pero el sistema usa español como lengua canónica\n */\nconst TERMINOS_PULPARES_ES: Record<PulpDiagnosis, string> = {\n  \"clinically_normal_pulp\": \"Pulpa clínicamente normal\",\n  \"hypersensitive_pulp\": \"Hipersensibilidad pulpar\",\n  \"mild_pulpitis\": \"Pulpitis leve\",\n  \"severe_pulpitis\": \"Pulpitis severa\",\n  \"pulp_necrosis\": \"Necrosis pulpar\",\n  \"inconclusive_pulp_status\": \"Estado pulpar inconcluso\",\n  \"previously_initiated_root_canal_treatment\": \"Tratamiento de conductos iniciado previamente\",\n  \"previously_obturated_root_canal\": \"Conducto radicular previamente obturado\",\n  \"previous_regenerative_endodontic_treatment\": \"Tratamiento regenerativo endodóntico previo\"\n};\n\nconst TERMINOS_APICALES_ES: Record<ApicalDiagnosis, string> = {\n  \"clinically_normal_apical_tissues\": \"Tejidos apicales clínicamente normales\",\n  \"apical_hypersensitivity\": \"Hipersensibilidad apical\",\n  \"localized_symptomatic_apical_periodontitis\": \"Periodontitis apical sintomática localizada\",\n  \"localized_asymptomatic_apical_periodontitis\": \"Periodontitis apical asintomática localizada\",\n  \"localized_apical_periodontitis_with_sinus_tract\": \"Periodontitis apical con tracto sinusal\",\n  \"apical_periodontitis_with_systemic_involvement\": \"Periodontitis apical con afectación sistémica\",\n  \"healing_apical_tissue\": \"Tejido apical en curación\",\n  \"inconclusive_apical_condition\": \"Estado apical inconcluso\"\n};\n\ninterface DatosClinico {\n  dolorEspontaneo: string;\n  respuestaFrio: string;\n  lingeringSeg: string;\n  percusionDolor: string;\n  radiolucidezApical: string;\n  profundidadCaries: string;\n  sangradoControlable: string;\n  sinusTractPresent?: string;\n  systemicInvolvement?: string;\n  previousTreatment?: string;\n  apicalPalpationPain?: string;\n  notas?: string;\n}\n\ninterface ResultadoIA {\n  pulpalDxIA: string;\n  apicalDxIA: string;\n  ttoPropuestoIA: string;\n  recomendaciones: RecomendacionesClinicas;\n  recomendacionesTexto: string;\n  flags: string[];\n}\n\n/**\n * Normaliza profundidad de caries del español al inglés para el motor AAE-ESE 2025\n */\nfunction normalizeDepthOfCaries(profundidad?: string): string {\n  if (!profundidad) return \"none\";\n  const p = profundidad.toLowerCase().trim();\n  \n  if (p === \"extrema\" || p === \"extreme\") return \"extreme\";\n  if (p === \"profunda\" || p === \"deep\") return \"deep\";\n  if (p === \"moderada\" || p === \"moderate\") return \"moderate\";\n  if (p === \"superficial\" || p === \"shallow\") return \"shallow\";\n  \n  return \"none\";\n}\n\n/**\n * Convierte datos del formulario al formato CaseData del motor AAE-ESE 2025\n */\nfunction convertirDatosAAE_ESE(datos: DatosClinico): CaseData {\n  // Mapear respuesta al frío\n  let thermalColdResponse: string;\n  switch (datos.respuestaFrio) {\n    case \"0_no_responde\":\n      thermalColdResponse = \"none\";\n      break;\n    case \"2_aumentada\":\n      thermalColdResponse = \"increased\";\n      break;\n    case \"1_normal\":\n    default:\n      thermalColdResponse = \"normal\";\n      break;\n  }\n\n  // Estimar PAI basándose en radiolucidez y percusión\n  let estimatedPAI: string;\n  if (datos.radiolucidezApical === \"si\") {\n    if (datos.percusionDolor === \"si\") {\n      estimatedPAI = \"4\";\n    } else {\n      estimatedPAI = \"3\";\n    }\n  } else if (datos.percusionDolor === \"si\") {\n    estimatedPAI = \"2\";\n  } else {\n    estimatedPAI = \"1\";\n  }\n\n  // Estimar ensanchamiento PDL\n  let pdlWidening: string;\n  if (datos.radiolucidezApical === \"si\") {\n    pdlWidening = \"moderate\";\n  } else if (datos.percusionDolor === \"si\") {\n    pdlWidening = \"mild\";\n  } else {\n    pdlWidening = \"none\";\n  }\n\n  return {\n    spontaneous_pain_yesno: datos.dolorEspontaneo === \"si\" ? \"yes\" : \"no\",\n    thermal_cold_response: thermalColdResponse,\n    lingering_pain_seconds: datos.lingeringSeg || \"0\",\n    percussion_pain_yesno: datos.percusionDolor === \"si\" ? \"yes\" : \"no\",\n    apical_palpation_pain: datos.apicalPalpationPain === \"si\" ? \"yes\" : \"no\",\n    sinus_tract_present: datos.sinusTractPresent === \"si\" ? \"yes\" : \"no\",\n    systemic_involvement: datos.systemicInvolvement === \"si\" ? \"yes\" : \"no\",\n    depth_of_caries: normalizeDepthOfCaries(datos.profundidadCaries),\n    previous_treatment: datos.previousTreatment || \"none\",\n    periapical_index_pai_1_5: estimatedPAI,\n    radiolucency_yesno: datos.radiolucidezApical === \"si\" ? \"yes\" : \"no\",\n    pdl_widening: pdlWidening,\n  };\n}\n\n/**\n * Sugiere tratamiento basado en diagnósticos AAE-ESE 2025 (en español)\n */\nfunction sugerirTratamiento(pulpar: string, apical: string, sangradoControlable: string): string {\n  // Casos de tratamiento previo\n  if (pulpar === \"Conducto radicular previamente obturado\") {\n    if (apical.includes(\"periodontitis\")) {\n      return \"Retratamiento endodóntico (re-RCT) o cirugía apical\";\n    }\n    return \"Observación y control periódico\";\n  }\n\n  if (pulpar === \"Tratamiento de conductos iniciado previamente\") {\n    return \"Completar tratamiento de conductos (RCT)\";\n  }\n\n  if (pulpar === \"Tratamiento regenerativo endodóntico previo\") {\n    if (apical.includes(\"periodontitis\")) {\n      return \"Evaluar retratamiento o cirugía apical\";\n    }\n    return \"Control y seguimiento del tratamiento regenerativo\";\n  }\n\n  // Casos de pulpa vital\n  if (pulpar === \"Pulpa clínicamente normal\") {\n    return \"Restaurar o proteger estructura; no endodoncia indicada\";\n  }\n  \n  if (pulpar === \"Hipersensibilidad pulpar\") {\n    return \"Protección dentinaria / sellado y control; no endodoncia inicial\";\n  }\n  \n  if (pulpar === \"Pulpitis leve\") {\n    return \"Tratamiento restaurador o terapia pulpar vital selectiva\";\n  }\n  \n  if (pulpar === \"Pulpitis severa\") {\n    if (sangradoControlable === \"si\") {\n      return \"Pulpotomía vital (parcial/total) bajo aislamiento\";\n    } else {\n      return \"Endodoncia completa (RCT)\";\n    }\n  }\n  \n  if (pulpar === \"Necrosis pulpar\") {\n    return \"Endodoncia completa (RCT) / desinfección del sistema radicular\";\n  }\n  \n  if (pulpar === \"Estado pulpar inconcluso\") {\n    return \"Reevaluar; control clínico y radiográfico antes de intervenir\";\n  }\n  \n  return \"Monitorizar / manejo restaurador conservador\";\n}\n\n/**\n * Motor IA AAE-ESE 2025 - Usa el nuevo motor TypeScript\n * Incluye recomendaciones automáticas de la biblioteca clínica\n * Normaliza términos del motor IA (inglés) a español (lengua canónica del sistema)\n */\nexport function motorIA_AAE_ESE(datos: DatosClinico): ResultadoIA {\n  // Convertir datos al formato CaseData del motor AAE-ESE 2025\n  const datosConvertidos = convertirDatosAAE_ESE(datos);\n  \n  // Obtener diagnósticos usando el nuevo motor TypeScript AAE-ESE 2025\n  const diagnostico = diagnoseEndoAAE_ESE_2025(datosConvertidos);\n  \n  // Normalizar términos a español (lengua canónica del sistema)\n  const pulpalDxIA_ES = TERMINOS_PULPARES_ES[diagnostico.pulpal] || diagnostico.pulpal;\n  const apicalDxIA_ES = TERMINOS_APICALES_ES[diagnostico.apical] || diagnostico.apical;\n  \n  // Sugerir tratamiento basado en diagnósticos (ahora en español)\n  const tratamiento = sugerirTratamiento(\n    pulpalDxIA_ES,\n    apicalDxIA_ES,\n    datos.sangradoControlable\n  );\n  \n  // Generar recomendaciones clínicas automáticas desde la biblioteca (ahora en español)\n  const recomendaciones = generarRecomendacionesBiblioteca(\n    pulpalDxIA_ES,\n    apicalDxIA_ES,\n    datos.sangradoControlable\n  );\n  \n  const recomendacionesTexto = formatearRecomendaciones(recomendaciones);\n  \n  return {\n    pulpalDxIA: pulpalDxIA_ES,\n    apicalDxIA: apicalDxIA_ES,\n    ttoPropuestoIA: tratamiento,\n    recomendaciones,\n    recomendacionesTexto,\n    flags: diagnostico.flags,\n  };\n}\n","path":null,"size_bytes":8013,"size_tokens":null},"ENDOIA/client/public/service-worker.js":{"content":"self.addEventListener(\"install\", () => {\n  console.log(\"Service Worker instalado para AEDE-IA\");\n});\n\nself.addEventListener(\"activate\", () => {\n  console.log(\"Service Worker activado para AEDE-IA\");\n});\n\nself.addEventListener(\"fetch\", (event) => {\n  // Permite que las peticiones pasen normalmente\n  event.respondWith(fetch(event.request));\n});\n","path":null,"size_bytes":345,"size_tokens":null},"ENDOIA/client/src/components/clinico/index.ts":{"content":"export * from './types';\nexport * from './helpers';\nexport { EnhancedStats } from './EnhancedStats';\nexport { SeguimientosPendientes } from './SeguimientosPendientes';\nexport { HistorialDientes } from './HistorialDientes';\nexport { CasosComplejos } from './CasosComplejos';\nexport { CalidadRegistros } from './CalidadRegistros';\nexport { FailedTeethRanking } from './FailedTeethRanking';\nexport { PersonalStats } from './PersonalStats';\nexport { EnhancedDiagnosisBadges } from './EnhancedCaseModal';\nexport { FDIHeatmap } from './FDIHeatmap';\nexport { CasosPorDienteModal } from './CasosPorDienteModal';\n","path":null,"size_bytes":604,"size_tokens":null},"ENDOIA/client/src/lib/classifications.ts":{"content":"// Clasificaciones AEDE/ESE 2025 - Gold Standard\nexport const OPCIONES_PULPAR = [\n  \"Clinically normal pulp\",\n  \"Hypersensitive pulp\",\n  \"Mild pulpitis\",\n  \"Severe pulpitis\",\n  \"Pulp necrosis\",\n  \"Inconclusive pulp status\",\n] as const;\n\nexport const OPCIONES_APICAL = [\n  \"Clinically normal apical tissues\",\n  \"Localized symptomatic apical periodontitis\",\n  \"Localized asymptomatic apical periodontitis\",\n  \"Apical periodontitis with sinus tract\",\n  \"Apical periodontitis with systemic involvement\",\n  \"Inconclusive apical condition\",\n] as const;\n\nexport type PulpalClassification = typeof OPCIONES_PULPAR[number];\nexport type ApicalClassification = typeof OPCIONES_APICAL[number];\n\n// Helper: Mapeo de email de tutor a token de n8n\nconst TUTOR_TOKEN_MAP: Record<string, string> = {\n  \"jennifer.endoia@gmail.com\": \"JEN_MARTIN_2025\",\n  \"jenifer.margon@gmail.com\": \"JEN_MARTIN_2025\",\n  \"segura.endoia@gmail.com\": \"SEGURA_2025\",\n  \"sevillaendous@gmail.com\": \"SEGURA_2025\",\n  \"ague220601@gmail.com\": \"JEN_MARTIN_2025\",\n  \"investigador.endoia@gmail.com\": \"INVESTIGADOR_2025\",\n  \"ague2206@gmail.com\": \"INVESTIGADOR_2025\",\n};\n\nexport function getTutorTokenFromEmail(email: string): string | null {\n  return TUTOR_TOKEN_MAP[email.toLowerCase()] || null;\n}\n","path":null,"size_bytes":1248,"size_tokens":null},"ENDOIA/client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"ENDOIA/client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"ENDOIA/client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"ENDOIA/client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 210 6% 98%;\n\n  --foreground: 210 6% 12%;\n\n  --border: 210 6% 88%;\n\n  --card: 210 6% 96%;\n\n  --card-foreground: 210 6% 12%;\n\n  --card-border: 210 6% 90%;\n\n  --sidebar: 210 6% 94%;\n\n  --sidebar-foreground: 210 6% 12%;\n\n  --sidebar-border: 210 6% 86%;\n\n  --sidebar-primary: 225 100% 55%;\n\n  --sidebar-primary-foreground: 210 6% 98%;\n\n  --sidebar-accent: 210 8% 88%;\n\n  --sidebar-accent-foreground: 210 6% 12%;\n\n  --sidebar-ring: 225 100% 55%;\n\n  --popover: 210 6% 92%;\n\n  --popover-foreground: 210 6% 12%;\n\n  --popover-border: 210 6% 84%;\n\n  --primary: 225 100% 55%;\n\n  --primary-foreground: 210 6% 98%;\n\n  --secondary: 210 6% 86%;\n\n  --secondary-foreground: 210 6% 12%;\n\n  --muted: 210 8% 90%;\n\n  --muted-foreground: 210 6% 35%;\n\n  --accent: 210 10% 88%;\n\n  --accent-foreground: 210 6% 12%;\n\n  --destructive: 0 84% 35%;\n\n  --destructive-foreground: 0 6% 98%;\n\n  --input: 210 6% 76%;\n  --ring: 225 100% 55%;\n  --chart-1: 225 100% 55%;\n  --chart-2: 173 58% 39%;\n  --chart-3: 43 96% 56%;\n  --chart-4: 27 87% 55%;\n  --chart-5: 280 67% 45%;\n\n  --font-sans: Inter, system-ui, -apple-system, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: \"JetBrains Mono\", Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(210 6% 12% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(210 6% 12% / 0.08);\n  --shadow-sm: 0px 2px 4px -1px hsl(210 6% 12% / 0.06), 0px 1px 2px -1px hsl(210 6% 12% / 0.08);\n  --shadow: 0px 4px 6px -1px hsl(210 6% 12% / 0.08), 0px 2px 4px -2px hsl(210 6% 12% / 0.06);\n  --shadow-md: 0px 6px 12px -2px hsl(210 6% 12% / 0.10), 0px 3px 6px -3px hsl(210 6% 12% / 0.08);\n  --shadow-lg: 0px 12px 24px -4px hsl(210 6% 12% / 0.12), 0px 6px 12px -6px hsl(210 6% 12% / 0.08);\n  --shadow-xl: 0px 20px 40px -8px hsl(210 6% 12% / 0.14), 0px 10px 20px -10px hsl(210 6% 12% / 0.10);\n  --shadow-2xl: 0px 30px 60px -12px hsl(210 6% 12% / 0.18);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 210 6% 8%;\n\n  --foreground: 210 6% 92%;\n\n  --border: 210 6% 18%;\n\n  --card: 210 6% 10%;\n\n  --card-foreground: 210 6% 92%;\n\n  --card-border: 210 6% 16%;\n\n  --sidebar: 210 6% 12%;\n\n  --sidebar-foreground: 210 6% 92%;\n\n  --sidebar-border: 210 6% 20%;\n\n  --sidebar-primary: 225 100% 58%;\n\n  --sidebar-primary-foreground: 210 6% 98%;\n\n  --sidebar-accent: 210 8% 18%;\n\n  --sidebar-accent-foreground: 210 6% 92%;\n\n  --sidebar-ring: 225 100% 58%;\n\n  --popover: 210 6% 14%;\n\n  --popover-foreground: 210 6% 92%;\n\n  --popover-border: 210 6% 22%;\n\n  --primary: 225 100% 58%;\n\n  --primary-foreground: 210 6% 98%;\n\n  --secondary: 210 6% 20%;\n\n  --secondary-foreground: 210 6% 92%;\n\n  --muted: 210 8% 16%;\n\n  --muted-foreground: 210 6% 70%;\n\n  --accent: 210 10% 18%;\n\n  --accent-foreground: 210 6% 92%;\n\n  --destructive: 0 84% 35%;\n\n  --destructive-foreground: 0 6% 98%;\n\n  --input: 210 6% 30%;\n  --ring: 225 100% 58%;\n  --chart-1: 225 100% 60%;\n  --chart-2: 173 58% 55%;\n  --chart-3: 43 96% 65%;\n  --chart-4: 27 87% 62%;\n  --chart-5: 280 67% 60%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(210 6% 2% / 0.20);\n  --shadow-xs: 0px 1px 3px 0px hsl(210 6% 2% / 0.30);\n  --shadow-sm: 0px 2px 4px -1px hsl(210 6% 2% / 0.25), 0px 1px 2px -1px hsl(210 6% 2% / 0.30);\n  --shadow: 0px 4px 6px -1px hsl(210 6% 2% / 0.30), 0px 2px 4px -2px hsl(210 6% 2% / 0.25);\n  --shadow-md: 0px 6px 12px -2px hsl(210 6% 2% / 0.35), 0px 3px 6px -3px hsl(210 6% 2% / 0.30);\n  --shadow-lg: 0px 12px 24px -4px hsl(210 6% 2% / 0.40), 0px 6px 12px -6px hsl(210 6% 2% / 0.30);\n  --shadow-xl: 0px 20px 40px -8px hsl(210 6% 2% / 0.45), 0px 10px 20px -10px hsl(210 6% 2% / 0.35);\n  --shadow-2xl: 0px 30px 60px -12px hsl(210 6% 2% / 0.50);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","path":null,"size_bytes":11263,"size_tokens":null},"ENDOIA/client/src/components/clinico/CalidadRegistros.tsx":{"content":"import { ClinicoCase } from './types';\nimport { getCaseQualityScore } from './helpers';\nimport { ClipboardCheck } from 'lucide-react';\n\ninterface CalidadRegistrosProps {\n  casos: ClinicoCase[];\n}\n\nexport function CalidadRegistros({ casos }: CalidadRegistrosProps) {\n  if (casos.length === 0) return null;\n  \n  let withNotes = 0;\n  let withKeyFields = 0;\n  let withAnyControl = 0;\n  \n  casos.forEach(caso => {\n    const quality = getCaseQualityScore(caso);\n    if (quality.hasNotes) withNotes++;\n    if (quality.hasKeyFields) withKeyFields++;\n    if (quality.hasAnyControl) withAnyControl++;\n  });\n  \n  const notesPercent = Math.round((withNotes / casos.length) * 100);\n  const keyFieldsPercent = Math.round((withKeyFields / casos.length) * 100);\n  const controlPercent = Math.round((withAnyControl / casos.length) * 100);\n\n  return (\n    <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-300 hover:shadow-xl\">\n      <div className=\"flex items-center gap-2 mb-6\">\n        <ClipboardCheck className=\"w-5 h-5\" style={{ color: '#2ECC71' }} />\n        <h3 className=\"text-lg font-semibold tracking-tight\">Calidad de registros</h3>\n      </div>\n      \n      <div className=\"space-y-6\">\n        <div>\n          <div className=\"flex items-center justify-between mb-2.5\">\n            <span className=\"text-sm font-medium text-zinc-600 dark:text-zinc-400\">Casos con notas</span>\n            <span className=\"text-sm font-semibold\" style={{ color: '#3A7AFE' }}>{notesPercent}%</span>\n          </div>\n          <div className=\"w-full bg-zinc-200 dark:bg-zinc-800 rounded-full h-2.5 overflow-hidden\">\n            <div \n              className=\"h-2.5 rounded-full transition-all duration-700 ease-out\" \n              style={{ width: `${notesPercent}%`, backgroundColor: '#3A7AFE' }}\n            />\n          </div>\n        </div>\n        \n        <div>\n          <div className=\"flex items-center justify-between mb-2.5\">\n            <span className=\"text-sm font-medium text-zinc-600 dark:text-zinc-400\">Campos clave completos</span>\n            <span className=\"text-sm font-semibold\" style={{ color: '#2ECC71' }}>{keyFieldsPercent}%</span>\n          </div>\n          <div className=\"w-full bg-zinc-200 dark:bg-zinc-800 rounded-full h-2.5 overflow-hidden\">\n            <div \n              className=\"h-2.5 rounded-full transition-all duration-700 ease-out\" \n              style={{ width: `${keyFieldsPercent}%`, backgroundColor: '#2ECC71' }}\n            />\n          </div>\n        </div>\n        \n        <div>\n          <div className=\"flex items-center justify-between mb-2.5\">\n            <span className=\"text-sm font-medium text-zinc-600 dark:text-zinc-400\">Con al menos un control</span>\n            <span className=\"text-sm font-semibold\" style={{ color: '#B983FF' }}>{controlPercent}%</span>\n          </div>\n          <div className=\"w-full bg-zinc-200 dark:bg-zinc-800 rounded-full h-2.5 overflow-hidden\">\n            <div \n              className=\"h-2.5 rounded-full transition-all duration-700 ease-out\" \n              style={{ width: `${controlPercent}%`, backgroundColor: '#B983FF' }}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3247,"size_tokens":null},"ENDOIA/client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"ENDOIA/client/src/lib/vision.ts":{"content":"export type RadiographMoment = 'baseline' | 'control_1m' | 'control_3m' | 'control_6m';\n\nexport interface RadiographAnalysis {\n  pai: number | null;\n  radiolucencyDetected: boolean;\n  lesionDiameterMm: number | null;\n  laminaDuraIntact: boolean | null;\n  pdlWidening: 'none' | 'normal' | 'mild' | 'moderate' | 'severe' | null;\n  borders: 'well-defined' | 'ill-defined' | null;\n  comments: string;\n}\n\nexport async function analyzeRadiographFromUrl(\n  publicUrl: string,\n  options: { tipo: 'periapical' | 'cbct'; momento: RadiographMoment }\n): Promise<RadiographAnalysis> {\n  const res = await fetch(\"/api/vision-analyze\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({\n      imageUrl: publicUrl,\n      tipo: options.tipo,\n      momento: options.momento,\n    }),\n  });\n\n  if (!res.ok) {\n    console.error(\"Error en /api/vision-analyze:\", res.status, await res.text());\n    return {\n      pai: null,\n      radiolucencyDetected: false,\n      lesionDiameterMm: null,\n      laminaDuraIntact: null,\n      pdlWidening: null,\n      borders: null,\n      comments: \"Análisis radiográfico IA no disponible.\",\n    };\n  }\n\n  const data = await res.json();\n\n  const analysis: RadiographAnalysis = {\n    pai: typeof data.pai === \"number\" ? data.pai : null,\n    radiolucencyDetected: Boolean(data.radiolucencyDetected),\n    lesionDiameterMm:\n      typeof data.lesionDiameterMm === \"number\" ? data.lesionDiameterMm : null,\n    laminaDuraIntact:\n      typeof data.laminaDuraIntact === \"boolean\" || data.laminaDuraIntact === null\n        ? data.laminaDuraIntact\n        : null,\n    pdlWidening: data.pdlWidening ?? null,\n    borders: data.borders ?? null,\n    comments: typeof data.comments === \"string\" ? data.comments : \"\",\n  };\n\n  return analysis;\n}\n","path":null,"size_bytes":1790,"size_tokens":null},"ENDOIA/client/src/vite-env.d.ts":{"content":"/// <reference types=\"vite/client\" />\n/// <reference types=\"vite-plugin-pwa/client\" />\n","path":null,"size_bytes":87,"size_tokens":null},"ENDOIA/vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { VitePWA } from 'vite-plugin-pwa';\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    VitePWA({\n      registerType: 'autoUpdate',\n      includeAssets: ['favicon.png', 'endoia-logo.svg'],\n      manifest: {\n        name: 'ENDOIA',\n        short_name: 'ENDOIA',\n        description: 'Herramienta de apoyo diagnóstico pulpar y apical basada en clasificación AAE-ESE 2025.',\n        theme_color: '#1C56FF',\n        background_color: '#ffffff',\n        display: 'standalone',\n        start_url: '/',\n        icons: [\n          {\n            src: '/icons/endoia-192.png',\n            sizes: '192x192',\n            type: 'image/png'\n          },\n          {\n            src: '/icons/endoia-512.png',\n            sizes: '512x512',\n            type: 'image/png'\n          },\n          {\n            src: '/icons/endoia-512.png',\n            sizes: '512x512',\n            type: 'image/png',\n            purpose: 'any maskable'\n          }\n        ]\n      },\n      workbox: {\n        globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],\n        runtimeCaching: [\n          {\n            urlPattern: /^https:\\/\\/fonts\\.googleapis\\.com\\/.*/i,\n            handler: 'CacheFirst',\n            options: {\n              cacheName: 'google-fonts-cache',\n              expiration: {\n                maxEntries: 10,\n                maxAgeSeconds: 60 * 60 * 24 * 365\n              },\n              cacheableResponse: {\n                statuses: [0, 200]\n              }\n            }\n          }\n        ]\n      }\n    }),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":2545,"size_tokens":null},"ENDOIA/client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"ENDOIA/client/src/components/radiographs/SubirRadiografia.tsx":{"content":"import { useState } from \"react\";\nimport { uploadRadiographWithVision, uploadImageToStorage, getSignedUrl } from \"@/lib/radiographs\";\nimport type { RadiographMoment } from \"@/lib/vision\";\n\ninterface SubirRadiografiaProps {\n  caseId: string;\n  toothFdi?: number;\n  defaultMomento?: RadiographMoment;\n  defaultTipo?: \"periapical\" | \"cbct\";\n  allowSelectMomento?: boolean;\n  onUploadSuccess?: () => void;\n}\n\ninterface ToothDetectionResult {\n  detected: boolean;\n  fdi: number;\n  toothName?: string;\n  confidence: number;\n  notes: string;\n}\n\nexport function SubirRadiografia({\n  caseId,\n  toothFdi,\n  defaultMomento = \"baseline\",\n  defaultTipo = \"periapical\",\n  allowSelectMomento = true,\n  onUploadSuccess,\n}: SubirRadiografiaProps) {\n  const [file, setFile] = useState<File | null>(null);\n  const [momento, setMomento] = useState<RadiographMoment>(defaultMomento);\n  const [tipo, setTipo] = useState<\"periapical\" | \"cbct\">(defaultTipo);\n  const [loading, setLoading] = useState(false);\n  const [statusMsg, setStatusMsg] = useState<string>(\"\");\n\n  async function handleUpload() {\n    if (!file) return alert(\"Selecciona una imagen\");\n\n    if (!toothFdi) {\n      return proceedWithUpload(file);\n    }\n\n    setLoading(true);\n    setStatusMsg(\"Verificando diente en la imagen...\");\n\n    try {\n      const timestamp = Date.now();\n      const tempPath = `${caseId}/temp-check-${timestamp}.jpg`;\n      await uploadImageToStorage(file, tempPath);\n      const tempUrl = await getSignedUrl(tempPath);\n\n      const detection: ToothDetectionResult = await fetch(\"/api/vision-detect-teeth\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          imageUrl: tempUrl,\n          targetFdi: toothFdi\n        }),\n      }).then(r => r.json());\n\n      console.log(\"🦷 Resultado detección:\", detection);\n\n      if (!detection.detected) {\n        const toothName = getToothName(toothFdi);\n        const userConfirm = window.confirm(\n          `⚠️ El diente FDI ${toothFdi} (${toothName}) no aparece en la radiografía.\\n\\n` +\n          `Motivo: ${detection.notes}\\n\\n` +\n          `¿Deseas analizar igualmente la imagen completa?`\n        );\n\n        if (!userConfirm) {\n          setStatusMsg(\"\");\n          setLoading(false);\n          alert(\"Radiografía no analizada. Revisa el diente seleccionado o sube otra imagen.\");\n          return;\n        }\n      }\n\n      if (detection.detected && detection.fdi !== toothFdi) {\n        const userConfirm = window.confirm(\n          `⚠️ Has seleccionado FDI ${toothFdi}, pero la IA detecta FDI ${detection.fdi}.\\n\\n` +\n          `¿Quieres analizar la imagen igualmente?`\n        );\n\n        if (!userConfirm) {\n          setStatusMsg(\"\");\n          setLoading(false);\n          alert(\"Radiografía no analizada. Corrige el diente y vuelve a intentarlo.\");\n          return;\n        }\n      }\n\n      await proceedWithUpload(file);\n\n    } catch (err) {\n      console.error(\"Error en verificación:\", err);\n      const userConfirm = window.confirm(\n        \"Error verificando el diente. ¿Deseas continuar con la subida normal?\"\n      );\n      if (userConfirm) {\n        await proceedWithUpload(file);\n      } else {\n        setLoading(false);\n        setStatusMsg(\"\");\n      }\n    }\n  }\n\n  async function proceedWithUpload(fileToUpload: File) {\n    setLoading(true);\n    setStatusMsg(\"Subiendo y analizando radiografía...\");\n    try {\n      await uploadRadiographWithVision(fileToUpload, caseId, momento, tipo);\n      setFile(null);\n      onUploadSuccess?.();\n    } catch (err) {\n      console.error(\"Error subiendo radiografía:\", err);\n      alert(\"Error al subir la radiografía\");\n    } finally {\n      setLoading(false);\n      setStatusMsg(\"\");\n    }\n  }\n\n  function getToothName(fdi: number): string {\n    const positions = ['', 'incisivo central', 'incisivo lateral', 'canino', '1er premolar', '2do premolar', '1er molar', '2do molar', '3er molar'];\n    const quadrants = ['', 'superior derecho', 'superior izquierdo', 'inferior izquierdo', 'inferior derecho'];\n    const quadrant = Math.floor(fdi / 10);\n    const position = fdi % 10;\n    return `${positions[position] || 'diente'} ${quadrants[quadrant] || ''}`.trim();\n  }\n\n  return (\n    <div className=\"p-4 border rounded mt-4 bg-white dark:bg-zinc-900\">\n      <h3 className=\"font-bold mb-2\">Subir radiografía</h3>\n\n      <div className=\"flex flex-wrap gap-2 mb-2\">\n        {allowSelectMomento && (\n          <select \n            value={momento} \n            onChange={(e) => setMomento(e.target.value as RadiographMoment)}\n            className=\"border p-1 rounded dark:bg-zinc-800 dark:border-zinc-700\"\n          >\n            <option value=\"baseline\">Baseline</option>\n            <option value=\"control_1m\">1 mes</option>\n            <option value=\"control_3m\">3 meses</option>\n            <option value=\"control_6m\">6 meses</option>\n          </select>\n        )}\n\n        <select \n          value={tipo} \n          onChange={(e) => setTipo(e.target.value as \"periapical\" | \"cbct\")}\n          className=\"border p-1 rounded dark:bg-zinc-800 dark:border-zinc-700\"\n        >\n          <option value=\"periapical\">Periapical</option>\n          <option value=\"cbct\">CBCT</option>\n        </select>\n      </div>\n\n      <input \n        type=\"file\" \n        accept=\"image/*\"\n        onChange={(e) => setFile(e.target.files?.[0] || null)}\n        className=\"border p-1 mt-2 w-full rounded dark:bg-zinc-800 dark:border-zinc-700\"\n      />\n\n      <button \n        onClick={handleUpload}\n        disabled={loading || !file}\n        className=\"mt-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-3 py-1 rounded transition-colors\"\n      >\n        {loading ? \"Procesando...\" : \"Subir\"}\n      </button>\n\n      {statusMsg && (\n        <p className=\"mt-2 text-sm text-blue-600 dark:text-blue-400 animate-pulse\">\n          {statusMsg}\n        </p>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":5940,"size_tokens":null},"ENDOIA/client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n\n// Register PWA Service Worker\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    import('virtual:pwa-register').then(({ registerSW }) => {\n      registerSW({\n        immediate: true,\n        onNeedRefresh() {\n          console.log('[PWA] New version available, reloading...');\n        },\n        onOfflineReady() {\n          console.log('[PWA] App ready to work offline');\n        },\n      });\n    }).catch((error) => {\n      console.error('[PWA] Service worker registration failed:', error);\n    });\n  });\n}\n","path":null,"size_bytes":699,"size_tokens":null},"ENDOIA/client/src/data/bibliotecaClinica.ts":{"content":"// ══════════════════════════════════════════════════════════════════════════════\n// BIBLIOTECA CLÍNICA ENDOIA\n// Contenido basado en fuentes oficiales verificadas:\n// - AAE/ESE 2025 Diagnostic Classification (PDF oficial)\n// - IADT 2020-2024 Trauma Guidelines\n// - ADA/AAE Pharmacological Guidelines 2024\n// Última actualización: Noviembre 2025\n// ══════════════════════════════════════════════════════════════════════════════\n\nexport type BibliotecaCategoria =\n  | 'clasificacion'\n  | 'reabsorciones'\n  | 'farmacologia'\n  | 'trauma'\n  | 'urgencias'\n  | 'algoritmos_dx'\n  | 'algoritmos_tx'\n  | 'recursos'\n  | 'faq';\n\nexport interface TextoContent {\n  description?: string;\n  clinicalSigns?: string[];\n  management?: string;\n  question?: string;\n  answer?: string;\n  note?: string;\n  alternatives?: string;\n  definition?: string;\n  clinicalPresentation?: string;\n  diagnosticTests?: string;\n  responseToTests?: string;\n  managementRecommendations?: string;\n  secondaryTo?: string;\n}\n\nexport interface TablaContent {\n  headers: string[];\n  rows: string[][];\n  caption?: string;\n}\n\nexport interface ListaContent {\n  steps: string[];\n  timeWindow?: string;\n  notes?: string;\n  alerts?: string[];\n}\n\nexport interface AlgoritmoStep {\n  num: number;\n  title: string;\n  description: string;\n}\n\nexport interface AlgoritmoContent {\n  steps: AlgoritmoStep[];\n}\n\nexport type BibliotecaContent = \n  | TextoContent \n  | TablaContent \n  | ListaContent \n  | AlgoritmoContent \n  | null;\n\nexport interface BibliotecaItem {\n  id: string;\n  categoria: BibliotecaCategoria;\n  title: string;\n  subtitle?: string;\n  shortDescription?: string;\n  tags?: string[];\n  type: 'texto' | 'tabla' | 'lista' | 'algoritmo' | 'enlace';\n  content: BibliotecaContent;\n  reference?: string;\n  externalUrl?: string;\n}\n\n// ══════════════════════════════════════════════════════════════════════════════\n// CLASIFICACIÓN AAE/ESE 2025 OFICIAL\n// Fuente: Pulpal and Pulp Space Diagnoses + Periapical Diagnoses (PDFs oficiales)\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst clasificacionItems: BibliotecaItem[] = [\n  // ─────────────────────────────────────────────────────────────────────────\n  // TABLA OFICIAL 1: PULPAL AND PULP SPACE DIAGNOSES\n  // ─────────────────────────────────────────────────────────────────────────\n  {\n    id: 'cls-pulpal-tabla-oficial',\n    categoria: 'clasificacion',\n    title: 'Tabla Oficial: Diagnósticos Pulpares y del Espacio Pulpar',\n    subtitle: 'AAE/ESE 2025 - Pulpal and Pulp Space Diagnoses',\n    shortDescription: 'Tabla completa oficial de clasificación pulpar 2025',\n    tags: ['clasificación', 'pulpar', 'AAE', 'ESE', '2025', 'oficial'],\n    type: 'tabla',\n    content: {\n      headers: ['Diagnóstico', 'Definición y presentación clínica', 'Respuesta a pruebas diagnósticas', 'Recomendaciones de tratamiento'],\n      rows: [\n        [\n          'Clinically normal pulp',\n          'Categoría diagnóstica clínica en la que el paciente no tiene síntomas del diente que puedan atribuirse a la pulpa como fuente.',\n          'Diente intacto o restaurado. Caries inicial puede estar presente pero no cercana a pulpa en Rx 2D. Responde dentro de límites normales (igual que dientes control). Respuesta puede reducirse si hay formación de dentina secundaria/terciaria, piedras pulpares por envejecimiento normal, restauración o tratamiento pulpar vital previo. No radiolucidez apical.',\n          'No se requiere intervención endodóntica.'\n        ],\n        [\n          'Hypersensitive pulp (Secundaria a: exposición dentinaria no cariosa)',\n          'Categoría diagnóstica clínica en la que la pulpa está generalmente sana, pero la respuesta está aumentada debido a túbulos dentinarios expuestos o respuestas pulpares transitorias post-intervención (ej: restauración reciente, recesión gingival). Asociada a síntomas leves o moderados desencadenados por estímulos fríos/dulces.',\n          'Responde con respuesta aumentada (mayor intensidad, pero NO prolongada) a pruebas térmicas, estímulos táctiles o aire. No radiolucidez apical.',\n          'No intervención, o protección pulpar, dependiendo de la etiología.'\n        ],\n        [\n          'Mild pulpitis (Secundaria a: caries moderada o profunda, restauración moderada o profunda o corona con/sin microfiltración, trauma con/sin exposición pulpar, diente fisurado, reabsorción cervical externa, otras causas)',\n          'Categoría diagnóstica clínica basada en hallazgos subjetivos y objetivos que indican que la pulpa está levemente inflamada y no está infectada. Asociada a síntomas nulos, leves o moderados desencadenados por estímulos fríos/dulces.',\n          'Rango de respuestas desde normal hasta aumentada (mayor intensidad, pero NO prolongada) con pruebas pulpares. Evidencia radiográfica de caries cercana a pulpa en Rx 2D (tercio o cuarto interno) pero tejido duro radiopaco visible entre pulpa y lesión cariosa. No radiolucidez apical presente / breakdown apical transitorio en casos de trauma. Radiopacidad apical puede estar presente.',\n          'Dependiendo de severidad: restauración dental o tratamiento pulpar vital. Diente fisurado puede requerir cobertura cuspal. Es improbable que se requiera tratamiento radicular.'\n        ],\n        [\n          'Severe pulpitis (Secundaria a: caries extremadamente profunda, restauración extremadamente profunda o corona con/sin microfiltración, trauma con exposición pulpar, diente fisurado, reabsorción cervical externa, otras causas)',\n          'Categoría diagnóstica clínica basada en hallazgos subjetivos y objetivos que pueden indicar un nivel progresivo aumentado de inflamación pulpar y posiblemente infección de la porción coronal de la pulpa. Puede o no estar asociada a un rango de síntomas desencadenados por estímulos térmicos o ser espontáneos en naturaleza. Asociada a síntomas nulos, leves, moderados o severos.',\n          'Desde normalmente responsiva hasta dolor prolongado a pruebas pulpares (térmicas). El diente puede o no ser sensible a percusión y/o palpación. Restauración o caries considerada cercana a pulpa en radiografía, u otra indicación de invasión bacteriana cercana a pulpa. Radiolucidez apical (típicamente vista en pacientes jóvenes) o radiopacidad puede estar presente en imágenes radiográficas.',\n          'Dependiendo de severidad de síntomas y hallazgos objetivos, incluyendo evaluación intraoperatoria de la progresión de la enfermedad dentro del espacio pulpar y consideraciones restaurativas: pulpotomía (parcial o completa) o tratamiento de conductos radiculares.'\n        ],\n        [\n          'Pulp necrosis (Secundaria a: caries profunda/extremadamente profunda, restauración extremadamente profunda o corona con microfiltración, trauma con/sin exposición pulpar, diente fisurado, reabsorción cervical externa, otras causas)',\n          'Categoría diagnóstica clínica que indica pérdida de vitalidad de la pulpa dental. La pulpa puede estar parcial o completamente necrótica.',\n          'Generalmente, no respuesta a pruebas pulpares (térmicas o eléctricas). Restauración, pérdida traumática de dentina, desgaste dental o caries puede aparecer cercana a pulpa en radiografía. El diente puede o no ser sensible a percusión y/o palpación. Puede estar presente una radiolucidez apical.',\n          'Las intervenciones incluyen tratamiento endodóntico regenerativo y tratamiento de conductos radiculares.'\n        ],\n        [\n          'Pulp necrosis (Secundaria a: trauma resultando en lesión al paquete vaso-nervioso del diente - ej: luxación lateral/intrusiva, avulsión)',\n          'Categoría diagnóstica clínica que indica ruptura o aplastamiento del paquete vaso-nervioso del diente (ej: luxación lateral/intrusiva, avulsión).',\n          'Generalmente, no respuesta a pruebas pulpares hasta 3 meses post-trauma. Obliteración del conducto radicular significa proceso de reparación. Desarrollo radicular detenido sin radiolucidez periapical puede ser signo de necrosis pulpar estéril. Radiolucidez apical y signos radiográficos de reabsorción radicular inflamatoria externa (signos de infección del conducto radicular) puede estar presente.',\n          'La pulpa puede revascularizarse dependiendo del tipo de trauma y madurez del ápice. Si la probabilidad de revascularización es baja, está indicado tratamiento de conductos o procedimiento endodóntico regenerativo para prevenir infección/reabsorción inflamatoria.'\n        ]\n      ],\n      caption: '© 2025 American Association of Endodontists (AAE) and European Society of Endodontology (ESE). Fuente oficial.'\n    },\n    reference: 'AAE/ESE 2025 - Pulpal and Pulp Space Diagnoses'\n  },\n  \n  // ─────────────────────────────────────────────────────────────────────────\n  // TABLA OFICIAL 2: PERIAPICAL DIAGNOSES\n  // ─────────────────────────────────────────────────────────────────────────\n  {\n    id: 'cls-apical-tabla-oficial',\n    categoria: 'clasificacion',\n    title: 'Tabla Oficial: Diagnósticos Periapicales',\n    subtitle: 'AAE/ESE 2025 - Periapical Diagnoses',\n    shortDescription: 'Tabla completa oficial de clasificación apical 2025',\n    tags: ['clasificación', 'apical', 'AAE', 'ESE', '2025', 'oficial'],\n    type: 'tabla',\n    content: {\n      headers: ['Diagnóstico', 'Definición y presentación clínica', 'Respuesta a pruebas diagnósticas e imagen', 'Recomendaciones de tratamiento'],\n      rows: [\n        [\n          'Clinically normal apical tissues',\n          'Categoría diagnóstica clínica en la que el área apical está sana y el diente es asintomático.',\n          'No dolor a percusión y palpación. La lámina dura que rodea la raíz está intacta, y el espacio del ligamento periodontal es uniforme y dentro de límites normales usando técnicas de imagen (ej: radiografía 2D, CBCT).',\n          'Si el diagnóstico pulpar se considera como Pulpa Clínicamente Normal, la intervención endodóntica no está indicada.'\n        ],\n        [\n          'Apical hypersensitivity (Secundaria a: hiperoclusión, lesiones traumáticas, enfermedad periodontal, causas no odontogénicas como condiciones neuropáticas, TMD)',\n          'Categoría diagnóstica clínica donde el área apical está sana o levemente inflamada, pero la inflamación NO es de origen pulpar. Consecuentemente, el paciente reporta síntomas ante estímulos mecánicos (ej: presión al morder o dolor al golpear el diente).',\n          'Dolor leve o moderado a percusión. No radiolucidez apical, o ligero ensanchamiento de la lámina dura, se observa en radiografía periapical y/o CBCT relativo a dientes control.',\n          'La intervención endodóntica NO está indicada.'\n        ],\n        [\n          'Localized symptomatic apical periodontitis',\n          'Categoría diagnóstica clínica donde el área apical o perirradicular está inflamada desde un origen pulpar. El paciente reporta síntomas ante estímulos mecánicos (ej: presión al morder, dolor al golpear el diente) o hinchazón intraoral).',\n          'Una radiolucidez perirradicular en radiografía periapical, o áreas de baja densidad en CBCT es probable, pero no necesariamente, presente. Dolor a percusión y/o palpación.',\n          'La intervención endodóntica está indicada.'\n        ],\n        [\n          'Localized asymptomatic apical periodontitis',\n          'Categoría diagnóstica clínica donde el área apical o perirradicular está inflamada desde un origen pulpar. El paciente no tiene dolor o molestias.',\n          'Una radiolucidez perirradicular en radiografía periapical, o áreas de baja densidad en CBCT, está presente. No dolor, o dolor leve, a percusión y palpación.',\n          'La intervención endodóntica está indicada.'\n        ],\n        [\n          'Localized apical periodontitis with sinus tract',\n          'Categoría diagnóstica clínica donde el área apical o perirradicular está inflamada desde un origen pulpar. El paciente reporta síntomas nulos o leves ante estímulos mecánicos (ej: presión al morder, dolor al golpear el diente). El paciente puede reportar la presencia de una pequeña hinchazón/grano/bulto en el tejido blando adyacente o extraoralmente.',\n          'Una radiolucidez perirradicular en radiografía periapical o áreas de baja densidad en CBCT está presente que se extiende a placa cortical bucal o lingual/palatina. Presencia de tracto sinusal que puede ser rastreado al diente en cuestión.',\n          'La intervención endodóntica está indicada.'\n        ],\n        [\n          'Apical periodontitis with systemic involvement',\n          'Categoría diagnóstica clínica donde el área apical o perirradicular está inflamada desde un origen pulpar. El paciente presenta signos claros de infección sistémica (ej: enrojecimiento, calor, fiebre, hinchazón facial, linfadenopatía).',\n          'Una radiolucidez perirradicular en radiografía periapical o áreas de baja densidad en CBCT probablemente está presente. Hinchazón facial difusa/asimetría facial se observa. El paciente probablemente tiene dolor a percusión y/o palpación.',\n          'Se recomienda intervención endodóntica inmediata para aliviar síntomas y/o drenar cualquier infección activa. Los antibióticos están indicados. Puede ser necesaria medicación para el dolor.'\n        ],\n        [\n          'Healing apical tissue',\n          'Categoría diagnóstica clínica asociada a un diente previamente tratado (ej: obturación radicular previa, tratamiento regenerativo previo) en el cual el periodonto apical y/o lateral muestran signos de resolución de enfermedad endodóntica y el paciente está clínicamente asintomático.',\n          'No dolor a percusión o palpación. Imágenes radiográficas de seguimiento deben compararse con imágenes preoperatorias y/o postoperatorias tempranas. Una radiolucidez perirradicular en radiografía periapical o áreas de baja densidad en CBCT puede verse pero aparece estar reduciéndose en tamaño. En CBCT, formación emergente de hueso trabecular y/o disminución del área de baja densidad alrededor del ápice del diente puede ser detectada.',\n          'La intervención NO está indicada. Está indicado monitoreo adicional.'\n        ],\n        [\n          'Inconclusive apical condition',\n          'Categoría diagnóstica clínica en la que el paciente no tiene síntomas clínicos pero la presentación radiográfica es incierta.',\n          'No dolor a percusión o palpación. A) Una radiolucidez perirradicular en radiografía periapical o áreas de baja densidad en CBCT se observan alrededor del ápice del diente con \"pulpa clínicamente normal\" o \"estado pulpar inconcluso\". Ejemplos incluyen lesiones de origen no odontogénico, lesiones expandiéndose desde dientes adyacentes, o breakdown apical transitorio siguiendo lesiones traumáticas. B) Una radiolucidez perirradicular en radiografía periapical o áreas de baja densidad en CBCT se observan alrededor del ápice de un diente previamente tratado con conductos radiculares, pero es demasiado temprano para determinar si el tratamiento fue efectivo. C) Cambios encontrados en imágenes no pueden ser interpretados con certeza.',\n          'Está indicado monitoreo adicional. Se recomendaría monitoreo periódico continuado para observar cualquier cambio (incremento o disminución) en el hueso perirradicular.'\n        ]\n      ],\n      caption: '© 2025 American Association of Endodontists (AAE) and European Society of Endodontology (ESE). Fuente oficial.'\n    },\n    reference: 'AAE/ESE 2025 - Periapical Diagnoses'\n  }\n];\n\n// ══════════════════════════════════════════════════════════════════════════════\n// REABSORCIONES RADICULARES (BLOQUE 5 COMPLETO)\n// Fuente: IADT 2020-2024 + AAE Guidelines + Montse Mercadé\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst reabsorcionesItems: BibliotecaItem[] = [\n  {\n    id: 'reab-clasificacion',\n    categoria: 'reabsorciones',\n    title: 'Clasificación Oficial 2025',\n    subtitle: 'Categorías de reabsorciones radiculares',\n    shortDescription: 'IADT + AAE clasificación actualizada 2024-2025',\n    tags: ['reabsorción', 'clasificación', 'IADT', 'AAE', '2025'],\n    type: 'lista',\n    content: {\n      steps: [\n        'A. REABSORCIÓN INFLAMATORIA: Externa inflamatoria, Interna inflamatoria, Cervical invasiva (ICR) - antes \"cervical invasiva externa\", ahora una entidad propia',\n        'B. REABSORCIÓN POR REEMPLAZO / ANQUILOSIS: Fusión del diente al hueso. Propia de traumas severos o reimplantes tardíos',\n        'C. REABSORCIÓN SUPERFICIAL TRANSITORIA: Curación normal del PDL. Pasa desapercibida → NO requiere tratamiento'\n      ],\n      notes: 'Principios clave: 1) El cemento es la defensa natural. Si se destruye por trauma, cirugía, ortodoncia excesiva o infección → aparece reabsorción. 2) Dos grandes triggers: inflamación (generalmente infecciosa → necrosis pulpar) y daño severo del PDL (avulsión/intrusión → reemplazo). 3) El factor tiempo es crítico: cuanto más tarda el tratamiento adecuado, más avanza la reabsorción.'\n    },\n    reference: 'IADT 2020-2024 + AAE 2024'\n  },\n  {\n    id: 'reab-externa-inflamatoria',\n    categoria: 'reabsorciones',\n    title: 'Reabsorción Externa Inflamatoria (EIRR)',\n    subtitle: 'Asociada a luxaciones severas, intrusiones, avulsiones',\n    shortDescription: 'Origen, clínica, radiología y tratamiento estándar 2025',\n    tags: ['reabsorción', 'externa', 'inflamatoria', 'EIRR'],\n    type: 'texto',\n    content: {\n      description: 'Reabsorción externa inflamatoria (EIRR) se presenta tras luxaciones severas, intrusiones, avulsiones >60 minutos, o cualquier diente con necrosis + infección.',\n      clinicalSigns: [\n        'Clínica: casi siempre asintomática',\n        'Solo en estadios avanzados: sensibilidad a percusión, cambio de color tardío, fístula si hay perforación masiva'\n      ],\n      management: 'TRATAMIENTO ESTÁNDAR 2025: 1) Endodoncia inmediata (eliminar infección → detener proceso). 2) Hidróxido de calcio 4–6 semanas o MTA si hay perforación cervical. 3) Revisión a 4–8 semanas y 3–6 meses. PRONÓSTICO: Bueno si se trata pronto. Malo si avanza >1/3 de raíz.',\n      note: 'Radiología: Áreas radiolúcidas irregulares en superficie radicular, ensanchamiento PDL, pérdida de contorno radicular, raíz \"mordida\" o \"comida\".'\n    },\n    reference: 'IADT 2020-2024'\n  },\n  {\n    id: 'reab-interna-inflamatoria',\n    categoria: 'reabsorciones',\n    title: 'Reabsorción Interna Inflamatoria (IIRR)',\n    subtitle: 'Inflamación intrapulpar crónica con zonas de necrosis',\n    shortDescription: 'Clínica: ROSADO coronario, dolor leve intermitente',\n    tags: ['reabsorción', 'interna', 'inflamatoria', 'IIRR'],\n    type: 'texto',\n    content: {\n      description: 'Ocurre cuando hay inflamación intrapulpar crónica con zonas de necrosis coexistiendo con pulpa vital.',\n      clinicalSigns: [\n        'A veces ROSADO coronario',\n        'Dolor leve intermitente (muy variable)'\n      ],\n      management: 'TRATAMIENTO: Endodoncia inmediata, instrumentación suave, irrigación abundante. Si hay perforación → tapón MTA.',\n      note: 'Radiología: Imagen redonda y simétrica, bien delimitada, sigue el canal'\n    },\n    reference: 'AAE Guidelines 2024'\n  },\n  {\n    id: 'reab-cervical-invasiva',\n    categoria: 'reabsorciones',\n    title: 'Reabsorción Cervical Invasiva (ICR)',\n    subtitle: 'La más difícil de diagnosticar y manejar',\n    shortDescription: 'Factores predisponentes: trauma, blanqueamiento interno, ortodoncia',\n    tags: ['reabsorción', 'cervical', 'invasiva', 'ICR', 'Heithersay'],\n    type: 'texto',\n    content: {\n      description: 'Factores predisponentes: trauma previo, blanqueamientos internos, ortodoncia, cirugía apical, bruxismo, intrusión tácita (sin registrarse).',\n      clinicalSigns: [\n        'Clínica: Casi siempre asintomática',\n        'A veces leve sangrado al sondar cervical'\n      ],\n      management: 'TRATAMIENTO 2025: Acceso quirúrgico si necesario, remoción del tejido reabsortivo, restauración con biocerámicos (retro o directa). CBCT obligatorio en casos II–IV. Clasificación Heithersay (aún vigente): I → Pequeña, II → Profunda hacia dentina, III → Extensa, IV → Casi imposible salvar.',\n      note: 'Radiología / CBCT: \"Mordedura\" cervical irregular, espacio pulpar respetado, defecto que rodea la corona'\n    },\n    reference: 'Heithersay Classification + AAE 2024'\n  },\n  {\n    id: 'reab-reemplazo-anquilosis',\n    categoria: 'reabsorciones',\n    title: 'Reabsorción por Reemplazo / Anquilosis (RR)',\n    subtitle: 'Destrucción del PDL → osteoclastos reemplazan raíz por hueso',\n    shortDescription: 'Causas: avulsión >60 min, intrusión severa, luxación lateral fuerte',\n    tags: ['reabsorción', 'reemplazo', 'anquilosis'],\n    type: 'texto',\n    content: {\n      description: 'Base: destrucción del PDL → osteoclastos reemplazan raíz por hueso. Causas: Avulsión >60 minutos, intrusión severa, luxación lateral muy fuerte.',\n      clinicalSigns: [\n        'Tono metálico al percutir',\n        'No movilidad',\n        'Infraoclusión en niños'\n      ],\n      management: 'TRATAMIENTO: En adultos: monitorización. En niños: decoronación para preservar hueso.',\n      note: 'Radiología: Ligamento periodontal ausente, raíz fusionada al hueso, contorno irregular pero sin radiolucidez inflamatoria. Irreversible y muy frecuente en intrusiones.'\n    },\n    reference: 'IADT 2020-2024'\n  },\n  {\n    id: 'reab-algoritmos',\n    categoria: 'reabsorciones',\n    title: 'Algoritmos Clínicos de Manejo',\n    subtitle: 'Versión ENDOIA para decisión clínica',\n    shortDescription: '4 algoritmos para sospecha de diferentes tipos de reabsorción',\n    tags: ['reabsorción', 'algoritmo', 'manejo'],\n    type: 'lista',\n    content: {\n      steps: [\n        '🔥 Sospecha de reabsorción externa inflamatoria: Traumatismo previo + cambios radiográficos → Test frío negativo → ENDODONCIA inmediata → CaOH 4–6 semanas → Control 3–6 meses → Si estable: obturación; Si progresa: reevaluar CBCT',\n        '🔥 Sospecha de reabsorción interna: Imagen redonda, centrada en canal → Test frío variable → Endodoncia forzosa → Si perforación: MTA → Control 6 meses',\n        '🔥 Sospecha de reabsorción cervical invasiva (ICR): Radiolucidez cervical + pulpa respetada → CBCT → Heithersay I–II: desbridar + reconstruir; Heithersay III–IV: pronóstico reservado',\n        '🔥 Sospecha de reemplazo / anquilosis: Percusión metálica → Rx: PDL ausente → Niño: decoronación; Adulto: mantener y plan protésico futuro'\n      ],\n      notes: 'ENDOIA puede: mostrar alertas de riesgo al clínico, identificar complicaciones en seguimiento, priorizar controles tempranos, diferenciar reabsorción inflamatoria vs reemplazo (clave), sugerir cuándo hacer CBCT, sugerir cuándo iniciar endodoncia, montar estadísticas personales y globales.'\n    },\n    reference: 'Algoritmo ENDOIA basado en IADT + AAE 2024'\n  }\n];\n\n// ══════════════════════════════════════════════════════════════════════════════\n// FARMACOLOGÍA Y PROTOCOLOS DE SOPORTE (BLOQUE 6 COMPLETO)\n// Fuente: ADA/AAE 2024 Pharmacological Guidelines\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst farmacologiaItems: BibliotecaItem[] = [\n  {\n    id: 'farm-objetivo',\n    categoria: 'farmacologia',\n    title: 'Objetivo del Manejo Farmacológico',\n    subtitle: 'Principios generales 2025',\n    shortDescription: 'Controlar dolor e infección sin abuso de fármacos',\n    tags: ['farmacología', 'principios', 'ADA', 'AAE'],\n    type: 'lista',\n    content: {\n      steps: [\n        '1. Controlar el dolor, no taparlo mientras la causa sigue activa',\n        '2. Controlar la infección sistémica cuando exista (no \"por si acaso\")',\n        '3. Minimizar efectos adversos (AINEs, antibióticos, opioides)',\n        '4. Evitar abuso de antibióticos (ADA/AAE son muy estrictos aquí)'\n      ]\n    },\n    reference: 'ADA/AAE Pharmacological Guidelines 2024'\n  },\n  {\n    id: 'farm-analgesia-primera-linea',\n    categoria: 'farmacologia',\n    title: 'Analgesia en Endodoncia (2025)',\n    subtitle: '🟢 Primera línea (EVIDENCIA TOP): Combinación AINE + Paracetamol',\n    shortDescription: 'Ibuprofeno 600 mg cada 8h + Paracetamol 1g cada 8h',\n    tags: ['analgesia', 'ibuprofeno', 'paracetamol', 'primera línea'],\n    type: 'texto',\n    content: {\n      description: 'Combinación AINE + paracetamol: Ibuprofeno 600 mg cada 8 h + Paracetamol 1 g cada 8 h (alternado o combinado).',\n      management: 'Esquema típico para adulto sano (72 h máx. a dosis altas): Mañana: Ibuprofeno 600 mg, Mediodía: Paracetamol 1 g, Tarde: Ibuprofeno 600 mg, Noche: Paracetamol 1 g (si precisa). Esta combinación es más efectiva que muchos opioides en dolor dental.',\n      alternatives: '🟡 Alternativas si no puede tomar AINEs: Paracetamol 1 g cada 6–8 h. Máx: 3 g/día en adultos sanos. Vigilar hepáticos, alcohólicos, polimedicados. Si dolor muy intenso y no hay otra opción → se puede asociar opioide suave (tipo tramadol) 24–48 h máx, pero esto es cada vez menos recomendado; mejor evitarlo si se puede.',\n      note: '🔴 Lo que NO es de elección: Mezclas de opioides (tramadol/codeína) como primera línea, corticoides sistémicos solo \"para el dolor pulpar\", AINEs + corticoides juntos (riesgo GI y otros problemas)'\n    },\n    reference: 'AAE 2022 Evidence-Based Pain Management'\n  },\n  {\n    id: 'farm-analgesia-escenarios',\n    categoria: 'farmacologia',\n    title: 'Analgésicos según Escenario Clínico',\n    subtitle: 'Relacionado con bloques 2 y 3 (diagnósticos 2025)',\n    shortDescription: 'Pulpitis moderada, severa, post-endodoncia',\n    tags: ['analgesia', 'escenarios', 'clínica'],\n    type: 'tabla',\n    content: {\n      headers: ['Escenario', 'Analgesia recomendada'],\n      rows: [\n        ['1️⃣ Pulpitis moderada (dolor moderado, no loco)', 'Ibuprofeno 400–600 mg / 8 h ± Paracetamol 1 g/8 h si precisa'],\n        ['2️⃣ Pulpitis severa (dolor fuerte que no deja dormir)', 'Manejo local (apertura) + Ibuprofeno 600 mg + Paracetamol 1 g (esquema combinado). Revaluación 24–48 h'],\n        ['3️⃣ Dolor post-endodoncia', 'Igual que arriba. Revisar oclusión. Revisar si hay sobreinstrumentación / sobreobturación']\n      ]\n    },\n    reference: 'ADA/AAE 2024'\n  },\n  {\n    id: 'farm-antibioticos-regla-oro',\n    categoria: 'farmacologia',\n    title: 'Antibióticos (ADA/AAE 2025) – SOLO CUANDO TOCA',\n    subtitle: '🔴 Regla de oro: El antibiótico NO trata el dolor dental',\n    shortDescription: 'Solo indicado si hay infección sistémica o riesgo de diseminación',\n    tags: ['antibióticos', 'ADA', 'AAE', 'infección'],\n    type: 'texto',\n    content: {\n      description: '✔️ Indicaciones CLARAS de antibiótico: Prescribir antibiótico SOLO si hay fiebre, malestar general, edema difuso (celulitis), trismus importante, adenopatías dolorosas, paciente inmunodeprimido o con patologías de riesgo, imposibilidad de drenaje y clara progresión de la infección. Y siempre acompañando a → TRATAMIENTO LOCAL (drenaje / apertura / incisión), nunca en sustitución.',\n      note: '❌ Situaciones en las que NO se debe dar antibiótico: Pulpitis leve, Pulpitis moderada o severa SIN datos sistémicos, Pulpa necrótica sin celulitis, Absceso apical crónico con fístula, Dolor postoperatorio sin signos de infección, Fracaso endodóntico sin signos sistémicos'\n    },\n    reference: 'ADA/AAE Antibiotic Stewardship 2024'\n  },\n  {\n    id: 'farm-antibioticos-esquemas',\n    categoria: 'farmacologia',\n    title: 'Esquemas Antibióticos Recomendados',\n    subtitle: 'Adulto sano - respetar alergias y comorbilidades',\n    shortDescription: 'Primera elección, alergia a penicilina, infecciones severas',\n    tags: ['antibióticos', 'amoxicilina', 'clindamicina', 'esquemas'],\n    type: 'tabla',\n    content: {\n      headers: ['Situación', 'Fármaco y dosis', 'Duración'],\n      rows: [\n        ['🟢 Primera elección (no alérgico a penicilina)', 'Amoxicilina 500 mg cada 8 h', '5–7 días (Suspender a las 48–72 h si síntomas sistémicos remiten)'],\n        ['🟢 Infecciones más severas / celulitis', 'Amoxicilina + ácido clavulánico 875/125 mg cada 12 h', '5–7 días'],\n        ['🟡 Alergia a penicilina', 'Clindamicina 300 mg cada 8 h', '5–7 días']\n      ],\n      caption: '🔴 Lo que hay que evitar: Prescribir antibióticos \"por si acaso\", darlos cada vez que duele un molar, esquemas muy largos sin necesidad, antibióticos sin drenaje local cuando el absceso es evidente'\n    },\n    reference: 'ADA/AAE 2024'\n  },\n  {\n    id: 'farm-corticoides',\n    categoria: 'farmacologia',\n    title: 'Corticoides Sistémicos – ¿tienen sitio?',\n    subtitle: 'En endodoncia pura, su papel es limitado',\n    shortDescription: 'Solo en edema muy severo o compromiso funcional',\n    tags: ['corticoides', 'edema'],\n    type: 'texto',\n    content: {\n      description: '✔ Se pueden considerar en: Edema muy severo o compromiso funcional, casos en los que el paciente ya está en tratamiento por un facultativo y se coordina.',\n      note: '❌ No deben ser fármaco base para dolor pulpar de rutina.'\n    },\n    reference: 'AAE Guidelines 2024'\n  },\n  {\n    id: 'farm-drenaje-protocolo',\n    categoria: 'farmacologia',\n    title: 'Protocolo de Drenaje (para urgencias)',\n    subtitle: 'Drenaje endodóntico y drenaje por incisión',\n    shortDescription: 'Procedimientos paso a paso',\n    tags: ['drenaje', 'urgencias', 'absceso'],\n    type: 'lista',\n    content: {\n      steps: [\n        '🧪 DRENAJE ENDODÓNTICO (a través del conducto): 1) Anestesia + aislamiento con dique, 2) Apertura de acceso adecuada, 3) Llegar a longitud de trabajo, 4) Permitir salida de exudado si lo hay, 5) Irrigación abundante con NaOCl, 6) No dejar abierto → sellado provisional estanco, 7) Programar cita de control',\n        '✂️ INCISIÓN Y DRENAJE (tejidos blandos): Indicaciones: Fluctuación evidente, colección purulenta submucosa accesible. Pasos: 1) Asepsia local, 2) Anestesia infiltrativa, 3) Incisión en zona más declive, 4) Desbridamiento suave, 5) Lavado con suero, 6) Colocar dren si es necesario, 7) Antibiótico si hay datos sistémicos, 8) Revisar a las 24–48 h'\n      ]\n    },\n    reference: 'AAE Emergency Treatment Protocols 2024'\n  },\n  {\n    id: 'farm-red-flags',\n    categoria: 'farmacologia',\n    title: 'Red Flags para Derivación Urgente',\n    subtitle: 'ENDOIA puede mostrarlos como alertas rojas en pantalla',\n    shortDescription: 'Derivar a hospital/urgencias si...',\n    tags: ['derivación', 'urgencias', 'red flags'],\n    type: 'lista',\n    content: {\n      steps: [\n        'Edema submandibular o sublingual (potencial compromiso vía aérea)',\n        'Disfagia (dificultad para tragar)',\n        'Disnea (dificultad para respirar)',\n        'Fiebre alta persistente (> 38,5 °C)',\n        'Paciente oncológico / inmunodeprimido con infección dental aguda',\n        'Dolor no controlable pese a tratamiento correcto',\n        'Niños con celulitis facial progresiva'\n      ],\n      alerts: ['⚠️ ESTAS SON EMERGENCIAS MÉDICAS - DERIVAR INMEDIATAMENTE']\n    },\n    reference: 'ADA/AAE Emergency Guidelines 2024'\n  },\n  {\n    id: 'farm-micro-resumen',\n    categoria: 'farmacologia',\n    title: 'Micro-resumen Tipo \"Pocket Guideline\"',\n    subtitle: 'Para ENDOIA - guía rápida de bolsillo',\n    shortDescription: '4 reglas de oro',\n    tags: ['resumen', 'guía rápida'],\n    type: 'lista',\n    content: {\n      steps: [\n        '👉 Dolor fuerte + sin fiebre → Analgesia + tratamiento local',\n        '👉 Dolor + fiebre/celulitis → Drenar + antibiótico + control 24–48 h',\n        '👉 Nunca antibiótico solo para dolor pulpar',\n        '👉 Nunca dejar el diente abierto'\n      ]\n    },\n    reference: 'ADA/AAE 2024'\n  }\n];\n\n// ══════════════════════════════════════════════════════════════════════════════\n// TRAUMATOLOGÍA DENTAL (BLOQUES 1 y 4 COMPLETOS)\n// Fuente: IADT 2020-2024\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst traumaItems: BibliotecaItem[] = [\n  {\n    id: 'trauma-evaluacion-inicial',\n    categoria: 'trauma',\n    title: 'Evaluación Inicial Obligatoria',\n    subtitle: 'IADT 2020 - Protocolo completo',\n    shortDescription: 'Historia, evaluación extraoral/intraoral, radiografías recomendadas',\n    tags: ['trauma', 'evaluación', 'IADT', '2020'],\n    type: 'lista',\n    content: {\n      steps: [\n        '1. HISTORIA COMPLETA DEL SUCESO: Tiempo desde el trauma (clave p/ pronóstico), mecanismo (impacto directo, indirecto, objeto romo, caída…), velocidad del golpe, medio donde ocurrió (suelo, piscina, bicicleta, deporte)',\n        '2. EVALUACIÓN EXTRAORAL: Heridas faciales, contusiones, trismus, asimetría facial, fracturas mandibulares posibles, lesiones de tejidos blandos (labio y mucosa — buscar fragmentos dentales)',\n        '3. EVALUACIÓN INTRAORAL: Sangrado, movilidad, cambios de color, sensibilidad, puntos de fractura, mucosa desgarrada. En el labio: palpar fragmentos dentales incrustados → muy frecuente y muchas veces olvidado',\n        '4. RADIOGRAFÍAS RECOMENDADAS: PA periapical, lateral excéntrica, oclusal, CBCT (solo si sospecha: fractura radicular, intrusión, reabsorción inicial o luxación severa)'\n      ]\n    },\n    reference: 'IADT 2020'\n  },\n  {\n    id: 'trauma-clasificacion-iadt',\n    categoria: 'trauma',\n    title: 'Clasificación IADT Completa (2020)',\n    subtitle: 'Lesiones de tejidos duros, periodontales y alveolares',\n    shortDescription: 'Con detalles PRO para dientes permanentes',\n    tags: ['trauma', 'clasificación', 'IADT'],\n    type: 'lista',\n    content: {\n      steps: [\n        'A. LESIONES DE TEJIDOS DUROS Y PULPARES: 1) Fractura de esmalte, 2) Fractura esmalte-dentina sin exposición pulpar, 3) Fractura esmalte-dentina con exposición pulpar (exp. pin-point <1 mm, exp. amplia), 4) Fractura coronorradicular (con/sin exposición pulpar), 5) Fractura radicular (tercio apical, medio, cervical)',\n        'B. LESIONES DE TEJIDOS PERIODONTALES: 1) Conmoción (concussion): sensibilidad sin movilidad, 2) Subluxación: movilidad ligera sin desplazamiento, 3) Luxación extrusiva, 4) Luxación lateral, 5) Luxación intrusiva, 6) Avulsión',\n        'C. LESIONES ALVEOLARES: 1) Fractura de proceso alveolar, 2) Fractura alveolar multifragmentaria'\n      ]\n    },\n    reference: 'IADT Classification 2020'\n  },\n  {\n    id: 'trauma-manejo-fracturas',\n    categoria: 'trauma',\n    title: 'Algoritmos de Manejo de Fracturas',\n    subtitle: 'Árbol clínico real IADT',\n    shortDescription: 'Sin exposición pulpar, con exposición pulpar, coronorradicular, radicular',\n    tags: ['trauma', 'fracturas', 'manejo'],\n    type: 'lista',\n    content: {\n      steps: [\n        'A. FRACTURAS SIN EXPOSICIÓN PULPAR: Esquema IADT: sellado inmediato de dentina expuesta, control a 6–8 semanas, 6 meses, 1 año',\n        'B. FRACTURAS CON EXPOSICIÓN PULPAR: Decisión según edad/cierre apical y tamaño: 1) Apex inmaduro (abierto): Vital → Direct pulp cap si exp. <24h, Partial pulpotomy (Cvek) si >24h; No vital → revascularización (primera elección). 2) Apex cerrado: Pulp cap si exp. pequeña <1 mm, pulpotomía parcial si exp. reciente, endodoncia si exposición grande/contaminada',\n        'C. FRACTURA CORONORRADICULAR: Retirar fragmento → valorar restaurabilidad. Si pulpa expuesta → pulpotomía parcial o endodoncia. Si afecta subgingival → ortodoncia/quirúrgico para exposición del margen',\n        'D. FRACTURA RADICULAR: Mejor pronóstico: tercio apical. Tratamiento: reposición si desplazado, ferulización 4 semanas, vitalidad → seguimiento, si necrosis → tratamiento solo del segmento coronal'\n      ]\n    },\n    reference: 'IADT 2020 + AAE Trauma Guidance'\n  },\n  {\n    id: 'trauma-luxaciones-manejo',\n    categoria: 'trauma',\n    title: 'Luxaciones: Manejo Profesional Completo',\n    subtitle: 'IADT + AAE - Conmoción, subluxación, extrusión, lateral, intrusión',\n    shortDescription: 'Protocolos detallados según tipo de luxación',\n    tags: ['trauma', 'luxación', 'manejo', 'IADT', 'AAE'],\n    type: 'tabla',\n    content: {\n      headers: ['Tipo de Luxación', 'Clínica', 'Tratamiento', 'Riesgo Necrosis'],\n      rows: [\n        ['Conmoción', 'No hay desplazamiento', 'Sin ferulización. Control 4 semanas, 6 meses, 1 año', 'Bajo-moderado'],\n        ['Subluxación', 'Movilidad ligera', 'Ferulización flexible 2 semanas', 'Moderado'],\n        ['Extrusión', 'Diente \"salido\", movilidad alta', 'Reposición manual inmediata. Ferulización flexible 2 semanas. Control pulpar a 2–4 semanas. Endodoncia solo si aparece necrosis', 'Alto'],\n        ['Lateral', 'Desplazamiento con enclavamiento cortical', 'Reposición forzada. Ferulización flexible 4 semanas. Rx. Muy alto riesgo de necrosis → control estricto', 'Muy alto'],\n        ['Intrusión', 'Diente \"metido hacia dentro\"', 'Depende edad + severidad: Apex abierto (<17 años): <3mm esperar erupción espontánea, 3-7mm ortodoncia, >7mm cirugía. Apex cerrado: reposición quirúrgica inmediata. Riesgos: reabsorción inflamatoria, reabsorción por reemplazo (anquilosis) → Control radiológico muy estricto', 'Muy alto']\n      ],\n      caption: 'El trauma más grave es la intrusión'\n    },\n    reference: 'IADT 2020 + AAE'\n  },\n  {\n    id: 'trauma-avulsion-protocolo',\n    categoria: 'trauma',\n    title: 'Avulsiones: Protocolo Oficial (IADT 2020)',\n    subtitle: 'El más exigente - tiempo extraoral crítico',\n    shortDescription: 'Procedimiento según si está reimplantado o no',\n    tags: ['trauma', 'avulsión', 'reimplante', 'IADT'],\n    type: 'lista',\n    content: {\n      steps: [\n        'TIEMPO EXTRAORAL: <60 min: mejor pronóstico. >60 min: daño periodontal irreversible',\n        'SI EL DIENTE ESTÁ REIMPLANTADO ANTES DE LLEGAR A CONSULTA: Radiografía, no remover si está en buena posición, ferulización 2 semanas. Lactente: no reimplantar. Profilaxis antibiótica según ADA',\n        'SI NO ESTÁ REIMPLANTADO: 1) Agarrar por corona + lavar suavemente 10 s, 2) Reimplantar inmediatamente si el paciente lo permite, 3) Si no: leche fría, suero o saliva, 4) Revisar alveolo, 5) Reimplantar, 6) Ferulización 2 semanas, 7) Tetraciclina sistémica en adultos / penicilina alternativa'\n      ],\n      notes: 'Protocolo oficial IADT 2020. Tiempo es crítico para pronóstico.'\n    },\n    reference: 'IADT Avulsion Guidelines 2020'\n  },\n  {\n    id: 'trauma-calendario-revisiones',\n    categoria: 'trauma',\n    title: 'Calendario Oficial de Revisiones IADT',\n    subtitle: 'Para panel clínico - seguimiento según tipo de trauma',\n    shortDescription: 'Controles a 2 semanas, 4 semanas, 6-8 semanas, 3-6-12 meses, anual 5 años',\n    tags: ['trauma', 'seguimiento', 'calendario', 'IADT'],\n    type: 'tabla',\n    content: {\n      headers: ['Trauma', '2 semanas', '4 semanas', '6-8 semanas', '3 meses', '6 meses', '1 año', 'Anual 5 años'],\n      rows: [\n        ['Concussion', '−', '✔', '−', '✔', '✔', '✔', '✔'],\n        ['Subluxation', '✔', '✔', '✔', '✔', '✔', '✔', '✔'],\n        ['Extrusión', '✔', '✔', '✔', '✔', '✔', '✔', '✔'],\n        ['Lateral', '✔', '✔', '✔', '✔', '✔', '✔', '✔'],\n        ['Intrusión', '✔', '✔', '✔', '✔', '✔', '✔', '✔'],\n        ['Avulsión', '✔', '✔', '✔', '✔', '✔', '✔', '✔']\n      ],\n      caption: 'Qué revisar: 2 semanas: ferulización, síntomas; 4 semanas: radiografía si luxación; 6–8 semanas: vitalidad; 3 meses: comprobación reabsorciones; 6 meses: CBCT si dudas; 1 año: confirmar estabilidad; Anual 5 años: trauma complejo'\n    },\n    reference: 'IADT Follow-up Protocol 2020'\n  },\n  {\n    id: 'trauma-prevencion-complicaciones',\n    categoria: 'trauma',\n    title: 'Prevención de Complicaciones Post-Trauma',\n    subtitle: 'Ferulización, control pulpar, endodoncia precoz',\n    shortDescription: 'Medidas para minimizar riesgo de reabsorción y necrosis',\n    tags: ['trauma', 'prevención', 'complicaciones'],\n    type: 'lista',\n    content: {\n      steps: [\n        'Ferulización flexible para preservar PDL',\n        'Control pulpar periódico',\n        'Endodoncia precoz en adultos intrusión/avulsión',\n        'Higiene + clorhexidina',\n        'En dientes jóvenes → retrasar endodoncia si es posible'\n      ]\n    },\n    reference: 'IADT 2020'\n  },\n  {\n    id: 'trauma-fichas-rapidas',\n    categoria: 'trauma',\n    title: 'Fichas Rápidas (Guía Rápida ENDOIA)',\n    subtitle: 'Tarjetas tipo \"pocket card\"',\n    shortDescription: 'Intrusión, avulsión, alerta roja post-trauma',\n    tags: ['trauma', 'guía rápida', 'fichas'],\n    type: 'lista',\n    content: {\n      steps: [\n        '⭐ \"¿Qué hago ante una intrusión?\" <3 mm → esperar, 3–7 mm → ortodoncia, >7 mm → quirúrgico. Endo adultos siempre',\n        '⭐ \"¿Qué hago ante una avulsión?\" Reimplante inmediato, ferulización 2 semanas, endo 7–10 días, antibióticos si procede',\n        '⭐ \"Alerta roja post-trauma\" Fiebre, edema, movilidad creciente, cambio color gris, dolor a morder, fístula'\n      ]\n    },\n    reference: 'IADT 2020-2024'\n  }\n];\n\n// ══════════════════════════════════════════════════════════════════════════════\n// URGENCIAS ENDODÓNCICAS (BLOQUE 2 COMPLETO)\n// Fuente: AAE/ESE 2025 + ADA Guidelines\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst urgenciasItems: BibliotecaItem[] = [\n  {\n    id: 'urg-tipos-urgencias',\n    categoria: 'urgencias',\n    title: 'Tipos de Urgencias Endodóncicas en 2025',\n    subtitle: 'Clasificación según diagnóstico 2025 implicado',\n    shortDescription: 'Desde dolor provocado hasta absceso con fiebre',\n    tags: ['urgencias', 'clasificación', '2025'],\n    type: 'tabla',\n    content: {\n      headers: ['Urgencia', 'Diagnóstico 2025 implicado', 'Prioridad', 'Qué requiere'],\n      rows: [\n        ['🔥 Dolor severo provocado o espontáneo', 'Pulpitis moderada / severa', 'Alta', 'Apertura + control'],\n        ['⚡ Dolor espontáneo intenso, que despierta por la noche', 'Pulpitis severa', 'Muy alta', 'Apertura urgente'],\n        ['💀 Dolor al morder, sensación de diente \"largo\"', 'Apical inflamado persistente', 'Media', 'Ajuste oclusal ± tratamiento'],\n        ['🦠 Fiebre, edema, celulitis', 'Absceso apical agudo', 'Crítica', 'Drenaje + antibióticos'],\n        ['⏳ Fístula indolora', 'Absceso apical crónico', 'Baja', 'Tratamiento programable'],\n        ['💥 Traumatismo dental', 'Fracturas, avulsión, luxación', 'Crítica', 'Manejo según IADT'],\n        ['❌ Fracaso de tratamiento previo', 'Apical afectado / avanzado', 'Media', 'Reendodoncia']\n      ]\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'urg-algoritmo-rapido',\n    categoria: 'urgencias',\n    title: 'Algoritmo Rápido de Urgencias según Síntomas (2025)',\n    subtitle: 'Árbol de decisión clínica',\n    shortDescription: 'Sin dolor espontáneo, dolor espontáneo, síntomas apicales',\n    tags: ['urgencias', 'algoritmo', 'síntomas'],\n    type: 'lista',\n    content: {\n      steps: [\n        'A) SIN DOLOR ESPONTÁNEO: Dolor ligero provocado → Pulpitis leve → No urgente. Revisable. Dolor moderado provocado + ligera prolongación → Pulpitis moderada → Urgencia en 24-48 h',\n        'B) DOLOR ESPONTÁNEO: Dolor espontáneo leve a moderado → Pulpitis moderada → Urgencia. Dolor espontáneo intenso, despierta por la noche, irradiado → Pulpitis severa → Urgencia inmediata: apertura, control de inflamación',\n        'C) SÍNTOMAS APICALES: Dolor a la percusión, diente \"largo\" → Apical inflamado persistente → Urgencia. Dolor pulsátil + movilidad + fiebre + edema → Absceso apical agudo → Emergencia clínica'\n      ]\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'urg-manejo-diagnosticos',\n    categoria: 'urgencias',\n    title: 'Manejo Clínico según Diagnóstico (Actualizado 2025)',\n    subtitle: 'De pulpitis leve hasta absceso apical agudo',\n    shortDescription: 'Protocolo completo para cada diagnóstico',\n    tags: ['urgencias', 'manejo', 'protocolo'],\n    type: 'tabla',\n    content: {\n      headers: ['Diagnóstico', 'Clínica', 'Manejo', 'Antibiótico'],\n      rows: [\n        ['🔵 Pulpitis Leve', 'Dolor provocado breve, respuesta normal al frío, no dolor espontáneo', '✔ Remoción de irritantes (caries), restauración adecuada. ❌ No se abre la cámara', '❌ No'],\n        ['🔵 Pulpitis Moderada', 'Dolor provocado prolongado (>10–15 s), puede haber dolor espontáneo leve', '✔ Apertura cameral, remoción de inflamación, analgesia, sellado provisional correcto', '❌ No (salvo signos sistémicos)'],\n        ['🔵 Pulpitis Severa', 'Dolor espontáneo intenso, irradiado, empeora en posición supina', '✔ Apertura cameral inmediata, localizar y drenar si hay sangrado abundante, analgesia potente + bloqueo según caso', '❌ Salvo fiebre o celulitis'],\n        ['🔵 Pulpa Necrótica', 'A veces no hay dolor pulpar, pero sí apical', '✔ Apertura y descompresión si hay presión, irrigación abundante, sellado temporal estanco. ❌ Nunca dejar diente abierto', '❌ Sin infección sistémica'],\n        ['🔵 Apical Inflamado Persistente', 'Dolor al morder, sensación de \"diente largo\", percusión positiva', '✔ Apertura / ajuste oclusal, desinflamación', '❌ No indicados'],\n        ['🔵 Absceso Apical Agudo', 'Fiebre, edema, celulitis, limitación de apertura, dolor pulsátil, movilidad', '✔ Drenaje endodóntico o incisión, analgesia + AINE, control 24–48 h. Derivar si celulitis difusa, compromiso vía aérea, inmunosupresión', '✔ OBLIGATORIO'],\n        ['🔵 Absceso Apical Crónico', 'Fístula, indoloro', '✔ Tratamiento endodóntico (no urgente)', '❌ No indicados']\n      ]\n    },\n    reference: 'AAE/ESE 2025 + ADA Guidelines'\n  },\n  {\n    id: 'urg-medicacion',\n    categoria: 'urgencias',\n    title: 'Medicación en Urgencias (2025)',\n    subtitle: 'Analgesia y antibióticos según evidencia AAE 2022',\n    shortDescription: 'Primera línea, dolor intenso, cuándo antibiótico',\n    tags: ['urgencias', 'medicación', 'analgesia', 'antibióticos'],\n    type: 'lista',\n    content: {\n      steps: [\n        '🔹 ANALGESIA Primera línea: Ibuprofeno 600 mg cada 8 h. Paracetamol 1 g alternado si dolor severo',\n        '🔹 ANALGESIA Dolor muy intenso: Ibuprofeno + Paracetamol combinados (Evidencia AAE 2022)',\n        '🔹 ANTIBIÓTICOS — SOLO si hay infección. ✔ Indicado: Fiebre, edema difuso, celulitis, adenopatías + dolor, imposibilidad de drenaje, paciente inmunodeprimido',\n        '🔹 ANTIBIÓTICOS — ❌ NO indicado en: Pulpitis moderada, Pulpitis severa, Pulpa necrótica sin infección, absceso crónico, dolor pulpar sin fiebre',\n        '🔹 ANTIBIÓTICOS Fármacos según ADA/AAE: Amoxicilina 500 mg / 8 h 5-7 días. Amoxicilina + clavulánico 875/125 mg / 8 h. Alergia: Clindamicina 300 mg / 8 h'\n      ]\n    },\n    reference: 'AAE 2022 + ADA 2024'\n  },\n  {\n    id: 'urg-que-no-hacer',\n    categoria: 'urgencias',\n    title: '¿Qué NO debe hacerse en una urgencia endodóncica?',\n    subtitle: 'Errores frecuentes a evitar',\n    shortDescription: '5 errores críticos en urgencias',\n    tags: ['urgencias', 'errores', 'evitar'],\n    type: 'lista',\n    content: {\n      steps: [\n        '🚫 Dejar un diente abierto',\n        '🚫 Prescribir antibióticos sin infección',\n        '🚫 Obturación sin desinflamación adecuada',\n        '🚫 Pulpotomía parcial en dolor avanzado',\n        '🚫 Drenaje continuo sin sellado'\n      ],\n      alerts: ['Estos son los 5 errores más frecuentes que comprometen el éxito del tratamiento']\n    },\n    reference: 'AAE Best Practices 2024'\n  },\n  {\n    id: 'urg-derivacion',\n    categoria: 'urgencias',\n    title: 'Cuándo Derivar a Urgencias Hospitalarias',\n    subtitle: 'Red flags para derivación inmediata',\n    shortDescription: 'Situaciones de riesgo vital',\n    tags: ['urgencias', 'derivación', 'hospital', 'red flags'],\n    type: 'lista',\n    content: {\n      steps: [\n        'Celulitis submandibular / sublingual',\n        'Disfagia',\n        'Disnea',\n        'Fiebre > 38,5 °C',\n        'Paciente inmunosuprimido',\n        'Niños con edema progresivo'\n      ],\n      alerts: ['⚠️ ESTAS SON EMERGENCIAS MÉDICAS - DERIVAR INMEDIATAMENTE']\n    },\n    reference: 'ADA/AAE Emergency Guidelines 2024'\n  }\n];\n\n// ══════════════════════════════════════════════════════════════════════════════\n// ALGORITMOS DIAGNÓSTICOS Y DE TRATAMIENTO (BLOQUE 3 COMPLETO)\n// Fuente: AAE/ESE 2025 Diagnostic Classification\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst algoritmosDxItems: BibliotecaItem[] = [\n  {\n    id: 'alg-dx-evaluacion-inicial',\n    categoria: 'algoritmos_dx',\n    title: 'Algoritmo Completo de Evaluación Inicial y Diagnóstico (2025)',\n    subtitle: 'Versión oficial AAE/ESE',\n    shortDescription: '5 pasos: historia, pruebas, decisión pulpar, decisión apical, diagnóstico final',\n    tags: ['algoritmo', 'diagnóstico', 'evaluación', 'AAE', 'ESE', '2025'],\n    type: 'algoritmo',\n    content: {\n      steps: [\n        {\n          num: 1,\n          title: 'PASO 1 — Recogida de historia y síntomas',\n          description: 'Solicita: 1) Dolor espontáneo: sí/no, 2) Dolor provocado al frío: intensidad + duración, 3) Dolor al morder/percutir: sí/no, 4) Sensación de diente \"largo\", 5) Fiebre, malestar, edema, 6) Trastornos oclusales / restauración reciente, 7) Historia de traumatismo reciente, 8) Tratamientos previos'\n        },\n        {\n          num: 2,\n          title: 'PASO 2 — Pruebas diagnósticas (core 2025)',\n          description: 'Test frío (Pulpar): Vitalidad + calidad respuesta. Prueba eléctrica (Pulpar): Vitalidad (solo si dudas). Percusión vertical (Apical): Inflamación apical. Palpación apical (Apical): Inflamación cortical. Rx periapical (Apical): PAI 1–5 + lesiones. CBCT si dudas (Apical): Anatomía, fracturas'\n        },\n        {\n          num: 3,\n          title: 'PASO 3 — Decisión diagnóstica pulpar (según tabla 2025)',\n          description: 'Evalúa: 1) Respuesta al frío, 2) Duración, 3) Dolor espontáneo, 4) Hallazgos clínicos adicionales (caries profunda, restauración, exposición, hemorragia). Árbol pulpar 2025: Pulpa normal (sin dolor espontáneo, dolor breve al frío <3–5 s, sin caries/cambios recientes) → Pulpitis leve (dolor provocado breve <10 s, sensible al frío, no dolor espontáneo, caries/restauración profunda) → Pulpitis moderada (dolor provocado prolongado >10–15 s, puede haber dolor espontáneo leve ocasional, inflamación que no revertirá sola) → Pulpitis severa (dolor espontáneo intenso, irradiado, empeora al tumbarse, dolor severo al frío, asociado a caries extensa o exposición pulpar) → Pulpa necrótica (no respuesta al frío, cavidad con olor característico, a veces dolor apical, suele coexistir con inflamación periapical)'\n        },\n        {\n          num: 4,\n          title: 'PASO 4 — Diagnóstico apical (según tabla 2025)',\n          description: 'Usa: Percusión, Palpación, PAI (1–5), CBCT si dudas. Apical normal (percusión normal, palpación normal, PAI 1–2, no dolor) → Apical inflamado inicial (ligera molestia al morder, PAI 2–3, sin edema) → Apical inflamado persistente (dolor claro al morder/percutir, diente \"largo\", PAI 3–4, suele acompañar a Pulpitis severa o necrosis) → Absceso apical agudo (fiebre, edema, dolor pulsátil, movilidad, PAI 4–5, urgencia) → Absceso apical crónico (fístula, poco o nada de dolor)'\n        },\n        {\n          num: 5,\n          title: 'PASO 5 — Decisión final del diagnóstico combinado (pulpar + apical)',\n          description: 'Tu web lo mostrará así: Diagnóstico final: - Pulpar: Pulpitis moderada - Apical: Apical inflamado persistente'\n        }\n      ]\n    },\n    reference: 'AAE/ESE 2025 Diagnostic Algorithm'\n  },\n  {\n    id: 'alg-dx-decision-antibiotica',\n    categoria: 'algoritmos_dx',\n    title: 'Algoritmo de Decisión Antibiótica (2025)',\n    subtitle: 'Cuándo SÍ y cuándo NO',\n    shortDescription: 'Criterios claros para prescripción',\n    tags: ['algoritmo', 'antibióticos', 'ADA', 'AAE'],\n    type: 'lista',\n    content: {\n      steps: [\n        'SÍ antibiótico si existe: Fiebre, edema, celulitis, trismus, adenopatías, paciente inmunodeprimido, imposibilidad de drenaje',\n        'NO antibiótico si existe: Dolor pulpar, Pulpitis moderada, Pulpitis severa, necrosis sin infección, absceso crónico'\n      ]\n    },\n    reference: 'ADA/AAE Antibiotic Stewardship 2024'\n  },\n  {\n    id: 'alg-dx-urgencias-rapido',\n    categoria: 'algoritmos_dx',\n    title: 'Algoritmo de Urgencias (resumen 2025)',\n    subtitle: 'Ideal como diagrama en la web',\n    shortDescription: 'Árbol de decisión rápido',\n    tags: ['algoritmo', 'urgencias', 'árbol decisión'],\n    type: 'lista',\n    content: {\n      steps: [\n        'Dolor espontáneo intenso? → Sí → Pulpitis severa → Endo urgente. → No → Dolor provocado prolongado? → Sí → Pulpitis moderada. → No → Pulpitis leve',\n        'Dolor al morder/percutir? → Sí → Apical inflamado / absceso según síntomas',\n        'Fiebre/Edema? → Sí → Absceso agudo (emergencia)'\n      ]\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'alg-dx-seguimiento',\n    categoria: 'algoritmos_dx',\n    title: 'Algoritmo de Seguimiento (1–3–6 meses)',\n    subtitle: 'Evaluación de éxito del tratamiento',\n    shortDescription: 'Criterios de éxito y fracaso',\n    tags: ['algoritmo', 'seguimiento', 'evaluación'],\n    type: 'lista',\n    content: {\n      steps: [\n        'Pulpar y apical normal → éxito',\n        'Apical inflamado mejorando → reevaluar',\n        'Lesión igual o mayor → fracaso',\n        'Dolor al morder persistente → reevaluar',\n        'Fístula → fracaso'\n      ]\n    },\n    reference: 'AAE Outcome Assessment 2024'\n  }\n];\n\nconst algoritmosTxItems: BibliotecaItem[] = [\n  {\n    id: 'alg-tx-decision-terapeutica',\n    categoria: 'algoritmos_tx',\n    title: 'Algoritmo de Decisión Terapéutica según Diagnóstico 2025',\n    subtitle: 'Basado en la clasificación oficial',\n    shortDescription: 'De pulpa normal hasta absceso agudo',\n    tags: ['algoritmo', 'tratamiento', 'decisión'],\n    type: 'tabla',\n    content: {\n      headers: ['Diagnóstico pulpar', 'Tratamiento'],\n      rows: [\n        ['Pulpa normal', 'No tratamiento'],\n        ['Pulpitis leve', 'Restauración'],\n        ['Pulpitis moderada', 'Endodoncia'],\n        ['Pulpitis severa', 'Endodoncia urgente'],\n        ['Pulpa necrótica', 'Endodoncia completa']\n      ],\n      caption: 'Diagnóstico apical: Apical normal (no intervención), Apical inflamado inicial (ajuste oclusal ± endodoncia), Apical inflamado persistente (endodoncia confirmada), Absceso agudo (drenaje + antibióticos), Absceso crónico (endodoncia programada)'\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'alg-tx-combinacion-pulpar-apical',\n    categoria: 'algoritmos_tx',\n    title: 'Algoritmo de Manejo según Combinación Pulpar/Apical',\n    subtitle: 'Decisión integradora',\n    shortDescription: '5 escenarios clínicos frecuentes',\n    tags: ['algoritmo', 'combinación', 'pulpar', 'apical'],\n    type: 'lista',\n    content: {\n      steps: [\n        '🟦 1. Pulpitis moderada + Apical normal → Endodoncia NO urgente',\n        '🟦 2. Pulpitis moderada + Apical inflamado persistente → Endodoncia en 24–48 h',\n        '🔥 3. Pulpitis severa + Apical inflamado persistente → Endodoncia URGENTE',\n        '💀 4. Pulpa necrótica + Absceso apical agudo → Drenaje + Antibióticos + Endo',\n        '🟢 5. Pulpa normal + Apical inflamado (trauma) → Manejo traumático según IADT'\n      ]\n    },\n    reference: 'AAE/ESE 2025'\n  }\n];\n\n// ══════════════════════════════════════════════════════════════════════════════\n// FAQ CLÍNICO + CASOS TÍPICOS (BLOQUE 7 COMPLETO)\n// Fuente: Playbook ENDOIA basado en AAE/ESE 2025\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst faqItems: BibliotecaItem[] = [\n  {\n    id: 'faq-respuesta-frio',\n    categoria: 'faq',\n    title: '¿Por qué la respuesta al frío es tan importante?',\n    subtitle: 'Fundamentos del diagnóstico pulpar 2025',\n    shortDescription: 'Diferencia Pulpitis moderada vs severa vs necrótica',\n    tags: ['FAQ', 'frío', 'diagnóstico', 'pulpar'],\n    type: 'texto',\n    content: {\n      question: '¿Por qué la respuesta al frío es tan importante?',\n      answer: 'Porque hoy, con la clasificación AAE/ESE 2025, el diagnóstico pulpar depende principalmente de: si el estímulo desencadena dolor, si persiste después del estímulo, y si el paciente tiene síntomas espontáneos. La respuesta al frío ayuda a diferenciar Pulpitis moderada vs Pulpitis severa vs Pulpa necrótica.'\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'faq-fistula-diagnostico',\n    categoria: 'faq',\n    title: 'Si hay fístula, ¿el diagnóstico pulpar es automático?',\n    subtitle: 'Diferencia entre diagnóstico pulpar y apical',\n    shortDescription: 'No. La fístula habla del estado apical, no de la pulpa',\n    tags: ['FAQ', 'fístula', 'diagnóstico'],\n    type: 'texto',\n    content: {\n      question: 'Si hay fístula, ¿el diagnóstico pulpar es automático?',\n      answer: 'No. La fístula te habla del estado apical, no de la pulpa. Puede coexistir: Pulpa necrótica + Absceso apical crónico (con fístula) o incluso Pulpa necrótica + Sinus tract sin dolor.'\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'faq-antibiotico-fistula',\n    categoria: 'faq',\n    title: '¿Debo usar antibiótico en un absceso apical crónico con fístula?',\n    subtitle: 'Regla de oro',\n    shortDescription: '❌ NO. Si hay fístula = drenaje, no requiere antibiótico',\n    tags: ['FAQ', 'antibiótico', 'fístula', 'absceso'],\n    type: 'texto',\n    content: {\n      question: '¿Debo usar antibiótico en un absceso apical crónico con fístula?',\n      answer: '❌ NO. Si hay fístula = el absceso está drenando, no requiere antibiótico. Solo tratar causa → endodoncia.'\n    },\n    reference: 'ADA/AAE 2024'\n  },\n  {\n    id: 'faq-dolor-insoportable',\n    categoria: 'faq',\n    title: '¿Qué hago si el dolor es insoportable pero no veo infección?',\n    subtitle: 'Abordaje correcto sin antibióticos',\n    shortDescription: 'Abordaje pulpar + analgesia escalonada, NO antibiótico',\n    tags: ['FAQ', 'dolor', 'tratamiento'],\n    type: 'texto',\n    content: {\n      question: '¿Qué hago si el dolor es insoportable pero no veo infección?',\n      answer: '→ Abordaje pulpar: acceso y control de la causa. → Analgesia escalonada (del bloque 6). → No antibiótico salvo criterios sistémicos.'\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'faq-celulitis-incision',\n    categoria: 'faq',\n    title: '¿La celulitis siempre requiere incisión?',\n    subtitle: 'Cuándo incidir y cuándo derivar',\n    shortDescription: 'Si fluctúa → incidir y drenar. Si muy difusa y profunda → derivación',\n    tags: ['FAQ', 'celulitis', 'incisión'],\n    type: 'texto',\n    content: {\n      question: '¿La celulitis siempre requiere incisión?',\n      answer: 'La mayoría sí, salvo que sea muy difusa y profunda (derivación). Si fluctúa → incidir y drenar.'\n    },\n    reference: 'AAE Emergency Guidelines 2024'\n  },\n  {\n    id: 'faq-cuando-cerrar-diente',\n    categoria: 'faq',\n    title: '¿Cuándo cierro el diente en la primera visita?',\n    subtitle: 'Regla de oro: NUNCA dejar abierto',\n    shortDescription: 'Si el caso está controlado y seco → NO DEJARLO ABIERTO',\n    tags: ['FAQ', 'sellado', 'provisional'],\n    type: 'texto',\n    content: {\n      question: '¿Cuándo cierro el diente en la primera visita?',\n      answer: 'Si el caso está controlado y seco → NO DEJARLO ABIERTO. Siempre con restauración provisional estanca.'\n    },\n    reference: 'AAE Best Practices 2024'\n  },\n  {\n    id: 'faq-dolor-espontaneo-vs-persistente',\n    categoria: 'faq',\n    title: '¿Qué diferencia hay entre dolor espontáneo y dolor persistente?',\n    subtitle: 'Clave en el diagnóstico pulpar',\n    shortDescription: 'Espontáneo: sin estímulo. Persistente: tras estímulo y no se va rápido',\n    tags: ['FAQ', 'dolor', 'diagnóstico'],\n    type: 'texto',\n    content: {\n      question: '¿Qué diferencia hay entre dolor espontáneo y dolor persistente?',\n      answer: 'Espontáneo: aparece solo, sin estímulo. Persistente: aparece tras un estímulo (frío/calor) y no se va rápido. Esto es clave en el diagnóstico pulpar.'\n    },\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'caso-1-molar-dolor-frio',\n    categoria: 'faq',\n    title: 'CASO 1 — Molar inferior con dolor intenso al frío que dura 20–30 s',\n    subtitle: 'Caso típico de Pulpitis moderada',\n    shortDescription: 'Dolor no espontáneo, frío positivo, persistencia moderada',\n    tags: ['caso', 'Pulpitis moderada', 'ejemplo'],\n    type: 'texto',\n    content: {\n      description: 'Molar inferior con dolor intenso al frío que dura 20–30 s. Dolor no espontáneo, frío positivo, persistencia moderada, sondaje normal, percusión negativa, Rx normal.',\n      clinicalSigns: [\n        '👉 Diagnóstico pulpar: Pulpitis moderada',\n        '👉 Diagnóstico apical: Sin alteración apical'\n      ],\n      management: '👉 Tratamiento: Apertura en 24–48 h según disponibilidad; analgesia combinada.'\n    },\n    reference: 'Caso clínico ENDOIA'\n  },\n  {\n    id: 'caso-2-dolor-pulsatil-madrugada',\n    categoria: 'faq',\n    title: 'CASO 2 — Paciente llega de madrugada con dolor pulsátil que no lo deja dormir',\n    subtitle: 'Caso típico de Pulpitis severa',\n    shortDescription: 'Dolor espontáneo, frío muy doloroso y persistente',\n    tags: ['caso', 'Pulpitis severa', 'urgencia'],\n    type: 'texto',\n    content: {\n      description: 'Paciente llega de madrugada con dolor pulsátil que no lo deja dormir. Dolor espontáneo, frío muy doloroso y persistente, percusión positiva moderada, Rx sin lesión evidente.',\n      clinicalSigns: [\n        '👉 Pulpar: Pulpitis severa',\n        '👉 Apical: Sin alteración apical'\n      ],\n      management: '👉 Tratamiento: Apertura urgente + analgesia. (No antibiótico.)'\n    },\n    reference: 'Caso clínico ENDOIA'\n  },\n  {\n    id: 'caso-3-fistula-sin-dolor',\n    categoria: 'faq',\n    title: 'CASO 3 — Sin dolor, pero fístula presente',\n    subtitle: 'Caso típico de absceso apical crónico',\n    shortDescription: 'Frío negativo, sin síntomas, fístula evidente',\n    tags: ['caso', 'absceso crónico', 'fístula'],\n    type: 'texto',\n    content: {\n      description: 'Sin dolor, pero fístula presente. Frío negativo, sin síntomas, fístula evidente, radiolucidez apical.',\n      clinicalSigns: [\n        '👉 Pulpar: Pulpa necrótica',\n        '👉 Apical: Absceso apical crónico'\n      ],\n      management: '👉 Tratamiento: Endodoncia; no antibiótico.'\n    },\n    reference: 'Caso clínico ENDOIA'\n  },\n  {\n    id: 'caso-4-celulitis-fiebre',\n    categoria: 'faq',\n    title: 'CASO 4 — Celulitis facial, trismus y fiebre',\n    subtitle: 'Caso típico de absceso apical agudo con extensión',\n    shortDescription: 'Dolor variable, edema difuso, fiebre, dificultad apertura bucal',\n    tags: ['caso', 'absceso agudo', 'celulitis', 'emergencia'],\n    type: 'texto',\n    content: {\n      description: 'Celulitis facial, trismus y fiebre. Dolor variable, edema difuso, fiebre, dificultad apertura bucal, radiolucidez + dolor a percusión.',\n      clinicalSigns: [\n        '👉 Pulpar: Pulpa necrótica (asumir)',\n        '👉 Apical: Absceso apical agudo con extensión'\n      ],\n      management: '👉 Tratamiento: Drenaje + antibiótico (amoxicilina-clavulánico). Si compromiso vías aéreas → hospital.'\n    },\n    reference: 'Caso clínico ENDOIA'\n  },\n  {\n    id: 'caso-5-trauma-luxacion',\n    categoria: 'faq',\n    title: 'CASO 5 — Traumatismo con luxación y dolor a la percusión',\n    subtitle: 'Caso típico de inflamación apical traumática',\n    shortDescription: 'Tacto dental alterado, movilidad, PDL ensanchado',\n    tags: ['caso', 'trauma', 'luxación'],\n    type: 'texto',\n    content: {\n      description: 'Traumatismo con luxación y dolor a la percusión. Tacto dental alterado, movilidad, PDL ensanchado, desplazamiento del diente.',\n      clinicalSigns: [\n        '👉 Pulpar: Estado pulpar a monitorizar (riesgo de necrosis)',\n        '👉 Apical: Inflamación apical traumática'\n      ],\n      management: '👉 Tratamiento: Reubicación + férula + seguimiento estricto.'\n    },\n    reference: 'Caso clínico ENDOIA basado en IADT'\n  },\n  {\n    id: 'errores-frecuentes',\n    categoria: 'faq',\n    title: '⚠️ ERRORES FRECUENTES (Y CÓMO EVITARLOS)',\n    subtitle: '10 errores críticos en endodoncia',\n    shortDescription: 'De diagnosticar solo por Rx hasta no registrar seguimiento',\n    tags: ['errores', 'evitar', 'mejores prácticas'],\n    type: 'lista',\n    content: {\n      steps: [\n        '❌ 1. Diagnosticar por radiografía solo → La radiografía habla del estado apical, no del pulpar',\n        '❌ 2. Dar antibiótico en lugar de drenar → Nunca sustituye al tratamiento local',\n        '❌ 3. Llamar \"pulpitis severa\" a lo que ahora es: Pulpitis moderada, Pulpitis severa → La terminología antigua ya no aplica',\n        '❌ 4. No registrar sondaje → Es fundamental para descartar fractura/periodontitis combinada',\n        '❌ 5. No valorar factores sistémicos → Inmunodeprimidos → más riesgo → antibiótico si infección',\n        '❌ 6. Hacer incisión sin fluctuación → Solo si hay clara colección purulenta',\n        '❌ 7. Dejar el diente abierto → Gran error → riesgo de contaminación y fracaso',\n        '❌ 8. No derivar a hospital cuando hay riesgo vital → Vías aéreas, disnea, fiebre persistente',\n        '❌ 9. No registrar seguimiento → El control a 1–3–6 meses es clave para tu fase predictiva (IA en fase 2)',\n        '❌ 10. No seguir la clasificación moderna → Muchos clínicos siguen usando nomenclaturas antiguas → sesgo diagnóstico. ENDOIA va a unificar y modernizar esto'\n      ],\n      alerts: ['⚠️ Estos son los 10 errores más frecuentes que comprometen el diagnóstico y tratamiento']\n    },\n    reference: 'AAE/ESE 2025 + Best Practices'\n  }\n];\n\n// ══════════════════════════════════════════════════════════════════════════════\n// RECURSOS OFICIALES\n// ══════════════════════════════════════════════════════════════════════════════\n\nconst recursosItems: BibliotecaItem[] = [\n  {\n    id: 'rec-iadt',\n    categoria: 'recursos',\n    title: 'International Association of Dental Traumatology (IADT)',\n    subtitle: 'Guías de manejo de trauma dental',\n    shortDescription: 'Protocolos actualizados 2020-2024 para traumatismos dentoalveolares',\n    tags: ['recursos', 'IADT', 'trauma'],\n    type: 'enlace',\n    content: null,\n    externalUrl: 'https://www.iadt-dentaltrauma.org/',\n    reference: 'IADT 2020-2024'\n  },\n  {\n    id: 'rec-aae-ese-2025',\n    categoria: 'recursos',\n    title: 'Clasificación AAE/ESE 2025',\n    subtitle: 'Sistema de diagnóstico pulpar y apical actualizado',\n    shortDescription: 'Documento oficial de consenso AAE/ESE para diagnóstico endodóntico',\n    tags: ['recursos', 'clasificación', 'AAE', 'ESE', '2025'],\n    type: 'enlace',\n    content: null,\n    externalUrl: 'https://www.aae.org/specialty/clinical-resources/diagnostic-terms/',\n    reference: 'AAE/ESE 2025'\n  },\n  {\n    id: 'rec-ada-antibiotics',\n    categoria: 'recursos',\n    title: 'ADA Antibiotic Stewardship',\n    subtitle: 'Guías de uso responsable de antibióticos',\n    shortDescription: 'Criterios actualizados para prescripción antibiótica en odontología',\n    tags: ['recursos', 'antibióticos', 'ADA'],\n    type: 'enlace',\n    content: null,\n    externalUrl: 'https://www.ada.org/resources/research/science-and-research-institute/oral-health-topics/antibiotic-stewardship',\n    reference: 'ADA 2024'\n  }\n];\n\n// Exportar todos los items\nexport const allBibliotecaItems: BibliotecaItem[] = [\n  ...clasificacionItems,\n  ...reabsorcionesItems,\n  ...farmacologiaItems,\n  ...traumaItems,\n  ...urgenciasItems,\n  ...algoritmosDxItems,\n  ...algoritmosTxItems,\n  ...faqItems,\n  ...recursosItems\n];\n\nexport const bibliotecaItemsByCategory = {\n  clasificacion: clasificacionItems,\n  reabsorciones: reabsorcionesItems,\n  farmacologia: farmacologiaItems,\n  trauma: traumaItems,\n  urgencias: urgenciasItems,\n  algoritmos_dx: algoritmosDxItems,\n  algoritmos_tx: algoritmosTxItems,\n  faq: faqItems,\n  recursos: recursosItems\n};\n\nexport const bibliotecaData = allBibliotecaItems;\n\nexport function getCategoriaLabel(categoria: BibliotecaCategoria): string {\n  const labels: Record<BibliotecaCategoria, string> = {\n    clasificacion: 'Clasificación AAE/ESE 2025',\n    reabsorciones: 'Reabsorciones Radiculares',\n    farmacologia: 'Farmacología y Protocolos',\n    trauma: 'Traumatología (IADT 2020-2024)',\n    urgencias: 'Urgencias Endodóncicas',\n    algoritmos_dx: 'Algoritmos Diagnósticos',\n    algoritmos_tx: 'Algoritmos de Tratamiento',\n    recursos: 'Recursos Oficiales',\n    faq: 'FAQ Clínico + Casos'\n  };\n  return labels[categoria];\n}\n\nexport function getCategoriaIcon(categoria: BibliotecaCategoria): string {\n  const icons: Record<BibliotecaCategoria, string> = {\n    clasificacion: 'layers',\n    reabsorciones: 'git-branch',\n    farmacologia: 'pill',\n    trauma: 'activity',\n    urgencias: 'alert-circle',\n    algoritmos_dx: 'git-branch',\n    algoritmos_tx: 'git-merge',\n    recursos: 'external-link',\n    faq: 'help-circle'\n  };\n  return icons[categoria];\n}\n","path":null,"size_bytes":73690,"size_tokens":null},"ENDOIA/client/src/pages/Clinico/HomeClinico.tsx":{"content":"export default function HomeClinico() {\n  return (\n    <div className=\"container mx-auto p-6\">\n      <h1 className=\"text-3xl font-bold\">Panel del Clínico</h1>\n    </div>\n  );\n}\n","path":null,"size_bytes":178,"size_tokens":null},"ENDOIA/client/src/lib/fakeIA.ts":{"content":"interface DatosClinico {\n  dolorEspontaneo: string;\n  respuestaFrio: string;\n  lingeringSeg: string;\n  percusionDolor: string;\n  radiolucidezApical: string;\n  profundidadCaries: string;\n  sangradoControlable: string;\n}\n\ninterface ResultadoIA {\n  pulpalDxIA: string;\n  apicalDxIA: string;\n  ttoPropuestoIA: string;\n}\n\nexport function fakeIA(datos: DatosClinico): ResultadoIA {\n  const {\n    dolorEspontaneo,\n    respuestaFrio,\n    lingeringSeg,\n    percusionDolor,\n    radiolucidezApical,\n    profundidadCaries,\n    sangradoControlable,\n  } = datos;\n\n  let pulpalDx = \"Inconclusive pulp status\";\n\n  if (respuestaFrio === \"0_no_responde\") {\n    pulpalDx = \"Pulp necrosis\";\n  } else {\n    const lingerLong = Number(lingeringSeg || 0) > 5;\n    if (dolorEspontaneo === \"si\" || lingerLong) {\n      pulpalDx = \"Severe pulpitis\";\n    } else {\n      if (respuestaFrio === \"2_aumentada\" || Number(lingeringSeg || 0) > 0) {\n        pulpalDx = \"Mild pulpitis\";\n      } else {\n        if (\n          respuestaFrio === \"1_normal\" &&\n          (profundidadCaries === \"superficial\" ||\n            profundidadCaries === \"moderada\")\n        ) {\n          pulpalDx = \"Hypersensitive pulp\";\n        } else {\n          if (\n            dolorEspontaneo === \"no\" &&\n            (respuestaFrio === \"1_normal\" || respuestaFrio === \"2_aumentada\") &&\n            Number(lingeringSeg || 0) <= 5\n          ) {\n            pulpalDx = \"Clinically normal / stable pulp\";\n          }\n        }\n      }\n    }\n  }\n\n  let apicalDx = \"Apical tissues clinically normal\";\n  if (radiolucidezApical === \"si\" && percusionDolor === \"si\") {\n    apicalDx = \"Symptomatic apical periodontitis (localized)\";\n  } else if (radiolucidezApical === \"si\" && percusionDolor === \"no\") {\n    apicalDx = \"Asymptomatic apical periodontitis (localized)\";\n  } else if (percusionDolor === \"si\" && radiolucidezApical === \"no\") {\n    apicalDx = \"Possible acute apical inflammation (no clear radiolucency)\";\n  }\n\n  let tto = \"Monitorizar / manejo restaurador conservador\";\n\n  if (pulpalDx === \"Clinically normal / stable pulp\") {\n    tto = \"Restaurar o proteger estructura; no endodoncia indicada\";\n  } else if (pulpalDx === \"Hypersensitive pulp\") {\n    tto = \"Protección dentinaria / sellado y control; no endodoncia inicial\";\n  } else if (pulpalDx === \"Mild pulpitis\") {\n    tto = \"Tratamiento restaurador o terapia pulpar vital selectiva\";\n  } else if (pulpalDx === \"Severe pulpitis\") {\n    if (sangradoControlable === \"si\") {\n      tto = \"Pulpotomía vital (parcial/total) bajo aislamiento\";\n    } else {\n      tto = \"Endodoncia completa (RCT)\";\n    }\n  } else if (pulpalDx === \"Pulp necrosis\") {\n    tto = \"Endodoncia completa (RCT) / desinfección del sistema radicular\";\n  } else if (pulpalDx === \"Inconclusive pulp status\") {\n    tto = \"Reevaluar; control clínico y radiográfico antes de intervenir\";\n  }\n\n  return {\n    pulpalDxIA: pulpalDx,\n    apicalDxIA: apicalDx,\n    ttoPropuestoIA: tto,\n  };\n}\n","path":null,"size_bytes":2947,"size_tokens":null},"ENDOIA/client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"ENDOIA/design_guidelines.md":{"content":"# Design Guidelines: Clinical Education Platform\n\n## Design Approach\n**Selected Approach:** Clean Professional System - Medical/Educational Interface\n**Justification:** Medical education applications require clarity, trust, and efficiency. Drawing inspiration from modern medical platforms (Epic, Doximity) and educational tools (Canvas, Coursera), prioritizing information hierarchy and professional credibility over visual flair.\n\n**Core Principles:**\n- Medical-grade clarity and precision\n- Role-based interface differentiation\n- Trust through professional restraint\n- Efficient information architecture\n\n## Typography System\n\n**Font Families:**\n- Primary: Inter (via Google Fonts) - UI elements, body text\n- Secondary: JetBrains Mono - Code snippets, AI responses, technical data\n\n**Hierarchy:**\n- Page Headers: text-3xl font-semibold (Clinical/Tutor View titles)\n- Section Headers: text-xl font-medium\n- Subsections: text-lg font-medium\n- Body Text: text-base font-normal\n- Captions/Meta: text-sm text-gray-600\n- AI Responses: text-base font-mono leading-relaxed\n\n## Layout System\n\n**Spacing Primitives:** Tailwind units of 4, 6, 8, and 12\n- Component padding: p-6\n- Section spacing: space-y-8\n- Card margins: gap-6\n- Page containers: py-12 px-6\n\n**Container Strategy:**\n- Main wrapper: max-w-7xl mx-auto\n- Content areas: max-w-4xl for reading-heavy sections\n- Two-column layouts: grid-cols-1 lg:grid-cols-2 gap-8 for comparative views\n\n## Navigation & Layout Structure\n\n**Top Navigation Bar:**\n- Fixed header with role switcher (Clinical/Tutor toggle)\n- Logo/title on left\n- User profile and settings on right\n- Height: h-16\n- Shadow: shadow-sm for subtle elevation\n\n**View Switching:**\n- Tab-style navigation between Clinical and Tutor modes\n- Active state with bottom border indicator (border-b-2)\n- Inactive tabs with hover state\n- Icons (Heroicons) accompanying labels\n\n## Component Library\n\n### Core Components\n\n**Clinical View Interface:**\n- Case presentation cards with white backgrounds, rounded-lg, shadow-md\n- Patient scenario sections with clear visual hierarchy\n- AI interaction panel: fixed bottom or side panel\n- Input textarea with border-2, rounded-lg, focus:ring-2\n- Response display area with bg-gray-50, p-6, rounded-lg\n- Action buttons prominently placed\n\n**Tutor View Interface:**\n- Dashboard grid showing student progress (grid-cols-1 md:grid-cols-3)\n- Case management table with alternating row backgrounds\n- Student interaction logs in timeline format\n- Analytics cards with key metrics (border-l-4 accent stripe)\n\n### Forms & Inputs\n- Text inputs: border-gray-300, rounded-md, px-4 py-2.5\n- Focus states: ring-2 ring-offset-2\n- Textareas for long-form content: min-h-32\n- Select dropdowns with custom styling\n- Submit buttons: px-6 py-3 rounded-lg font-medium\n\n### Data Display\n- Cards: bg-white rounded-lg shadow p-6\n- Tables: Striped rows, hover states, fixed headers for scrolling\n- Lists: Divided list items with py-4 spacing\n- Status badges: Inline pills with rounded-full, px-3 py-1, text-sm\n- Progress indicators for student advancement\n\n### AI Interface Panel\n- Distinct visual container: border-2 rounded-xl\n- Message bubbles: User (text-right, bg-blue-50) vs AI (text-left, bg-gray-50)\n- Typing indicator animation\n- Clear input field with send button\n- Conversation history scrollable area\n\n### Overlays & Modals\n- Confirmation dialogs: Centered, max-w-md, shadow-2xl\n- Case detail overlays: Slide-in panel from right (w-96 lg:w-1/3)\n- Backdrop: bg-black bg-opacity-50\n- Close buttons: Absolute top-right with hover state\n\n## Icons\n**Library:** Heroicons (via CDN)\n**Usage:**\n- Navigation: AcademicCapIcon, UserGroupIcon\n- Actions: PaperAirplaneIcon (send), PencilIcon (edit), TrashIcon (delete)\n- Status: CheckCircleIcon (complete), ClockIcon (pending), ExclamationCircleIcon (alert)\n- Size: w-5 h-5 for inline, w-6 h-6 for buttons\n\n## Animations\n**Minimal, purposeful motion:**\n- Page transitions: fade-in (200ms)\n- AI response: Gentle slide-up with fade\n- Tab switching: Quick crossfade\n- Button feedback: scale transform on active (scale-95)\n\n## Accessibility\n- Semantic HTML throughout (nav, main, section, article)\n- ARIA labels for role switcher and interactive elements\n- Focus visible states with ring utilities\n- Sufficient contrast ratios (WCAG AA minimum)\n- Keyboard navigation for all interactive elements\n- Screen reader announcements for AI responses\n\n## Images\n**No hero images required.** This is a functional application interface.\n\n**Supporting visuals:**\n- Placeholder avatars for users (rounded-full w-10 h-10)\n- Medical illustration placeholders in case scenarios (if provided)\n- Empty state illustrations for no data conditions\n\n## Responsive Behavior\n- Mobile: Single column, stacked navigation, collapsible panels\n- Tablet: Two-column grids where appropriate\n- Desktop: Full three-column layouts for dashboards, side panels visible\n- Breakpoints: Standard Tailwind (sm, md, lg, xl)\n\n## Role-Specific Design Distinctions\n\n**Clinical View:** Learner-focused, emphasis on case exploration and AI guidance\n- Prominent case display\n- Easy-access AI chat interface\n- Progress tracking visible but secondary\n\n**Tutor View:** Instructor-focused, analytics and management priority\n- Dashboard with overview metrics\n- Detailed student interaction logs\n- Case creation/editing workflows\n- Batch operations for managing multiple students","path":null,"size_bytes":5392,"size_tokens":null},"ENDOIA/client/src/lib/recomendacionesBiblioteca.ts":{"content":"// ══════════════════════════════════════════════════════════════════════════════\n// SISTEMA DE RECOMENDACIONES AUTOMÁTICAS BASADAS EN BIBLIOTECA CLÍNICA ENDOIA\n// Genera recomendaciones personalizadas según diagnósticos AAE/ESE 2025\n// Noviembre 2025\n// ══════════════════════════════════════════════════════════════════════════════\n\nexport interface RecomendacionesClinicas {\n  analgesia: string;\n  planActuacion: string;\n  urgencia: 'baja' | 'media' | 'alta' | 'critica';\n  antibiotico: boolean;\n  notasAdicionales: string[];\n}\n\n/**\n * Genera recomendaciones clínicas automáticas basadas en diagnósticos AAE/ESE 2025\n * Integra conocimiento de la biblioteca clínica ENDOIA\n * Recibe diagnósticos en ESPAÑOL (lengua canónica del sistema)\n */\nexport function generarRecomendacionesBiblioteca(\n  pulpalDx: string,\n  apicalDx: string,\n  sangradoControlable?: string\n): RecomendacionesClinicas {\n  \n  // ─────────────────────────────────────────────────────────────────────────\n  // ANALGESIA según diagnóstico pulpar\n  // ─────────────────────────────────────────────────────────────────────────\n  let analgesia = \"No se requiere analgesia específica\";\n  \n  if (pulpalDx === \"Pulpitis leve\") {\n    analgesia = \"Ibuprofeno 400-600 mg/8h si dolor leve. Paracetamol 1g/8h como alternativa.\";\n  } else if (pulpalDx === \"Pulpitis severa\") {\n    analgesia = \"Ibuprofeno 600 mg + Paracetamol 1g combinados (esquema potente AAE 2022). Reevaluar en 24-48h.\";\n  } else if (apicalDx.includes(\"sintomática\") || apicalDx.includes(\"sistémica\")) {\n    analgesia = \"Ibuprofeno 600 mg/8h + Paracetamol 1g alternado. Control inflamación es prioritario.\";\n  }\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // PLAN DE ACTUACIÓN según combinación diagnóstica\n  // ─────────────────────────────────────────────────────────────────────────\n  let planActuacion = \"\";\n  let urgencia: 'baja' | 'media' | 'alta' | 'critica' = 'baja';\n  let antibiotico = false;\n  const notasAdicionales: string[] = [];\n\n  // CASO 1: Pulpa normal o hipersensible\n  if (pulpalDx === \"Pulpa normal\" || pulpalDx === \"Hipersensibilidad pulpar\") {\n    planActuacion = \"Restauración o protección dentinaria. No se requiere endodoncia. Control en 1-3 meses.\";\n    urgencia = 'baja';\n  }\n\n  // CASO 2: Pulpitis leve\n  else if (pulpalDx === \"Pulpitis leve\") {\n    if (apicalDx === \"Tejidos apicales clínicamente normales\") {\n      planActuacion = \"Tratamiento restaurador conservador o terapia pulpar vital selectiva. Control en 2-4 semanas.\";\n      urgencia = 'baja';\n      notasAdicionales.push(\"Remoción de irritantes (caries), restauración adecuada.\");\n      notasAdicionales.push(\"❌ No abrir cámara pulpar si no hay indicación.\");\n    } else {\n      planActuacion = \"Evaluar extensión de lesión. Considerar endodoncia si síntomas progresan.\";\n      urgencia = 'media';\n    }\n  }\n\n  // CASO 3: Pulpitis severa\n  else if (pulpalDx === \"Pulpitis severa\") {\n    if (sangradoControlable === \"si\") {\n      planActuacion = \"Pulpotomía vital (parcial o completa) bajo aislamiento absoluto. Analgesia potente + bloqueo anestésico.\";\n      urgencia = 'alta';\n      notasAdicionales.push(\"El sangrado controlable indica pulpa vital inflamada.\");\n      notasAdicionales.push(\"Técnica: localizar y drenar sangrado, analgesia combinada.\");\n    } else {\n      planActuacion = \"Endodoncia completa URGENTE. Apertura cameral inmediata, desinflamación, sellado provisional estanco.\";\n      urgencia = 'alta';\n      notasAdicionales.push(\"❌ NUNCA dejar el diente abierto.\");\n    }\n    \n    if (apicalDx.includes(\"sintomática\")) {\n      planActuacion += \" Ajuste oclusal si dolor a la percusión.\";\n      notasAdicionales.push(\"Diente puede sentirse 'largo' - ajustar oclusión.\");\n    }\n  }\n\n  // CASO 4: Necrosis pulpar (Pulpa necrótica)\n  else if (pulpalDx === \"Pulpa necrótica\") {\n    if (apicalDx === \"Tejidos apicales clínicamente normales\") {\n      planActuacion = \"Endodoncia completa. Desinfección del sistema radicular. No urgente si asintomático.\";\n      urgencia = 'media';\n      notasAdicionales.push(\"Apertura y descompresión si hay presión, irrigación abundante.\");\n      notasAdicionales.push(\"Sellado temporal estanco obligatorio.\");\n    } else if (apicalDx.includes(\"asintomática\")) {\n      planActuacion = \"Endodoncia programada. Tratamiento no urgente pero necesario.\";\n      urgencia = 'media';\n      notasAdicionales.push(\"Absceso crónico con fístula: no antibiótico indicado.\");\n    } else if (apicalDx.includes(\"sintomática\")) {\n      planActuacion = \"Endodoncia URGENTE + drenaje endodóntico. Desinflamación y control en 24-48h.\";\n      urgencia = 'alta';\n      notasAdicionales.push(\"Dolor pulsátil, movilidad, percusión positiva → drenaje prioritario.\");\n    } else if (apicalDx.includes(\"sistémica\")) {\n      planActuacion = \"EMERGENCIA CLÍNICA: Drenaje endodóntico o incisión + antibióticos. Derivar si celulitis difusa o compromiso vía aérea.\";\n      urgencia = 'critica';\n      antibiotico = true;\n      notasAdicionales.push(\"✔ ANTIBIÓTICO OBLIGATORIO: Fiebre, edema difuso, celulitis, trismus.\");\n      notasAdicionales.push(\"Primera elección: Amoxicilina 500mg/8h 5-7 días.\");\n      notasAdicionales.push(\"Alergia penicilina: Clindamicina 300mg/8h.\");\n    } else if (apicalDx.includes(\"sinusal\")) {\n      planActuacion = \"Endodoncia completa. Fístula indica drenaje crónico - no antibiótico necesario.\";\n      urgencia = 'media';\n      notasAdicionales.push(\"❌ No antibiótico: absceso crónico drena espontáneamente.\");\n    } else if (apicalDx.includes(\"inconcluso\")) {\n      planActuacion = \"Endodoncia indicada por necrosis pulpar. Reevaluación apical en 1-2 semanas para aclarar estado periapical.\";\n      urgencia = 'media';\n      notasAdicionales.push(\"Estado apical inconcluso: realizar CBCT o rx adicionales si persisten dudas.\");\n      notasAdicionales.push(\"Desinfección del sistema radicular es prioritaria independientemente del estado apical.\");\n    } else {\n      // Rama por defecto para cualquier otro diagnóstico apical con necrosis\n      planActuacion = \"Endodoncia completa. Desinfección del sistema radicular. Control y reevaluación según evolución clínica.\";\n      urgencia = 'media';\n      notasAdicionales.push(\"Tratamiento endodóntico indicado por necrosis pulpar.\");\n    }\n  }\n\n  // CASO 5: Estado inconcluso\n  else if (pulpalDx === \"Estado pulpar inconcluso\") {\n    planActuacion = \"Reevaluación clínica y radiográfica en 1-2 semanas. Monitorización sin intervención inmediata.\";\n    urgencia = 'baja';\n    notasAdicionales.push(\"Realizar pruebas diagnósticas adicionales antes de decidir tratamiento.\");\n  }\n\n  // CASO POR DEFECTO: Si no coincide con ningún caso anterior\n  else {\n    planActuacion = \"Evaluación clínica completa. Consultar con biblioteca clínica ENDOIA para diagnósticos específicos.\";\n    urgencia = 'media';\n    notasAdicionales.push(\"Diagnóstico no reconocido en el sistema. Revisar datos clínicos ingresados.\");\n    notasAdicionales.push(\"Contactar con tutor para orientación diagnóstica si persiste incertidumbre.\");\n  }\n\n  // Validación final: asegurar que planActuacion nunca esté vacío\n  if (!planActuacion || planActuacion.trim() === \"\") {\n    planActuacion = \"Evaluación clínica integral requerida. Consultar protocolos AAE/ESE 2025 en Biblioteca ENDOIA.\";\n    urgencia = 'media';\n  }\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // NOTAS ADICIONALES según contexto específico\n  // ─────────────────────────────────────────────────────────────────────────\n\n  // Recomendaciones generales de manejo\n  if (urgencia === 'alta' || urgencia === 'critica') {\n    notasAdicionales.push(\"Control postoperatorio en 24-48 horas obligatorio.\");\n  }\n\n  // Criterios de derivación\n  if (apicalDx.includes(\"sistémica\")) {\n    notasAdicionales.push(\"DERIVAR SI: Celulitis difusa, compromiso vía aérea, inmunosupresión, fiebre persistente >38.5°C.\");\n  }\n\n  // Antibióticos - aclaración de cuándo NO dar\n  if (!antibiotico && (pulpalDx === \"Pulpitis severa\" || pulpalDx === \"Pulpa necrótica\")) {\n    notasAdicionales.push(\"❌ NO antibiótico: Pulpitis sin signos sistémicos, necrosis sin celulitis, dolor pulpar sin fiebre.\");\n  }\n\n  // Seguimiento estructurado\n  if (planActuacion.includes(\"Endodoncia\")) {\n    notasAdicionales.push(\"Seguimiento recomendado: 1 mes (control inicial), 3 meses, 6 meses (éxito del tratamiento).\");\n  }\n\n  return {\n    analgesia,\n    planActuacion,\n    urgencia,\n    antibiotico,\n    notasAdicionales\n  };\n}\n\n/**\n * Genera resumen textual de las recomendaciones para mostrar al clínico\n */\nexport function formatearRecomendaciones(rec: RecomendacionesClinicas): string {\n  let texto = `📋 PLAN DE ACTUACIÓN:\\n${rec.planActuacion}\\n\\n`;\n  \n  texto += `💊 ANALGESIA:\\n${rec.analgesia}\\n\\n`;\n  \n  if (rec.antibiotico) {\n    texto += `🦠 ANTIBIÓTICO: SÍ - Indicado según criterios ADA/AAE 2024\\n\\n`;\n  } else {\n    texto += `🦠 ANTIBIÓTICO: NO indicado\\n\\n`;\n  }\n  \n  const urgenciaEmoji = {\n    'baja': '🟢',\n    'media': '🟡',\n    'alta': '🔴',\n    'critica': '🚨'\n  };\n  \n  texto += `${urgenciaEmoji[rec.urgencia]} URGENCIA: ${rec.urgencia.toUpperCase()}\\n\\n`;\n  \n  if (rec.notasAdicionales.length > 0) {\n    texto += `📌 NOTAS CLÍNICAS:\\n`;\n    rec.notasAdicionales.forEach(nota => {\n      texto += `  • ${nota}\\n`;\n    });\n  }\n  \n  return texto;\n}\n","path":null,"size_bytes":10693,"size_tokens":null},"ENDOIA/client/src/lib/radiographs.ts":{"content":"import { supabase } from \"./supabase\";\nimport { analyzeRadiographFromUrl, RadiographMoment } from \"./vision\";\n\nexport const BUCKET_NAME = \"radiographs\";\n\nexport async function uploadImageToStorage(file: File, filePath: string): Promise<void> {\n  const { error } = await supabase.storage\n    .from(BUCKET_NAME)\n    .upload(filePath, file, { upsert: true });\n  \n  if (error) {\n    console.error(\"❌ Error subiendo imagen:\", error);\n    throw error;\n  }\n}\n\nexport async function getSignedUrl(filePath: string): Promise<string> {\n  const { data, error } = await supabase.storage\n    .from(BUCKET_NAME)\n    .createSignedUrl(filePath, 3600);\n  \n  if (error || !data?.signedUrl) {\n    throw new Error(\"No se pudo obtener URL firmada\");\n  }\n  \n  return data.signedUrl;\n}\n\nexport interface Radiograph {\n  rad_id?: number;\n  case_id: string;\n  filepath: string;\n  tipo: \"periapical\" | \"cbct\";\n  momento: RadiographMoment;\n  fecha: string;\n  pai?: number;\n  lesion_mm?: number;\n  lamina_dura?: string;\n  pdl_status?: string;\n  borders?: string;\n  notas?: string;\n  healing?: string;\n}\n\nexport interface ToothDetectionResult {\n  detected: boolean;\n  fdi: number;\n  toothName?: string;\n  confidence: number;\n  notes: string;\n}\n\nexport async function uploadRadiograph(\n  file: File, \n  caseId: string, \n  momento: string, \n  tipo: string\n): Promise<string> {\n  const fileExt = file.name.split('.').pop();\n  const filePath = `${caseId}/${momento}-${Date.now()}.${fileExt}`;\n\n  const { error: uploadError } = await supabase.storage\n    .from('radiographs')\n    .upload(filePath, file);\n\n  if (uploadError) {\n    console.error(\"❌ Error subiendo radiografía:\", uploadError);\n    throw uploadError;\n  }\n\n  const { data: publicUrlData } = supabase.storage\n    .from(\"radiographs\")\n    .getPublicUrl(filePath);\n\n  const publicUrl = publicUrlData.publicUrl;\n\n  let ai: { pai: number | null; lesion_mm: number | null } = { \n    pai: null, \n    lesion_mm: null\n  };\n  \n  if (publicUrl) {\n    try {\n      const momentoMap: Record<string, RadiographMoment> = {\n        'baseline': 'baseline',\n        '1m': 'control_1m',\n        '3m': 'control_3m',\n        '6m': 'control_6m'\n      };\n      const resultado = await analyzeRadiographFromUrl(publicUrl, {\n        tipo: tipo as 'periapical' | 'cbct',\n        momento: momentoMap[momento] || 'baseline'\n      });\n      ai = {\n        pai: resultado.pai,\n        lesion_mm: resultado.lesionDiameterMm\n      };\n    } catch (err) {\n      console.warn(\"⚠️ IA no disponible, continuando sin análisis\");\n    }\n  }\n\n  const { error } = await supabase\n    .from(\"radiographs\")\n    .insert([{\n      case_id: caseId,\n      filepath: filePath,\n      tipo,\n      momento,\n      fecha: new Date().toISOString().split(\"T\")[0],\n      pai: ai.pai,\n      lesion_mm: ai.lesion_mm\n    }]);\n\n  if (error) {\n    console.error(\"❌ Error guardando registro de radiografía:\", error);\n    throw error;\n  }\n\n  if (momento === \"baseline\") {\n    await supabase\n      .from(\"cases\")\n      .update({\n        vision_PAI_baseline: ai.pai,\n        vision_lesion_diam_mm_baseline: ai.lesion_mm\n      })\n      .eq(\"case_id\", caseId);\n  } else {\n    await supabase\n      .from(\"cases\")\n      .update({\n        vision_PAI_followup: ai.pai,\n        vision_lesion_diam_mm_followup: ai.lesion_mm\n      })\n      .eq(\"case_id\", caseId);\n  }\n\n  console.log(\"✅ Radiografía subida y analizada:\", filePath, ai);\n  return publicUrl;\n}\n\nexport async function getRadiographs(caseId: string): Promise<Radiograph[]> {\n  const { data, error } = await supabase\n    .from(\"radiographs\")\n    .select(\"*\")\n    .eq(\"case_id\", caseId)\n    .order(\"fecha\", { ascending: false });\n\n  if (error) {\n    console.error(\"❌ Error obteniendo radiografías:\", error);\n    throw error;\n  }\n\n  return data || [];\n}\n\nexport async function deleteRadiograph(radId: number, filepath: string): Promise<void> {\n  const { error: storageError } = await supabase.storage\n    .from('radiographs')\n    .remove([filepath]);\n\n  if (storageError) {\n    console.error(\"❌ Error eliminando archivo:\", storageError);\n    throw storageError;\n  }\n\n  const { error } = await supabase\n    .from(\"radiographs\")\n    .delete()\n    .eq(\"rad_id\", radId);\n\n  if (error) {\n    console.error(\"❌ Error eliminando registro:\", error);\n    throw error;\n  }\n\n  console.log(\"✅ Radiografía eliminada correctamente\");\n}\n\nexport function getRadiographPublicUrl(filepath: string): string {\n  const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n  return `${supabaseUrl}/storage/v1/object/public/radiographs/${filepath}`;\n}\n\nexport async function getRadiographSignedUrl(filepath: string): Promise<string> {\n  const { data } = await supabase.storage\n    .from(\"radiographs\")\n    .createSignedUrl(filepath, 60 * 60);\n\n  return data?.signedUrl || '';\n}\n\nexport interface LongitudinalPAI {\n  case_id: string;\n  baseline: number;\n  followup: number;\n  delta: number;\n}\n\nexport async function getLongitudinalPAI(): Promise<LongitudinalPAI[]> {\n  const { data, error } = await supabase\n    .from(\"cases\")\n    .select(\"case_id, vision_PAI_baseline, vision_PAI_followup\");\n\n  if (error) throw error;\n\n  return (data || [])\n    .filter(c => c.vision_PAI_baseline && c.vision_PAI_followup)\n    .map(c => ({\n      case_id: c.case_id,\n      baseline: Number(c.vision_PAI_baseline),\n      followup: Number(c.vision_PAI_followup),\n      delta: Number(c.vision_PAI_baseline) - Number(c.vision_PAI_followup)\n    }));\n}\n\nexport type ExitoRadiologico = 'exito' | 'parcial' | 'fracaso' | 'indeterminado';\n\nexport async function calcularExitoRadiologico(caseId: string): Promise<ExitoRadiologico> {\n  const { data, error } = await supabase\n    .from(\"cases\")\n    .select(\"vision_PAI_baseline, vision_PAI_followup, vision_lesion_diam_mm_baseline, vision_lesion_diam_mm_followup\")\n    .eq(\"case_id\", caseId)\n    .single();\n\n  if (error) throw error;\n\n  const basePAI = Number(data.vision_PAI_baseline || 0);\n  const follPAI = Number(data.vision_PAI_followup || 0);\n  const baseL = Number(data.vision_lesion_diam_mm_baseline || 0);\n  const follL = Number(data.vision_lesion_diam_mm_followup || 0);\n\n  let resultado: ExitoRadiologico = \"indeterminado\";\n\n  if (follPAI <= 2 && follL < baseL && follL <= 1) {\n    resultado = \"exito\";\n  } else if (follPAI < basePAI && follL < baseL) {\n    resultado = \"parcial\";\n  } else if (follPAI >= basePAI || follL >= baseL) {\n    resultado = \"fracaso\";\n  }\n\n  await supabase\n    .from(\"cases\")\n    .update({ exito_radiologico_final: resultado })\n    .eq(\"case_id\", caseId);\n\n  return resultado;\n}\n\n\nexport async function uploadRadiographWithVision(\n  file: File,\n  caseId: string,\n  momento: RadiographMoment,\n  tipo: \"periapical\" | \"cbct\"\n) {\n  const timestamp = Date.now();\n\n  /* 1) Subir archivo original */\n  const ext = file.name.split(\".\").pop() || \"jpg\";\n  const filePath = `${caseId}/${momento}-${timestamp}.${ext}`;\n\n  const { error: storageError } = await supabase.storage\n    .from(BUCKET_NAME)\n    .upload(filePath, file);\n\n  if (storageError) throw storageError;\n\n  /* 2) URL firmada */\n  const { data: signedData } = await supabase.storage\n    .from(BUCKET_NAME)\n    .createSignedUrl(filePath, 3600);\n\n  const publicUrl = signedData?.signedUrl;\n\n  /* 3) Obtener case_pk y tooth_fdi del caso */\n  const { data: caseRow } = await supabase\n    .from(\"cases\")\n    .select(\"id, tooth_fdi\")\n    .eq(\"case_id\", caseId)\n    .maybeSingle();\n\n  const targetFdi = caseRow?.tooth_fdi ? parseInt(caseRow.tooth_fdi) : null;\n\n  /* 4) Insertar radiografía inicial */\n  const { data: inserted, error: insertError } = await supabase\n    .from(\"radiographs\")\n    .insert({\n      case_id: caseId,\n      filepath: filePath,\n      tipo,\n      momento,\n      fecha: new Date().toISOString().slice(0, 10),\n      case_pk: caseRow?.id ?? null,\n      pai: null,\n      lesion_mm: null,\n      lamina_dura: null,\n      pdl_status: null,\n      borders: null,\n      notas: null\n    })\n    .select(\"rad_id\")\n    .single();\n\n  if (insertError) throw insertError;\n\n  /* 5) Analizar imagen COMPLETA con Vision (sin recortes) */\n  let analysis: any = null;\n\n  if (publicUrl) {\n    try {\n      console.log(\"🔬 Analizando radiografía completa con Vision...\");\n      analysis = await analyzeRadiographFromUrl(publicUrl, { tipo, momento });\n      console.log(\"✅ Análisis completado:\", analysis);\n    } catch (err) {\n      console.error(\"Error IA:\", err);\n      return { ok: true, analyzed: false };\n    }\n  }\n\n  if (!analysis) {\n    return { ok: true, analyzed: false };\n  }\n\n  /* 6) Mini-informe IA */\n  const notasIA = `\n[AI RADIOLOGICAL REPORT${targetFdi ? ` - FDI ${targetFdi}` : \"\"}]\nPAI: ${analysis.pai}\nRadiolucency: ${analysis.radiolucencyDetected ? \"YES\" : \"NO\"}\nLesion (mm): ${analysis.lesionDiameterMm}\nLamina dura intact: ${\n    analysis.laminaDuraIntact === null\n      ? \"UNSURE\"\n      : analysis.laminaDuraIntact\n      ? \"YES\"\n      : \"NO\"\n  }\nPDL: ${analysis.pdlWidening}\nBorders: ${analysis.borders}\nComments: ${analysis.comments}\n  `.trim();\n\n  /* 7) Procesar campos IA */\n  const laminaDuraLabel =\n    analysis.laminaDuraIntact === null\n      ? \"no_claro\"\n      : analysis.laminaDuraIntact\n      ? \"intacta\"\n      : \"perdida\";\n\n  const pdlLabel = analysis.pdlWidening ?? \"no_claro\";\n  const bordersLabel = analysis.borders ?? \"no_claro\";\n\n  /* 8) Actualizar radiographs */\n  await supabase\n    .from(\"radiographs\")\n    .update({\n      pai: analysis.pai,\n      lesion_mm: analysis.lesionDiameterMm,\n      lamina_dura: laminaDuraLabel,\n      pdl_status: pdlLabel,\n      borders: bordersLabel,\n      notas: notasIA\n    })\n    .eq(\"rad_id\", inserted.rad_id);\n\n  /* 9) Actualizar tabla CASES (baseline o followup) */\n  const updateCases: Record<string, any> = {};\n\n  if (momento === \"baseline\") {\n    updateCases.vision_pai_baseline = String(analysis.pai);\n    updateCases.vision_lesion_diam_mm_baseline = String(analysis.lesionDiameterMm);\n  } else {\n    updateCases.vision_pai_followup = String(analysis.pai);\n    updateCases.vision_lesion_diam_mm_followup = String(analysis.lesionDiameterMm);\n  }\n\n  await supabase.from(\"cases\").update(updateCases).eq(\"case_id\", caseId);\n\n  return {\n    ok: true,\n    analyzed: true,\n    message: \"Radiografía subida y analizada\"\n  };\n}\n","path":null,"size_bytes":10213,"size_tokens":null},"ENDOIA/client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/BibliotecaList.tsx":{"content":"import { BibliotecaItem } from '@/data/bibliotecaClinica';\nimport { BibliotecaCard } from './BibliotecaCard';\nimport { ItemFAQ } from './ItemFAQ';\n\ninterface BibliotecaListProps {\n  items: BibliotecaItem[];\n  showCategoria?: boolean;\n}\n\nexport function BibliotecaList({ items, showCategoria = false }: BibliotecaListProps) {\n  if (items.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-zinc-400\">No se encontraron resultados</p>\n      </div>\n    );\n  }\n  \n  const faqItems = items.filter(item => item.categoria === 'faq');\n  const otherItems = items.filter(item => item.categoria !== 'faq');\n  \n  return (\n    <div className=\"space-y-6\">\n      {otherItems.length > 0 && (\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {otherItems.map((item) => (\n            <BibliotecaCard key={item.id} item={item} showCategoria={showCategoria} />\n          ))}\n        </div>\n      )}\n      \n      {faqItems.length > 0 && (\n        <div className=\"space-y-4\">\n          {faqItems.map((item) => (\n            <div\n              key={item.id}\n              className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 hover:shadow-xl transition-all duration-300\"\n            >\n              {showCategoria && (\n                <div className=\"mb-4\">\n                  <span className=\"inline-block px-3 py-1 rounded-full text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300\">\n                    FAQ Clínica\n                  </span>\n                </div>\n              )}\n              <ItemFAQ item={item} />\n              {item.reference && (\n                <div className=\"mt-4 pt-4 border-t border-zinc-200 dark:border-zinc-700\">\n                  <p className=\"text-xs text-zinc-400\">\n                    Fuente: {item.reference}\n                  </p>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":2007,"size_tokens":null},"ENDOIA/client/src/components/clinico/FailedTeethRanking.tsx":{"content":"import { ClinicoCase, ToothFailureStats } from './types';\nimport { toNumber } from './helpers';\nimport { TrendingDown, Hash } from 'lucide-react';\n\ninterface FailedTeethRankingProps {\n  casos: ClinicoCase[];\n}\n\nexport function FailedTeethRanking({ casos }: FailedTeethRankingProps) {\n  const failuresByTooth = new Map<string, number>();\n  \n  casos.forEach(caso => {\n    if (!caso.tooth_fdi) return;\n    \n    const hasFailure = \n      toNumber(caso.control_1m_exito) === -1 ||\n      toNumber(caso.control_3m_exito) === -1 ||\n      toNumber(caso.control_6m_exito) === -1;\n    \n    if (hasFailure) {\n      const fdi = String(caso.tooth_fdi);\n      failuresByTooth.set(fdi, (failuresByTooth.get(fdi) || 0) + 1);\n    }\n  });\n  \n  const ranking: ToothFailureStats[] = Array.from(failuresByTooth.entries())\n    .map(([fdi, failures]) => ({ fdi, failures }))\n    .sort((a, b) => b.failures - a.failures)\n    .slice(0, 5);\n\n  return (\n    <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-300 hover:shadow-xl\">\n      <div className=\"flex items-center gap-2 mb-6\">\n        <TrendingDown className=\"w-5 h-5\" style={{ color: '#F5A623' }} />\n        <h3 className=\"text-lg font-semibold tracking-tight\">Dientes con más fracasos</h3>\n      </div>\n      \n      {ranking.length === 0 ? (\n        <div className=\"text-center py-8\">\n          <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-full mb-3\" style={{ backgroundColor: 'rgba(46, 204, 113, 0.1)' }}>\n            <TrendingDown className=\"w-6 h-6\" style={{ color: '#2ECC71' }} />\n          </div>\n          <p className=\"text-sm font-medium\" style={{ color: '#2ECC71' }}>\n            Aún no se han registrado fracasos\n          </p>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {ranking.map(({ fdi, failures }, index) => (\n            <div key={fdi} className=\"flex items-center gap-4\">\n              <div className=\"flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold\" style={{ backgroundColor: 'rgba(245, 166, 35, 0.1)', color: '#F5A623' }}>\n                {index + 1}\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Hash className=\"w-3.5 h-3.5 text-zinc-400\" />\n                    <span className=\"font-semibold tracking-tight\">Diente {fdi}</span>\n                  </div>\n                  <span className=\"text-sm font-semibold\" style={{ color: '#F5A623' }}>\n                    {failures} {failures === 1 ? 'fracaso' : 'fracasos'}\n                  </span>\n                </div>\n                <div className=\"w-full bg-zinc-200 dark:bg-zinc-800 rounded-full h-1.5 overflow-hidden\">\n                  <div \n                    className=\"h-1.5 rounded-full transition-all duration-700\" \n                    style={{ width: `${(failures / ranking[0].failures) * 100}%`, backgroundColor: '#F5A623' }}\n                  />\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":3209,"size_tokens":null},"ENDOIA/client/src/components/clinico/EnhancedStats.tsx":{"content":"import { ClinicoCase } from './types';\nimport { toNumber, hasCompletedFollowUp } from './helpers';\nimport { FileText, CheckCircle2, TrendingUp, Activity } from 'lucide-react';\n\ninterface EnhancedStatsProps {\n  casos: ClinicoCase[];\n}\n\nexport function EnhancedStats({ casos }: EnhancedStatsProps) {\n  const total = casos.length;\n  \n  const casosConSeguimientoCompleto = casos.filter(hasCompletedFollowUp).length;\n  \n  let allControls: boolean[] = [];\n  casos.forEach(caso => {\n    const c1m = toNumber(caso.control_1m_exito);\n    const c3m = toNumber(caso.control_3m_exito);\n    const c6m = toNumber(caso.control_6m_exito);\n    \n    if (c1m !== 0) allControls.push(c1m === 1);\n    if (c3m !== 0) allControls.push(c3m === 1);\n    if (c6m !== 0) allControls.push(c6m === 1);\n  });\n  \n  const exitoGlobal = allControls.length >= 10 \n    ? `${Math.round((allControls.filter(Boolean).length / allControls.length) * 100)}%`\n    : 'Pendiente';\n  \n  const toothCounts = new Map<string, number>();\n  casos.forEach(caso => {\n    if (caso.tooth_fdi) {\n      const fdi = String(caso.tooth_fdi);\n      toothCounts.set(fdi, (toothCounts.get(fdi) || 0) + 1);\n    }\n  });\n  \n  const topTeeth = Array.from(toothCounts.entries())\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 5);\n\n  const pendientes = casos.filter(caso => {\n    return caso.fecha_tto && (\n      toNumber(caso.control_1m_exito) === 0 ||\n      toNumber(caso.control_3m_exito) === 0 ||\n      toNumber(caso.control_6m_exito) === 0\n    );\n  }).length;\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      <div className=\"group bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-500 ease-out hover:scale-[1.02] animate-in fade-in-0 slide-in-from-bottom-4\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"space-y-3\">\n            <p className=\"text-sm text-zinc-400 font-medium tracking-wide\">Total de casos</p>\n            <p className=\"text-4xl font-bold tracking-tight\" style={{ color: '#3A7AFE' }}>{total}</p>\n          </div>\n          <FileText className=\"w-10 h-10 opacity-10\" style={{ color: '#3A7AFE' }} />\n        </div>\n      </div>\n\n      <div className=\"group bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-500 ease-out hover:scale-[1.02] animate-in fade-in-0 slide-in-from-bottom-4\" style={{ animationDelay: '100ms' }}>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"space-y-3\">\n            <p className=\"text-sm text-zinc-400 font-medium tracking-wide\">Seguimiento completo</p>\n            <p className=\"text-4xl font-bold tracking-tight\" style={{ color: '#2ECC71' }}>{casosConSeguimientoCompleto}</p>\n            <p className=\"text-xs text-zinc-400\">\n              {total > 0 ? `${Math.round((casosConSeguimientoCompleto / total) * 100)}% del total` : '0%'}\n            </p>\n          </div>\n          <CheckCircle2 className=\"w-10 h-10 opacity-10\" style={{ color: '#2ECC71' }} />\n        </div>\n      </div>\n\n      <div className=\"group bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-500 ease-out hover:scale-[1.02] animate-in fade-in-0 slide-in-from-bottom-4\" style={{ animationDelay: '200ms' }}>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"space-y-3\">\n            <p className=\"text-sm text-zinc-400 font-medium tracking-wide\">Pendientes</p>\n            <p className=\"text-4xl font-bold tracking-tight\" style={{ color: '#F5A623' }}>{pendientes}</p>\n            <p className=\"text-xs text-zinc-400\">Requieren seguimiento</p>\n          </div>\n          <Activity className=\"w-10 h-10 opacity-10\" style={{ color: '#F5A623' }} />\n        </div>\n      </div>\n\n      <div className=\"group bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-500 ease-out hover:scale-[1.02] animate-in fade-in-0 slide-in-from-bottom-4\" style={{ animationDelay: '300ms' }}>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"space-y-3\">\n            <p className=\"text-sm text-zinc-400 font-medium tracking-wide\">Éxito global</p>\n            <p className=\"text-4xl font-bold tracking-tight\" style={{ color: '#B983FF' }}>\n              {exitoGlobal}\n            </p>\n            <p className=\"text-xs text-zinc-400\">Controles exitosos</p>\n          </div>\n          <TrendingUp className=\"w-10 h-10 opacity-10\" style={{ color: '#B983FF' }} />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4673,"size_tokens":null},"ENDOIA/client/src/components/Navbar.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet';\nimport { Sparkles, FilePlus, FolderOpen, FileCheck, BarChart3, BookOpen, LogOut, Menu, Info } from 'lucide-react';\nimport { useAuth } from '@/auth/AuthContext';\nimport { auth } from '@/lib/firebase';\nimport PWAInstallButton from '@/components/PWAInstallButton';\n\nexport default function Navbar() {\n  const [location, setLocation] = useLocation();\n  const { user, role } = useAuth();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n\n  async function handleLogout() {\n    try {\n      await auth.signOut();\n      setLocation('/login');\n    } catch (err) {\n      console.error('Error al cerrar sesión:', err);\n    }\n  }\n\n  const navigateTo = (path: string) => {\n    setLocation(path);\n    setMobileMenuOpen(false);\n  };\n\n  if (!user) return null;\n\n  const roleLabels = {\n    clinico: 'Clínico',\n    tutor: 'Tutor Validador',\n    investigador: 'Investigador'\n  };\n\n  const roleColors = {\n    clinico: 'default',\n    tutor: 'secondary',\n    investigador: 'outline'\n  } as const;\n\n  const isActive = (path: string) => location.startsWith(path);\n\n  return (\n    <nav className=\"border-b bg-background\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"flex items-center justify-between h-16\">\n          <div className=\"flex items-center gap-6\">\n            <div className=\"flex flex-col\">\n              <div className=\"flex items-center gap-2\">\n                <img src=\"/endoia-logo.svg\" alt=\"ENDOIA\" className=\"w-8 h-8\" />\n                <span className=\"font-bold text-lg\">ENDOIA</span>\n              </div>\n              <span className=\"text-[10px] text-muted-foreground ml-10\">AAE–ESE 2025 Classification</span>\n            </div>\n\n            {/* Desktop Navigation */}\n            <div className=\"hidden md:flex items-center gap-1\">\n              <Button\n                variant={isActive('/clinico/registrar') ? 'default' : 'ghost'}\n                size=\"sm\"\n                onClick={() => setLocation('/clinico/registrar')}\n                className=\"gap-2\"\n              >\n                <FilePlus className=\"w-4 h-4\" />\n                Registrar caso\n              </Button>\n\n              <Button\n                variant={isActive('/clinico/mis-casos') ? 'default' : 'ghost'}\n                size=\"sm\"\n                onClick={() => setLocation('/clinico/mis-casos')}\n                className=\"gap-2\"\n              >\n                <FolderOpen className=\"w-4 h-4\" />\n                Mis casos\n              </Button>\n\n              <Button\n                variant={isActive('/biblioteca') ? 'default' : 'ghost'}\n                size=\"sm\"\n                onClick={() => setLocation('/biblioteca')}\n                className=\"gap-2\"\n              >\n                <BookOpen className=\"w-4 h-4\" />\n                Biblioteca\n              </Button>\n\n              <Button\n                variant={isActive('/sobre-endoia') ? 'default' : 'ghost'}\n                size=\"sm\"\n                onClick={() => setLocation('/sobre-endoia')}\n                className=\"gap-2\"\n              >\n                <Info className=\"w-4 h-4\" />\n                Sobre ENDOIA\n              </Button>\n\n              {(role === 'tutor' || role === 'investigador') && (\n                <Button\n                  variant={isActive('/tutor') ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  onClick={() => setLocation('/tutor')}\n                  className=\"gap-2\"\n                >\n                  <FileCheck className=\"w-4 h-4\" />\n                  Validar casos\n                </Button>\n              )}\n\n              {role === 'investigador' && (\n                <Button\n                  variant={isActive('/investigador/dashboard') ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  onClick={() => setLocation('/investigador/dashboard')}\n                  className=\"gap-2\"\n                >\n                  <BarChart3 className=\"w-4 h-4\" />\n                  Dashboard\n                </Button>\n              )}\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            {/* Mobile Navigation Menu */}\n            <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>\n              <SheetTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\" className=\"md:hidden\">\n                  <Menu className=\"w-5 h-5\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"left\" className=\"w-72\">\n                <SheetHeader>\n                  <SheetTitle className=\"flex items-center gap-2\">\n                    <img src=\"/endoia-logo.svg\" alt=\"ENDOIA\" className=\"w-6 h-6\" />\n                    ENDOIA\n                  </SheetTitle>\n                </SheetHeader>\n                \n                <div className=\"flex flex-col gap-2 mt-6\">\n                  {/* User Info */}\n                  <div className=\"flex flex-col gap-2 pb-4 border-b mb-2\">\n                    <span className=\"text-sm font-medium truncate\">{user.email}</span>\n                    <Badge variant={roleColors[role]} className=\"text-xs w-fit\">\n                      {roleLabels[role]}\n                    </Badge>\n                  </div>\n\n                  {/* Navigation Links */}\n                  <Button\n                    variant={isActive('/clinico/registrar') ? 'default' : 'ghost'}\n                    className=\"justify-start gap-2\"\n                    onClick={() => navigateTo('/clinico/registrar')}\n                  >\n                    <FilePlus className=\"w-4 h-4\" />\n                    Registrar caso\n                  </Button>\n\n                  <Button\n                    variant={isActive('/clinico/mis-casos') ? 'default' : 'ghost'}\n                    className=\"justify-start gap-2\"\n                    onClick={() => navigateTo('/clinico/mis-casos')}\n                  >\n                    <FolderOpen className=\"w-4 h-4\" />\n                    Mis casos\n                  </Button>\n\n                  <Button\n                    variant={isActive('/biblioteca') ? 'default' : 'ghost'}\n                    className=\"justify-start gap-2\"\n                    onClick={() => navigateTo('/biblioteca')}\n                  >\n                    <BookOpen className=\"w-4 h-4\" />\n                    Biblioteca\n                  </Button>\n\n                  <Button\n                    variant={isActive('/sobre-endoia') ? 'default' : 'ghost'}\n                    className=\"justify-start gap-2\"\n                    onClick={() => navigateTo('/sobre-endoia')}\n                  >\n                    <Info className=\"w-4 h-4\" />\n                    Sobre ENDOIA\n                  </Button>\n\n                  {(role === 'tutor' || role === 'investigador') && (\n                    <Button\n                      variant={isActive('/tutor') ? 'default' : 'ghost'}\n                      className=\"justify-start gap-2\"\n                      onClick={() => navigateTo('/tutor')}\n                    >\n                      <FileCheck className=\"w-4 h-4\" />\n                      Validar casos\n                    </Button>\n                  )}\n\n                  {role === 'investigador' && (\n                    <Button\n                      variant={isActive('/investigador/dashboard') ? 'default' : 'ghost'}\n                      className=\"justify-start gap-2\"\n                      onClick={() => navigateTo('/investigador/dashboard')}\n                    >\n                      <BarChart3 className=\"w-4 h-4\" />\n                      Dashboard\n                    </Button>\n                  )}\n\n                  {/* Logout */}\n                  <Button\n                    variant=\"ghost\"\n                    className=\"justify-start gap-2 mt-4 border-t pt-4\"\n                    onClick={() => {\n                      setMobileMenuOpen(false);\n                      handleLogout();\n                    }}\n                  >\n                    <LogOut className=\"w-4 h-4\" />\n                    Cerrar sesión\n                  </Button>\n                </div>\n              </SheetContent>\n            </Sheet>\n\n            <PWAInstallButton />\n            \n            <div className=\"hidden sm:flex flex-col items-end text-sm\">\n              <span className=\"font-medium\">{user.email}</span>\n              <Badge variant={roleColors[role]} className=\"text-xs\">\n                {roleLabels[role]}\n              </Badge>\n            </div>\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleLogout}\n              className=\"gap-2\"\n            >\n              <LogOut className=\"w-4 h-4\" />\n              <span className=\"hidden sm:inline\">Salir</span>\n            </Button>\n          </div>\n        </div>\n      </div>\n    </nav>\n  );\n}\n","path":null,"size_bytes":9036,"size_tokens":null},"ENDOIA/client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"ENDOIA/client/src/lib/IA_AAE_ESE_2025.ts":{"content":"// IA_AAE_ESE_2025.ts\n// Motor diagnóstico corregido según tablas AAE–ESE 2025\n// Adaptado a campos reales de tu tabla `cases`\n\n// -------------------- Tipos básicos --------------------\n\nexport type PreviousTreatmentType =\n  | \"none\"\n  | \"small_restoration\"\n  | \"deep_restoration\"\n  | \"vital_indirect_cap\"\n  | \"vital_direct_cap\"\n  | \"partial_pulpotomy\"\n  | \"full_pulpotomy\"\n  | \"previous_regenerative\"\n  | \"previously_initiated_rct\"\n  | \"previously_obturated_rct\";\n\nexport type PulpDiagnosis =\n  | \"clinically_normal_pulp\"\n  | \"hypersensitive_pulp\"\n  | \"mild_pulpitis\"\n  | \"severe_pulpitis\"\n  | \"pulp_necrosis\"\n  | \"inconclusive_pulp_status\"\n  | \"previously_initiated_root_canal_treatment\"\n  | \"previously_obturated_root_canal\"\n  | \"previous_regenerative_endodontic_treatment\";\n\nexport type ApicalDiagnosis =\n  | \"clinically_normal_apical_tissues\"\n  | \"apical_hypersensitivity\"\n  | \"localized_symptomatic_apical_periodontitis\"\n  | \"localized_asymptomatic_apical_periodontitis\"\n  | \"localized_apical_periodontitis_with_sinus_tract\"\n  | \"apical_periodontitis_with_systemic_involvement\"\n  | \"healing_apical_tissue\"\n  | \"inconclusive_apical_condition\";\n\nexport interface CaseData {\n  // Clínico\n  spontaneous_pain_yesno?: string | null;          // \"yes\"/\"no\" o \"1\"/\"0\"\n  thermal_cold_response?: string | null;          // \"0\",\"1\",\"2\" o texto\n  lingering_pain_seconds?: string | number | null;\n  pain_to_heat?: string | null;\n  percussion_pain_yesno?: string | null;\n  apical_palpation_pain?: string | null;\n  sinus_tract_present?: string | null;\n  systemic_involvement?: string | null;\n  depth_of_caries?: string | null;                // \"no_aplica\",\"no_refiere\",\"superficial\",\"media\",\"profunda\",...\n  tipo_dolor?: string | null;                     // \"sin_dolor\",\"dolor_provocado_corto\",\"dolor_provocado_largo\",\"dolor_espontaneo\",...\n  previous_treatment?: string | null;\n  trauma_history?: string | null;\n\n  // Radiografía (clínico / IA)\n  periapical_index_pai_1_5?: string | number | null;\n  radiolucency_yesno?: string | null;             // \"1\"/\"0\",\"si\"/\"no\"\n  pdl_widening?: string | null;                   // \"none\",\"mild\",\"moderate\",\"severe\",\"1-5\"\n  vision_pai_baseline?: string | number | null;\n  vision_pai_followup?: string | number | null;\n  vision_lesion_diam_mm_baseline?: string | number | null;\n  vision_lesion_diam_mm_followup?: string | number | null;\n}\n\nexport interface EndoDiagnosis {\n  pulpal: PulpDiagnosis;\n  apical: ApicalDiagnosis;\n  flags: string[];\n}\n\n// -------------------- Helpers --------------------\n\nfunction isYes(v?: string | null): boolean {\n  if (!v) return false;\n  const t = v.toString().toLowerCase().trim();\n  return (\n    t === \"yes\" ||\n    t === \"si\" ||\n    t === \"sí\" ||\n    t === \"true\" ||\n    t === \"1\"\n  );\n}\n\nfunction toNumber(v?: string | number | null): number | null {\n  if (v === null || v === undefined || v === \"\") return null;\n  const n = typeof v === \"number\" ? v : Number(v);\n  return Number.isFinite(n) ? n : null;\n}\n\nfunction normalizePreviousTreatment(raw?: string | null): PreviousTreatmentType {\n  if (!raw) return \"none\";\n  const t = raw.toString().toLowerCase().trim();\n\n  if (t.includes(\"obtur\") || t === \"previously_obturated_rct\") {\n    return \"previously_obturated_rct\";\n  }\n  if (t.includes(\"inici\") || t === \"previously_initiated_rct\") {\n    return \"previously_initiated_rct\";\n  }\n  if (t.includes(\"regener\") || t === \"previous_regenerative\") {\n    return \"previous_regenerative\";\n  }\n  if (t.includes(\"indirect\")) {\n    return \"vital_indirect_cap\";\n  }\n  if (t.includes(\"direct\")) {\n    return \"vital_direct_cap\";\n  }\n  if (t.includes(\"parcial\") || t.includes(\"partial\")) {\n    return \"partial_pulpotomy\";\n  }\n  if (t.includes(\"pulpotomía completa\") || t.includes(\"full_pulpotomy\") || t.includes(\"pulpotomia_completa\")) {\n    return \"full_pulpotomy\";\n  }\n  if (t.includes(\"deep\") || t.includes(\"profunda\") || t.includes(\"deep_rest\")) {\n    return \"deep_restoration\";\n  }\n  if (t.includes(\"small\") || t.includes(\"peque\") || t.includes(\"small_rest\")) {\n    return \"small_restoration\";\n  }\n\n  return \"none\";\n}\n\n// Radiolucidez combinando clínico + IA (PAI)\nfunction hasApicalRadiolucency(data: CaseData, flags: string[]): boolean {\n  const clinico = isYes(data.radiolucency_yesno);\n  const paiClinico = toNumber(data.periapical_index_pai_1_5);\n  const paiVision = toNumber(data.vision_pai_baseline);\n\n  const iaDicePatologia = paiVision !== null && paiVision >= 3;\n  const clinicoDicePatologia = paiClinico !== null && paiClinico >= 3;\n\n  // Si clínico dice NO pero IA ve PAI alto → priorizamos IA y avisamos\n  if (!clinico && iaDicePatologia) {\n    flags.push(\n      \"IA radiográfica detecta PAI ≥ 3 aunque clínicamente está marcado sin radiolucidez. Se ha considerado patología apical.\"\n    );\n    return true;\n  }\n\n  if (clinico) return true;\n  if (clinicoDicePatologia) return true;\n  if (iaDicePatologia) return true;\n\n  return false;\n}\n\nfunction pdlIsWidened(data: CaseData): boolean {\n  const raw = (data.pdl_widening || \"\").toString().toLowerCase().trim();\n  if (!raw) return false;\n\n  if ([\"mild\", \"moderate\", \"severe\"].includes(raw)) return true;\n  if ([\"2\", \"3\", \"4\", \"5\"].includes(raw)) return true;\n\n  return false;\n}\n\n// -------------------- Diagnóstico pulpar --------------------\n\nexport function diagnosePulp(data: CaseData): { diagnosis: PulpDiagnosis; flags: string[] } {\n  const flags: string[] = [];\n\n  const prev = normalizePreviousTreatment(data.previous_treatment);\n  const hasApicalRad = hasApicalRadiolucency(data, flags);\n\n  const spontPain =\n    isYes(data.spontaneous_pain_yesno) ||\n    data.tipo_dolor === \"dolor_espontaneo\";\n\n  const coldResp = (data.thermal_cold_response || \"\")\n    .toString()\n    .toLowerCase()\n    .trim();\n\n  const linger = toNumber(data.lingering_pain_seconds);\n  const heatPain = isYes(data.pain_to_heat);\n  const percPain = isYes(data.percussion_pain_yesno);\n  const sinusTract = isYes(data.sinus_tract_present);\n\n  const depth = (data.depth_of_caries || \"\").toString().toLowerCase();\n\n  const cariesProfunda =\n    depth.includes(\"profunda\") ||\n    depth.includes(\"media\") ||\n    depth.includes(\"deep\") ||\n    depth.includes(\"moderate\");\n\n  const cariesEsmalte =\n    depth.includes(\"superficial\") ||\n    depth.includes(\"esmalt\") ||\n    depth.includes(\"enamel\");\n\n  const noColdResponse =\n    coldResp === \"0\" ||\n    coldResp === \"no_responde\" ||\n    coldResp === \"none\" ||\n    coldResp === \"ausente\" ||\n    coldResp === \"no\";\n\n  const increasedCold =\n    coldResp === \"2\" ||\n    coldResp === \"2_aumentada\" ||\n    coldResp === \"increased\";\n\n  const hasVPT = [\n    \"vital_indirect_cap\",\n    \"vital_direct_cap\",\n    \"partial_pulpotomy\",\n    \"full_pulpotomy\",\n  ].includes(prev);\n\n  const trauma = (data.trauma_history || \"\").toString().trim() !== \"\";\n\n  // ---------------- 1. Tratamientos previos \"especiales\" ----------------\n\n  if (prev === \"previously_obturated_rct\") {\n    return { diagnosis: \"previously_obturated_root_canal\", flags };\n  }\n  if (prev === \"previously_initiated_rct\") {\n    return { diagnosis: \"previously_initiated_root_canal_treatment\", flags };\n  }\n  if (prev === \"previous_regenerative\") {\n    return { diagnosis: \"previous_regenerative_endodontic_treatment\", flags };\n  }\n\n  // ---------------- 2. Pulp Necrosis ----------------\n\n  const signsOfInfection =\n    hasApicalRad || sinusTract || isYes(data.systemic_involvement);\n\n  if (noColdResponse) {\n    if (signsOfInfection) {\n      return { diagnosis: \"pulp_necrosis\", flags };\n    }\n    if (percPain || isYes(data.apical_palpation_pain)) {\n      return { diagnosis: \"pulp_necrosis\", flags };\n    }\n\n    // Ausencia de respuesta al frío sin síntomas y sin caries profunda / VPT → inconcluso\n    if (!spontPain && !cariesProfunda && !hasVPT) {\n      flags.push(\n        \"Ausencia de respuesta al frío sin signos claros de infección ni caries profunda: estado pulpar inconcluso (posible calcificación o necrosis estéril).\"\n      );\n      return { diagnosis: \"inconclusive_pulp_status\", flags };\n    }\n\n    // Por defecto, si no responde y hay historia previa (caries/VPT), inclinamos a necrosis\n    return { diagnosis: \"pulp_necrosis\", flags };\n  }\n\n  // ---------------- 3. Severe Pulpitis ----------------\n\n  const prolongedPain =\n    (linger !== null && linger > 5) ||\n    data.tipo_dolor === \"dolor_provocado_largo\";\n\n  if (spontPain || prolongedPain || heatPain) {\n    return { diagnosis: \"severe_pulpitis\", flags };\n  }\n\n  // ---------------- 4. Mild Pulpitis ----------------\n\n  if (\n    (cariesProfunda || prev === \"deep_restoration\") &&\n    (increasedCold || (linger !== null && linger > 0 && linger <= 5))\n  ) {\n    return { diagnosis: \"mild_pulpitis\", flags };\n  }\n\n  // ---------------- 5. Hypersensitive Pulp ----------------\n\n  if (increasedCold || (linger !== null && linger > 0 && linger <= 5)) {\n    if (!cariesProfunda) {\n      // Sin caries profunda → hipersensibilidad (cuellos, recesión, etc.)\n      return { diagnosis: \"hypersensitive_pulp\", flags };\n    }\n    // Si hay caries profunda + sensibilidad corta → mild_pulpitis\n    return { diagnosis: \"mild_pulpitis\", flags };\n  }\n\n  // ---------------- 6. Clinically Normal Pulp ----------------\n\n  if (!spontPain && !percPain && !hasApicalRad && !sinusTract) {\n    return { diagnosis: \"clinically_normal_pulp\", flags };\n  }\n\n  flags.push(\"Diagnóstico pulpar incierto con los datos disponibles.\");\n  return { diagnosis: \"inconclusive_pulp_status\", flags };\n}\n\n// -------------------- Diagnóstico apical --------------------\n\nexport function diagnoseApical(\n  data: CaseData,\n  pulpDiag: PulpDiagnosis\n): { diagnosis: ApicalDiagnosis; flags: string[] } {\n  const flags: string[] = [];\n\n  const percPain = isYes(data.percussion_pain_yesno);\n  const apicalPalp = isYes(data.apical_palpation_pain);\n  const sinusTract = isYes(data.sinus_tract_present);\n  const systemic = isYes(data.systemic_involvement);\n  const hasApicalRad = hasApicalRadiolucency(data, flags);\n  const pdlWidened = pdlIsWidened(data);\n\n  const prev = normalizePreviousTreatment(data.previous_treatment);\n  const isPreviouslyTreated =\n    prev === \"previously_obturated_rct\" || prev === \"previous_regenerative\";\n\n  const paiBase = toNumber(data.vision_pai_baseline);\n  const paiFollow = toNumber(data.vision_pai_followup);\n  const diamBase = toNumber(data.vision_lesion_diam_mm_baseline);\n  const diamFollow = toNumber(data.vision_lesion_diam_mm_followup);\n\n  // 1. Systemic involvement\n  if (systemic) {\n    return {\n      diagnosis: \"apical_periodontitis_with_systemic_involvement\",\n      flags,\n    };\n  }\n\n  // 2. Sinus tract\n  if (sinusTract) {\n    return {\n      diagnosis: \"localized_apical_periodontitis_with_sinus_tract\",\n      flags,\n    };\n  }\n\n  // 3. Symptomatic Apical Periodontitis (SAP)\n  // CLAVE 2025: si hay dolor a la percusión y la pulpa está enferma (necrosis/severe/mild avanzada),\n  // es SAP aunque todavía no se vea radiolucidez clara.\n  const pulpDiseased = [\n    \"pulp_necrosis\",\n    \"severe_pulpitis\",\n    \"mild_pulpitis\",\n    \"previously_initiated_root_canal_treatment\",\n    \"previously_obturated_root_canal\",\n  ].includes(pulpDiag);\n\n  if (percPain || apicalPalp) {\n    if (hasApicalRad) {\n      return {\n        diagnosis: \"localized_symptomatic_apical_periodontitis\",\n        flags,\n      };\n    }\n\n    if (pulpDiseased) {\n      return {\n        diagnosis: \"localized_symptomatic_apical_periodontitis\",\n        flags,\n      };\n    }\n\n    // Pulpa clínicamente sana/hipersensible + dolor percusión → Apical Hypersensitivity (origen no endodóntico)\n    flags.push(\n      \"Dolor a la percusión con pulpa sana/hipersensible: posible origen no endodóntico (trauma oclusal, sinusitis, etc.).\"\n    );\n    return {\n      diagnosis: \"apical_hypersensitivity\",\n      flags,\n    };\n  }\n\n  // 4. Asymptomatic Apical Periodontitis\n  if (!percPain && !apicalPalp && hasApicalRad) {\n    return {\n      diagnosis: \"localized_asymptomatic_apical_periodontitis\",\n      flags,\n    };\n  }\n\n  // 5. Healing (disminución de PAI o tamaño de lesión en dientes ya tratados)\n  if (\n    isPreviouslyTreated &&\n    paiBase !== null &&\n    paiFollow !== null &&\n    paiFollow < paiBase\n  ) {\n    return {\n      diagnosis: \"healing_apical_tissue\",\n      flags,\n    };\n  }\n\n  if (\n    isPreviouslyTreated &&\n    diamBase !== null &&\n    diamFollow !== null &&\n    diamFollow < diamBase\n  ) {\n    return {\n      diagnosis: \"healing_apical_tissue\",\n      flags,\n    };\n  }\n\n  // 6. Clinically normal apical tissues\n  if (!percPain && !apicalPalp && !hasApicalRad && !pdlWidened && !sinusTract && !systemic) {\n    return {\n      diagnosis: \"clinically_normal_apical_tissues\",\n      flags,\n    };\n  }\n\n  // 7. Inconclusive\n  return {\n    diagnosis: \"inconclusive_apical_condition\",\n    flags,\n  };\n}\n\n// -------------------- Diagnóstico combinado --------------------\n\nexport function diagnoseEndoAAE_ESE_2025(data: CaseData): EndoDiagnosis {\n  const pulp = diagnosePulp(data);\n  const apical = diagnoseApical(data, pulp.diagnosis);\n\n  const flags: string[] = [...pulp.flags, ...apical.flags];\n\n  // Coherencia pulpa–ápice\n  if (\n    (pulp.diagnosis === \"clinically_normal_pulp\" ||\n      pulp.diagnosis === \"hypersensitive_pulp\") &&\n    (apical.diagnosis === \"localized_symptomatic_apical_periodontitis\" ||\n      apical.diagnosis === \"localized_asymptomatic_apical_periodontitis\" ||\n      apical.diagnosis === \"localized_apical_periodontitis_with_sinus_tract\")\n  ) {\n    flags.push(\n      \"Alerta: Tejidos apicales patológicos con pulpa clínicamente normal/hipersensible. Revisar prueba de vitalidad y posibles causas no endodónticas.\"\n    );\n  }\n\n  if (\n    pulp.diagnosis === \"previously_obturated_root_canal\" &&\n    (apical.diagnosis === \"clinically_normal_apical_tissues\" ||\n      apical.diagnosis === \"inconclusive_apical_condition\")\n  ) {\n    flags.push(\n      \"Diente con endodoncia previa: valorar evolución a largo plazo (control radiográfico).\"\n    );\n  }\n\n  return {\n    pulpal: pulp.diagnosis,\n    apical: apical.diagnosis,\n    flags: Array.from(new Set(flags)), // sin duplicados\n  };\n}\n","path":null,"size_bytes":14091,"size_tokens":null},"ENDOIA/client/src/auth/AuthContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport type { User } from 'firebase/auth';\nimport { auth, onAuthStateChanged } from '@/lib/firebase';\nimport { getRoleFromEmail, type UserRole } from './roles';\n\ninterface AuthContextType {\n  user: User | null;\n  role: UserRole;\n  loading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n      setUser(currentUser);\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const role = getRoleFromEmail(user?.email);\n\n  useEffect(() => {\n    if (role === 'clinico') {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }, [role]);\n\n  return (\n    <AuthContext.Provider value={{ user, role, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":1334,"size_tokens":null},"ENDOIA/client/src/lib/firebase.ts":{"content":"import { initializeApp } from \"firebase/app\";\nimport {\n  getAuth,\n  GoogleAuthProvider,\n  signInWithPopup,\n  onAuthStateChanged\n} from \"firebase/auth\";\n\nconst firebaseConfig = {\n  apiKey: \"AIzaSyCcrYXfGRt4YEXGCqlqe-03UL1mA4NSNA8\",\n  authDomain: \"endoia.firebaseapp.com\",\n  projectId: \"endoia\",\n  storageBucket: \"endoia.firebasestorage.app\",\n  messagingSenderId: \"494853206194\",\n  appId: \"1:494853206194:web:176136166a25c2813619ab\",\n  measurementId: \"G-YDLB7CXLZ4\"\n};\n\nconst app = initializeApp(firebaseConfig);\n\nexport const auth = getAuth(app);\nexport const googleProvider = new GoogleAuthProvider();\n\nexport { signInWithPopup, onAuthStateChanged };\n","path":null,"size_bytes":651,"size_tokens":null},"ENDOIA/client/src/components/examples/ClinicoView.tsx":{"content":"import ClinicoView from '../ClinicoView';\n\nexport default function ClinicoViewExample() {\n  return <ClinicoView />;\n}\n","path":null,"size_bytes":118,"size_tokens":null},"ENDOIA/client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"ENDOIA/client/src/components/examples/TutorView.tsx":{"content":"import TutorView from '../TutorView';\n\nexport default function TutorViewExample() {\n  return <TutorView />;\n}\n","path":null,"size_bytes":110,"size_tokens":null},"ENDOIA/client/src/components/clinico/CasosPorDienteModal.tsx":{"content":"import { ClinicoCase } from './types';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Eye, X } from 'lucide-react';\nimport { getDiagnosisColor } from './helpers';\n\ninterface CasosPorDienteModalProps {\n  fdi: string | null;\n  casos: ClinicoCase[];\n  onClose: () => void;\n  onVerDetalle?: (caso: ClinicoCase) => void;\n}\n\nexport function CasosPorDienteModal({ fdi, casos, onClose, onVerDetalle }: CasosPorDienteModalProps) {\n  if (!fdi) return null;\n\n  const casosDiente = casos.filter(caso => String(caso.tooth_fdi) === fdi);\n\n  return (\n    <Dialog open={!!fdi} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-2xl\">\n              Casos del diente FDI {fdi}\n            </DialogTitle>\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <DialogDescription>\n            {casosDiente.length} {casosDiente.length === 1 ? 'caso registrado' : 'casos registrados'}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"mt-4\">\n          {casosDiente.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No hay casos registrados para este diente\n            </div>\n          ) : (\n            <>\n              {/* Vista desktop: tabla */}\n              <div className=\"hidden md:block overflow-x-auto\">\n                <table className=\"w-full border-collapse\">\n                  <thead>\n                    <tr className=\"border-b bg-muted/50\">\n                      <th className=\"text-left p-3 text-sm font-semibold\">ID</th>\n                      <th className=\"text-left p-3 text-sm font-semibold\">Fecha</th>\n                      <th className=\"text-left p-3 text-sm font-semibold\">Diagnóstico Pulpar IA</th>\n                      <th className=\"text-left p-3 text-sm font-semibold\">Diagnóstico Apical IA</th>\n                      <th className=\"text-left p-3 text-sm font-semibold\">Tratamiento</th>\n                      <th className=\"text-left p-3 text-sm font-semibold\">Estado</th>\n                      <th className=\"text-center p-3 text-sm font-semibold\">Acción</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {casosDiente.map((caso) => {\n                      const hasTreatment = caso.tto_realizado && caso.tto_realizado.trim() !== '';\n                      const hasControls = caso.fecha_control_1m || caso.fecha_control_3m || caso.fecha_control_6m;\n                      \n                      return (\n                        <tr key={caso.case_id} className=\"border-b hover:bg-muted/30\">\n                          <td className=\"p-3 text-xs font-mono\">{caso.case_id}</td>\n                          <td className=\"p-3 text-sm\">{caso.registro_fecha || caso.date || 'N/A'}</td>\n                          <td className=\"p-3\">\n                            <Badge className={`${getDiagnosisColor(caso.AEDE_pulpar_IA)} text-xs`}>\n                              {caso.AEDE_pulpar_IA || 'N/A'}\n                            </Badge>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className={`${getDiagnosisColor(caso.AEDE_apical_IA)} text-xs`}>\n                              {caso.AEDE_apical_IA || 'N/A'}\n                            </Badge>\n                          </td>\n                          <td className=\"p-3 text-sm max-w-[200px] truncate\" title={caso.tto_realizado || caso.tto_propuesto}>\n                            {caso.tto_realizado || caso.tto_propuesto || 'N/A'}\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge variant={hasTreatment ? (hasControls ? 'default' : 'secondary') : 'outline'} className=\"text-xs\">\n                              {hasTreatment ? (hasControls ? 'Con seguimiento' : 'Sin controles') : 'Sin tratamiento'}\n                            </Badge>\n                          </td>\n                          <td className=\"p-3 text-center\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => onVerDetalle?.(caso)}\n                              className=\"gap-2\"\n                            >\n                              <Eye className=\"w-3 h-3\" />\n                              Ver\n                            </Button>\n                          </td>\n                        </tr>\n                      );\n                    })}\n                  </tbody>\n                </table>\n              </div>\n\n              {/* Vista mobile: cards */}\n              <div className=\"md:hidden space-y-3\">\n                {casosDiente.map((caso) => {\n                  const hasTreatment = caso.tto_realizado && caso.tto_realizado.trim() !== '';\n                  const hasControls = caso.fecha_control_1m || caso.fecha_control_3m || caso.fecha_control_6m;\n                  \n                  return (\n                    <div key={caso.case_id} className=\"border rounded-lg p-4 space-y-3\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"space-y-1\">\n                          <p className=\"font-mono text-xs text-muted-foreground\">{caso.case_id}</p>\n                          <p className=\"text-sm font-semibold\">\n                            {caso.registro_fecha || caso.date || 'N/A'}\n                          </p>\n                        </div>\n                        <Badge variant={hasTreatment ? (hasControls ? 'default' : 'secondary') : 'outline'} className=\"text-xs\">\n                          {hasTreatment ? (hasControls ? 'Con seguimiento' : 'Sin controles') : 'Sin tratamiento'}\n                        </Badge>\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <div>\n                          <p className=\"text-xs text-muted-foreground mb-1\">Diagnóstico Pulpar IA:</p>\n                          <Badge className={`${getDiagnosisColor(caso.AEDE_pulpar_IA)} text-xs`}>\n                            {caso.AEDE_pulpar_IA || 'N/A'}\n                          </Badge>\n                        </div>\n                        <div>\n                          <p className=\"text-xs text-muted-foreground mb-1\">Diagnóstico Apical IA:</p>\n                          <Badge className={`${getDiagnosisColor(caso.AEDE_apical_IA)} text-xs`}>\n                            {caso.AEDE_apical_IA || 'N/A'}\n                          </Badge>\n                        </div>\n                        <div>\n                          <p className=\"text-xs text-muted-foreground mb-1\">Tratamiento:</p>\n                          <p className=\"text-sm\">{caso.tto_realizado || caso.tto_propuesto || 'N/A'}</p>\n                        </div>\n                      </div>\n\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => onVerDetalle?.(caso)}\n                        className=\"w-full gap-2\"\n                      >\n                        <Eye className=\"w-3 h-3\" />\n                        Ver detalles\n                      </Button>\n                    </div>\n                  );\n                })}\n              </div>\n            </>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":7811,"size_tokens":null},"ENDOIA/client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"ENDOIA/client/src/components/ClinicoView.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Sparkles, Save, AlertCircle, CheckCircle2, Upload, X, Image } from \"lucide-react\";\nimport { motorIA_AAE_ESE } from \"@/lib/IA_AAE_ESE_adapter\";\nimport { enviarCasoNuevo, type CasoClinico } from \"@/lib/api\";\nimport { uploadRadiographWithVision } from \"@/lib/radiographs\";\nimport { useAuth } from \"@/auth/AuthContext\";\n\n// Generador de ID pseudonimizado AEDE-IA\nfunction generarCaseID(identificadorLocal = \"\") {\n  const fecha = new Date().toISOString().slice(2,10).replace(/-/g,''); // YYMMDD\n  const primeraLetra = identificadorLocal\n    ? identificadorLocal.trim().charAt(0).toUpperCase()\n    : String.fromCharCode(65 + Math.floor(Math.random() * 26)); // Letra aleatoria A-Z\n  const aleatorio = Math.random().toString(36).substring(2,6).toUpperCase();\n  return `ENDOIA-${fecha}-${primeraLetra}${aleatorio}`;\n}\n\nexport default function ClinicoView() {\n  const { user } = useAuth();\n  \n  const [form, setForm] = useState<CasoClinico & {\n    tipo_dolor?: string;\n    sondaje_max_mm?: string;\n    camara_abierta?: string;\n    pulpa_expuesta?: string;\n  }>({\n    case_id: \"\",\n    tooth_fdi: \"\",\n    dolorEspontaneo: \"no\",\n    respuestaFrio: \"1_normal\",\n    lingeringSeg: \"\",\n    percusionDolor: \"no\",\n    radiolucidezApical: \"no\",\n    profundidadCaries: \"\",\n    sangradoControlable: \"\",\n    sinusTractPresent: \"no\",\n    systemicInvolvement: \"no\",\n    previousTreatment: \"none\",\n    apicalPalpationPain: \"no\",\n    notas: \"\",\n    tratamientoRealizado: \"no_realizado\",\n    clinicoNombre: \"\",\n    clinicoEmail: \"\",\n    tipo_dolor: \"\",\n    sondaje_max_mm: \"\",\n    camara_abierta: \"\",\n    pulpa_expuesta: \"\",\n  });\n\n  useEffect(() => {\n    if (user?.email) {\n      setForm(f => ({ \n        ...f, \n        clinicoEmail: user.email || \"\",\n        clinicoNombre: user.displayName || user.email?.split('@')[0] || \"\"\n      }));\n    }\n  }, [user]);\n\n  const [identificadorLocal, setIdentificadorLocal] = useState(\"\");\n  \n  const [radiografiaFile, setRadiografiaFile] = useState<File | null>(null);\n  const [radiografiaPreview, setRadiografiaPreview] = useState<string | null>(null);\n  const [tipoRadiografia, setTipoRadiografia] = useState<'periapical' | 'cbct'>('periapical');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const [iaResult, setIaResult] = useState<{\n    pulpalDxIA: string;\n    apicalDxIA: string;\n    ttoPropuestoIA: string;\n    recomendaciones: {\n      analgesia: string;\n      planActuacion: string;\n      urgencia: 'baja' | 'media' | 'alta' | 'critica';\n      antibiotico: boolean;\n      notasAdicionales: string[];\n    };\n    recomendacionesTexto: string;\n    flags?: string[];\n  } | null>(null);\n  const [enviando, setEnviando] = useState(false);\n  const [estadoEnvio, setEstadoEnvio] = useState<{ tipo: \"success\" | \"error\"; mensaje: string } | null>(null);\n\n  function handleChange(name: string, value: string) {\n    setForm(f => ({ ...f, [name]: value }));\n  }\n\n  function handleFileChange(e: React.ChangeEvent<HTMLInputElement>) {\n    const file = e.target.files?.[0];\n    if (file) {\n      setRadiografiaFile(file);\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setRadiografiaPreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  }\n\n  function removeRadiografia() {\n    setRadiografiaFile(null);\n    setRadiografiaPreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  }\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setEnviando(true);\n    setEstadoEnvio(null);\n\n    const ia = motorIA_AAE_ESE(form);\n    setIaResult(ia);\n\n    // Generar ID pseudonimizado automáticamente\n    const caseIdGenerado = generarCaseID(identificadorLocal);\n\n    // Convertir datos del formulario al formato que espera n8n/Google Sheets\n    const payload = {\n      case_id: caseIdGenerado,\n      fecha: new Date().toISOString().split('T')[0], // YYYY-MM-DD\n      clinicoEmail: form.clinicoEmail,\n      tooth_fdi: form.tooth_fdi,\n      \n      // Campos clínicos convertidos al formato esperado\n      spontaneous_pain_yesno: form.dolorEspontaneo === \"si\" ? \"1\" : \"0\",\n      thermal_cold_response: form.respuestaFrio === \"0_no_responde\" ? \"0\" \n        : form.respuestaFrio === \"2_aumentada\" ? \"2\" : \"1\",\n      lingering_pain_seconds: form.lingeringSeg || \"0\",\n      depth_of_caries: form.profundidadCaries || null,\n      \n      // Nuevos campos clínicos AAE-ESE 2025\n      tipo_dolor: form.tipo_dolor || null,\n      sondaje_max_mm: form.sondaje_max_mm ? Number(form.sondaje_max_mm) : null,\n      sangrado_controlable: form.sangradoControlable || null,\n      camara_abierta: form.camara_abierta || null,\n      pulpa_expuesta: form.pulpa_expuesta || null,\n      \n      // Campos radiográficos (estimados por el adaptador)\n      periapical_index_PAI_1_5: form.radiolucidezApical === \"si\" \n        ? (form.percusionDolor === \"si\" ? \"4\" : \"3\") \n        : (form.percusionDolor === \"si\" ? \"2\" : \"1\"),\n      radiolucency_yesno: form.radiolucidezApical === \"si\" ? \"1\" : \"0\",\n      pdl_widening: form.radiolucidezApical === \"si\" ? \"3\" \n        : (form.percusionDolor === \"si\" ? \"2\" : \"1\"),\n      percussion_pain_yesno: form.percusionDolor === \"si\" ? \"sí\" : \"no\",\n      \n      // Campos clínicos adicionales\n      sinus_tract_present: form.sinusTractPresent === \"si\" ? \"sí\" : \"no\",\n      systemic_involvement: form.systemicInvolvement === \"si\" ? \"sí\" : \"no\",\n      previous_treatment: form.previousTreatment,\n      apical_palpation_pain: form.apicalPalpationPain === \"si\" ? \"sí\" : \"no\",\n      \n      notes: form.notas,\n      \n      // Diagnósticos IA generados\n      AEDE_pulpar_IA: ia.pulpalDxIA,\n      AEDE_apical_IA: ia.apicalDxIA,\n      tto_propuesto: ia.ttoPropuestoIA,\n      \n      // Campos de tratamiento (vacíos inicialmente)\n      tto_realizado: \"\",\n      fecha_tto: \"\",\n      \n      // Campos de control/seguimiento (inicializados en 0)\n      control_1m_exito: \"0\",\n      control_3m_exito: \"0\",\n      control_6m_exito: \"0\",\n      fecha_control_1m: \"\",\n      fecha_control_3m: \"\",\n      fecha_control_6m: \"\",\n    };\n\n    const r = await enviarCasoNuevo(payload);\n    if (r.ok) {\n      let mensajeExito = `Caso guardado correctamente. ID generado: ${caseIdGenerado}`;\n      \n      if (radiografiaFile) {\n        try {\n          await uploadRadiographWithVision(radiografiaFile, caseIdGenerado, 'baseline', tipoRadiografia);\n          mensajeExito += ` Radiografía baseline subida y analizada por IA.`;\n          removeRadiografia();\n        } catch (err) {\n          console.error(\"Error subiendo radiografía:\", err);\n          mensajeExito += ` (Error al subir radiografía)`;\n        }\n      }\n      \n      setEstadoEnvio({ \n        tipo: \"success\", \n        mensaje: mensajeExito\n      });\n    } else {\n      setEstadoEnvio({ \n        tipo: \"error\", \n        mensaje: r.error || \"Error al guardar el caso. Verifica tu conexión y la configuración de n8n.\" \n      });\n    }\n\n    setEnviando(false);\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card data-testid=\"card-clinical-form\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Sparkles className=\"w-5 h-5 text-primary\" />\n            Formulario Clínico\n          </CardTitle>\n          <CardDescription>\n            Registro del caso con análisis de apoyo por IA\n          </CardDescription>\n          <Alert className=\"mt-3\">\n            <AlertCircle className=\"w-4 h-4\" />\n            <AlertDescription className=\"text-xs\">\n              <strong>Importante:</strong> Esta herramienta proporciona apoyo al diagnóstico y NO sustituye el juicio clínico del profesional. La decisión final siempre debe basarse en la evaluación clínica completa.\n            </AlertDescription>\n          </Alert>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"identificador_local\">Código interno del clínico (opcional)</Label>\n                <Input\n                  id=\"identificador_local\"\n                  data-testid=\"input-identificador-local\"\n                  value={identificadorLocal}\n                  onChange={(e) => setIdentificadorLocal(e.target.value)}\n                  placeholder=\"Ej: P123, ABC, etc.\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Se generará un ID pseudonimizado automáticamente\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tooth_fdi\">Diente (FDI) *</Label>\n                <Input\n                  id=\"tooth_fdi\"\n                  data-testid=\"input-tooth-fdi\"\n                  value={form.tooth_fdi}\n                  onChange={(e) => handleChange(\"tooth_fdi\", e.target.value)}\n                  placeholder=\"36\"\n                  required\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"dolorEspontaneo\">Dolor espontáneo</Label>\n                <Select\n                  value={form.dolorEspontaneo}\n                  onValueChange={(value) => handleChange(\"dolorEspontaneo\", value)}\n                >\n                  <SelectTrigger id=\"dolorEspontaneo\" data-testid=\"select-dolor-espontaneo\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no\">No</SelectItem>\n                    <SelectItem value=\"si\">Sí</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"respuestaFrio\">Respuesta al frío</Label>\n                <Select\n                  value={form.respuestaFrio}\n                  onValueChange={(value) => handleChange(\"respuestaFrio\", value)}\n                >\n                  <SelectTrigger id=\"respuestaFrio\" data-testid=\"select-respuesta-frio\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"0_no_responde\">No responde</SelectItem>\n                    <SelectItem value=\"1_normal\">Normal / leve</SelectItem>\n                    <SelectItem value=\"2_aumentada\">Muy aumentada</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"lingeringSeg\">Duración dolor tras frío (seg)</Label>\n                <Input\n                  id=\"lingeringSeg\"\n                  data-testid=\"input-lingering\"\n                  type=\"number\"\n                  min=\"0\"\n                  value={form.lingeringSeg}\n                  onChange={(e) => handleChange(\"lingeringSeg\", e.target.value)}\n                  placeholder=\"0-60\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"percusionDolor\">Dolor a percusión</Label>\n                <Select\n                  value={form.percusionDolor}\n                  onValueChange={(value) => handleChange(\"percusionDolor\", value)}\n                >\n                  <SelectTrigger id=\"percusionDolor\" data-testid=\"select-percusion\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no\">No</SelectItem>\n                    <SelectItem value=\"si\">Sí</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"radiolucidezApical\">Radiolucidez apical</Label>\n                <Select\n                  value={form.radiolucidezApical}\n                  onValueChange={(value) => handleChange(\"radiolucidezApical\", value)}\n                >\n                  <SelectTrigger id=\"radiolucidezApical\" data-testid=\"select-radiolucidez\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no\">No visible</SelectItem>\n                    <SelectItem value=\"si\">Sí visible</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tipo_dolor\">Tipo de dolor principal</Label>\n                <Select\n                  value={form.tipo_dolor || \"\"}\n                  onValueChange={(value) => handleChange(\"tipo_dolor\", value)}\n                >\n                  <SelectTrigger id=\"tipo_dolor\" data-testid=\"select-tipo-dolor\">\n                    <SelectValue placeholder=\"Selecciona una opción\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"sin_dolor\">Sin dolor</SelectItem>\n                    <SelectItem value=\"dolor_provocado_corto\">Dolor provocado de corta duración</SelectItem>\n                    <SelectItem value=\"dolor_provocado_largo\">Dolor provocado de larga duración</SelectItem>\n                    <SelectItem value=\"dolor_espontaneo\">Dolor espontáneo</SelectItem>\n                    <SelectItem value=\"dolor_mal_localizado\">Dolor mal localizado / irradiado</SelectItem>\n                    <SelectItem value=\"no_refiere\">No refiere / no sabe describir</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"profundidadCaries\">Profundidad caries</Label>\n                <Select\n                  value={form.profundidadCaries || \"\"}\n                  onValueChange={(value) => handleChange(\"profundidadCaries\", value)}\n                >\n                  <SelectTrigger id=\"profundidadCaries\" data-testid=\"select-profundidad\">\n                    <SelectValue placeholder=\"Selecciona una opción\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no_aplica\">No aplica / diente ya tratado</SelectItem>\n                    <SelectItem value=\"no_refiere\">No se puede determinar</SelectItem>\n                    <SelectItem value=\"esmaltaria\">Esmaltaria</SelectItem>\n                    <SelectItem value=\"dentinaria_media\">Dentinaria media</SelectItem>\n                    <SelectItem value=\"dentinaria_profunda\">Dentinaria profunda</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"sondaje_max_mm\">Profundidad de sondaje máxima (mm)</Label>\n                <Input\n                  id=\"sondaje_max_mm\"\n                  data-testid=\"input-sondaje\"\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"12\"\n                  step=\"1\"\n                  value={form.sondaje_max_mm || \"\"}\n                  onChange={(e) => handleChange(\"sondaje_max_mm\", e.target.value)}\n                  placeholder=\"p.ej. 6\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"sangradoControlable\">Sangrado controlable</Label>\n                <Select\n                  value={form.sangradoControlable || \"\"}\n                  onValueChange={(value) => handleChange(\"sangradoControlable\", value)}\n                >\n                  <SelectTrigger id=\"sangradoControlable\" data-testid=\"select-sangrado\">\n                    <SelectValue placeholder=\"Selecciona una opción\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"si\">Sí</SelectItem>\n                    <SelectItem value=\"no\">No</SelectItem>\n                    <SelectItem value=\"no_valorable\">No valorable</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"camara_abierta\">¿Se abrió la cámara pulpar en esta cita?</Label>\n                <Select\n                  value={form.camara_abierta || \"\"}\n                  onValueChange={(value) => handleChange(\"camara_abierta\", value)}\n                >\n                  <SelectTrigger id=\"camara_abierta\" data-testid=\"select-camara\">\n                    <SelectValue placeholder=\"Selecciona una opción\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"si\">Sí</SelectItem>\n                    <SelectItem value=\"no\">No</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"pulpa_expuesta\">Pulpa expuesta</Label>\n                <Select\n                  value={form.pulpa_expuesta || \"\"}\n                  onValueChange={(value) => handleChange(\"pulpa_expuesta\", value)}\n                >\n                  <SelectTrigger id=\"pulpa_expuesta\" data-testid=\"select-pulpa\">\n                    <SelectValue placeholder=\"Selecciona una opción\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"si\">Sí</SelectItem>\n                    <SelectItem value=\"no\">No</SelectItem>\n                    <SelectItem value=\"no_valorable\">No valorable</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"sinusTractPresent\">Tracto sinusal / fístula</Label>\n                <Select\n                  value={form.sinusTractPresent}\n                  onValueChange={(value) => handleChange(\"sinusTractPresent\", value)}\n                >\n                  <SelectTrigger id=\"sinusTractPresent\" data-testid=\"select-sinus-tract\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no\">No</SelectItem>\n                    <SelectItem value=\"si\">Sí</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"systemicInvolvement\">Compromiso sistémico</Label>\n                <Select\n                  value={form.systemicInvolvement}\n                  onValueChange={(value) => handleChange(\"systemicInvolvement\", value)}\n                >\n                  <SelectTrigger id=\"systemicInvolvement\" data-testid=\"select-systemic\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no\">No</SelectItem>\n                    <SelectItem value=\"si\">Sí (fiebre, malestar)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"previousTreatment\">Tratamiento previo</Label>\n                <Select\n                  value={form.previousTreatment}\n                  onValueChange={(value) => handleChange(\"previousTreatment\", value)}\n                >\n                  <SelectTrigger id=\"previousTreatment\" data-testid=\"select-previous-treatment\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">Ninguno</SelectItem>\n                    <SelectItem value=\"small_restoration\">Restauración pequeña</SelectItem>\n                    <SelectItem value=\"deep_restoration\">Restauración profunda</SelectItem>\n                    <SelectItem value=\"vital_indirect_cap\">Recubrimiento pulpar indirecto</SelectItem>\n                    <SelectItem value=\"vital_direct_cap\">Recubrimiento pulpar directo</SelectItem>\n                    <SelectItem value=\"partial_pulpotomy\">Pulpotomía parcial</SelectItem>\n                    <SelectItem value=\"full_pulpotomy\">Pulpotomía completa</SelectItem>\n                    <SelectItem value=\"previous_regenerative\">Endodoncia regenerativa previa</SelectItem>\n                    <SelectItem value=\"previously_initiated_rct\">Endodoncia iniciada (no completada)</SelectItem>\n                    <SelectItem value=\"previously_obturated_rct\">Endodoncia completa previa</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"apicalPalpationPain\">Dolor a palpación apical</Label>\n                <Select\n                  value={form.apicalPalpationPain}\n                  onValueChange={(value) => handleChange(\"apicalPalpationPain\", value)}\n                >\n                  <SelectTrigger id=\"apicalPalpationPain\" data-testid=\"select-apical-palpation\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no\">No</SelectItem>\n                    <SelectItem value=\"si\">Sí</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tratamientoRealizado\">Tratamiento realizado</Label>\n                <Select\n                  value={form.tratamientoRealizado}\n                  onValueChange={(value) => handleChange(\"tratamientoRealizado\", value)}\n                >\n                  <SelectTrigger id=\"tratamientoRealizado\" data-testid=\"select-tratamiento\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"no_realizado\">(Aún no realizado)</SelectItem>\n                    <SelectItem value=\"recubrimiento\">Recubrimiento / Protección pulpar</SelectItem>\n                    <SelectItem value=\"pulpotomia_vital\">Pulpotomía vital</SelectItem>\n                    <SelectItem value=\"rct\">Endodoncia completa (RCT)</SelectItem>\n                    <SelectItem value=\"otro\">Otro</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2 sm:col-span-2\">\n                <Label htmlFor=\"notas\">Notas clínicas</Label>\n                <Textarea\n                  id=\"notas\"\n                  data-testid=\"input-notas\"\n                  value={form.notas}\n                  onChange={(e) => handleChange(\"notas\", e.target.value)}\n                  placeholder=\"Ej. molestia nocturna, analgésicos previos, restauración previa...\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"space-y-2 sm:col-span-2\">\n                <Label className=\"flex items-center gap-2\">\n                  <Image className=\"w-4 h-4\" />\n                  Radiografía Baseline (opcional)\n                </Label>\n                <div className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-primary/50 transition-colors\">\n                  {radiografiaPreview ? (\n                    <div className=\"relative\">\n                      <img \n                        src={radiografiaPreview} \n                        alt=\"Preview radiografía\" \n                        className=\"max-h-48 mx-auto rounded-lg object-contain\"\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"destructive\"\n                        size=\"icon\"\n                        className=\"absolute top-2 right-2 h-8 w-8\"\n                        onClick={removeRadiografia}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                      <div className=\"mt-3 flex items-center justify-center gap-2\">\n                        <Label className=\"text-sm\">Tipo:</Label>\n                        <Select\n                          value={tipoRadiografia}\n                          onValueChange={(value: 'periapical' | 'cbct') => setTipoRadiografia(value)}\n                        >\n                          <SelectTrigger className=\"w-32 h-8\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"periapical\">Periapical</SelectItem>\n                            <SelectItem value=\"cbct\">CBCT</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n                  ) : (\n                    <div \n                      className=\"flex flex-col items-center justify-center cursor-pointer py-4\"\n                      onClick={() => fileInputRef.current?.click()}\n                    >\n                      <Upload className=\"w-8 h-8 text-muted-foreground mb-2\" />\n                      <p className=\"text-sm text-muted-foreground text-center\">\n                        Haz clic para subir radiografía periapical o CBCT\n                      </p>\n                      <p className=\"text-xs text-muted-foreground/70 mt-1\">\n                        La IA analizará automáticamente PAI y lesión\n                      </p>\n                    </div>\n                  )}\n                  <input\n                    ref={fileInputRef}\n                    type=\"file\"\n                    accept=\"image/*\"\n                    className=\"hidden\"\n                    onChange={handleFileChange}\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"clinicoNombre\">Clínico responsable</Label>\n                <Input\n                  id=\"clinicoNombre\"\n                  data-testid=\"input-clinico-nombre\"\n                  value={form.clinicoNombre}\n                  readOnly\n                  className=\"bg-muted\"\n                  placeholder=\"Dr./Dra. Apellido\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"clinicoEmail\">Email clínico</Label>\n                <Input\n                  id=\"clinicoEmail\"\n                  data-testid=\"input-clinico-email\"\n                  type=\"email\"\n                  value={form.clinicoEmail}\n                  readOnly\n                  className=\"bg-muted\"\n                  placeholder=\"nombre@hospital.es\"\n                />\n              </div>\n            </div>\n\n            <Button\n              type=\"submit\"\n              disabled={enviando}\n              className=\"w-full gap-2\"\n              data-testid=\"button-submit\"\n            >\n              {enviando ? (\n                <>Guardando...</>\n              ) : (\n                <>\n                  <Save className=\"w-4 h-4\" />\n                  Guardar y calcular IA\n                </>\n              )}\n            </Button>\n          </form>\n\n          {estadoEnvio && (\n            <Alert className=\"mt-4\" data-testid=\"alert-status\">\n              {estadoEnvio.tipo === \"success\" ? (\n                <CheckCircle2 className=\"w-4 h-4\" />\n              ) : (\n                <AlertCircle className=\"w-4 h-4\" />\n              )}\n              <AlertDescription>{estadoEnvio.mensaje}</AlertDescription>\n            </Alert>\n          )}\n\n          {iaResult && (\n            <div className=\"mt-6 space-y-4\">\n              <Card className=\"border-l-4 border-l-primary\" data-testid=\"card-ia-result\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    <Sparkles className=\"w-4 h-4 text-primary\" />\n                    Sugerencia de Apoyo por IA\n                  </CardTitle>\n                  <CardDescription className=\"text-xs\">\n                    Sugerencia preliminar basada en los datos clínicos ingresados\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">Clasificación pulpar sugerida</p>\n                    <Badge variant=\"secondary\" className=\"mt-1\">\n                      {iaResult.pulpalDxIA}\n                    </Badge>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">Estado apical sugerido</p>\n                    <Badge variant=\"secondary\" className=\"mt-1\">\n                      {iaResult.apicalDxIA}\n                    </Badge>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">Orientación terapéutica</p>\n                    <p className=\"text-sm mt-1\">{iaResult.ttoPropuestoIA}</p>\n                  </div>\n                  <Alert variant=\"default\" className=\"border-amber-500 bg-amber-50 dark:bg-amber-950\">\n                    <AlertCircle className=\"w-4 h-4 text-amber-600 dark:text-amber-400\" />\n                    <AlertDescription className=\"text-xs text-amber-800 dark:text-amber-200\">\n                      <strong>Recordatorio:</strong> Esta es una sugerencia de apoyo. La decisión diagnóstica y terapéutica final debe basarse en su criterio clínico profesional, exploración completa del paciente y será validada por el tutor.\n                    </AlertDescription>\n                  </Alert>\n                </CardContent>\n              </Card>\n\n              <Card className=\"border-l-4 border-l-blue-500\" data-testid=\"card-recomendaciones\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    📚 Recomendaciones Clínicas (Biblioteca ENDOIA)\n                  </CardTitle>\n                  <CardDescription className=\"text-xs\">\n                    Guía basada en protocolos AAE/ESE 2025, IADT y ADA/AAE 2024\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* Nivel de urgencia */}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-2xl\">\n                      {iaResult.recomendaciones.urgencia === 'baja' && '🟢'}\n                      {iaResult.recomendaciones.urgencia === 'media' && '🟡'}\n                      {iaResult.recomendaciones.urgencia === 'alta' && '🔴'}\n                      {iaResult.recomendaciones.urgencia === 'critica' && '🚨'}\n                    </span>\n                    <div>\n                      <p className=\"text-sm font-medium\">Nivel de urgencia</p>\n                      <Badge variant={\n                        iaResult.recomendaciones.urgencia === 'critica' ? 'destructive' :\n                        iaResult.recomendaciones.urgencia === 'alta' ? 'destructive' :\n                        iaResult.recomendaciones.urgencia === 'media' ? 'default' : 'secondary'\n                      }>\n                        {iaResult.recomendaciones.urgencia.toUpperCase()}\n                      </Badge>\n                    </div>\n                  </div>\n\n                  {/* Plan de actuación */}\n                  <div className=\"p-3 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800\">\n                    <p className=\"text-sm font-medium mb-1 flex items-center gap-1\">\n                      📋 Plan de actuación\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">{iaResult.recomendaciones.planActuacion}</p>\n                  </div>\n\n                  {/* Analgesia */}\n                  <div className=\"p-3 bg-green-50 dark:bg-green-950 rounded-md border border-green-200 dark:border-green-800\">\n                    <p className=\"text-sm font-medium mb-1 flex items-center gap-1\">\n                      💊 Manejo analgésico\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">{iaResult.recomendaciones.analgesia}</p>\n                  </div>\n\n                  {/* Antibiótico */}\n                  <div className={`p-3 rounded-md border ${\n                    iaResult.recomendaciones.antibiotico \n                      ? 'bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800'\n                      : 'bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800'\n                  }`}>\n                    <p className=\"text-sm font-medium mb-1 flex items-center gap-1\">\n                      🦠 Antibiótico\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {iaResult.recomendaciones.antibiotico \n                        ? '✔ SÍ indicado según criterios ADA/AAE 2024' \n                        : '❌ NO indicado'}\n                    </p>\n                  </div>\n\n                  {/* Notas adicionales */}\n                  {iaResult.recomendaciones.notasAdicionales.length > 0 && (\n                    <div className=\"p-3 bg-amber-50 dark:bg-amber-950 rounded-md border border-amber-200 dark:border-amber-800\">\n                      <p className=\"text-sm font-medium mb-2 flex items-center gap-1\">\n                        📌 Notas clínicas importantes\n                      </p>\n                      <ul className=\"space-y-1 text-xs text-muted-foreground\">\n                        {iaResult.recomendaciones.notasAdicionales.map((nota, idx) => (\n                          <li key={idx} className=\"flex gap-2\">\n                            <span className=\"text-amber-600 dark:text-amber-400\">•</span>\n                            <span>{nota}</span>\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n\n                  <Alert className=\"border-blue-500 bg-blue-50 dark:bg-blue-950\">\n                    <AlertCircle className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n                    <AlertDescription className=\"text-xs text-blue-800 dark:text-blue-200\">\n                      Estas recomendaciones están basadas en protocolos oficiales (AAE/ESE 2025, IADT, ADA) de la Biblioteca Clínica ENDOIA y sirven como guía de apoyo al profesional.\n                    </AlertDescription>\n                  </Alert>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":35121,"size_tokens":null},"ENDOIA/client/src/services/vision.ts":{"content":"// client/src/lib/vision.ts\n\nexport type RadiographMoment = 'baseline' | 'control_1m' | 'control_3m' | 'control_6m';\n\nexport interface RadiographAnalysis {\n  pai: number | null;                 // PAI 1–5 estimado por IA\n  radiolucencyDetected: boolean;      // true/false\n  lesionDiameterMm: number | null;    // diámetro máximo estimado\n  laminaDuraIntact: boolean | null;   // true = íntegra, false = pérdida, null = no claro\n  pdlWidening: 'none' | 'mild' | 'moderate' | 'severe' | null;\n  borders: 'well-defined' | 'ill-defined' | null;\n  comments: string;                   // mini-informe radiológico\n}\n\n/**\n * 🔥 Punto ÚNICO donde se habla con la IA de visión.\n * Recibe la URL pública de la radiografía y devuelve hallazgos normalizados.\n *\n * Ahora mismo te dejo un stub que NO rompe nada:\n * solo tienes que sustituir la parte marcada con TODO\n * por la llamada real a OpenAI / Gemini / Replit, etc.\n */\nexport async function analyzeRadiographFromUrl(\n  publicUrl: string,\n  options: { tipo: 'periapical' | 'cbct'; momento: RadiographMoment }\n): Promise<RadiographAnalysis> {\n  const { tipo, momento } = options;\n\n  const systemPrompt = `\nEres un asistente experto en radiología endodóntica.\nAnaliza la imagen (${tipo}, momento clínico: ${momento}) y devuelve SOLO un JSON válido con este formato exacto:\n\n{\n  \"pai\": number | null,                // entero 1-5 según índice PAI, o null si no puedes estimarlo\n  \"radiolucencyDetected\": boolean,     // true si ves lesión radiolúcida periapical\n  \"lesionDiameterMm\": number | null,   // diámetro máximo de la lesión en mm (aproximado), o null si no hay\n  \"laminaDuraIntact\": true | false | null,  // true = íntegra, false = pérdida/discontinuidad, null = no claro\n  \"pdlWidening\": \"none\" | \"mild\" | \"moderate\" | \"severe\" | null,\n  \"borders\": \"well-defined\" | \"ill-defined\" | null,\n  \"comments\": string                   // resumen muy breve de los hallazgos principales (máx. 2 frases)\n}\n\nNo añadas nada fuera del JSON.\nSi no puedes valorar algo con seguridad, usa null.\n`;\n\n  // TODO: 👇 Sustituir por tu llamada real a la IA de visión.\n  // Ejemplo de pseudo-código (AJÚSTALO a tu proveedor real):\n  //\n  // const resp = await fetch(\"https://TU_ENDPOINT_DE_VISION\", {\n  //   method: \"POST\",\n  //   headers: { \"Content-Type\": \"application/json\" },\n  //   body: JSON.stringify({\n  //     prompt: systemPrompt,\n  //     imageUrl: publicUrl,\n  //   }),\n  // });\n  // const text = await resp.text();\n  // const parsed = JSON.parse(text) as RadiographAnalysis;\n  // return parsed;\n\n  // Mientras tanto, devolvemos algo neutro que NO rompe nada:\n  const fallback: RadiographAnalysis = {\n    pai: null,\n    radiolucencyDetected: false,\n    lesionDiameterMm: null,\n    laminaDuraIntact: null,\n    pdlWidening: null,\n    borders: null,\n    comments: \"Análisis radiográfico IA pendiente de implementación.\",\n  };\n\n  return fallback;\n}\n","path":null,"size_bytes":2921,"size_tokens":null},"ENDOIA/client/src/components/radiographs/ListaRadiografias.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { getRadiographs, getRadiographSignedUrl } from \"@/lib/radiographs\";\nimport { ImageIcon, Loader2, ExternalLink, X } from \"lucide-react\";\n\ninterface RadiographWithUrl {\n  rad_id: number;\n  case_id: string;\n  filepath: string;\n  tipo: string;\n  momento: string;\n  fecha: string;\n  pai?: number;\n  lesion_mm?: number;\n  healing?: string;\n  signedUrl?: string;\n}\n\ninterface ListaRadiografiasProps {\n  caseId: string;\n  refreshTrigger?: number;\n  showComparison?: boolean;\n}\n\nexport function ListaRadiografias({ caseId, refreshTrigger, showComparison = true }: ListaRadiografiasProps) {\n  const [rads, setRads] = useState<RadiographWithUrl[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [modalUrl, setModalUrl] = useState(\"\");\n\n  useEffect(() => {\n    async function load() {\n      setLoading(true);\n      try {\n        const data = await getRadiographs(caseId);\n        for (const r of data) {\n          (r as RadiographWithUrl).signedUrl = await getRadiographSignedUrl(r.filepath);\n        }\n        setRads(data as RadiographWithUrl[]);\n      } catch (err) {\n        console.error(\"Error cargando radiografías:\", err);\n      } finally {\n        setLoading(false);\n      }\n    }\n    load();\n  }, [caseId, refreshTrigger]);\n\n  const baseline = rads.find(r => r.momento === 'baseline');\n  const followup = rads.find(r => r.momento !== 'baseline');\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"w-6 h-6 animate-spin text-zinc-400\" />\n      </div>\n    );\n  }\n\n  if (rads.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-zinc-400\">\n        <ImageIcon className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n        <p>No hay radiografías registradas</p>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      {showComparison && baseline && followup && (\n        <div className=\"mb-6 p-4 border rounded-lg bg-zinc-50 dark:bg-zinc-800/50\">\n          <h4 className=\"font-bold text-center mb-4\">Comparativa Baseline vs Control</h4>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <p className=\"text-center font-medium mb-2 text-sm\">Baseline</p>\n              <img \n                src={baseline.signedUrl} \n                className=\"rounded shadow cursor-pointer hover:opacity-90 transition-opacity\" \n                alt=\"Baseline\"\n                onClick={() => setModalUrl(baseline.signedUrl || '')}\n              />\n              {baseline.pai && (\n                <p className=\"text-center text-sm mt-2\">PAI: {baseline.pai}</p>\n              )}\n            </div>\n            <div>\n              <p className=\"text-center font-medium mb-2 text-sm\">Control ({followup.momento})</p>\n              <img \n                src={followup.signedUrl} \n                className=\"rounded shadow cursor-pointer hover:opacity-90 transition-opacity\" \n                alt=\"Control\"\n                onClick={() => setModalUrl(followup.signedUrl || '')}\n              />\n              {followup.pai && (\n                <p className=\"text-center text-sm mt-2\">PAI: {followup.pai}</p>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-2 gap-4 mt-4\">\n        {rads.map((rad) => (\n          <div \n            key={rad.rad_id} \n            className=\"border p-2 rounded shadow-sm bg-white dark:bg-zinc-900\"\n          >\n            <img \n              src={rad.signedUrl} \n              className=\"w-full rounded mb-2 cursor-pointer hover:opacity-90 transition-opacity\" \n              alt=\"Radiografía\"\n              onClick={() => setModalUrl(rad.signedUrl || '')}\n            />\n\n            <div className=\"flex gap-2 flex-wrap\">\n              <span className=\"px-2 py-1 rounded bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 text-xs\">\n                {rad.tipo}\n              </span>\n\n              <span className=\"px-2 py-1 rounded bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-200 text-xs\">\n                {rad.momento}\n              </span>\n            </div>\n\n            {rad.pai !== undefined && rad.pai !== null && (\n              <p className=\"text-sm mt-2\">\n                <strong>PAI IA:</strong> {rad.pai}\n              </p>\n            )}\n\n            {rad.lesion_mm !== undefined && rad.lesion_mm !== null && rad.lesion_mm > 0 && (\n              <p className=\"text-sm\">\n                <strong>Lesión:</strong> {rad.lesion_mm} mm\n              </p>\n            )}\n\n            {rad.healing && (\n              <p className=\"text-sm\">\n                <strong>Healing:</strong> {rad.healing}\n              </p>\n            )}\n\n            <button\n              onClick={() => window.open(rad.signedUrl, \"_blank\")}\n              className=\"mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded flex items-center gap-1 transition-colors\"\n            >\n              <ExternalLink className=\"w-3 h-3\" />\n              Abrir en visor\n            </button>\n          </div>\n        ))}\n      </div>\n\n      {modalUrl && (\n        <div \n          className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\n          onClick={() => setModalUrl(\"\")}\n        >\n          <button \n            className=\"absolute top-4 right-4 text-white hover:text-zinc-300 transition-colors\"\n            onClick={() => setModalUrl(\"\")}\n          >\n            <X className=\"w-8 h-8\" />\n          </button>\n          <img \n            src={modalUrl} \n            className=\"max-h-[90vh] max-w-[90vw] rounded shadow-2xl\" \n            alt=\"Radiografía ampliada\"\n            onClick={(e) => e.stopPropagation()}\n          />\n        </div>\n      )}\n    </>\n  );\n}\n","path":null,"size_bytes":5755,"size_tokens":null},"ENDOIA/client/src/pages/Tutor/CasosPendientes.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { FileCheck, Loader2, AlertCircle, CheckCircle2, Clock, Calendar } from \"lucide-react\";\nimport { useAuth } from \"@/auth/AuthContext\";\nimport { obtenerPendientes } from \"@/lib/api\";\n\nexport default function CasosPendientes() {\n  const { user, role } = useAuth();\n  const [, navigate] = useLocation();\n  const [pendientes, setPendientes] = useState<any[]>([]);\n  const [cargando, setCargando] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!user || (role !== 'tutor' && role !== 'investigador')) return;\n    cargarPendientes();\n  }, [user, role]);\n\n  async function cargarPendientes() {\n    setCargando(true);\n    setError(null);\n    try {\n      const casos = await obtenerPendientes();\n      \n      if (casos.length > 0) {\n        console.log('📋 Estructura de casos pendientes:', casos[0]);\n        console.log('📋 Total de casos:', casos.length);\n      }\n      \n      setPendientes(casos);\n    } catch (err) {\n      console.error('Error cargando pendientes:', err);\n      setError('No se pudieron cargar los casos pendientes');\n    } finally {\n      setCargando(false);\n    }\n  }\n\n  function handleValidar(caso: any) {\n    if (!caso || !caso.case_id) {\n      console.error('Error: caso sin case_id', caso);\n      setError('Error: El caso no tiene un ID válido');\n      return;\n    }\n    \n    const { \n      pulpalDxIA, \n      apicalDxIA, \n      AEDE_pulpar_IA, \n      AEDE_apical_IA, \n      tto_propuesto,\n      recomendacion_analgesia,\n      recomendacion_plan,\n      recomendacion_urgencia,\n      recomendacion_antibiotico,\n      recomendacion_notas,\n      ...clinicalData \n    } = caso;\n    sessionStorage.setItem(`caso_${caso.case_id}`, JSON.stringify(clinicalData));\n    navigate(`/tutor/validar/${caso.case_id}`);\n  }\n\n  if (role !== 'tutor' && role !== 'investigador') {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"w-4 h-4\" />\n          <AlertDescription>\n            Tu cuenta no tiene permisos de tutor. Contacta al administrador.\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  const total = pendientes.length;\n  const ultimos7Dias = pendientes.filter(c => {\n    if (!c.date && !c.registro_fecha) return false;\n    const fecha = new Date(c.date || c.registro_fecha);\n    const hace7Dias = new Date();\n    hace7Dias.setDate(hace7Dias.getDate() - 7);\n    return fecha >= hace7Dias;\n  }).length;\n  const conNotas = pendientes.filter(c => c.notes && c.notes.trim() !== '').length;\n\n  return (\n    <div className=\"container mx-auto p-4 md:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-bold flex items-center gap-2\">\n            <FileCheck className=\"w-7 h-7\" />\n            Casos Pendientes\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Valida diagnósticos según AEDE/ESE 2025\n          </p>\n        </div>\n        <Badge variant=\"secondary\" className=\"gap-1\">\n          {user?.email}\n        </Badge>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Total Pendientes</p>\n                <p className=\"text-3xl font-bold mt-2\">{total}</p>\n              </div>\n              <Clock className=\"w-10 h-10 text-orange-500 opacity-20\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Últimos 7 días</p>\n                <p className=\"text-3xl font-bold mt-2 text-blue-600\">{ultimos7Dias}</p>\n              </div>\n              <Calendar className=\"w-10 h-10 text-blue-500 opacity-20\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Con Notas</p>\n                <p className=\"text-3xl font-bold mt-2 text-green-600\">{conNotas}</p>\n              </div>\n              <CheckCircle2 className=\"w-10 h-10 text-green-500 opacity-20\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {cargando ? (\n        <Card>\n          <CardContent className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n          </CardContent>\n        </Card>\n      ) : error ? (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"w-4 h-4\" />\n          <AlertDescription>{error}</AlertDescription>\n        </Alert>\n      ) : pendientes.length === 0 ? (\n        <Alert>\n          <AlertCircle className=\"w-4 h-4\" />\n          <AlertDescription>\n            No hay casos pendientes de validar en este momento\n          </AlertDescription>\n        </Alert>\n      ) : (\n        <>\n          <div className=\"hidden md:block\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Casos a Validar ({total})</CardTitle>\n                <CardDescription>\n                  Haz clic en \"Validar\" para revisar los datos clínicos y asignar clasificación AEDE/ESE\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"rounded-md border overflow-x-auto\">\n                  <table className=\"w-full\">\n                    <thead className=\"bg-muted\">\n                      <tr>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground\">ID de Caso</th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground\">Diente (FDI)</th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground\">Fecha</th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground\">Notas</th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-muted-foreground\">Acciones</th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"divide-y\">\n                      {pendientes.map((caso) => (\n                        <tr key={caso.case_id} className=\"hover:bg-muted/50\">\n                          <td className=\"px-4 py-3 font-mono text-xs\">{caso.case_id}</td>\n                          <td className=\"px-4 py-3 font-semibold\">{caso.tooth_fdi}</td>\n                          <td className=\"px-4 py-3 text-sm\">\n                            {caso.date || caso.registro_fecha || 'N/A'}\n                          </td>\n                          <td className=\"px-4 py-3\">\n                            {caso.notes && caso.notes.trim() !== '' ? (\n                              <Badge variant=\"outline\" className=\"text-xs\">Sí</Badge>\n                            ) : (\n                              <span className=\"text-xs text-muted-foreground\">—</span>\n                            )}\n                          </td>\n                          <td className=\"px-4 py-3\">\n                            <Button\n                              size=\"sm\"\n                              onClick={() => handleValidar(caso)}\n                              className=\"gap-2\"\n                            >\n                              <FileCheck className=\"w-3 h-3\" />\n                              Validar\n                            </Button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"md:hidden space-y-4\">\n            <h2 className=\"text-xl font-bold\">Casos a Validar ({total})</h2>\n            {pendientes.map((caso) => (\n              <Card key={caso.case_id}>\n                <CardContent className=\"p-4 space-y-3\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"space-y-1\">\n                      <p className=\"font-mono text-xs text-muted-foreground\">{caso.case_id}</p>\n                      <p className=\"text-lg font-bold\">Diente {caso.tooth_fdi}</p>\n                    </div>\n                    {caso.notes && caso.notes.trim() !== '' && (\n                      <Badge variant=\"outline\" className=\"text-xs\">Con notas</Badge>\n                    )}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    {caso.date || caso.registro_fecha || 'Fecha no disponible'}\n                  </div>\n                  <Button\n                    onClick={() => handleValidar(caso)}\n                    className=\"w-full gap-2\"\n                  >\n                    <FileCheck className=\"w-4 h-4\" />\n                    Validar caso\n                  </Button>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":9779,"size_tokens":null},"ENDOIA/client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"ENDOIA/client/src/pages/LoginPage.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Loader2, AlertCircle, Sparkles } from 'lucide-react';\nimport { auth, googleProvider, signInWithPopup } from '@/lib/firebase';\n\nexport default function LoginPage() {\n  const [, setLocation] = useLocation();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  async function handleGoogleLogin() {\n    setLoading(true);\n    setError('');\n\n    try {\n      await signInWithPopup(auth, googleProvider);\n      setLocation('/');\n    } catch (err: any) {\n      console.error('Error en login:', err);\n      setError(err.message || 'Error al iniciar sesión con Google');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <img src=\"/endoia-logo.svg\" alt=\"ENDOIA\" className=\"w-20 h-20\" />\n          </div>\n          <CardTitle className=\"text-2xl\">ENDOIA</CardTitle>\n          <CardDescription>\n            Endodontic Diagnostic & Analytics Assistant\n          </CardDescription>\n          <p className=\"text-xs text-muted-foreground mt-1\">AAE–ESE 2025 Classification</p>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Button\n            onClick={handleGoogleLogin}\n            disabled={loading}\n            className=\"w-full gap-2 h-12\"\n            size=\"lg\"\n          >\n            {loading ? (\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n            ) : (\n              <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n                <path\n                  fill=\"currentColor\"\n                  d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n                />\n                <path\n                  fill=\"currentColor\"\n                  d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n                />\n                <path\n                  fill=\"currentColor\"\n                  d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n                />\n                <path\n                  fill=\"currentColor\"\n                  d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n                />\n              </svg>\n            )}\n            Iniciar sesión con Google\n          </Button>\n\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertCircle className=\"w-4 h-4\" />\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":3281,"size_tokens":null},"ENDOIA/client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"ENDOIA/client/src/components/ProtectedRoute.tsx":{"content":"import { ReactNode } from 'react';\nimport { Redirect } from 'wouter';\nimport { Loader2 } from 'lucide-react';\nimport { useAuth } from '@/auth/AuthContext';\nimport type { UserRole } from '@/auth/roles';\n\ninterface ProtectedRouteProps {\n  children: ReactNode;\n  allowedRoles?: UserRole[];\n}\n\nexport default function ProtectedRoute({ children, allowedRoles }: ProtectedRouteProps) {\n  const { user, role, loading } = useAuth();\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Redirect to=\"/login\" />;\n  }\n\n  if (allowedRoles && !allowedRoles.includes(role)) {\n    return <Redirect to=\"/\" />;\n  }\n\n  return <>{children}</>;\n}\n","path":null,"size_bytes":793,"size_tokens":null},"ENDOIA/client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"ENDOIA/client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/BibliotecaCard.tsx":{"content":"import { BibliotecaItem, getCategoriaLabel } from '@/data/bibliotecaClinica';\nimport { ItemTexto } from './ItemTexto';\nimport { ItemTabla } from './ItemTabla';\nimport { ItemLista } from './ItemLista';\nimport { ItemAlgoritmo } from './ItemAlgoritmo';\nimport { ItemRecurso } from './ItemRecurso';\nimport { ItemFAQ } from './ItemFAQ';\n\ninterface BibliotecaCardProps {\n  item: BibliotecaItem;\n  showCategoria?: boolean;\n}\n\nexport function BibliotecaCard({ item, showCategoria = false }: BibliotecaCardProps) {\n  const renderContent = () => {\n    switch (item.type) {\n      case 'texto':\n        return <ItemTexto item={item} />;\n      case 'tabla':\n        return <ItemTabla item={item} />;\n      case 'lista':\n        return <ItemLista item={item} />;\n      case 'algoritmo':\n        return <ItemAlgoritmo item={item} />;\n      case 'enlace':\n        return <ItemRecurso item={item} />;\n      default:\n        return null;\n    }\n  };\n  \n  if (item.type === 'enlace') {\n    return (\n      <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 hover:shadow-xl transition-all duration-300\">\n        {showCategoria && (\n          <div className=\"mb-3\">\n            <span className=\"inline-block px-3 py-1 rounded-full text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300\">\n              {getCategoriaLabel(item.categoria)}\n            </span>\n          </div>\n        )}\n        \n        <div className=\"space-y-2 mb-4\">\n          <h3 className=\"text-lg font-semibold text-zinc-800 dark:text-zinc-100 tracking-tight\">\n            {item.title}\n          </h3>\n          {item.subtitle && (\n            <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\n              {item.subtitle}\n            </p>\n          )}\n        </div>\n        \n        {renderContent()}\n        \n        {item.reference && (\n          <div className=\"mt-4 pt-4 border-t border-zinc-200 dark:border-zinc-700\">\n            <p className=\"text-xs text-zinc-400\">\n              Fuente: {item.reference}\n            </p>\n          </div>\n        )}\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 hover:shadow-xl transition-all duration-300\">\n      {showCategoria && (\n        <div className=\"mb-3\">\n          <span className=\"inline-block px-3 py-1 rounded-full text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300\">\n            {getCategoriaLabel(item.categoria)}\n          </span>\n        </div>\n      )}\n      \n      <div className=\"space-y-2 mb-4\">\n        <h3 className=\"text-lg font-semibold text-zinc-800 dark:text-zinc-100 tracking-tight\">\n          {item.title}\n        </h3>\n        {item.subtitle && (\n          <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\n            {item.subtitle}\n          </p>\n        )}\n      </div>\n      \n      {item.type === 'texto' && renderContent()}\n      {item.type === 'tabla' && renderContent()}\n      {item.type === 'lista' && renderContent()}\n      {item.type === 'algoritmo' && renderContent()}\n      \n      {item.reference && (\n        <div className=\"mt-4 pt-4 border-t border-zinc-200 dark:border-zinc-700\">\n          <p className=\"text-xs text-zinc-400\">\n            Fuente: {item.reference}\n          </p>\n        </div>\n      )}\n      \n      {item.tags && item.tags.length > 0 && (\n        <div className=\"mt-3 flex flex-wrap gap-2\">\n          {item.tags.map((tag) => (\n            <span\n              key={tag}\n              className=\"inline-block px-2 py-0.5 rounded text-xs bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400\"\n            >\n              {tag}\n            </span>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":3795,"size_tokens":null},"ENDOIA/client/src/pages/Investigador/Dashboard.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  BarChart3, Download, FileSpreadsheet, Loader2, AlertCircle, \n  TrendingUp, Users, CheckCircle2, AlertTriangle, Activity \n} from \"lucide-react\";\nimport { useAuth } from \"@/auth/AuthContext\";\nimport { obtenerDatosInvestigacion, type CasoInvestigacion } from \"@/lib/api-investigador\";\nimport { OPCIONES_PULPAR, OPCIONES_APICAL } from \"@/lib/classifications\";\nimport {\n  BarChart, Bar, LineChart, Line,\n  XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer\n} from \"recharts\";\n\ntype ConfusionMatrix = Record<string, Record<string, number>>;\n\ninterface AgreementMetrics {\n  agreement: number;\n  kappa: number;\n  confusion: ConfusionMatrix;\n}\n\ninterface DiscrepancyRow {\n  case_id: string;\n  jen_p: string;\n  seg_p: string;\n  inv_p: string;\n  final_p: string;\n  ia_p: string;\n  jen_a: string;\n  seg_a: string;\n  inv_a: string;\n  final_a: string;\n  ia_a: string;\n}\n\nfunction computeConfusionMatrix(observed: string[], predicted: string[]): ConfusionMatrix {\n  const matrix: ConfusionMatrix = {};\n  const categories = Array.from(new Set([...observed, ...predicted])).filter(Boolean);\n  \n  categories.forEach(cat => {\n    matrix[cat] = {};\n    categories.forEach(cat2 => {\n      matrix[cat][cat2] = 0;\n    });\n  });\n  \n  for (let i = 0; i < observed.length; i++) {\n    if (observed[i] && predicted[i]) {\n      matrix[observed[i]][predicted[i]]++;\n    }\n  }\n  \n  return matrix;\n}\n\nfunction computeKappa(observed: string[], predicted: string[]): number {\n  if (observed.length !== predicted.length || observed.length === 0) return 0;\n  \n  const n = observed.length;\n  const categories = Array.from(new Set([...observed, ...predicted])).filter(Boolean);\n  \n  if (categories.length === 0) return 0;\n  \n  let po = 0;\n  for (let i = 0; i < n; i++) {\n    if (observed[i] && predicted[i] && observed[i] === predicted[i]) {\n      po++;\n    }\n  }\n  po /= n;\n  \n  let pe = 0;\n  for (const cat of categories) {\n    const obsCount = observed.filter(v => v === cat).length;\n    const predCount = predicted.filter(v => v === cat).length;\n    pe += (obsCount / n) * (predCount / n);\n  }\n  \n  if (pe === 1) return 0;\n  return (po - pe) / (1 - pe);\n}\n\nfunction percentAgreement(a: string[], b: string[]): number {\n  if (a.length !== b.length || a.length === 0) return 0;\n  let matches = 0;\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] && b[i] && a[i] === b[i]) matches++;\n  }\n  return (matches / a.length) * 100;\n}\n\nfunction computeAgreementMetrics(observed: string[], predicted: string[]): AgreementMetrics {\n  return {\n    agreement: percentAgreement(observed, predicted),\n    kappa: computeKappa(observed, predicted),\n    confusion: computeConfusionMatrix(observed, predicted),\n  };\n}\n\nexport default function Dashboard() {\n  const { user, role } = useAuth();\n  const [casos, setCasos] = useState<CasoInvestigacion[]>([]);\n  const [cargando, setCargando] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!user || role !== 'investigador') return;\n    cargarDatos();\n  }, [user, role]);\n\n  async function cargarDatos() {\n    setCargando(true);\n    setError(null);\n    try {\n      const data = await obtenerDatosInvestigacion(user);\n      setCasos(data);\n    } catch (err) {\n      console.error('Error cargando datos:', err);\n      setError('No se pudieron cargar los datos de investigación');\n    } finally {\n      setCargando(false);\n    }\n  }\n\n  function exportCSV() {\n    if (casos.length === 0) {\n      alert('No hay datos para exportar');\n      return;\n    }\n\n    const headers = Object.keys(casos[0]).join(',');\n    const rows = casos.map(caso => \n      Object.values(caso).map(v => \n        typeof v === 'string' && v.includes(',') ? `\"${v}\"` : v\n      ).join(',')\n    );\n    \n    const csv = [headers, ...rows].join('\\n');\n    const blob = new Blob([csv], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `endoia-investigacion-${new Date().toISOString().split('T')[0]}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  function exportDiscrepanciesCSV() {\n    if (discrepancyTable.length === 0) {\n      alert('No hay discrepancias para exportar');\n      return;\n    }\n\n    const headers = 'case_id,JEN_pulpar,SEG_pulpar,INV_pulpar,FINAL_pulpar,IA_pulpar,JEN_apical,SEG_apical,INV_apical,FINAL_apical,IA_apical';\n    const rows = discrepancyTable.map(row => \n      `${row.case_id},\"${row.jen_p}\",\"${row.seg_p}\",\"${row.inv_p}\",\"${row.final_p}\",\"${row.ia_p}\",\"${row.jen_a}\",\"${row.seg_a}\",\"${row.inv_a}\",\"${row.final_a}\",\"${row.ia_a}\"`\n    );\n    \n    const csv = [headers, ...rows].join('\\n');\n    const blob = new Blob([csv], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `endoia-discrepancias-${new Date().toISOString().split('T')[0]}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  async function exportPNG() {\n    const html2canvas = await import('html2canvas').then(m => m.default);\n    const element = document.getElementById('dashboard-content');\n    if (!element) return;\n\n    const canvas = await html2canvas(element, { scale: 2 });\n    const url = canvas.toDataURL('image/png');\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `endoia-dashboard-${new Date().toISOString().split('T')[0]}.png`;\n    a.click();\n  }\n\n  if (role !== 'investigador') {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"w-4 h-4\" />\n          <AlertDescription>\n            Tu cuenta no tiene permisos de investigador.\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  if (cargando) {\n    return (\n      <div className=\"container mx-auto p-6 flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"w-4 h-4\" />\n          <AlertDescription>{error}</AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  const totalCasos = casos.length;\n  const validados = casos.filter(c => c.AEDE_pulpar_FINAL && c.AEDE_apical_FINAL).length;\n  const seguimientosCompletos = casos.filter(c => \n    (c.control_1m_exito === '1' || c.control_1m_exito === '0') &&\n    (c.control_3m_exito === '1' || c.control_3m_exito === '0') &&\n    (c.control_6m_exito === '1' || c.control_6m_exito === '0')\n  ).length;\n\n  const pulparDistribution = OPCIONES_PULPAR.map(opcion => ({\n    name: opcion.replace('Clinically normal pulp', 'Normal').replace('Hypersensitive pulp', 'Hypersensitive').replace('Mild pulpitis', 'Mild').replace('Severe pulpitis', 'Severe').replace('Pulp necrosis', 'Necrosis').replace('Inconclusive pulp status', 'Inconclusive'),\n    value: casos.filter(c => c.AEDE_pulpar_FINAL === opcion).length,\n  }));\n\n  const apicalDistribution = OPCIONES_APICAL.map(opcion => ({\n    name: opcion.replace('Clinically normal apical tissues', 'Normal').replace('Localized symptomatic apical periodontitis', 'Symptomatic AP').replace('Localized asymptomatic apical periodontitis', 'Asymptomatic AP').replace('Apical periodontitis with sinus tract', 'Sinus tract').replace('Apical periodontitis with systemic involvement', 'Systemic').replace('Inconclusive apical condition', 'Inconclusive'),\n    value: casos.filter(c => c.AEDE_apical_FINAL === opcion).length,\n  }));\n\n  // 1. Concordancia entre validadores principales (JEN vs SEG)\n  const casosJENvsSEG = casos.filter(c => \n    c.AEDE_pulpar_JEN && c.AEDE_pulpar_SEG && \n    c.AEDE_apical_JEN && c.AEDE_apical_SEG\n  );\n  \n  const validatorMainAgreement = {\n    pulpar: computeAgreementMetrics(\n      casosJENvsSEG.map(c => c.AEDE_pulpar_JEN || ''),\n      casosJENvsSEG.map(c => c.AEDE_pulpar_SEG || '')\n    ),\n    apical: computeAgreementMetrics(\n      casosJENvsSEG.map(c => c.AEDE_apical_JEN || ''),\n      casosJENvsSEG.map(c => c.AEDE_apical_SEG || '')\n    ),\n  };\n\n  // 2. Detectar discrepancias (JEN ≠ SEG)\n  const discrepanciesPulpar = casosJENvsSEG.filter(c => c.AEDE_pulpar_JEN !== c.AEDE_pulpar_SEG);\n  const discrepanciesApical = casosJENvsSEG.filter(c => c.AEDE_apical_JEN !== c.AEDE_apical_SEG);\n  const discrepanciesBoth = casosJENvsSEG.filter(c => \n    c.AEDE_pulpar_JEN !== c.AEDE_pulpar_SEG || \n    c.AEDE_apical_JEN !== c.AEDE_apical_SEG\n  );\n\n  const discrepancyTable: DiscrepancyRow[] = discrepanciesBoth.map(c => ({\n    case_id: c.case_id || '',\n    jen_p: c.AEDE_pulpar_JEN || '',\n    seg_p: c.AEDE_pulpar_SEG || '',\n    inv_p: c.AEDE_pulpar_INV || '',\n    final_p: c.AEDE_pulpar_FINAL || '',\n    ia_p: c.AEDE_pulpar_IA || '',\n    jen_a: c.AEDE_apical_JEN || '',\n    seg_a: c.AEDE_apical_SEG || '',\n    inv_a: c.AEDE_apical_INV || '',\n    final_a: c.AEDE_apical_FINAL || '',\n    ia_a: c.AEDE_apical_IA || '',\n  }));\n\n  // 3. Analizar INV solo en casos de discrepancia\n  const invResolutionStats = {\n    totalDiscrepancies: discrepanciesBoth.length,\n    invPulpar: {\n      alignsWithJen: discrepanciesPulpar.filter(c => c.AEDE_pulpar_INV === c.AEDE_pulpar_JEN).length,\n      alignsWithSeg: discrepanciesPulpar.filter(c => c.AEDE_pulpar_INV === c.AEDE_pulpar_SEG).length,\n    },\n    invApical: {\n      alignsWithJen: discrepanciesApical.filter(c => c.AEDE_apical_INV === c.AEDE_apical_JEN).length,\n      alignsWithSeg: discrepanciesApical.filter(c => c.AEDE_apical_INV === c.AEDE_apical_SEG).length,\n    },\n  };\n\n  // 4. Concordancia de cada validador vs FINAL\n  const casosConFinal = casos.filter(c => c.AEDE_pulpar_FINAL && c.AEDE_apical_FINAL);\n  \n  const casosJENvsFinal = casosConFinal.filter(c => c.AEDE_pulpar_JEN && c.AEDE_apical_JEN);\n  const casosSEGvsFinal = casosConFinal.filter(c => c.AEDE_pulpar_SEG && c.AEDE_apical_SEG);\n  const casosINVvsFinal = casosConFinal.filter(c => c.AEDE_pulpar_INV && c.AEDE_apical_INV);\n\n  const validatorVsFinal = {\n    jen: {\n      pulpar: computeAgreementMetrics(\n        casosJENvsFinal.map(c => c.AEDE_pulpar_FINAL || ''),\n        casosJENvsFinal.map(c => c.AEDE_pulpar_JEN || '')\n      ),\n      apical: computeAgreementMetrics(\n        casosJENvsFinal.map(c => c.AEDE_apical_FINAL || ''),\n        casosJENvsFinal.map(c => c.AEDE_apical_JEN || '')\n      ),\n    },\n    seg: {\n      pulpar: computeAgreementMetrics(\n        casosSEGvsFinal.map(c => c.AEDE_pulpar_FINAL || ''),\n        casosSEGvsFinal.map(c => c.AEDE_pulpar_SEG || '')\n      ),\n      apical: computeAgreementMetrics(\n        casosSEGvsFinal.map(c => c.AEDE_apical_FINAL || ''),\n        casosSEGvsFinal.map(c => c.AEDE_apical_SEG || '')\n      ),\n    },\n    inv: {\n      pulpar: computeAgreementMetrics(\n        casosINVvsFinal.map(c => c.AEDE_pulpar_FINAL || ''),\n        casosINVvsFinal.map(c => c.AEDE_pulpar_INV || '')\n      ),\n      apical: computeAgreementMetrics(\n        casosINVvsFinal.map(c => c.AEDE_apical_FINAL || ''),\n        casosINVvsFinal.map(c => c.AEDE_apical_INV || '')\n      ),\n    },\n  };\n\n  // 5. IA vs Validadores y vs FINAL\n  const casosIAvsJEN = casos.filter(c => c.AEDE_pulpar_IA && c.AEDE_pulpar_JEN && c.AEDE_apical_IA && c.AEDE_apical_JEN);\n  const casosIAvsSEG = casos.filter(c => c.AEDE_pulpar_IA && c.AEDE_pulpar_SEG && c.AEDE_apical_IA && c.AEDE_apical_SEG);\n  const casosIAvsINV = casos.filter(c => c.AEDE_pulpar_IA && c.AEDE_pulpar_INV && c.AEDE_apical_IA && c.AEDE_apical_INV);\n  const casosIAvsFinal = casosConFinal.filter(c => c.AEDE_pulpar_IA && c.AEDE_apical_IA);\n\n  const iaComparisons = {\n    jen: {\n      pulpar: computeAgreementMetrics(\n        casosIAvsJEN.map(c => c.AEDE_pulpar_JEN || ''),\n        casosIAvsJEN.map(c => c.AEDE_pulpar_IA || '')\n      ),\n      apical: computeAgreementMetrics(\n        casosIAvsJEN.map(c => c.AEDE_apical_JEN || ''),\n        casosIAvsJEN.map(c => c.AEDE_apical_IA || '')\n      ),\n    },\n    seg: {\n      pulpar: computeAgreementMetrics(\n        casosIAvsSEG.map(c => c.AEDE_pulpar_SEG || ''),\n        casosIAvsSEG.map(c => c.AEDE_pulpar_IA || '')\n      ),\n      apical: computeAgreementMetrics(\n        casosIAvsSEG.map(c => c.AEDE_apical_SEG || ''),\n        casosIAvsSEG.map(c => c.AEDE_apical_IA || '')\n      ),\n    },\n    inv: {\n      pulpar: computeAgreementMetrics(\n        casosIAvsINV.map(c => c.AEDE_pulpar_INV || ''),\n        casosIAvsINV.map(c => c.AEDE_pulpar_IA || '')\n      ),\n      apical: computeAgreementMetrics(\n        casosIAvsINV.map(c => c.AEDE_apical_INV || ''),\n        casosIAvsINV.map(c => c.AEDE_apical_IA || '')\n      ),\n    },\n    final: {\n      pulpar: computeAgreementMetrics(\n        casosIAvsFinal.map(c => c.AEDE_pulpar_FINAL || ''),\n        casosIAvsFinal.map(c => c.AEDE_pulpar_IA || '')\n      ),\n      apical: computeAgreementMetrics(\n        casosIAvsFinal.map(c => c.AEDE_apical_FINAL || ''),\n        casosIAvsFinal.map(c => c.AEDE_apical_IA || '')\n      ),\n    },\n  };\n\n  const control1mCasos = casos.filter(c => c.control_1m_exito !== null && c.control_1m_exito !== undefined && c.control_1m_exito !== '');\n  const control3mCasos = casos.filter(c => c.control_3m_exito !== null && c.control_3m_exito !== undefined && c.control_3m_exito !== '');\n  const control6mCasos = casos.filter(c => c.control_6m_exito !== null && c.control_6m_exito !== undefined && c.control_6m_exito !== '');\n\n  const exito1m = control1mCasos.filter(c => c.control_1m_exito === '1').length;\n  const exito3m = control3mCasos.filter(c => c.control_3m_exito === '1').length;\n  const exito6m = control6mCasos.filter(c => c.control_6m_exito === '1').length;\n\n  const seguimientoData = [\n    {\n      periodo: '1 mes',\n      exito: control1mCasos.length > 0 ? (exito1m / control1mCasos.length) * 100 : 0,\n      n: control1mCasos.length,\n    },\n    {\n      periodo: '3 meses',\n      exito: control3mCasos.length > 0 ? (exito3m / control3mCasos.length) * 100 : 0,\n      n: control3mCasos.length,\n    },\n    {\n      periodo: '6 meses',\n      exito: control6mCasos.length > 0 ? (exito6m / control6mCasos.length) * 100 : 0,\n      n: control6mCasos.length,\n    },\n  ];\n\n  const toothCounts: Record<string, number> = {};\n  casos.forEach(c => {\n    if (c.tooth_fdi) {\n      toothCounts[c.tooth_fdi] = (toothCounts[c.tooth_fdi] || 0) + 1;\n    }\n  });\n\n  const topTeeth = Object.entries(toothCounts)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 10)\n    .map(([tooth, count]) => ({ tooth, count }));\n\n  const monthCounts: Record<string, { nuevos: number; validados: number; seguimiento: number }> = {};\n  casos.forEach(c => {\n    const fecha = c.date || c.registro_fecha;\n    if (fecha) {\n      const month = fecha.substring(0, 7);\n      if (!monthCounts[month]) {\n        monthCounts[month] = { nuevos: 0, validados: 0, seguimiento: 0 };\n      }\n      monthCounts[month].nuevos++;\n      if (c.AEDE_pulpar_FINAL && c.AEDE_apical_FINAL) {\n        monthCounts[month].validados++;\n      }\n      const tieneSeguimiento = (\n        (c.control_1m_exito === '1' || c.control_1m_exito === '0') ||\n        (c.control_3m_exito === '1' || c.control_3m_exito === '0') ||\n        (c.control_6m_exito === '1' || c.control_6m_exito === '0')\n      );\n      if (tieneSeguimiento) {\n        monthCounts[month].seguimiento++;\n      }\n    }\n  });\n\n  const tendenciaData = Object.entries(monthCounts)\n    .sort((a, b) => a[0].localeCompare(b[0]))\n    .slice(-12)\n    .map(([mes, data]) => ({\n      mes: mes.substring(5),\n      nuevos: data.nuevos,\n      validados: data.validados,\n      seguimiento: data.seguimiento,\n    }));\n\n  const missingFields: Record<string, number> = {};\n  const fieldKeys = ['spontaneous_pain_yesno', 'thermal_cold_response', 'percussion_pain_yesno', \n    'radiolucency_yesno', 'AEDE_pulpar_FINAL', 'AEDE_apical_FINAL', 'tto_realizado'];\n  \n  fieldKeys.forEach(key => {\n    missingFields[key] = casos.filter(c => {\n      const value = c[key as keyof CasoInvestigacion];\n      return value === null || value === undefined || value === '';\n    }).length;\n  });\n\n  const topMissing = Object.entries(missingFields)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 5);\n\n  const casosConNotas = casos.filter(c => c.notes && c.notes.trim() !== '').length;\n\n  return (\n    <div className=\"container mx-auto p-4 md:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-bold flex items-center gap-2\">\n            <BarChart3 className=\"w-7 h-7\" />\n            Panel de Investigación\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Análisis completo de datos ENDOIA\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button onClick={exportCSV} variant=\"outline\" size=\"sm\" className=\"gap-2\">\n            <FileSpreadsheet className=\"w-4 h-4\" />\n            Datos Completos\n          </Button>\n          <Button onClick={exportDiscrepanciesCSV} variant=\"outline\" size=\"sm\" className=\"gap-2\">\n            <FileSpreadsheet className=\"w-4 h-4\" />\n            Discrepancias\n          </Button>\n          <Button onClick={exportPNG} variant=\"outline\" size=\"sm\" className=\"gap-2\">\n            <Download className=\"w-4 h-4\" />\n            PNG\n          </Button>\n        </div>\n      </div>\n\n      <div id=\"dashboard-content\" className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Total Casos</p>\n                  <p className=\"text-3xl font-bold mt-2\">{totalCasos}</p>\n                </div>\n                <Activity className=\"w-10 h-10 text-blue-500 opacity-20\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Validados</p>\n                  <p className=\"text-3xl font-bold mt-2 text-green-600\">{validados}</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {totalCasos > 0 ? `${((validados / totalCasos) * 100).toFixed(1)}%` : '0%'}\n                  </p>\n                </div>\n                <CheckCircle2 className=\"w-10 h-10 text-green-500 opacity-20\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Discrepancias JEN≠SEG</p>\n                  <p className=\"text-3xl font-bold mt-2 text-orange-600\">{discrepanciesBoth.length}</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {casosJENvsSEG.length > 0 ? `${((discrepanciesBoth.length / casosJENvsSEG.length) * 100).toFixed(1)}%` : '0%'}\n                  </p>\n                </div>\n                <AlertTriangle className=\"w-10 h-10 text-orange-500 opacity-20\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Seguimientos 100%</p>\n                  <p className=\"text-3xl font-bold mt-2 text-purple-600\">{seguimientosCompletos}</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">1m + 3m + 6m</p>\n                </div>\n                <TrendingUp className=\"w-10 h-10 text-purple-500 opacity-20\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Tendencia Temporal (últimos 12 meses)</CardTitle>\n            <CardDescription>Casos nuevos, validados y con seguimiento por mes</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <LineChart data={tendenciaData}>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis dataKey=\"mes\" />\n                <YAxis />\n                <Tooltip />\n                <Legend />\n                <Line type=\"monotone\" dataKey=\"nuevos\" stroke=\"#8884d8\" name=\"Nuevos\" />\n                <Line type=\"monotone\" dataKey=\"validados\" stroke=\"#82ca9d\" name=\"Validados\" />\n                <Line type=\"monotone\" dataKey=\"seguimiento\" stroke=\"#ffc658\" name=\"Seguimiento\" />\n              </LineChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Distribución Diagnóstico Pulpar (AAE–ESE 2025)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <BarChart data={pulparDistribution}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"name\" angle={-45} textAnchor=\"end\" height={100} />\n                  <YAxis />\n                  <Tooltip />\n                  <Bar dataKey=\"value\" fill=\"#8884d8\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Distribución Diagnóstico Apical (AAE–ESE 2025)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <BarChart data={apicalDistribution}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"name\" angle={-45} textAnchor=\"end\" height={100} />\n                  <YAxis />\n                  <Tooltip />\n                  <Bar dataKey=\"value\" fill=\"#82ca9d\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Concordancia JEN vs SEG (Validadores Principales)</CardTitle>\n            <CardDescription>Acuerdo entre los dos validadores principales antes de INV</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"p-4 border rounded-lg bg-blue-50 dark:bg-blue-950\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Diagnóstico Pulpar</p>\n                <p className=\"text-2xl font-bold mt-2\">{validatorMainAgreement.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Kappa: {validatorMainAgreement.pulpar.kappa.toFixed(3)} | N = {casosJENvsSEG.length}\n                </p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg bg-green-50 dark:bg-green-950\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Diagnóstico Apical</p>\n                <p className=\"text-2xl font-bold mt-2\">{validatorMainAgreement.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Kappa: {validatorMainAgreement.apical.kappa.toFixed(3)} | N = {casosJENvsSEG.length}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Discrepancias y Resolución por INV (Tercer Validador)</CardTitle>\n            <CardDescription>\n              INV solo interviene cuando JEN ≠ SEG para resolver el diagnóstico final\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"p-4 border rounded-lg\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Total Discrepancias</p>\n                <p className=\"text-3xl font-bold mt-2 text-orange-600\">{invResolutionStats.totalDiscrepancies}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {casosJENvsSEG.length > 0 ? `${((invResolutionStats.totalDiscrepancies / casosJENvsSEG.length) * 100).toFixed(1)}% de casos` : '0%'}\n                </p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Discrepancias Pulpar</p>\n                <p className=\"text-2xl font-bold mt-2\">{discrepanciesPulpar.length}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  INV→JEN: {invResolutionStats.invPulpar.alignsWithJen} | \n                  INV→SEG: {invResolutionStats.invPulpar.alignsWithSeg}\n                </p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Discrepancias Apical</p>\n                <p className=\"text-2xl font-bold mt-2\">{discrepanciesApical.length}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  INV→JEN: {invResolutionStats.invApical.alignsWithJen} | \n                  INV→SEG: {invResolutionStats.invApical.alignsWithSeg}\n                </p>\n              </div>\n            </div>\n\n            {discrepancyTable.length > 0 && (\n              <div className=\"mt-6\">\n                <h3 className=\"text-sm font-semibold mb-2\">Tabla de Discrepancias Detallada</h3>\n                <div className=\"overflow-x-auto border rounded-lg\">\n                  <table className=\"w-full text-xs\">\n                    <thead className=\"bg-muted\">\n                      <tr>\n                        <th className=\"p-2 text-left\">Caso</th>\n                        <th className=\"p-2 text-left\">JEN_P</th>\n                        <th className=\"p-2 text-left\">SEG_P</th>\n                        <th className=\"p-2 text-left\">INV_P</th>\n                        <th className=\"p-2 text-left\">FINAL_P</th>\n                        <th className=\"p-2 text-left\">JEN_A</th>\n                        <th className=\"p-2 text-left\">SEG_A</th>\n                        <th className=\"p-2 text-left\">INV_A</th>\n                        <th className=\"p-2 text-left\">FINAL_A</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {discrepancyTable.slice(0, 10).map((row, idx) => (\n                        <tr key={idx} className=\"border-t\">\n                          <td className=\"p-2 font-mono\">{row.case_id.substring(0, 8)}</td>\n                          <td className=\"p-2\">{row.jen_p.substring(0, 15)}</td>\n                          <td className=\"p-2\">{row.seg_p.substring(0, 15)}</td>\n                          <td className=\"p-2\">{row.inv_p.substring(0, 15)}</td>\n                          <td className=\"p-2 font-semibold\">{row.final_p.substring(0, 15)}</td>\n                          <td className=\"p-2\">{row.jen_a.substring(0, 15)}</td>\n                          <td className=\"p-2\">{row.seg_a.substring(0, 15)}</td>\n                          <td className=\"p-2\">{row.inv_a.substring(0, 15)}</td>\n                          <td className=\"p-2 font-semibold\">{row.final_a.substring(0, 15)}</td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n                {discrepancyTable.length > 10 && (\n                  <p className=\"text-xs text-muted-foreground mt-2\">\n                    Mostrando 10 de {discrepancyTable.length} discrepancias. Exporta CSV para ver todas.\n                  </p>\n                )}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Concordancia Validadores vs FINAL (Gold Standard)</CardTitle>\n            <CardDescription>Comparación de cada validador contra el diagnóstico final consensuado</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"p-4 border rounded-lg\">\n                <h4 className=\"font-semibold mb-3\">JEN vs FINAL</h4>\n                <p className=\"text-sm text-muted-foreground\">Pulpar: {validatorVsFinal.jen.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">Kappa: {validatorVsFinal.jen.pulpar.kappa.toFixed(3)}</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Apical: {validatorVsFinal.jen.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">Kappa: {validatorVsFinal.jen.apical.kappa.toFixed(3)}</p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg\">\n                <h4 className=\"font-semibold mb-3\">SEG vs FINAL</h4>\n                <p className=\"text-sm text-muted-foreground\">Pulpar: {validatorVsFinal.seg.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">Kappa: {validatorVsFinal.seg.pulpar.kappa.toFixed(3)}</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Apical: {validatorVsFinal.seg.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">Kappa: {validatorVsFinal.seg.apical.kappa.toFixed(3)}</p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg\">\n                <h4 className=\"font-semibold mb-3\">INV vs FINAL (solo en discrepancias)</h4>\n                <p className=\"text-sm text-muted-foreground\">Pulpar: {validatorVsFinal.inv.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">Kappa: {validatorVsFinal.inv.pulpar.kappa.toFixed(3)}</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Apical: {validatorVsFinal.inv.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">Kappa: {validatorVsFinal.inv.apical.kappa.toFixed(3)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>IA Comparada con Validadores y FINAL</CardTitle>\n            <CardDescription>Rendimiento del sistema de IA contra cada validador y el gold standard</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div className=\"p-4 border rounded-lg bg-purple-50 dark:bg-purple-950\">\n                <h4 className=\"font-semibold mb-3\">IA vs JEN</h4>\n                <p className=\"text-sm text-muted-foreground\">Pulpar: {iaComparisons.jen.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.jen.pulpar.kappa.toFixed(3)}</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Apical: {iaComparisons.jen.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.jen.apical.kappa.toFixed(3)}</p>\n                <p className=\"text-xs text-muted-foreground mt-2\">N = {casosIAvsJEN.length}</p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg bg-purple-50 dark:bg-purple-950\">\n                <h4 className=\"font-semibold mb-3\">IA vs SEG</h4>\n                <p className=\"text-sm text-muted-foreground\">Pulpar: {iaComparisons.seg.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.seg.pulpar.kappa.toFixed(3)}</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Apical: {iaComparisons.seg.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.seg.apical.kappa.toFixed(3)}</p>\n                <p className=\"text-xs text-muted-foreground mt-2\">N = {casosIAvsSEG.length}</p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg bg-purple-50 dark:bg-purple-950\">\n                <h4 className=\"font-semibold mb-3\">IA vs INV</h4>\n                <p className=\"text-sm text-muted-foreground\">Pulpar: {iaComparisons.inv.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.inv.pulpar.kappa.toFixed(3)}</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Apical: {iaComparisons.inv.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.inv.apical.kappa.toFixed(3)}</p>\n                <p className=\"text-xs text-muted-foreground mt-2\">N = {casosIAvsINV.length}</p>\n              </div>\n\n              <div className=\"p-4 border rounded-lg bg-amber-50 dark:bg-amber-950\">\n                <h4 className=\"font-semibold mb-3\">IA vs FINAL ⭐</h4>\n                <p className=\"text-sm text-muted-foreground\">Pulpar: {iaComparisons.final.pulpar.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.final.pulpar.kappa.toFixed(3)}</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Apical: {iaComparisons.final.apical.agreement.toFixed(1)}%</p>\n                <p className=\"text-xs text-muted-foreground\">κ: {iaComparisons.final.apical.kappa.toFixed(3)}</p>\n                <p className=\"text-xs text-muted-foreground mt-2\">N = {casosIAvsFinal.length}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Tasas de Éxito en Seguimientos</CardTitle>\n            <CardDescription>Porcentaje de éxito clínico/radiológico por periodo</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={seguimientoData}>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis dataKey=\"periodo\" />\n                <YAxis />\n                <Tooltip formatter={(value: number) => `${value.toFixed(1)}%`} />\n                <Legend />\n                <Bar dataKey=\"exito\" fill=\"#10b981\" name=\"% Éxito\" />\n              </BarChart>\n            </ResponsiveContainer>\n            <div className=\"mt-4 grid grid-cols-3 gap-4 text-center\">\n              {seguimientoData.map((item) => (\n                <div key={item.periodo} className=\"p-2 border rounded\">\n                  <p className=\"text-xs text-muted-foreground\">{item.periodo}</p>\n                  <p className=\"text-lg font-bold\">{item.exito.toFixed(1)}%</p>\n                  <p className=\"text-xs text-muted-foreground\">n = {item.n}</p>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Top 10 Dientes Tratados (FDI)</CardTitle>\n            <CardDescription>Frecuencia por número de diente</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={topTeeth} layout=\"vertical\">\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis type=\"number\" />\n                <YAxis dataKey=\"tooth\" type=\"category\" />\n                <Tooltip />\n                <Bar dataKey=\"count\" fill=\"#6366f1\" />\n              </BarChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Métricas de Calidad de Datos</CardTitle>\n            <CardDescription>Variables con mayor porcentaje de datos faltantes</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {topMissing.map(([field, count]) => (\n                <div key={field} className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">{field}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-32 bg-gray-200 rounded-full h-2\">\n                      <div\n                        className=\"bg-orange-500 h-2 rounded-full\"\n                        style={{ width: `${(count / totalCasos) * 100}%` }}\n                      />\n                    </div>\n                    <span className=\"text-sm text-muted-foreground w-16 text-right\">\n                      {((count / totalCasos) * 100).toFixed(1)}%\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n            <div className=\"mt-6 grid grid-cols-2 gap-4\">\n              <div className=\"p-3 border rounded-lg\">\n                <p className=\"text-xs text-muted-foreground\">Casos con notas</p>\n                <p className=\"text-xl font-bold mt-1\">{casosConNotas}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  {((casosConNotas / totalCasos) * 100).toFixed(1)}%\n                </p>\n              </div>\n              <div className=\"p-3 border rounded-lg\">\n                <p className=\"text-xs text-muted-foreground\">Completitud promedio</p>\n                <p className=\"text-xl font-bold mt-1\">\n                  {(100 - (Object.values(missingFields).reduce((a, b) => a + b, 0) / \n                    (fieldKeys.length * totalCasos)) * 100).toFixed(1)}%\n                </p>\n                <p className=\"text-xs text-muted-foreground\">de los campos clave</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":38263,"size_tokens":null},"ENDOIA/client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"ENDOIA/client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"ENDOIA/client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"ENDOIA/client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"ENDOIA/client/src/pages/Clinico/MisCasos.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { useAuth } from '@/auth/AuthContext';\nimport { obtenerMisCasos, actualizarControl, actualizarTratamiento } from '@/lib/api';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  Loader2, \n  FileText, \n  RefreshCw, \n  CheckCircle2, \n  Clock, \n  TrendingUp,\n  Eye,\n  Calendar,\n  Pill,\n  Activity,\n  AlertCircle,\n  Stethoscope,\n  Edit,\n  Save,\n  Image\n} from 'lucide-react';\nimport { SubirRadiografia, ListaRadiografias } from '@/components/radiographs';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  EnhancedStats,\n  SeguimientosPendientes,\n  HistorialDientes,\n  CasosComplejos,\n  CalidadRegistros,\n  FailedTeethRanking,\n  PersonalStats,\n  EnhancedDiagnosisBadges,\n  FDIHeatmap,\n  CasosPorDienteModal,\n  ClinicoCase\n} from '@/components/clinico';\n\ninterface CasoData {\n  row_number: number;\n  case_id: string;\n  date: string;\n  clinicoEmail: string;\n  tooth_fdi: number | string;\n  spontaneous_pain_yesno: number | string;\n  thermal_cold_response: number | string;\n  lingering_pain_seconds: number | string;\n  periapical_index_PAI_1_5: number | string;\n  radiolucency_yesno: number | string;\n  pdl_widening: number | string;\n  probing_max_depth_mm: number | string;\n  depth_of_caries: string;\n  percussion_pain_yesno: string;\n  bleeding_control_possible: string;\n  sinus_tract_present: string;\n  systemic_involvement: string;\n  previous_treatment: string;\n  apical_palpation_pain: string;\n  notes: string;\n  AEDE_pulpar_IA: string;\n  AEDE_apical_IA: string;\n  tto_propuesto: string;\n  tto_realizado: string;\n  fecha_tto: string;\n  control_1m_exito: number | string;\n  fecha_control_1m: string;\n  control_3m_exito: number | string;\n  fecha_control_3m: string;\n  control_6m_exito: number | string;\n  fecha_control_6m: string;\n  AEDE_pulpar_JEN: string;\n  AEDE_apical_JEN: string;\n  validado_JEN: string;\n  AEDE_pulpar_SEG: string;\n  AEDE_apical_SEG: string;\n  validado_SEG: string;\n  AEDE_pulpar_INV: string;\n  AEDE_apical_INV: string;\n  validado_INV: string;\n  AEDE_pulpar_FINAL: string;\n  AEDE_apical_FINAL: string;\n  validado_FINAL: string;\n  registro_fecha: string;\n  registro_ip: string;\n  token_recibido?: string;\n  case_id_recibido?: string;\n  discrepancia?: boolean | string;\n  token?: string;\n  token_normalizado?: string;\n  token_valido?: boolean | string;\n  vision_PAI_baseline?: number | string;\n  vision_PAI_followup?: number | string;\n  vision_lesion_diam_mm_baseline?: number | string;\n  vision_lesion_diam_mm_followup?: number | string;\n  vision_radiolucency_detected?: boolean;\n  IA_flags?: string[];\n}\n\nfunction toNumber(value: number | string | null | undefined): number {\n  if (value === null || value === undefined || value === '') return 0;\n  if (typeof value === 'number') return value;\n  const parsed = Number(value);\n  return isNaN(parsed) ? 0 : parsed;\n}\n\nfunction calcularDiasHastaControl(caso: CasoData): { dias: number; controlTipo: string; vencido: boolean } | null {\n  if (!caso.fecha_tto || caso.fecha_tto.trim() === '') {\n    return null;\n  }\n\n  const fechaTratamiento = new Date(caso.fecha_tto);\n  const ahora = new Date();\n  \n  const control1mRealizado = toNumber(caso.control_1m_exito) === 1 || (caso.fecha_control_1m && caso.fecha_control_1m.trim() !== '');\n  const control3mRealizado = toNumber(caso.control_3m_exito) === 1 || (caso.fecha_control_3m && caso.fecha_control_3m.trim() !== '');\n  const control6mRealizado = toNumber(caso.control_6m_exito) === 1 || (caso.fecha_control_6m && caso.fecha_control_6m.trim() !== '');\n\n  if (!control1mRealizado) {\n    const fecha1m = new Date(fechaTratamiento);\n    fecha1m.setMonth(fecha1m.getMonth() + 1);\n    const dias = Math.ceil((fecha1m.getTime() - ahora.getTime()) / (1000 * 60 * 60 * 24));\n    return { dias, controlTipo: '1 mes', vencido: dias < 0 };\n  }\n  \n  if (!control3mRealizado) {\n    const fecha3m = new Date(fechaTratamiento);\n    fecha3m.setMonth(fecha3m.getMonth() + 3);\n    const dias = Math.ceil((fecha3m.getTime() - ahora.getTime()) / (1000 * 60 * 60 * 24));\n    return { dias, controlTipo: '3 meses', vencido: dias < 0 };\n  }\n  \n  if (!control6mRealizado) {\n    const fecha6m = new Date(fechaTratamiento);\n    fecha6m.setMonth(fecha6m.getMonth() + 6);\n    const dias = Math.ceil((fecha6m.getTime() - ahora.getTime()) / (1000 * 60 * 60 * 24));\n    return { dias, controlTipo: '6 meses', vencido: dias < 0 };\n  }\n  \n  return null;\n}\n\nfunction ordenarCasosPorProximidad(casos: CasoData[]): CasoData[] {\n  return [...casos].sort((a, b) => {\n    const proximidadA = calcularDiasHastaControl(a);\n    const proximidadB = calcularDiasHastaControl(b);\n    \n    if (!proximidadA && !proximidadB) return 0;\n    if (!proximidadA) return 1;\n    if (!proximidadB) return -1;\n    \n    if (proximidadA.vencido && !proximidadB.vencido) return -1;\n    if (!proximidadA.vencido && proximidadB.vencido) return 1;\n    \n    return proximidadA.dias - proximidadB.dias;\n  });\n}\n\nfunction getPulparColor(diagnosis: string): string {\n  if (!diagnosis) return 'bg-gray-100 text-gray-700 border-gray-300';\n  const lower = diagnosis.toLowerCase();\n  \n  if (lower.includes('normal') || lower.includes('clinically normal')) {\n    return 'bg-green-100 text-green-800 border-green-300';\n  }\n  if (lower.includes('reversible') || lower.includes('mild') || lower.includes('hypersensitive')) {\n    return 'bg-blue-100 text-blue-800 border-blue-300';\n  }\n  if (lower.includes('sintomática') || lower.includes('symptomatic') || lower.includes('severe')) {\n    return 'bg-orange-100 text-orange-800 border-orange-300';\n  }\n  if (lower.includes('necrótica') || lower.includes('necrosis') || lower.includes('pulp necrosis')) {\n    return 'bg-red-100 text-red-800 border-red-300';\n  }\n  return 'bg-gray-100 text-gray-700 border-gray-300';\n}\n\nfunction getApicalColor(diagnosis: string): string {\n  if (!diagnosis) return 'bg-gray-100 text-gray-700 border-gray-300';\n  const lower = diagnosis.toLowerCase();\n  \n  if (lower.includes('normal') || lower.includes('sin alteración') || lower.includes('clinically normal')) {\n    return 'bg-green-100 text-green-800 border-green-300';\n  }\n  if (lower.includes('sintomática') || lower.includes('symptomatic')) {\n    return 'bg-red-100 text-red-800 border-red-300';\n  }\n  if (lower.includes('asintomática') || lower.includes('asymptomatic') || lower.includes('localized')) {\n    return 'bg-orange-100 text-orange-800 border-orange-300';\n  }\n  if (lower.includes('sinus') || lower.includes('tract') || lower.includes('fístula')) {\n    return 'bg-purple-100 text-purple-800 border-purple-300';\n  }\n  if (lower.includes('systemic') || lower.includes('sistémico')) {\n    return 'bg-red-200 text-red-900 border-red-400';\n  }\n  return 'bg-blue-100 text-blue-700 border-blue-300';\n}\n\n\ninterface CaseModalProps {\n  caso: CasoData | null;\n  onClose: () => void;\n  onActualizar: () => void;\n}\n\nfunction CaseModal({ caso, onClose, onActualizar }: CaseModalProps) {\n  const [guardando, setGuardando] = useState(false);\n  const [tipoControl, setTipoControl] = useState<'1m' | '3m' | '6m'>('1m');\n  const [exitoClinico, setExitoClinico] = useState<'si' | 'no'>('si');\n  const [exitoRadiologico, setExitoRadiologico] = useState<'si' | 'parcial' | 'no'>('si');\n  const [radiologicoBloqueado, setRadiologicoBloqueado] = useState(false);\n  const [notas, setNotas] = useState('');\n  const [refreshRx, setRefreshRx] = useState(0);\n  \n  // Estados para actualizar tratamiento\n  const [ttoRealizado, setTtoRealizado] = useState('');\n  const [fechaTto, setFechaTto] = useState('');\n\n  // Sincronizar estados del tratamiento cuando cambia el caso\n  useEffect(() => {\n    if (caso) {\n      setTtoRealizado(caso.tto_realizado || '');\n      setFechaTto(caso.fecha_tto || '');\n      \n      // Calcular automáticamente éxito radiológico si hay RX baseline y followup\n      const hayRxControl = caso.vision_PAI_baseline && caso.vision_PAI_followup;\n      \n      if (hayRxControl) {\n        const paiBase = Number(caso.vision_PAI_baseline);\n        const paiFollow = Number(caso.vision_PAI_followup);\n        const diamBase = Number(caso.vision_lesion_diam_mm_baseline) || 0;\n        const diamFollow = Number(caso.vision_lesion_diam_mm_followup) || 0;\n        \n        let resultado: 'si' | 'parcial' | 'no' = 'si';\n        \n        if (paiFollow < paiBase) {\n          resultado = (paiFollow <= 2 && diamFollow <= 1) ? 'si' : 'parcial';\n        } else if (paiFollow > paiBase) {\n          resultado = 'no';\n        } else if (diamBase > 0 && diamFollow > 0) {\n          const reduccion = (diamBase - diamFollow) / diamBase;\n          if (reduccion >= 0.3) resultado = 'si';\n          else if (reduccion > 0) resultado = 'parcial';\n          else if (diamFollow > diamBase) resultado = 'no';\n        }\n        \n        setExitoRadiologico(resultado);\n        setRadiologicoBloqueado(true);\n      } else {\n        setRadiologicoBloqueado(false);\n      }\n    }\n  }, [caso]);\n\n  if (!caso) return null;\n\n  const handleActualizarTratamiento = async () => {\n    if (!caso.case_id) return;\n\n    if (!ttoRealizado.trim() && !fechaTto.trim()) {\n      alert('⚠️ Debes completar al menos uno de los campos (tratamiento o fecha).');\n      return;\n    }\n\n    setGuardando(true);\n    try {\n      await actualizarTratamiento({\n        case_id: caso.case_id,\n        tto_realizado: ttoRealizado.trim(),\n        fecha_tto: fechaTto.trim()\n      });\n      \n      onActualizar();\n      alert('✓ Tratamiento actualizado exitosamente');\n    } catch (error) {\n      console.error('Error al actualizar tratamiento:', error);\n      alert('Error al actualizar el tratamiento. Inténtalo de nuevo.');\n    } finally {\n      setGuardando(false);\n    }\n  };\n\n  const handleActualizarControl = async () => {\n    if (!caso.case_id) return;\n    \n    if (!caso.fecha_tto || caso.fecha_tto.trim() === '') {\n      alert('⚠️ No se puede actualizar el control: este caso no tiene un tratamiento registrado.');\n      return;\n    }\n\n    setGuardando(true);\n    try {\n      await actualizarControl({\n        case_id: caso.case_id,\n        tipo_control: tipoControl,\n        exito_clinico: exitoClinico === 'si',\n        exito_radiologico: exitoRadiologico,\n        notas: notas.trim()\n      });\n      \n      setNotas('');\n      setExitoClinico('si');\n      setExitoRadiologico('si');\n      onActualizar();\n      alert('✓ Control actualizado exitosamente');\n    } catch (error) {\n      console.error('Error al actualizar control:', error);\n      alert('Error al actualizar el control. Inténtalo de nuevo.');\n    } finally {\n      setGuardando(false);\n    }\n  };\n\n  return (\n    <Dialog open={!!caso} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Stethoscope className=\"w-5 h-5\" />\n            Caso: {caso.case_id}\n          </DialogTitle>\n          <DialogDescription>\n            Ver detalles y actualizar controles de seguimiento\n          </DialogDescription>\n        </DialogHeader>\n\n        <Tabs defaultValue=\"detalles\" className=\"mt-4\">\n          <TabsList className=\"grid w-full grid-cols-4\">\n            <TabsTrigger value=\"detalles\">\n              <Eye className=\"w-4 h-4 mr-2\" />\n              Detalles\n            </TabsTrigger>\n            <TabsTrigger value=\"radiografias\">\n              <Image className=\"w-4 h-4 mr-2\" />\n              Radiografías\n            </TabsTrigger>\n            <TabsTrigger value=\"tratamiento\">\n              <Pill className=\"w-4 h-4 mr-2\" />\n              Tratamiento\n            </TabsTrigger>\n            <TabsTrigger value=\"actualizar\" disabled={!caso.fecha_tto || caso.fecha_tto.trim() === ''}>\n              <Edit className=\"w-4 h-4 mr-2\" />\n              Controles\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"detalles\" className=\"space-y-6 mt-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground flex items-center gap-2\">\n                <Calendar className=\"w-4 h-4\" />\n                Información General\n              </h3>\n              <div className=\"bg-muted p-4 rounded-lg space-y-2\">\n                <p className=\"text-sm\"><span className=\"font-medium\">ID:</span> {caso.case_id}</p>\n                <p className=\"text-sm\"><span className=\"font-medium\">Diente FDI:</span> {caso.tooth_fdi}</p>\n                <p className=\"text-sm\"><span className=\"font-medium\">Fecha registro:</span> {caso.registro_fecha || caso.date || 'N/A'}</p>\n                <p className=\"text-sm\"><span className=\"font-medium\">Email clínico:</span> {caso.clinicoEmail}</p>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground flex items-center gap-2\">\n                <Activity className=\"w-4 h-4\" />\n                Signos Clínicos\n              </h3>\n              <div className=\"bg-muted p-4 rounded-lg space-y-2\">\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Dolor espontáneo:</span> {toNumber(caso.spontaneous_pain_yesno) === 1 ? '✓ Sí' : '✗ No'}\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Respuesta al frío:</span> {\n                    toNumber(caso.thermal_cold_response) === 0 ? 'No responde' : \n                    toNumber(caso.thermal_cold_response) === 2 ? 'Aumentada' : 'Normal'\n                  }\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Dolor persistente:</span> {toNumber(caso.lingering_pain_seconds)} seg\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Percusión dolorosa:</span> {caso.percussion_pain_yesno || 'N/A'}\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Palpación apical:</span> {caso.apical_palpation_pain || 'N/A'}\n                </p>\n                {caso.sinus_tract_present && (\n                  <p className=\"text-sm\">\n                    <span className=\"font-medium\">Tracto sinusal:</span> {caso.sinus_tract_present}\n                  </p>\n                )}\n                {caso.systemic_involvement && (\n                  <p className=\"text-sm\">\n                    <span className=\"font-medium\">Compromiso sistémico:</span> {caso.systemic_involvement}\n                  </p>\n                )}\n                {caso.previous_treatment && (\n                  <p className=\"text-sm\">\n                    <span className=\"font-medium\">Tratamiento previo:</span> {caso.previous_treatment}\n                  </p>\n                )}\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground flex items-center gap-2\">\n                <AlertCircle className=\"w-4 h-4\" />\n                Hallazgos Radiográficos\n              </h3>\n              <div className=\"bg-muted p-4 rounded-lg space-y-2\">\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">PAI (1-5):</span> {caso.periapical_index_PAI_1_5}\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Radiolucidez:</span> {toNumber(caso.radiolucency_yesno) === 1 ? '✓ Sí' : '✗ No'}\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Ensanchamiento PDL:</span> {caso.pdl_widening}\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Profundidad caries:</span> {caso.depth_of_caries || 'N/A'}\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Sondaje (mm):</span> {caso.probing_max_depth_mm || 'N/A'}\n                </p>\n                <p className=\"text-sm\">\n                  <span className=\"font-medium\">Control de sangrado:</span> {caso.bleeding_control_possible || 'N/A'}\n                </p>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground flex items-center gap-2\">\n                <Pill className=\"w-4 h-4\" />\n                Diagnóstico IA (AAE/ESE 2025)\n              </h3>\n              <EnhancedDiagnosisBadges caso={caso} />\n            </div>\n          </div>\n\n          {/* BLOQUE DE IA RADIOLÓGICA */}\n          <div className=\"bg-blue-50 p-4 rounded-lg mt-6 border border-blue-200\">\n            <h3 className=\"text-blue-900 font-semibold mb-3 flex items-center gap-2\">\n              <AlertCircle className=\"w-4 h-4\" />\n              Análisis Radiográfico IA (Vision GPT)\n            </h3>\n            <div className=\"space-y-2 text-sm\">\n              <p><strong>PAI inicial (IA):</strong> {caso.vision_PAI_baseline ?? \"No disponible\"}</p>\n              <p><strong>PAI seguimiento (IA):</strong> {caso.vision_PAI_followup ?? \"No disponible\"}</p>\n              <p><strong>Radiolucidez detectada:</strong> {caso.vision_radiolucency_detected ? \"Sí\" : \"No\"}</p>\n              <p>\n                <strong>Diámetro lesión (baseline):</strong>{\" \"}\n                {caso.vision_lesion_diam_mm_baseline ? `${caso.vision_lesion_diam_mm_baseline} mm` : \"No disponible\"}\n              </p>\n              <p>\n                <strong>Diámetro lesión (follow-up):</strong>{\" \"}\n                {caso.vision_lesion_diam_mm_followup ? `${caso.vision_lesion_diam_mm_followup} mm` : \"No disponible\"}\n              </p>\n              {caso.IA_flags && caso.IA_flags.length > 0 && (\n                <div className=\"mt-3 pt-3 border-t border-blue-200\">\n                  <h4 className=\"font-semibold text-blue-800 mb-2\">Alertas IA</h4>\n                  <ul className=\"list-disc list-inside space-y-1\">\n                    {caso.IA_flags.map((flag, idx) => (\n                      <li key={idx} className=\"text-blue-700\">{flag}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* BLOQUE DE COHERENCIA CLÍNICO – IA */}\n          <div className=\"bg-orange-50 p-4 rounded-lg mt-5 border border-orange-200\">\n            <h3 className=\"text-orange-800 font-semibold mb-3\">\n              Coherencia Clínico – IA\n            </h3>\n            <div className=\"space-y-2 text-sm\">\n              <p>\n                <strong>Radiolucidez (Clínico):</strong>{\" \"}\n                {caso.radiolucency_yesno === \"si\" || caso.radiolucency_yesno === \"1\" || toNumber(caso.radiolucency_yesno) === 1 ? \"Sí\" : \"No\"}\n              </p>\n              <p>\n                <strong>Radiolucidez (IA):</strong>{\" \"}\n                {caso.vision_radiolucency_detected ? \"Sí\" : \"No\"}\n              </p>\n              <p className=\"mt-2 pt-2 border-t border-orange-200\">\n                <strong>Interpretación final:</strong>{\" \"}\n                {caso.vision_radiolucency_detected\n                  ? \"Radiolucidez presente (confirmada por IA)\"\n                  : (caso.radiolucency_yesno === \"si\" || caso.radiolucency_yesno === \"1\" || toNumber(caso.radiolucency_yesno) === 1)\n                    ? \"Radiolucidez presente (identificada por el clínico)\"\n                    : \"No se detecta radiolucidez\"}\n              </p>\n              {(caso.vision_radiolucency_detected &&\n                (caso.radiolucency_yesno === \"no\" ||\n                 caso.radiolucency_yesno === \"0\" ||\n                 toNumber(caso.radiolucency_yesno) === 0)) && (\n                <p className=\"text-orange-700 mt-3 p-2 bg-orange-100 rounded\">\n                  <strong>Aviso:</strong> Se detecta discrepancia entre el clínico y la IA.\n                  La interpretación final prioriza la detección de IA por seguridad diagnóstica.\n                </p>\n              )}\n            </div>\n          </div>\n\n          {caso.notes && (\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground\">Notas Clínicas</h3>\n              <div className=\"bg-muted p-4 rounded-lg\">\n                <p className=\"text-sm\">{caso.notes}</p>\n              </div>\n            </div>\n          )}\n\n          {caso.tto_realizado && (\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground\">Tratamiento Realizado</h3>\n              <div className=\"bg-blue-50 border border-blue-200 p-4 rounded-lg\">\n                <p className=\"text-sm font-medium\">{caso.tto_realizado}</p>\n                {caso.fecha_tto && (\n                  <p className=\"text-xs text-muted-foreground mt-1\">Fecha: {caso.fecha_tto}</p>\n                )}\n              </div>\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <h3 className=\"font-semibold text-sm text-muted-foreground\">Controles de Seguimiento</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n              <div className={`p-3 rounded-lg border ${toNumber(caso.control_1m_exito) === 1 ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`}>\n                <p className=\"text-xs font-medium\">Control 1 mes</p>\n                <p className=\"text-lg font-bold\">{toNumber(caso.control_1m_exito) === 1 ? '✓ Éxito' : '—'}</p>\n                {caso.fecha_control_1m && <p className=\"text-xs text-muted-foreground\">{caso.fecha_control_1m}</p>}\n              </div>\n              <div className={`p-3 rounded-lg border ${toNumber(caso.control_3m_exito) === 1 ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`}>\n                <p className=\"text-xs font-medium\">Control 3 meses</p>\n                <p className=\"text-lg font-bold\">{toNumber(caso.control_3m_exito) === 1 ? '✓ Éxito' : '—'}</p>\n                {caso.fecha_control_3m && <p className=\"text-xs text-muted-foreground\">{caso.fecha_control_3m}</p>}\n              </div>\n              <div className={`p-3 rounded-lg border ${toNumber(caso.control_6m_exito) === 1 ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`}>\n                <p className=\"text-xs font-medium\">Control 6 meses</p>\n                <p className=\"text-lg font-bold\">{toNumber(caso.control_6m_exito) === 1 ? '✓ Éxito' : '—'}</p>\n                {caso.fecha_control_6m && <p className=\"text-xs text-muted-foreground\">{caso.fecha_control_6m}</p>}\n              </div>\n            </div>\n          </div>\n\n          {(caso.AEDE_pulpar_FINAL || caso.AEDE_pulpar_JEN || caso.AEDE_pulpar_SEG || caso.AEDE_pulpar_INV) && (\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground\">Validación por Expertos</h3>\n              <div className=\"bg-green-50 border border-green-200 p-4 rounded-lg space-y-3\">\n                {caso.AEDE_pulpar_FINAL && (\n                  <div>\n                    <p className=\"text-xs font-medium text-green-700 mb-2\">✓ Diagnóstico Final Validado</p>\n                    <div className=\"space-y-1\">\n                      <div>\n                        <span className=\"text-xs text-muted-foreground\">Pulpar:</span>\n                        <Badge className={`ml-2 ${getPulparColor(caso.AEDE_pulpar_FINAL)} border text-xs`}>\n                          {caso.AEDE_pulpar_FINAL}\n                        </Badge>\n                      </div>\n                      <div>\n                        <span className=\"text-xs text-muted-foreground\">Apical:</span>\n                        <Badge className={`ml-2 ${getApicalColor(caso.AEDE_apical_FINAL)} border text-xs`}>\n                          {caso.AEDE_apical_FINAL}\n                        </Badge>\n                      </div>\n                    </div>\n                    {caso.validado_FINAL && (\n                      <p className=\"text-xs text-green-600 mt-2\">Fecha: {caso.validado_FINAL}</p>\n                    )}\n                  </div>\n                )}\n                \n                {(caso.AEDE_pulpar_JEN || caso.AEDE_pulpar_SEG || caso.AEDE_pulpar_INV) && (\n                  <div className=\"pt-3 border-t border-green-200\">\n                    <p className=\"text-xs font-medium text-green-700 mb-2\">Validaciones Individuales:</p>\n                    <div className=\"space-y-2\">\n                      {caso.AEDE_pulpar_JEN && (\n                        <div className=\"text-xs\">\n                          <p className=\"font-medium\">Validador JEN:</p>\n                          <p className=\"text-muted-foreground\">Pulpar: {caso.AEDE_pulpar_JEN} | Apical: {caso.AEDE_apical_JEN}</p>\n                          {caso.validado_JEN && <p className=\"text-green-600\">✓ {caso.validado_JEN}</p>}\n                        </div>\n                      )}\n                      {caso.AEDE_pulpar_SEG && (\n                        <div className=\"text-xs\">\n                          <p className=\"font-medium\">Validador SEG:</p>\n                          <p className=\"text-muted-foreground\">Pulpar: {caso.AEDE_pulpar_SEG} | Apical: {caso.AEDE_apical_SEG}</p>\n                          {caso.validado_SEG && <p className=\"text-green-600\">✓ {caso.validado_SEG}</p>}\n                        </div>\n                      )}\n                      {caso.AEDE_pulpar_INV && (\n                        <div className=\"text-xs\">\n                          <p className=\"font-medium\">Validador INV:</p>\n                          <p className=\"text-muted-foreground\">Pulpar: {caso.AEDE_pulpar_INV} | Apical: {caso.AEDE_apical_INV}</p>\n                          {caso.validado_INV && <p className=\"text-green-600\">✓ {caso.validado_INV}</p>}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n          </TabsContent>\n\n          <TabsContent value=\"radiografias\" className=\"space-y-4 mt-4\">\n            <div className=\"bg-blue-50 border border-blue-200 p-4 rounded-lg\">\n              <p className=\"text-sm font-medium text-blue-900 mb-1\">Gestión de Radiografías</p>\n              <p className=\"text-xs text-blue-700\">\n                Sube radiografías periapicales o CBCT. La IA analizará automáticamente el índice PAI y el diámetro de lesión.\n              </p>\n            </div>\n\n            <SubirRadiografia \n              caseId={caso.case_id} \n              onUploadSuccess={() => {\n                setRefreshRx(prev => prev + 1);\n                onActualizar();\n              }}\n            />\n\n            <div className=\"mt-6\">\n              <h3 className=\"font-semibold mb-3\">Galería de radiografías</h3>\n              <ListaRadiografias \n                caseId={caso.case_id} \n                refreshTrigger={refreshRx}\n                showComparison={true}\n              />\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"tratamiento\" className=\"space-y-4 mt-4\">\n            <div className=\"bg-blue-50 border border-blue-200 p-4 rounded-lg\">\n              <p className=\"text-sm font-medium text-blue-900 mb-2\">📝 Registrar o actualizar tratamiento realizado</p>\n              <p className=\"text-xs text-blue-700\">\n                Completa la información del tratamiento endodóntico realizado. Esta información es necesaria para poder registrar controles de seguimiento.\n              </p>\n            </div>\n\n            <div className=\"space-y-4 border rounded-lg p-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tto-realizado\" className=\"font-semibold\">\n                  Tratamiento Realizado <span className=\"text-red-500\">*</span>\n                </Label>\n                <Textarea\n                  id=\"tto-realizado\"\n                  placeholder=\"Ej: Endodoncia completa en diente 47. Obturación con gutapercha mediante técnica de condensación lateral. Sellado con resina compuesta...\"\n                  value={ttoRealizado}\n                  onChange={(e) => setTtoRealizado(e.target.value)}\n                  rows={6}\n                  className=\"resize-none\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Describe el procedimiento endodóntico realizado, técnicas utilizadas y materiales empleados.\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"fecha-tto\" className=\"font-semibold\">\n                  Fecha del Tratamiento <span className=\"text-red-500\">*</span>\n                </Label>\n                <Input\n                  id=\"fecha-tto\"\n                  type=\"date\"\n                  value={fechaTto}\n                  onChange={(e: React.ChangeEvent<HTMLInputElement>) => setFechaTto(e.target.value)}\n                  max={new Date().toISOString().split('T')[0]}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Fecha en que se completó el tratamiento endodóntico\n                </p>\n              </div>\n\n              <div className=\"bg-amber-50 border border-amber-200 p-3 rounded-lg\">\n                <p className=\"text-xs text-amber-800\">\n                  <strong>Importante:</strong> Una vez registrada la fecha de tratamiento, podrás actualizar los controles de seguimiento en 1m, 3m y 6m.\n                </p>\n              </div>\n\n              <Button \n                onClick={handleActualizarTratamiento} \n                disabled={guardando}\n                className=\"w-full\"\n              >\n                {guardando ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Guardando...\n                  </>\n                ) : (\n                  <>\n                    <Save className=\"mr-2 h-4 w-4\" />\n                    Guardar Tratamiento\n                  </>\n                )}\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"actualizar\" className=\"space-y-4 mt-4\">\n            {!caso.fecha_tto ? (\n              <div className=\"bg-yellow-50 border border-yellow-200 p-4 rounded-lg\">\n                <p className=\"text-sm text-yellow-800\">\n                  ⚠️ Este caso aún no tiene un tratamiento registrado. Completa el tratamiento antes de registrar controles de seguimiento.\n                </p>\n              </div>\n            ) : (\n              <>\n                <div className=\"bg-blue-50 border border-blue-200 p-4 rounded-lg space-y-2\">\n                  <p className=\"text-sm font-medium text-blue-900\">Tratamiento realizado:</p>\n                  <p className=\"text-sm text-blue-800\">{caso.tto_realizado}</p>\n                  <p className=\"text-xs text-blue-600\">Fecha: {caso.fecha_tto}</p>\n                </div>\n\n                <div className=\"space-y-4 border rounded-lg p-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"tipo-control\" className=\"font-semibold\">\n                      Tipo de control a registrar\n                    </Label>\n                    <Select value={tipoControl} onValueChange={(v) => setTipoControl(v as '1m' | '3m' | '6m')}>\n                      <SelectTrigger id=\"tipo-control\">\n                        <SelectValue placeholder=\"Selecciona el control\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"1m\">Control 1 mes {toNumber(caso.control_1m_exito) === 1 && '(✓ Ya registrado)'}</SelectItem>\n                        <SelectItem value=\"3m\">Control 3 meses {toNumber(caso.control_3m_exito) === 1 && '(✓ Ya registrado)'}</SelectItem>\n                        <SelectItem value=\"6m\">Control 6 meses {toNumber(caso.control_6m_exito) === 1 && '(✓ Ya registrado)'}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"exito-clinico\" className=\"font-semibold\">\n                        Éxito Clínico\n                      </Label>\n                      <Select value={exitoClinico} onValueChange={(v) => setExitoClinico(v as 'si' | 'no')}>\n                        <SelectTrigger id=\"exito-clinico\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"si\">✔ Sí – Sin síntomas</SelectItem>\n                          <SelectItem value=\"no\">✖ No – Síntomas presentes</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <p className=\"text-sm text-gray-500 mt-1\">\n                        Paciente sin dolor, sin sensibilidad, sin fístula ni inflamación.\n                        Ausencia total de signos o síntomas clínicos periapicales.\n                      </p>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"exito-radiologico\" className=\"font-semibold flex items-center gap-2\">\n                        Éxito Radiológico\n                        {radiologicoBloqueado && (\n                          <span className=\"text-xs font-normal bg-blue-100 text-blue-700 px-2 py-0.5 rounded\">\n                            Calculado por IA\n                          </span>\n                        )}\n                      </Label>\n                      <Select \n                        value={exitoRadiologico} \n                        onValueChange={(v) => setExitoRadiologico(v as 'si' | 'parcial' | 'no')}\n                        disabled={radiologicoBloqueado}\n                      >\n                        <SelectTrigger id=\"exito-radiologico\" className={radiologicoBloqueado ? 'opacity-70' : ''}>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"si\">✔ Sí – Curación / reducción</SelectItem>\n                          <SelectItem value=\"parcial\">☆ Parcial – Mejoría incompleta</SelectItem>\n                          <SelectItem value=\"no\">✖ No – Persistencia / empeoramiento</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <p className=\"text-sm text-gray-500 mt-1\">\n                        Éxito radiográfico = reducción de lesión o PAI.<br />\n                        Fracaso = lesión igual o mayor.\n                      </p>\n                      {radiologicoBloqueado && (\n                        <p className=\"text-xs text-blue-600 mt-1\">\n                          Valor calculado automáticamente según PAI baseline ({caso.vision_PAI_baseline}) → followup ({caso.vision_PAI_followup})\n                        </p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"notas-control\" className=\"font-semibold\">\n                      Notas del control (opcional)\n                    </Label>\n                    <Textarea\n                      id=\"notas-control\"\n                      placeholder=\"Observaciones clínicas o radiológicas adicionales...\"\n                      value={notas}\n                      onChange={(e) => setNotas(e.target.value)}\n                      rows={4}\n                      className=\"resize-none\"\n                    />\n                  </div>\n\n                  <Button \n                    onClick={handleActualizarControl} \n                    disabled={guardando || !caso.fecha_tto || caso.fecha_tto.trim() === ''}\n                    className=\"w-full gap-2\"\n                  >\n                    {guardando ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        Guardando...\n                      </>\n                    ) : (\n                      <>\n                        <Save className=\"w-4 h-4\" />\n                        Guardar Control de Seguimiento\n                      </>\n                    )}\n                  </Button>\n                </div>\n\n                <div className=\"space-y-2 bg-muted p-4 rounded-lg\">\n                  <h4 className=\"text-sm font-semibold\">Estado actual de controles:</h4>\n                  <div className=\"grid grid-cols-3 gap-2 text-xs\">\n                    <div className={toNumber(caso.control_1m_exito) === 1 ? 'text-green-600' : 'text-gray-500'}>\n                      1m: {toNumber(caso.control_1m_exito) === 1 ? '✓' : '—'} {caso.fecha_control_1m && `(${caso.fecha_control_1m})`}\n                    </div>\n                    <div className={toNumber(caso.control_3m_exito) === 1 ? 'text-green-600' : 'text-gray-500'}>\n                      3m: {toNumber(caso.control_3m_exito) === 1 ? '✓' : '—'} {caso.fecha_control_3m && `(${caso.fecha_control_3m})`}\n                    </div>\n                    <div className={toNumber(caso.control_6m_exito) === 1 ? 'text-green-600' : 'text-gray-500'}>\n                      6m: {toNumber(caso.control_6m_exito) === 1 ? '✓' : '—'} {caso.fecha_control_6m && `(${caso.fecha_control_6m})`}\n                    </div>\n                  </div>\n                </div>\n              </>\n            )}\n          </TabsContent>\n        </Tabs>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\ninterface TablaProps {\n  casos: CasoData[];\n  onVerDetalle: (caso: CasoData) => void;\n}\n\nfunction ClinicoTabla({ casos, onVerDetalle }: TablaProps) {\n  if (casos.length === 0) {\n    return (\n      <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-12 text-center\">\n        <FileText className=\"w-16 h-16 mx-auto mb-4\" style={{ color: '#A6A6A6' }} />\n        <h3 className=\"text-xl font-semibold tracking-tight mb-2\">No hay casos registrados</h3>\n        <p className=\"text-zinc-400 max-w-sm mx-auto\">\n          Aún no has registrado ningún caso clínico. Ve a \"Registrar caso\" para comenzar.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"hidden md:block\">\n        <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 overflow-hidden\">\n          <div className=\"p-6 pb-4\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <FileText className=\"w-5 h-5\" style={{ color: '#3A7AFE' }} />\n              <h3 className=\"text-lg font-semibold tracking-tight\">Casos Registrados ({casos.length})</h3>\n            </div>\n            <p className=\"text-sm text-zinc-400\">\n              Listado completo de tus casos con diagnósticos IA\n            </p>\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-t border-b border-zinc-200/50 dark:border-zinc-700/50 bg-zinc-50/50 dark:bg-zinc-800/50\">\n                  <th className=\"px-6 py-4 text-left text-xs font-semibold text-zinc-500 tracking-wide\">ID de Caso</th>\n                  <th className=\"px-6 py-4 text-left text-xs font-semibold text-zinc-500 tracking-wide\">Diente</th>\n                  <th className=\"px-6 py-4 text-left text-xs font-semibold text-zinc-500 tracking-wide\">Diagnóstico Pulpar IA</th>\n                  <th className=\"px-6 py-4 text-left text-xs font-semibold text-zinc-500 tracking-wide\">Diagnóstico Apical IA</th>\n                  <th className=\"px-6 py-4 text-left text-xs font-semibold text-zinc-500 tracking-wide\">Tto. Propuesto</th>\n                  <th className=\"px-6 py-4 text-left text-xs font-semibold text-zinc-500 tracking-wide\">Estado</th>\n                  <th className=\"px-6 py-4 text-left text-xs font-semibold text-zinc-500 tracking-wide\">Acciones</th>\n                </tr>\n              </thead>\n              <tbody>\n                {casos.map((caso, idx) => (\n                  <tr \n                    key={`${caso.case_id}-${caso.row_number}`} \n                    className=\"border-b border-zinc-200/30 dark:border-zinc-700/30 hover:bg-zinc-50/50 dark:hover:bg-zinc-800/30 transition-colors\"\n                    style={{ backgroundColor: idx % 2 === 0 ? 'transparent' : 'rgba(0,0,0,0.015)' }}\n                  >\n                    <td className=\"px-6 py-5 font-mono text-xs text-zinc-500\">{caso.case_id}</td>\n                    <td className=\"px-6 py-5 font-semibold tracking-tight\">{caso.tooth_fdi}</td>\n                    <td className=\"px-6 py-5\">\n                      <span className=\"inline-flex items-center rounded-full px-3 py-1 text-xs font-medium\" style={{ backgroundColor: 'rgba(58, 122, 254, 0.1)', color: '#3A7AFE' }}>\n                        {caso.AEDE_pulpar_IA || 'Sin dx'}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-5\">\n                      <span className=\"inline-flex items-center rounded-full px-3 py-1 text-xs font-medium\" style={{ backgroundColor: 'rgba(245, 166, 35, 0.1)', color: '#F5A623' }}>\n                        {caso.AEDE_apical_IA || 'Sin dx'}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-5 text-sm max-w-[200px] truncate text-zinc-600 dark:text-zinc-400\">\n                      {caso.tto_propuesto || 'N/A'}\n                    </td>\n                    <td className=\"px-6 py-5\">\n                      {caso.AEDE_pulpar_FINAL ? (\n                        <span className=\"inline-flex items-center rounded-full px-3 py-1 text-xs font-medium\" style={{ backgroundColor: 'rgba(46, 204, 113, 0.1)', color: '#2ECC71' }}>\n                          Validado\n                        </span>\n                      ) : (\n                        <span className=\"inline-flex items-center rounded-full px-3 py-1 text-xs font-medium\" style={{ backgroundColor: 'rgba(166, 166, 166, 0.1)', color: '#A6A6A6' }}>\n                          Pendiente\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"px-6 py-5\">\n                      <Button \n                        size=\"sm\" \n                        variant=\"ghost\"\n                        onClick={() => onVerDetalle(caso)}\n                        className=\"gap-2 text-xs hover:bg-zinc-100 dark:hover:bg-zinc-800\"\n                      >\n                        <Eye className=\"w-3 h-3\" />\n                        Ver\n                      </Button>\n                    </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n      <div className=\"md:hidden space-y-4\">\n        <h3 className=\"text-lg font-semibold tracking-tight mb-4\">Casos Registrados ({casos.length})</h3>\n        {casos.map((caso) => (\n          <div key={`${caso.case_id}-${caso.row_number}`} className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-4 space-y-3\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"space-y-1\">\n                  <p className=\"font-mono text-xs text-muted-foreground\">{caso.case_id}</p>\n                  <p className=\"text-lg font-bold\">Diente {caso.tooth_fdi}</p>\n                </div>\n                {caso.AEDE_pulpar_FINAL ? (\n                  <Badge variant=\"default\" className=\"bg-green-600 text-white text-xs\">\n                    Validado\n                  </Badge>\n                ) : (\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    Pendiente\n                  </Badge>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-1\">Diagnóstico Pulpar:</p>\n                  <Badge className={`${getPulparColor(caso.AEDE_pulpar_IA)} border text-xs`}>\n                    {caso.AEDE_pulpar_IA || 'Sin diagnóstico'}\n                  </Badge>\n                </div>\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-1\">Diagnóstico Apical:</p>\n                  <Badge className={`${getApicalColor(caso.AEDE_apical_IA)} border text-xs`}>\n                    {caso.AEDE_apical_IA || 'Sin diagnóstico'}\n                  </Badge>\n                </div>\n                {caso.tto_propuesto && (\n                  <div>\n                    <p className=\"text-xs text-muted-foreground mb-1\">Tratamiento propuesto:</p>\n                    <p className=\"text-sm\">{caso.tto_propuesto}</p>\n                  </div>\n                )}\n              </div>\n\n            <Button \n              size=\"sm\" \n              variant=\"outline\"\n              onClick={() => onVerDetalle(caso)}\n              className=\"w-full gap-2\"\n            >\n              <Eye className=\"w-4 h-4\" />\n              Ver detalles completos\n            </Button>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n}\n\nexport default function MisCasos() {\n  const { user } = useAuth();\n  const [casos, setCasos] = useState<CasoData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  const [selectedCase, setSelectedCase] = useState<CasoData | null>(null);\n  const [followUpFilter, setFollowUpFilter] = useState<'1m' | '3m' | '6m' | null>(null);\n  const [toothFilter, setToothFilter] = useState<string | null>(null);\n  const [selectedFDI, setSelectedFDI] = useState<string | null>(null);\n  const [pendientesFilter, setPendientesFilter] = useState<string | null>(null);\n\n  async function cargarCasos() {\n    if (!user) return;\n    \n    setRefreshing(true);\n    const data = await obtenerMisCasos();\n    const casosOrdenados = ordenarCasosPorProximidad(data);\n    setCasos(casosOrdenados);\n    setLoading(false);\n    setRefreshing(false);\n  }\n\n  useEffect(() => {\n    cargarCasos();\n  }, [user]);\n\n  const casosParaMostrar = casos.filter(caso => {\n    // Filtro por diente específico\n    if (toothFilter && String(caso.tooth_fdi) !== toothFilter) return false;\n    \n    // Filtro antiguo de follow-up (mantener compatibilidad)\n    if (followUpFilter) {\n      if (followUpFilter === '1m' && toNumber(caso.control_1m_exito) !== 0) return false;\n      if (followUpFilter === '3m' && toNumber(caso.control_3m_exito) !== 0) return false;\n      if (followUpFilter === '6m' && toNumber(caso.control_6m_exito) !== 0) return false;\n    }\n    \n    // Nuevo filtro de pendientes (tarjetas clicables)\n    if (pendientesFilter) {\n      if (pendientesFilter === 'sin-tratamiento') {\n        // Mostrar solo casos SIN tratamiento\n        return !caso.fecha_tto || caso.fecha_tto.trim() === '';\n      }\n      \n      if (pendientesFilter === '1m') {\n        // Mostrar solo casos CON tratamiento Y control 1m pendiente\n        return caso.fecha_tto && caso.fecha_tto.trim() !== '' && toNumber(caso.control_1m_exito) === 0;\n      }\n      \n      if (pendientesFilter === '3m') {\n        // Mostrar solo casos CON tratamiento Y control 3m pendiente\n        return caso.fecha_tto && caso.fecha_tto.trim() !== '' && toNumber(caso.control_3m_exito) === 0;\n      }\n      \n      if (pendientesFilter === '6m') {\n        // Mostrar solo casos CON tratamiento Y control 6m pendiente\n        return caso.fecha_tto && caso.fecha_tto.trim() !== '' && toNumber(caso.control_6m_exito) === 0;\n      }\n    }\n    \n    return true;\n  });\n\n  const handleFollowUpFilter = (tipo: '1m' | '3m' | '6m' | null) => {\n    setFollowUpFilter(tipo);\n    setToothFilter(null);\n    setPendientesFilter(null);\n  };\n\n  const handleToothFilter = (fdi: string | null) => {\n    setToothFilter(fdi);\n    setFollowUpFilter(null);\n    setPendientesFilter(null);\n  };\n\n  const handlePendientesFilter = (filterType: string | null) => {\n    setPendientesFilter(filterType);\n    setFollowUpFilter(null);\n    setToothFilter(null);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center justify-center min-h-[400px]\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 md:p-8 space-y-10 animate-in fade-in-0 duration-700\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-semibold tracking-tight\">Panel del Clínico</h1>\n          <p className=\"text-zinc-400 mt-2 text-sm md:text-base\">\n            Dashboard de casos para {user?.email}\n          </p>\n        </div>\n        <Button \n          onClick={cargarCasos} \n          disabled={refreshing}\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"gap-2 bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl border-zinc-200 dark:border-zinc-700 hover:bg-white dark:hover:bg-zinc-800 transition-all\"\n        >\n          <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />\n          Actualizar\n        </Button>\n      </div>\n\n      <EnhancedStats casos={casos as ClinicoCase[]} />\n\n      <SeguimientosPendientes \n        casos={casos as ClinicoCase[]}\n        activeFilter={pendientesFilter}\n        onFilterClick={handlePendientesFilter}\n      />\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <CasosComplejos casos={casos as ClinicoCase[]} />\n        <CalidadRegistros casos={casos as ClinicoCase[]} />\n      </div>\n\n      {(followUpFilter || toothFilter || pendientesFilter) && (\n        <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-4 border-l-4\" style={{ borderLeftColor: '#3A7AFE' }}>\n          <div className=\"flex items-center justify-between\">\n            <p className=\"text-sm font-medium\" style={{ color: '#3A7AFE' }}>\n              {followUpFilter && `Mostrando solo casos pendientes de control ${followUpFilter}`}\n              {toothFilter && `Mostrando solo casos del diente FDI ${toothFilter}`}\n              {pendientesFilter === 'sin-tratamiento' && 'Mostrando solo casos sin tratamiento registrado'}\n              {pendientesFilter === '1m' && 'Mostrando solo casos con control de 1 mes pendiente'}\n              {pendientesFilter === '3m' && 'Mostrando solo casos con control de 3 meses pendiente'}\n              {pendientesFilter === '6m' && 'Mostrando solo casos con control de 6 meses pendiente'}\n              {' '} ({casosParaMostrar.length} {casosParaMostrar.length === 1 ? 'caso' : 'casos'})\n            </p>\n            <Button \n              size=\"sm\" \n              variant=\"ghost\" \n              onClick={() => {\n                setFollowUpFilter(null);\n                setToothFilter(null);\n                setPendientesFilter(null);\n              }}\n              className=\"hover:bg-zinc-100 dark:hover:bg-zinc-800\"\n            >\n              Limpiar filtro\n            </Button>\n          </div>\n        </div>\n      )}\n      \n      <ClinicoTabla casos={casosParaMostrar} onVerDetalle={setSelectedCase} />\n\n      <HistorialDientes \n        casos={casos as ClinicoCase[]} \n        onVerDetalle={setSelectedCase}\n      />\n\n      <PersonalStats casos={casos as ClinicoCase[]} />\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <FailedTeethRanking casos={casos as ClinicoCase[]} />\n        <div></div>\n      </div>\n\n      <FDIHeatmap \n        casos={casos as ClinicoCase[]} \n        onSelectFDI={setSelectedFDI}\n      />\n      \n      <CaseModal \n        caso={selectedCase} \n        onClose={() => setSelectedCase(null)} \n        onActualizar={cargarCasos}\n      />\n      \n      <CasosPorDienteModal\n        fdi={selectedFDI}\n        casos={casos as ClinicoCase[]}\n        onClose={() => setSelectedFDI(null)}\n        onVerDetalle={setSelectedCase}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":52712,"size_tokens":null},"ENDOIA/client/src/pages/ClinicoPage.tsx":{"content":"import ClinicoView from '@/components/ClinicoView';\nimport Navbar from '@/components/Navbar';\n\nexport default function ClinicoPage() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navbar />\n      <main className=\"container mx-auto px-4 py-6\">\n        <ClinicoView />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":321,"size_tokens":null},"ENDOIA/client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"ENDOIA/client/src/pages/Home.tsx":{"content":"import { useState } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Activity, Users } from \"lucide-react\";\nimport ClinicoView from \"@/components/ClinicoView\";\nimport TutorView from \"@/components/TutorView\";\n\nexport default function Home() {\n  const [activeView, setActiveView] = useState<\"clinico\" | \"tutor\">(\"clinico\");\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"border-b sticky top-0 bg-background z-50\">\n        <div className=\"max-w-5xl mx-auto px-4 sm:px-6 py-4\">\n          <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n            <div className=\"flex items-center gap-3\">\n              <img src=\"/endoia-logo.svg\" alt=\"ENDOIA\" className=\"w-10 h-10\" />\n              <div>\n                <h1 className=\"text-lg sm:text-xl font-semibold\" data-testid=\"text-app-title\">\n                  ENDOIA\n                </h1>\n                <p className=\"text-xs text-muted-foreground hidden sm:block\">\n                  AAE–ESE 2025 Classification\n                </p>\n              </div>\n            </div>\n            \n            <Tabs value={activeView} onValueChange={(v) => setActiveView(v as \"clinico\" | \"tutor\")} className=\"w-auto\">\n              <TabsList data-testid=\"tabs-view-switcher\">\n                <TabsTrigger value=\"clinico\" data-testid=\"tab-clinico\" className=\"gap-2\">\n                  <Activity className=\"w-4 h-4\" />\n                  <span className=\"hidden sm:inline\">Clínico</span>\n                </TabsTrigger>\n                <TabsTrigger value=\"tutor\" data-testid=\"tab-tutor\" className=\"gap-2\">\n                  <Users className=\"w-4 h-4\" />\n                  <span className=\"hidden sm:inline\">Tutor</span>\n                </TabsTrigger>\n              </TabsList>\n            </Tabs>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-5xl mx-auto px-4 sm:px-6 py-6 sm:py-8\">\n        {activeView === \"clinico\" ? <ClinicoView /> : <TutorView />}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":2057,"size_tokens":null},"ENDOIA/server/openaiClient.ts":{"content":"import OpenAI from \"openai\";\n\nexport const openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n","path":null,"size_bytes":107,"size_tokens":null},"ENDOIA/client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"ENDOIA/client/src/pages/Clinico/RegistrarCaso.tsx":{"content":"import ClinicoView from '@/components/ClinicoView';\n\nexport default function RegistrarCaso() {\n  return <ClinicoView />;\n}\n","path":null,"size_bytes":123,"size_tokens":null},"ENDOIA/tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"0.625rem\", /* 10px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4051,"size_tokens":null},"ENDOIA/client/src/components/clinico/helpers.ts":{"content":"import { ClinicoCase } from './types';\n\nexport function toNumber(value: number | string | null | undefined): number {\n  if (value === null || value === undefined || value === '') return 0;\n  if (typeof value === 'number') return value;\n  const parsed = Number(value);\n  return isNaN(parsed) ? 0 : parsed;\n}\n\nexport function getDiagnosisColor(diagnosis: string): string {\n  if (!diagnosis) return 'bg-yellow-100 text-yellow-700 border-yellow-300';\n  \n  const lower = diagnosis.toLowerCase();\n  \n  if (lower.includes('normal') || lower.includes('healthy') || lower.includes('clinically normal')) {\n    return 'bg-green-100 text-green-800 border-green-300';\n  }\n  \n  if (lower.includes('hypersens') || lower.includes('hipersens') || lower.includes('mild')) {\n    return 'bg-blue-100 text-blue-800 border-blue-300';\n  }\n  \n  if (lower.includes('symptomatic') || lower.includes('sintomática') || lower.includes('inflam')) {\n    return 'bg-orange-100 text-orange-800 border-orange-300';\n  }\n  \n  if (lower.includes('necr') || lower.includes('necrotic') || lower.includes('abscess') || \n      lower.includes('sinus') || lower.includes('lesión apical')) {\n    return 'bg-red-100 text-red-800 border-red-300';\n  }\n  \n  return 'bg-yellow-100 text-yellow-700 border-yellow-300';\n}\n\nexport function isComplexCase(caso: ClinicoCase): boolean {\n  const pai = toNumber(caso.periapical_index_PAI_1_5);\n  const radiolucency = toNumber(caso.radiolucency_yesno) === 1;\n  const probing = toNumber(caso.probing_max_depth_mm);\n  const spontaneousPain = toNumber(caso.spontaneous_pain_yesno) === 1;\n  \n  return pai >= 3 || radiolucency || probing > 4 || spontaneousPain;\n}\n\nexport function hasCompletedFollowUp(caso: ClinicoCase): boolean {\n  const control1m = toNumber(caso.control_1m_exito);\n  const control3m = toNumber(caso.control_3m_exito);\n  const control6m = toNumber(caso.control_6m_exito);\n  \n  return control1m !== 0 && control3m !== 0 && control6m !== 0;\n}\n\nexport function hasPendingFollowUp(caso: ClinicoCase): boolean {\n  if (!caso.fecha_tto || caso.fecha_tto.trim() === '') return false;\n  \n  const control1m = toNumber(caso.control_1m_exito);\n  const control3m = toNumber(caso.control_3m_exito);\n  const control6m = toNumber(caso.control_6m_exito);\n  \n  return control1m === 0 || control3m === 0 || control6m === 0;\n}\n\nexport function getCaseQualityScore(caso: ClinicoCase): {\n  hasNotes: boolean;\n  hasKeyFields: boolean;\n  hasAnyControl: boolean;\n} {\n  const hasNotes = Boolean(caso.notes && caso.notes.trim());\n  \n  const hasKeyFields = Boolean(\n    caso.tooth_fdi &&\n    caso.AEDE_pulpar_IA &&\n    caso.AEDE_apical_IA &&\n    caso.tto_propuesto\n  );\n  \n  const hasAnyControl = toNumber(caso.control_1m_exito) !== 0 ||\n                        toNumber(caso.control_3m_exito) !== 0 ||\n                        toNumber(caso.control_6m_exito) !== 0;\n  \n  return { hasNotes, hasKeyFields, hasAnyControl };\n}\n\nexport function getMonthKey(dateString: string): string {\n  if (!dateString) return '';\n  const date = new Date(dateString);\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n}\n\nexport function getMonthLabel(monthKey: string): string {\n  const [year, month] = monthKey.split('-');\n  const monthNames = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];\n  return `${monthNames[parseInt(month) - 1]} ${year}`;\n}\n","path":null,"size_bytes":3380,"size_tokens":null},"ENDOIA/client/src/lib/api.ts":{"content":"import { auth } from './firebase';\nimport { supabase, type CaseRecord } from './supabase';\n\nexport interface CasoClinico {\n  case_id: string;\n  tooth_fdi: string;\n  dolorEspontaneo: string;\n  respuestaFrio: string;\n  lingeringSeg: string;\n  percusionDolor: string;\n  radiolucidezApical: string;\n  profundidadCaries: string;\n  sangradoControlable: string;\n  sinusTractPresent?: string;\n  systemicInvolvement?: string;\n  previousTreatment?: string;\n  apicalPalpationPain?: string;\n  notas: string;\n  tratamientoRealizado: string;\n  clinicoNombre: string;\n  clinicoEmail: string;\n  pulpalDxIA?: string;\n  apicalDxIA?: string;\n  ttoPropuestoIA?: string;\n  AEDE_pulpar_class?: string;\n}\n\nasync function getCurrentUserEmail(): Promise<string> {\n  const user = auth.currentUser;\n  if (!user || !user.email) {\n    throw new Error('Usuario no autenticado');\n  }\n  return user.email;\n}\n\nfunction toInt(val: any): number | undefined {\n  if (val === undefined || val === null || val === '') return undefined;\n  const parsed = parseInt(String(val), 10);\n  return isNaN(parsed) ? undefined : parsed;\n}\n\nexport async function enviarCasoNuevo(datosCaso: any) {\n  try {\n    const email = await getCurrentUserEmail();\n    \n    const caseRecord: Partial<CaseRecord> = {\n      case_id: datosCaso.case_id,\n      date: datosCaso.date || datosCaso.fecha || new Date().toISOString().split('T')[0],\n      clinicoEmail: datosCaso.clinicoEmail || email,\n      tooth_fdi: toInt(datosCaso.tooth_fdi) || 0,\n      spontaneous_pain_yesno: toInt(datosCaso.spontaneous_pain_yesno),\n      thermal_cold_response: toInt(datosCaso.thermal_cold_response),\n      lingering_pain_seconds: datosCaso.lingering_pain_seconds || '',\n      periapical_index_PAI_1_5: toInt(datosCaso.periapical_index_PAI_1_5),\n      radiolucency_yesno: datosCaso.radiolucency_yesno || '',\n      pdl_widening: toInt(datosCaso.pdl_widening),\n      depth_of_caries: datosCaso.depth_of_caries || '',\n      percussion_pain_yesno: datosCaso.percussion_pain_yesno || '',\n      tipo_dolor: datosCaso.tipo_dolor || null,\n      sondaje_max_mm: datosCaso.sondaje_max_mm ? Number(datosCaso.sondaje_max_mm) : null,\n      sangrado_controlable: datosCaso.sangrado_controlable || null,\n      camara_abierta: datosCaso.camara_abierta || null,\n      pulpa_expuesta: datosCaso.pulpa_expuesta || null,\n      sinus_tract_present: datosCaso.sinus_tract_present || '',\n      systemic_involvement: datosCaso.systemic_involvement || '',\n      previous_treatment: datosCaso.previous_treatment || '',\n      apical_palpation_pain: datosCaso.apical_palpation_pain || '',\n      notes: datosCaso.notes || datosCaso.notas || '',\n      AEDE_pulpar_IA: datosCaso.AEDE_pulpar_IA || datosCaso.pulpalDxIA || '',\n      AEDE_apical_IA: datosCaso.AEDE_apical_IA || datosCaso.apicalDxIA || '',\n      tto_propuesto: datosCaso.tto_propuesto || datosCaso.ttoPropuestoIA || '',\n      tto_realizado: datosCaso.tto_realizado || '',\n      fecha_tto: datosCaso.fecha_tto || '',\n      control_1m_exito: toInt(datosCaso.control_1m_exito) || 0,\n      control_3m_exito: toInt(datosCaso.control_3m_exito) || 0,\n      control_6m_exito: toInt(datosCaso.control_6m_exito) || 0,\n      fecha_control_1m: datosCaso.fecha_control_1m || '',\n      fecha_control_3m: datosCaso.fecha_control_3m || '',\n      fecha_control_6m: datosCaso.fecha_control_6m || '',\n    };\n\n    console.log(\"📤 Insertando caso en Supabase:\", caseRecord.case_id);\n    \n    const { data, error } = await supabase\n      .from('cases')\n      .insert([caseRecord])\n      .select();\n\n    if (error) {\n      console.error(\"❌ Error de Supabase:\", error);\n      return { \n        ok: false, \n        error: error.message || 'Error al guardar el caso'\n      };\n    }\n    \n    console.log(\"✅ Caso guardado exitosamente en Supabase\");\n    return { ok: true, data };\n    \n  } catch (err) {\n    console.error(\"Error enviando caso:\", err);\n    return { \n      ok: false, \n      error: \"No se pudo conectar con la base de datos. Verifica tu conexión.\" \n    };\n  }\n}\n\nexport async function obtenerPendientes(): Promise<any[]> {\n  try {\n    const { data, error } = await supabase\n      .from('cases')\n      .select('*')\n      .or('validado_JEN.is.null,validado_SEG.is.null,AEDE_pulpar_FINAL.is.null')\n      .order('date', { ascending: false });\n\n    if (error) {\n      console.error(\"Error obteniendo pendientes:\", error);\n      return [];\n    }\n    \n    console.log(\"✅ Casos pendientes obtenidos:\", data?.length || 0);\n    return data || [];\n  } catch (err) {\n    console.error(\"Error cargando pendientes:\", err);\n    return [];\n  }\n}\n\nexport async function obtenerMisCasos(): Promise<any[]> {\n  try {\n    const email = await getCurrentUserEmail();\n    \n    console.log(\"📋 Obteniendo casos del clínico:\", email);\n    \n    const { data, error } = await supabase\n      .from('cases')\n      .select('*')\n      .eq('clinicoEmail', email)\n      .order('date', { ascending: false });\n\n    if (error) {\n      console.error(\"Error obteniendo mis casos:\", error);\n      return [];\n    }\n    \n    console.log(\"✅ Casos obtenidos de Supabase:\", data?.length || 0);\n    return data || [];\n  } catch (err) {\n    console.error(\"Error cargando mis casos:\", err);\n    return [];\n  }\n}\n\nexport interface Clasificaciones {\n  pulpar: string;\n  apical: string;\n}\n\nexport async function enviarLabelTutor(\n  case_id: string, \n  clasificaciones: Clasificaciones,\n  tutorType: 'JEN' | 'SEG' | 'INV' = 'JEN'\n) {\n  try {\n    const email = await getCurrentUserEmail();\n    const timestamp = new Date().toISOString();\n    \n    let updateData: any = {};\n    \n    if (tutorType === 'JEN') {\n      updateData = {\n        AEDE_pulpar_JEN: clasificaciones.pulpar,\n        AEDE_apical_JEN: clasificaciones.apical,\n        validado_JEN: timestamp\n      };\n    } else if (tutorType === 'SEG') {\n      updateData = {\n        AEDE_pulpar_SEG: clasificaciones.pulpar,\n        AEDE_apical_SEG: clasificaciones.apical,\n        validado_SEG: timestamp\n      };\n    } else if (tutorType === 'INV') {\n      updateData = {\n        AEDE_pulpar_INV: clasificaciones.pulpar,\n        AEDE_apical_INV: clasificaciones.apical,\n        validado_INV: timestamp\n      };\n    }\n\n    console.log(\"🏷️ Etiquetando caso:\", case_id, \"por tutor:\", email, \"→\", tutorType);\n    \n    const { data, error } = await supabase\n      .from('cases')\n      .update(updateData)\n      .eq('case_id', case_id)\n      .select();\n\n    if (error) {\n      console.error(\"Error etiquetando caso:\", error);\n      throw new Error(error.message || 'No se pudo etiquetar el caso');\n    }\n    \n    console.log(\"✅ Caso etiquetado exitosamente\");\n    return { success: true, data };\n  } catch (err) {\n    console.error(\"Error etiquetando caso:\", err);\n    throw err;\n  }\n}\n\nexport async function obtenerDatosInvestigacion(): Promise<any[]> {\n  try {\n    console.log(\"🔬 Obteniendo todos los casos para investigación\");\n    \n    const { data, error } = await supabase\n      .from('cases')\n      .select('*')\n      .order('date', { ascending: false });\n\n    if (error) {\n      console.error(\"Error obteniendo datos de investigación:\", error);\n      return [];\n    }\n    \n    console.log(\"✅ Datos de investigación obtenidos:\", data?.length || 0, \"casos\");\n    return data || [];\n  } catch (err) {\n    console.error(\"Error cargando datos de investigación:\", err);\n    return [];\n  }\n}\n\nexport interface ActualizarControlPayload {\n  case_id: string;\n  tipo_control: '1m' | '3m' | '6m';\n  exito_clinico: boolean;\n  exito_radiologico: 'si' | 'parcial' | 'no';\n  notas: string;\n}\n\nexport async function actualizarControl(payload: ActualizarControlPayload): Promise<any> {\n  try {\n    const { case_id, tipo_control, exito_clinico, exito_radiologico, notas } = payload;\n    const fecha_control = new Date().toISOString().split('T')[0];\n    \n    let exitoValue: number;\n    if (exito_clinico && exito_radiologico === 'si') {\n      exitoValue = 1;\n    } else if (exito_clinico && exito_radiologico === 'parcial') {\n      exitoValue = 3;\n    } else {\n      exitoValue = 2;\n    }\n    \n    let updateData: any = {};\n    \n    if (tipo_control === '1m') {\n      updateData = {\n        control_1m_exito: exitoValue,\n        fecha_control_1m: fecha_control,\n        exito_clinico_final: exito_clinico ? 'si' : 'no',\n        exito_radiologico_final: exito_radiologico\n      };\n    } else if (tipo_control === '3m') {\n      updateData = {\n        control_3m_exito: exitoValue,\n        fecha_control_3m: fecha_control,\n        exito_clinico_final: exito_clinico ? 'si' : 'no',\n        exito_radiologico_final: exito_radiologico\n      };\n    } else if (tipo_control === '6m') {\n      updateData = {\n        control_6m_exito: exitoValue,\n        fecha_control_6m: fecha_control,\n        exito_clinico_final: exito_clinico ? 'si' : 'no',\n        exito_radiologico_final: exito_radiologico\n      };\n    }\n\n    console.log(\"📝 Actualizando control:\", tipo_control, \"para caso:\", case_id);\n    \n    const { data, error } = await supabase\n      .from('cases')\n      .update(updateData)\n      .eq('case_id', case_id)\n      .select();\n\n    if (error) {\n      console.error(\"Error actualizando control:\", error);\n      throw new Error(error.message || 'No se pudo actualizar el control');\n    }\n    \n    console.log(\"✅ Control actualizado exitosamente\");\n    return { success: true, data };\n  } catch (err) {\n    console.error('Error actualizando control:', err);\n    throw err;\n  }\n}\n\nexport interface ActualizarTratamientoPayload {\n  case_id: string;\n  tto_realizado?: string;\n  fecha_tto?: string;\n}\n\nexport async function actualizarTratamiento(payload: ActualizarTratamientoPayload): Promise<any> {\n  try {\n    const { case_id, tto_realizado, fecha_tto } = payload;\n\n    console.log(\"💊 Actualizando tratamiento para caso:\", case_id);\n    \n    const updateData: any = {};\n    if (tto_realizado !== undefined) {\n      updateData.tto_realizado = tto_realizado;\n    }\n    if (fecha_tto !== undefined) {\n      updateData.fecha_tto = fecha_tto;\n    }\n\n    const { data, error } = await supabase\n      .from('cases')\n      .update(updateData)\n      .eq('case_id', case_id)\n      .select();\n\n    if (error) {\n      console.error(\"Error actualizando tratamiento:\", error);\n      throw new Error(error.message || 'No se pudo actualizar el tratamiento');\n    }\n    \n    console.log(\"✅ Tratamiento actualizado exitosamente\");\n    return { success: true, data };\n  } catch (err) {\n    console.error('Error actualizando tratamiento:', err);\n    throw err;\n  }\n}\n\nexport async function actualizarDiagnosticoFinal(case_id: string, pulpar: string, apical: string): Promise<any> {\n  try {\n    console.log(\"🎯 Actualizando diagnóstico FINAL para caso:\", case_id);\n    \n    const { data, error } = await supabase\n      .from('cases')\n      .update({\n        AEDE_pulpar_FINAL: pulpar,\n        AEDE_apical_FINAL: apical\n      })\n      .eq('case_id', case_id)\n      .select();\n\n    if (error) {\n      console.error(\"Error actualizando diagnóstico final:\", error);\n      throw new Error(error.message || 'No se pudo actualizar el diagnóstico final');\n    }\n    \n    console.log(\"✅ Diagnóstico FINAL actualizado exitosamente\");\n    return { success: true, data };\n  } catch (err) {\n    console.error('Error actualizando diagnóstico final:', err);\n    throw err;\n  }\n}\n","path":null,"size_bytes":11308,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/ItemLista.tsx":{"content":"import { BibliotecaItem, ListaContent } from '@/data/bibliotecaClinica';\nimport { Clock, AlertTriangle } from 'lucide-react';\n\ninterface ItemListaProps {\n  item: BibliotecaItem;\n}\n\nexport function ItemLista({ item }: ItemListaProps) {\n  const content = item.content as ListaContent;\n  \n  return (\n    <div className=\"space-y-4\">\n      <ol className=\"space-y-3\">\n        {content.steps?.map((step: string, idx: number) => (\n          <li key={idx} className=\"flex items-start gap-3\">\n            <span\n              className=\"flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white\"\n              style={{ backgroundColor: '#3A7AFE' }}\n            >\n              {idx + 1}\n            </span>\n            <span className=\"text-sm text-zinc-600 dark:text-zinc-300 pt-0.5\">\n              {step}\n            </span>\n          </li>\n        ))}\n      </ol>\n      \n      {content.timeWindow && (\n        <div className=\"flex items-start gap-2 p-3 rounded-lg\" style={{ backgroundColor: 'rgba(245, 166, 35, 0.1)' }}>\n          <Clock className=\"w-4 h-4 flex-shrink-0 mt-0.5\" style={{ color: '#F5A623' }} />\n          <p className=\"text-sm font-medium\" style={{ color: '#F5A623' }}>\n            {content.timeWindow}\n          </p>\n        </div>\n      )}\n      \n      {content.alerts && (\n        <div className=\"space-y-2\">\n          {content.alerts.map((alert: string, idx: number) => (\n            <div key={idx} className=\"flex items-start gap-2 p-3 rounded-lg\" style={{ backgroundColor: 'rgba(245, 166, 35, 0.1)' }}>\n              <AlertTriangle className=\"w-4 h-4 flex-shrink-0 mt-0.5\" style={{ color: '#F5A623' }} />\n              <p className=\"text-sm\" style={{ color: '#F5A623' }}>\n                {alert}\n              </p>\n            </div>\n          ))}\n        </div>\n      )}\n      \n      {content.notes && (\n        <div className=\"pt-3 border-t border-zinc-200 dark:border-zinc-700\">\n          <p className=\"text-sm text-zinc-500 dark:text-zinc-400 italic\">\n            {content.notes}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":2094,"size_tokens":null},"ENDOIA/client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"ENDOIA/client/src/components/clinico/PersonalStats.tsx":{"content":"import { ClinicoCase, MonthlyStats, TreatmentStats, DiagnosisDistribution } from './types';\nimport { toNumber, getMonthKey, getMonthLabel } from './helpers';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend } from 'recharts';\nimport { TrendingUp, Target, PieChartIcon } from 'lucide-react';\n\ninterface PersonalStatsProps {\n  casos: ClinicoCase[];\n}\n\nconst PULPAR_DIAGNOSES_AAE_ESE_2025: Record<string, { label: string; color: string }> = {\n  'Clinically normal pulp': { label: 'Clinically normal pulp', color: '#2ECC71' },\n  'Pulpa normal': { label: 'Clinically normal pulp', color: '#2ECC71' },\n  'Hypersensitive pulp': { label: 'Hypersensitive pulp', color: '#3498DB' },\n  'Hipersensibilidad pulpar': { label: 'Hypersensitive pulp', color: '#3498DB' },\n  'Mild pulpitis': { label: 'Mild pulpitis', color: '#F5A623' },\n  'Pulpitis leve': { label: 'Mild pulpitis', color: '#F5A623' },\n  'Severe pulpitis': { label: 'Severe pulpitis', color: '#E74C3C' },\n  'Pulpitis severa': { label: 'Severe pulpitis', color: '#E74C3C' },\n  'Pulp necrosis': { label: 'Pulp necrosis', color: '#8E44AD' },\n  'Pulpa necrótica': { label: 'Pulp necrosis', color: '#8E44AD' },\n  'Necrosis pulpar': { label: 'Pulp necrosis', color: '#8E44AD' },\n};\n\nconst LEGEND_ORDER = [\n  { diagnosis: 'Clinically normal pulp', color: '#2ECC71' },\n  { diagnosis: 'Hypersensitive pulp', color: '#3498DB' },\n  { diagnosis: 'Mild pulpitis', color: '#F5A623' },\n  { diagnosis: 'Severe pulpitis', color: '#E74C3C' },\n  { diagnosis: 'Pulp necrosis', color: '#8E44AD' },\n];\n\nexport function PersonalStats({ casos }: PersonalStatsProps) {\n  const last12Months = getLast12MonthsData(casos);\n  const treatmentStats = getTreatmentSuccessStats(casos);\n  const diagnosisDistribution = getDiagnosisDistribution(casos);\n\n  return (\n    <div className=\"space-y-10\">\n      <h2 className=\"text-2xl font-semibold tracking-tight\">Estadísticas personales</h2>\n      \n      <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-300 hover:shadow-xl\">\n        <div className=\"flex items-center gap-2 mb-6\">\n          <TrendingUp className=\"w-5 h-5\" style={{ color: '#3A7AFE' }} />\n          <h3 className=\"text-lg font-semibold tracking-tight\">Casos por mes (últimos 12 meses)</h3>\n        </div>\n        {last12Months.length > 0 ? (\n          <ResponsiveContainer width=\"100%\" height={320}>\n            <LineChart data={last12Months}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#E5E7EB\" opacity={0.3} />\n              <XAxis \n                dataKey=\"month\" \n                tick={{ fontSize: 11, fill: '#A6A6A6' }}\n                axisLine={{ stroke: '#E5E7EB' }}\n              />\n              <YAxis \n                tick={{ fontSize: 11, fill: '#A6A6A6' }}\n                axisLine={{ stroke: '#E5E7EB' }}\n              />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'rgba(255, 255, 255, 0.95)', \n                  border: 'none',\n                  borderRadius: '8px',\n                  boxShadow: '0 4px 12px rgba(0,0,0,0.1)'\n                }}\n              />\n              <Line \n                type=\"monotone\" \n                dataKey=\"count\" \n                stroke=\"#3A7AFE\" \n                strokeWidth={3}\n                dot={{ fill: '#3A7AFE', r: 4 }}\n                activeDot={{ r: 6 }}\n                animationDuration={800}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        ) : (\n          <p className=\"text-sm text-zinc-400 text-center py-12\">\n            No hay datos suficientes para mostrar\n          </p>\n        )}\n      </div>\n\n      <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-300 hover:shadow-xl\">\n        <div className=\"flex items-center gap-2 mb-6\">\n          <Target className=\"w-5 h-5\" style={{ color: '#2ECC71' }} />\n          <h3 className=\"text-lg font-semibold tracking-tight\">Éxito por tipo de tratamiento</h3>\n        </div>\n        {treatmentStats.length > 0 ? (\n          <div className=\"space-y-6\">\n            {treatmentStats.map((stat, idx) => (\n              <div key={stat.treatment} className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium truncate pr-2\">{stat.treatment}</span>\n                  <span className=\"text-sm font-semibold whitespace-nowrap\" style={{ color: '#2ECC71' }}>\n                    {stat.successRate}% ({stat.successfulCases}/{stat.casesWithControls})\n                  </span>\n                </div>\n                <div className=\"w-full bg-zinc-200 dark:bg-zinc-800 rounded-full h-2.5 overflow-hidden\">\n                  <div \n                    className=\"h-2.5 rounded-full transition-all duration-700 ease-out\" \n                    style={{ \n                      width: `${stat.successRate}%`,\n                      backgroundColor: '#2ECC71'\n                    }}\n                  />\n                </div>\n                <p className=\"text-xs text-zinc-400\">\n                  {stat.totalCases} {stat.totalCases === 1 ? 'caso total' : 'casos totales'}\n                </p>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-sm text-zinc-400 text-center py-12\">\n            No hay datos de tratamientos con controles\n          </p>\n        )}\n      </div>\n\n      <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-300 hover:shadow-xl\">\n        <div className=\"flex items-center gap-2 mb-6\">\n          <PieChartIcon className=\"w-5 h-5\" style={{ color: '#B983FF' }} />\n          <h3 className=\"text-lg font-semibold tracking-tight\">Distribución por diagnóstico pulpar (AAE/ESE 2025)</h3>\n        </div>\n        {diagnosisDistribution.length > 0 ? (\n          <div className=\"flex flex-col lg:flex-row items-center gap-6\">\n            <ResponsiveContainer width=\"100%\" height={320} className=\"lg:flex-1\">\n              <PieChart>\n                <Pie\n                  data={diagnosisDistribution}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={{\n                    stroke: '#A6A6A6',\n                    strokeWidth: 1\n                  }}\n                  label={({ percent }) => `${(percent * 100).toFixed(0)}%`}\n                  outerRadius={110}\n                  innerRadius={55}\n                  fill=\"#8884d8\"\n                  dataKey=\"count\"\n                  nameKey=\"diagnosis\"\n                  animationDuration={800}\n                  strokeWidth={2}\n                  stroke=\"#fff\"\n                >\n                  {diagnosisDistribution.map((entry) => (\n                    <Cell \n                      key={`cell-${entry.diagnosis}`} \n                      fill={PULPAR_DIAGNOSES_AAE_ESE_2025[entry.diagnosis]?.color || '#A6A6A6'} \n                    />\n                  ))}\n                </Pie>\n                <Tooltip \n                  formatter={(value: number, name: string) => [`${value} casos`, name]}\n                  contentStyle={{ \n                    backgroundColor: 'rgba(255, 255, 255, 0.95)', \n                    border: 'none',\n                    borderRadius: '8px',\n                    boxShadow: '0 4px 12px rgba(0,0,0,0.1)',\n                    fontSize: '12px'\n                  }}\n                />\n              </PieChart>\n            </ResponsiveContainer>\n            \n            <div className=\"flex flex-col gap-3 lg:w-56\">\n              <p className=\"text-xs font-medium text-zinc-500 uppercase tracking-wide mb-1\">Leyenda AAE/ESE 2025</p>\n              {LEGEND_ORDER.map((item) => {\n                const count = diagnosisDistribution.find(d => d.diagnosis === item.diagnosis)?.count || 0;\n                return (\n                  <div key={item.diagnosis} className=\"flex items-center gap-3\">\n                    <div \n                      className=\"w-3 h-3 rounded-full flex-shrink-0\" \n                      style={{ backgroundColor: item.color }}\n                    />\n                    <span className=\"text-sm text-zinc-700 dark:text-zinc-300 flex-1\">\n                      {item.diagnosis}\n                    </span>\n                    <span className=\"text-sm font-medium text-zinc-500\">\n                      {count > 0 ? count : '-'}\n                    </span>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        ) : (\n          <p className=\"text-sm text-zinc-400 text-center py-12\">\n            No hay diagnósticos pulpares registrados\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction getLast12MonthsData(casos: ClinicoCase[]): MonthlyStats[] {\n  const monthCounts = new Map<string, number>();\n  const now = new Date();\n  \n  const last12Months: string[] = [];\n  for (let i = 11; i >= 0; i--) {\n    const date = new Date(now.getFullYear(), now.getMonth() - i, 1);\n    const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n    last12Months.push(key);\n    monthCounts.set(key, 0);\n  }\n  \n  casos.forEach(caso => {\n    const dateStr = caso.registro_fecha || caso.date;\n    if (dateStr) {\n      const monthKey = getMonthKey(dateStr);\n      if (monthCounts.has(monthKey)) {\n        monthCounts.set(monthKey, (monthCounts.get(monthKey) || 0) + 1);\n      }\n    }\n  });\n  \n  return last12Months.map(monthKey => ({\n    month: getMonthLabel(monthKey),\n    count: monthCounts.get(monthKey) || 0\n  }));\n}\n\nfunction getTreatmentSuccessStats(casos: ClinicoCase[]): TreatmentStats[] {\n  const treatmentMap = new Map<string, { total: number; withControls: number; successful: number }>();\n  \n  casos.forEach(caso => {\n    const treatment = caso.tto_realizado || caso.tto_propuesto;\n    if (!treatment || treatment.trim() === '') return;\n    \n    if (!treatmentMap.has(treatment)) {\n      treatmentMap.set(treatment, { total: 0, withControls: 0, successful: 0 });\n    }\n    \n    const stats = treatmentMap.get(treatment)!;\n    stats.total++;\n    \n    const controls = [\n      toNumber(caso.control_1m_exito),\n      toNumber(caso.control_3m_exito),\n      toNumber(caso.control_6m_exito)\n    ].filter(c => c !== 0);\n    \n    if (controls.length > 0) {\n      stats.withControls++;\n      if (controls.every(c => c === 1)) {\n        stats.successful++;\n      }\n    }\n  });\n  \n  return Array.from(treatmentMap.entries())\n    .map(([treatment, stats]) => ({\n      treatment,\n      totalCases: stats.total,\n      casesWithControls: stats.withControls,\n      successfulCases: stats.successful,\n      successRate: stats.withControls > 0 ? Math.round((stats.successful / stats.withControls) * 100) : 0\n    }))\n    .filter(stat => stat.casesWithControls > 0)\n    .sort((a, b) => b.totalCases - a.totalCases);\n}\n\nfunction getDiagnosisDistribution(casos: ClinicoCase[]): DiagnosisDistribution[] {\n  const diagnosisCount = new Map<string, number>();\n  \n  casos.forEach(caso => {\n    if (caso.AEDE_pulpar_IA && caso.AEDE_pulpar_IA.trim() !== '') {\n      const rawDiagnosis = caso.AEDE_pulpar_IA.trim();\n      const normalized = PULPAR_DIAGNOSES_AAE_ESE_2025[rawDiagnosis]?.label || rawDiagnosis;\n      diagnosisCount.set(normalized, (diagnosisCount.get(normalized) || 0) + 1);\n    }\n  });\n  \n  const orderedDiagnoses = LEGEND_ORDER.map(item => item.diagnosis);\n  \n  return Array.from(diagnosisCount.entries())\n    .map(([diagnosis, count]) => ({ diagnosis, count }))\n    .sort((a, b) => {\n      const indexA = orderedDiagnoses.indexOf(a.diagnosis);\n      const indexB = orderedDiagnoses.indexOf(b.diagnosis);\n      if (indexA === -1 && indexB === -1) return b.count - a.count;\n      if (indexA === -1) return 1;\n      if (indexB === -1) return -1;\n      return indexA - indexB;\n    });\n}\n","path":null,"size_bytes":11946,"size_tokens":null},"ENDOIA/client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"ENDOIA/client/src/components/clinico/types.ts":{"content":"export interface ClinicoCase {\n  row_number: number;\n  case_id: string;\n  date: string;\n  clinicoEmail: string;\n  tooth_fdi: number | string;\n  spontaneous_pain_yesno: number | string;\n  thermal_cold_response: number | string;\n  lingering_pain_seconds: number | string;\n  periapical_index_PAI_1_5: number | string;\n  radiolucency_yesno: number | string;\n  pdl_widening: number | string;\n  probing_max_depth_mm: number | string;\n  depth_of_caries: string;\n  percussion_pain_yesno: string;\n  bleeding_control_possible: string;\n  sinus_tract_present: string;\n  systemic_involvement: string;\n  previous_treatment: string;\n  apical_palpation_pain: string;\n  notes: string;\n  AEDE_pulpar_IA: string;\n  AEDE_apical_IA: string;\n  tto_propuesto: string;\n  tto_realizado: string;\n  fecha_tto: string;\n  control_1m_exito: number | string;\n  fecha_control_1m: string;\n  control_3m_exito: number | string;\n  fecha_control_3m: string;\n  control_6m_exito: number | string;\n  fecha_control_6m: string;\n  AEDE_pulpar_JEN: string;\n  AEDE_apical_JEN: string;\n  validado_JEN: string;\n  AEDE_pulpar_SEG: string;\n  AEDE_apical_SEG: string;\n  validado_SEG: string;\n  AEDE_pulpar_INV: string;\n  AEDE_apical_INV: string;\n  validado_INV: string;\n  AEDE_pulpar_FINAL: string;\n  AEDE_apical_FINAL: string;\n  validado_FINAL: string;\n  registro_fecha: string;\n  registro_ip: string;\n  token_recibido?: string;\n  case_id_recibido?: string;\n  discrepancia?: boolean | string;\n  token?: string;\n  token_normalizado?: string;\n  token_valido?: boolean | string;\n}\n\nexport interface ToothHistoryGroup {\n  fdi: string;\n  cases: ClinicoCase[];\n  count: number;\n}\n\nexport interface MonthlyStats {\n  month: string;\n  count: number;\n}\n\nexport interface TreatmentStats {\n  treatment: string;\n  totalCases: number;\n  casesWithControls: number;\n  successfulCases: number;\n  successRate: number;\n}\n\nexport interface DiagnosisDistribution {\n  diagnosis: string;\n  count: number;\n}\n\nexport interface ToothFailureStats {\n  fdi: string;\n  failures: number;\n}\n","path":null,"size_bytes":2010,"size_tokens":null},"ENDOIA/client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"ENDOIA/client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/ItemRecurso.tsx":{"content":"import { BibliotecaItem } from '@/data/bibliotecaClinica';\nimport { ExternalLink } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ninterface ItemRecursoProps {\n  item: BibliotecaItem;\n}\n\nexport function ItemRecurso({ item }: ItemRecursoProps) {\n  if (!item.externalUrl) {\n    return (\n      <div className=\"text-sm text-zinc-500 dark:text-zinc-400 italic\">\n        {item.shortDescription || 'Recurso sin enlace disponible'}\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"flex items-center justify-between gap-4\">\n      <div className=\"flex-1\">\n        <p className=\"text-sm text-zinc-600 dark:text-zinc-300\">\n          {item.shortDescription}\n        </p>\n      </div>\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        asChild\n        className=\"flex-shrink-0 gap-2\"\n      >\n        <a\n          href={item.externalUrl}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          <ExternalLink className=\"w-4 h-4\" />\n          Abrir recurso\n        </a>\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":1060,"size_tokens":null},"ENDOIA/client/src/components/GoogleLoginButton.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Loader2, AlertCircle } from \"lucide-react\";\nimport { auth, googleProvider, signInWithPopup, onAuthStateChanged } from \"@/lib/firebase\";\nimport type { User } from \"firebase/auth\";\n\nexport default function GoogleLoginButton() {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  useState(() => {\n    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n      setUser(currentUser);\n    });\n    return () => unsubscribe();\n  });\n\n  async function handleGoogleLogin() {\n    setLoading(true);\n    setError(\"\");\n    \n    try {\n      const result = await signInWithPopup(auth, googleProvider);\n      setUser(result.user);\n    } catch (err: any) {\n      console.error(\"Error en login con Google:\", err);\n      setError(err.message || \"Error al iniciar sesión con Google\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleLogout() {\n    try {\n      await auth.signOut();\n      setUser(null);\n    } catch (err: any) {\n      console.error(\"Error en logout:\", err);\n      setError(err.message || \"Error al cerrar sesión\");\n    }\n  }\n\n  if (user) {\n    return (\n      <div className=\"space-y-3\">\n        <Alert>\n          <AlertDescription className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-semibold\">Sesión activa</p>\n              <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" onClick={handleLogout}>\n              Cerrar sesión\n            </Button>\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      <Button\n        onClick={handleGoogleLogin}\n        disabled={loading}\n        className=\"w-full gap-2\"\n      >\n        {loading && <Loader2 className=\"w-4 h-4 animate-spin\" />}\n        {!loading && (\n          <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n            <path\n              fill=\"currentColor\"\n              d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n            />\n            <path\n              fill=\"currentColor\"\n              d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n            />\n            <path\n              fill=\"currentColor\"\n              d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n            />\n            <path\n              fill=\"currentColor\"\n              d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n            />\n          </svg>\n        )}\n        Iniciar sesión con Google\n      </Button>\n\n      {error && (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"w-4 h-4\" />\n          <AlertDescription>{error}</AlertDescription>\n        </Alert>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":3277,"size_tokens":null},"ENDOIA/client/src/components/examples/Home.tsx":{"content":"import Home from '../../pages/Home';\n\nexport default function HomeExample() {\n  return <Home />;\n}\n","path":null,"size_bytes":99,"size_tokens":null},"ENDOIA/client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"ENDOIA/client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"ENDOIA/client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/ItemAlgoritmo.tsx":{"content":"import { BibliotecaItem, AlgoritmoContent, AlgoritmoStep } from '@/data/bibliotecaClinica';\nimport { ArrowDown } from 'lucide-react';\n\ninterface ItemAlgoritmoProps {\n  item: BibliotecaItem;\n}\n\nexport function ItemAlgoritmo({ item }: ItemAlgoritmoProps) {\n  const content = item.content as AlgoritmoContent;\n  \n  return (\n    <div className=\"space-y-3\">\n      {content.steps?.map((step: AlgoritmoStep, idx: number) => (\n        <div key={step.num}>\n          <div className=\"bg-white/40 dark:bg-zinc-800/40 backdrop-blur-sm rounded-xl p-4 shadow-sm\">\n            <div className=\"flex items-start gap-4\">\n              <div\n                className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-base font-bold text-white shadow-md\"\n                style={{ backgroundColor: '#3A7AFE' }}\n              >\n                {step.num}\n              </div>\n              <div className=\"flex-1 space-y-1\">\n                <h4 className=\"font-semibold text-zinc-800 dark:text-zinc-100\">\n                  {step.title}\n                </h4>\n                <p className=\"text-sm text-zinc-600 dark:text-zinc-300\">\n                  {step.description}\n                </p>\n              </div>\n            </div>\n          </div>\n          \n          {idx < content.steps.length - 1 && (\n            <div className=\"flex justify-center py-2\">\n              <ArrowDown className=\"w-5 h-5 text-zinc-400\" />\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1500,"size_tokens":null},"ENDOIA/client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"ENDOIA/client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"ENDOIA/client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"ENDOIA/client/src/components/TutorView.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { CheckCircle2, Loader2, AlertCircle, FileCheck } from \"lucide-react\";\nimport { obtenerPendientes, enviarLabelTutor, type CasoClinico } from \"@/lib/api\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuth } from \"@/auth/AuthContext\";\nimport { OPCIONES_PULPAR, OPCIONES_APICAL } from \"@/lib/classifications\";\n\ninterface Clasificaciones {\n  pulpar: string;\n  apical: string;\n}\n\nexport default function TutorView() {\n  const { user, role } = useAuth();\n  \n  const [pendientes, setPendientes] = useState<CasoClinico[]>([]);\n  const [seleccion, setSeleccion] = useState<Record<string, Clasificaciones>>({});\n  const [guardando, setGuardando] = useState<Record<string, boolean>>({});\n  const [cargando, setCargando] = useState(false);\n\n  useEffect(() => {\n    if (!user || (role !== 'tutor' && role !== 'investigador')) return;\n    \n    (async () => {\n      setCargando(true);\n      const data = await obtenerPendientes();\n      setPendientes(data);\n      setCargando(false);\n    })();\n  }, [user, role]);\n\n  function handleChangePulpar(case_id: string, value: string) {\n    setSeleccion(s => ({ \n      ...s, \n      [case_id]: { \n        pulpar: value, \n        apical: s[case_id]?.apical || \"\" \n      } \n    }));\n  }\n\n  function handleChangeApical(case_id: string, value: string) {\n    setSeleccion(s => ({ \n      ...s, \n      [case_id]: { \n        pulpar: s[case_id]?.pulpar || \"\", \n        apical: value \n      } \n    }));\n  }\n\n  async function guardar(case_id: string) {\n    const clasificaciones = seleccion[case_id];\n    if (!clasificaciones?.pulpar || !clasificaciones?.apical) return;\n    \n    setGuardando(g => ({ ...g, [case_id]: true }));\n    await enviarLabelTutor(case_id, clasificaciones);\n    setGuardando(g => ({ ...g, [case_id]: false }));\n    setPendientes(prev => prev.filter(c => c.case_id !== case_id));\n  }\n\n  if (role !== 'tutor' && role !== 'investigador') {\n    return (\n      <Alert variant=\"destructive\">\n        <AlertCircle className=\"w-4 h-4\" />\n        <AlertDescription>\n          Tu cuenta no tiene permisos de tutor. Contacta al administrador.\n        </AlertDescription>\n      </Alert>\n    );\n  }\n\n  // Vista principal de validación\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-start justify-between gap-4\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileCheck className=\"w-5 h-5 text-primary\" />\n                Validador Tutor\n              </CardTitle>\n              <CardDescription>\n                Asigna la clasificación pulpar y apical oficial AEDE/AAE (Gold Standard)\n              </CardDescription>\n            </div>\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              {user?.email}\n            </Badge>\n          </div>\n          <Alert className=\"mt-3\">\n            <AlertCircle className=\"w-4 h-4\" />\n            <AlertDescription className=\"text-xs\">\n              <strong>Importante:</strong> Debes asignar AMBAS clasificaciones (pulpar y apical) según criterios AEDE/AAE 2025 para completar la validación del caso.\n            </AlertDescription>\n          </Alert>\n        </CardHeader>\n        <CardContent>\n          {cargando ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : pendientes.length === 0 ? (\n            <Alert>\n              <AlertCircle className=\"w-4 h-4\" />\n              <AlertDescription>\n                No hay casos pendientes de validar para tu perfil en este momento\n              </AlertDescription>\n            </Alert>\n          ) : (\n            <div className=\"space-y-4\">\n              {pendientes.map((caso) => (\n                <Card key={caso.case_id} className=\"border-2\" data-testid={`card-case-${caso.case_id}`}>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">\n                      {caso.case_id}\n                    </CardTitle>\n                    <CardDescription className=\"mt-1\">\n                      Diente {caso.tooth_fdi}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm\">\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Dolor espontáneo</p>\n                        <p className=\"font-medium\">{caso.dolorEspontaneo === \"si\" ? \"Sí\" : \"No\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Respuesta frío</p>\n                        <p className=\"font-medium\">\n                          {caso.respuestaFrio === \"0_no_responde\" ? \"No responde\" :\n                           caso.respuestaFrio === \"1_normal\" ? \"Normal\" : \"Aumentada\"}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Lingering (seg)</p>\n                        <p className=\"font-medium\">{caso.lingeringSeg || \"0\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Percusión</p>\n                        <p className=\"font-medium\">{caso.percusionDolor === \"si\" ? \"Sí\" : \"No\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Radiolucidez</p>\n                        <p className=\"font-medium\">{caso.radiolucidezApical === \"si\" ? \"Sí\" : \"No\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Profundidad</p>\n                        <p className=\"font-medium capitalize\">{caso.profundidadCaries}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Tracto sinusal</p>\n                        <p className=\"font-medium\">{caso.sinusTractPresent === \"si\" ? \"Sí\" : \"No\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Compromiso sistémico</p>\n                        <p className=\"font-medium\">{caso.systemicInvolvement === \"si\" ? \"Sí\" : \"No\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Tratamiento previo</p>\n                        <p className=\"font-medium\">{caso.previousTreatment === \"si\" ? \"Sí\" : \"No\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-muted-foreground text-xs\">Palpación apical</p>\n                        <p className=\"font-medium\">{caso.apicalPalpationPain === \"si\" ? \"Sí\" : \"No\"}</p>\n                      </div>\n                    </div>\n\n                    {caso.notas && (\n                      <div className=\"bg-muted p-3 rounded-md\">\n                        <p className=\"text-xs text-muted-foreground mb-1\">Notas clínicas</p>\n                        <p className=\"text-sm\">{caso.notas}</p>\n                      </div>\n                    )}\n\n                    <div className=\"space-y-4 pt-3 border-t\">\n                      {/* Clasificación Pulpar */}\n                      <div className=\"space-y-2\">\n                        <Label htmlFor={`pulpar-${caso.case_id}`} className=\"text-sm font-semibold\">\n                          Clasificación Pulpar AEDE/AAE (Gold Standard)\n                        </Label>\n                        <Select\n                          value={seleccion[caso.case_id]?.pulpar || \"\"}\n                          onValueChange={(value) => handleChangePulpar(caso.case_id, value)}\n                        >\n                          <SelectTrigger\n                            id={`pulpar-${caso.case_id}`}\n                            data-testid={`select-pulpar-${caso.case_id}`}\n                          >\n                            <SelectValue placeholder=\"Selecciona clasificación pulpar...\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {OPCIONES_PULPAR.map((opcion) => (\n                              <SelectItem key={opcion} value={opcion}>\n                                {opcion}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n\n                      {/* Clasificación Apical */}\n                      <div className=\"space-y-2\">\n                        <Label htmlFor={`apical-${caso.case_id}`} className=\"text-sm font-semibold\">\n                          Clasificación Apical AEDE/AAE (Gold Standard)\n                        </Label>\n                        <Select\n                          value={seleccion[caso.case_id]?.apical || \"\"}\n                          onValueChange={(value) => handleChangeApical(caso.case_id, value)}\n                        >\n                          <SelectTrigger\n                            id={`apical-${caso.case_id}`}\n                            data-testid={`select-apical-${caso.case_id}`}\n                          >\n                            <SelectValue placeholder=\"Selecciona clasificación apical...\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {OPCIONES_APICAL.map((opcion) => (\n                              <SelectItem key={opcion} value={opcion}>\n                                {opcion}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n\n                      <Button\n                        onClick={() => guardar(caso.case_id)}\n                        disabled={\n                          !seleccion[caso.case_id]?.pulpar || \n                          !seleccion[caso.case_id]?.apical || \n                          guardando[caso.case_id]\n                        }\n                        className=\"w-full gap-2\"\n                        data-testid={`button-validate-${caso.case_id}`}\n                      >\n                        {guardando[caso.case_id] ? (\n                          <>\n                            <Loader2 className=\"w-4 h-4 animate-spin\" />\n                            Guardando...\n                          </>\n                        ) : (\n                          <>\n                            <CheckCircle2 className=\"w-4 h-4\" />\n                            Validar y guardar\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":11506,"size_tokens":null},"ENDOIA/client/src/components/clinico/CasosComplejos.tsx":{"content":"import { ClinicoCase } from './types';\nimport { isComplexCase } from './helpers';\nimport { AlertTriangle } from 'lucide-react';\n\ninterface CasosComplejosProps {\n  casos: ClinicoCase[];\n}\n\nexport function CasosComplejos({ casos }: CasosComplejosProps) {\n  const complexCases = casos.filter(isComplexCase);\n  const percentage = casos.length > 0 ? Math.round((complexCases.length / casos.length) * 100) : 0;\n\n  return (\n    <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6 transition-all duration-300 hover:shadow-xl\">\n      <div className=\"flex items-start gap-4\">\n        <div className=\"p-3 rounded-xl\" style={{ backgroundColor: 'rgba(245, 166, 35, 0.1)' }}>\n          <AlertTriangle className=\"w-7 h-7\" style={{ color: '#F5A623' }} />\n        </div>\n        <div className=\"flex-1 space-y-2\">\n          <p className=\"text-sm font-medium text-zinc-400 tracking-wide\">Casos complejos</p>\n          <p className=\"text-3xl font-bold tracking-tight\">\n            {complexCases.length}\n            <span className=\"text-lg text-zinc-400 font-normal ml-2\">de {casos.length}</span>\n          </p>\n          <p className=\"text-xs text-zinc-400\">\n            PAI≥3, radiolucidez, sondaje{'>'}4mm o dolor espontáneo\n          </p>\n          <div className=\"mt-3 pt-3 border-t border-zinc-200/50 dark:border-zinc-700/50\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex-1 bg-zinc-200 dark:bg-zinc-800 rounded-full h-1.5\">\n                <div className=\"h-1.5 rounded-full transition-all duration-700\" style={{ width: `${percentage}%`, backgroundColor: '#F5A623' }} />\n              </div>\n              <span className=\"text-sm font-semibold\" style={{ color: '#F5A623' }}>{percentage}%</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1866,"size_tokens":null},"ENDOIA/client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/ItemTexto.tsx":{"content":"import { BibliotecaItem, TextoContent } from '@/data/bibliotecaClinica';\n\ninterface ItemTextoProps {\n  item: BibliotecaItem;\n}\n\nexport function ItemTexto({ item }: ItemTextoProps) {\n  const content = item.content as TextoContent;\n  \n  return (\n    <div className=\"space-y-3\">\n      <p className=\"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed\">\n        {content.description}\n      </p>\n      \n      {content.clinicalSigns && (\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-semibold text-zinc-700 dark:text-zinc-200\">\n            Signos clínicos:\n          </h4>\n          <ul className=\"space-y-1\">\n            {content.clinicalSigns.map((sign: string, idx: number) => (\n              <li key={idx} className=\"text-sm text-zinc-600 dark:text-zinc-400 flex items-start gap-2\">\n                <span className=\"mt-1.5 w-1 h-1 rounded-full flex-shrink-0\" style={{ backgroundColor: '#3A7AFE' }} />\n                <span>{sign}</span>\n              </li>\n            ))}\n          </ul>\n        </div>\n      )}\n      \n      {content.management && (\n        <div className=\"pt-3 border-t border-zinc-200 dark:border-zinc-700\">\n          <p className=\"text-sm text-zinc-600 dark:text-zinc-300\">\n            <span className=\"font-semibold text-zinc-700 dark:text-zinc-200\">Manejo: </span>\n            {content.management}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":1410,"size_tokens":null},"ENDOIA/client/src/pages/HomePage.tsx":{"content":"import { useEffect } from 'react';\nimport { Redirect } from 'wouter';\nimport { Loader2 } from 'lucide-react';\nimport { useAuth } from '@/auth/AuthContext';\n\nexport default function HomePage() {\n  const { user, role, loading } = useAuth();\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Redirect to=\"/login\" />;\n  }\n\n  if (role === 'clinico') {\n    return <Redirect to=\"/clinico/registrar\" />;\n  }\n\n  if (role === 'tutor') {\n    return <Redirect to=\"/tutor\" />;\n  }\n\n  if (role === 'investigador') {\n    return <Redirect to=\"/investigador\" />;\n  }\n\n  return <Redirect to=\"/clinico/registrar\" />;\n}\n","path":null,"size_bytes":769,"size_tokens":null},"ENDOIA/client/src/lib/exito.ts":{"content":"export type ResultadoExitoRadiologico = 'si' | 'parcial' | 'no' | 'manual';\n\nexport function calcularExitoRadiologicoAuto(\n  PAI_base: number | string | null | undefined,\n  PAI_followup: number | string | null | undefined,\n  diam_base: number | string | null | undefined,\n  diam_followup: number | string | null | undefined\n): ResultadoExitoRadiologico {\n  if (!PAI_base || !PAI_followup) return \"manual\";\n\n  const paiBase = Number(PAI_base);\n  const paiFollow = Number(PAI_followup);\n  const diamBase = Number(diam_base) || 0;\n  const diamFollow = Number(diam_followup) || 0;\n\n  if (paiFollow < paiBase) {\n    if (paiFollow <= 2 && diamFollow <= 1) {\n      return \"si\";\n    }\n    return \"parcial\";\n  }\n\n  if (paiFollow > paiBase) return \"no\";\n\n  if (diamBase > 0 && diamFollow > 0) {\n    const reduccion = (diamBase - diamFollow) / diamBase;\n    if (reduccion >= 0.3) return \"si\";\n    if (reduccion > 0) return \"parcial\";\n    if (diamFollow > diamBase) return \"no\";\n  }\n\n  return \"si\";\n}\n","path":null,"size_bytes":989,"size_tokens":null},"ENDOIA/client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"ENDOIA/client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"ENDOIA/client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"ENDOIA/client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"ENDOIA/client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"ENDOIA/client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"ENDOIA/client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"ENDOIA/client/src/components/biblioteca/ItemTabla.tsx":{"content":"import { BibliotecaItem, TablaContent } from '@/data/bibliotecaClinica';\n\ninterface ItemTablaProps {\n  item: BibliotecaItem;\n}\n\nexport function ItemTabla({ item }: ItemTablaProps) {\n  const content = item.content as TablaContent;\n  \n  return (\n    <div className=\"overflow-x-auto\">\n      <table className=\"w-full text-sm\">\n        <thead>\n          <tr className=\"border-b border-zinc-200 dark:border-zinc-700\">\n            {content.headers?.map((header: string, idx: number) => (\n              <th\n                key={idx}\n                className=\"text-left px-4 py-3 font-semibold text-zinc-700 dark:text-zinc-200 bg-zinc-50 dark:bg-zinc-800/50\"\n              >\n                {header}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody>\n          {content.rows?.map((row: string[], rowIdx: number) => (\n            <tr\n              key={rowIdx}\n              className=\"border-b border-zinc-100 dark:border-zinc-800 last:border-0\"\n            >\n              {row.map((cell, cellIdx) => (\n                <td\n                  key={cellIdx}\n                  className=\"px-4 py-3 text-zinc-600 dark:text-zinc-300\"\n                >\n                  {cell}\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n","path":null,"size_bytes":1320,"size_tokens":null},"ENDOIA/client/src/pages/BibliotecaPage.tsx":{"content":"import { useState, useMemo } from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  bibliotecaData,\n  BibliotecaCategoria,\n  getCategoriaLabel,\n  getCategoriaIcon,\n} from '@/data/bibliotecaClinica';\nimport { BibliotecaList } from '@/components/biblioteca/BibliotecaList';\nimport {\n  Search,\n  Layers,\n  Activity,\n  AlertCircle,\n  GitBranch,\n  GitMerge,\n  ExternalLink,\n  HelpCircle,\n  BookOpen,\n  Pill,\n  LucideIcon,\n} from 'lucide-react';\n\nconst iconMap: Record<string, LucideIcon> = {\n  layers: Layers,\n  activity: Activity,\n  'alert-circle': AlertCircle,\n  'git-branch': GitBranch,\n  'git-merge': GitMerge,\n  'external-link': ExternalLink,\n  'help-circle': HelpCircle,\n  pill: Pill,\n};\n\nconst categorias: BibliotecaCategoria[] = [\n  'clasificacion',\n  'reabsorciones',\n  'farmacologia',\n  'trauma',\n  'urgencias',\n  'algoritmos_dx',\n  'algoritmos_tx',\n  'recursos',\n  'faq',\n];\n\nexport default function BibliotecaPage() {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [activeTab, setActiveTab] = useState<BibliotecaCategoria>('clasificacion');\n\n  const filteredItems = useMemo(() => {\n    if (!searchQuery.trim()) {\n      return null;\n    }\n\n    const query = searchQuery.toLowerCase();\n    return bibliotecaData.filter((item) => {\n      const matchTitle = item.title.toLowerCase().includes(query);\n      const matchSubtitle = item.subtitle?.toLowerCase().includes(query);\n      const matchDescription = item.shortDescription?.toLowerCase().includes(query);\n      const matchTags = item.tags?.some((tag) => tag.toLowerCase().includes(query));\n      \n      return matchTitle || matchSubtitle || matchDescription || matchTags;\n    });\n  }, [searchQuery]);\n\n  const currentCategoryItems = useMemo(() => {\n    return bibliotecaData.filter((item) => item.categoria === activeTab);\n  }, [activeTab]);\n\n  const displayItems = filteredItems !== null ? filteredItems : currentCategoryItems;\n  const showingSearchResults = filteredItems !== null;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-zinc-50 via-white to-zinc-50 dark:from-zinc-950 dark:via-zinc-900 dark:to-zinc-950\">\n      <div className=\"max-w-6xl mx-auto px-4 py-8 space-y-8\">\n        <div className=\"space-y-4\">\n          <div className=\"flex items-start gap-4\">\n            <div\n              className=\"p-4 rounded-2xl shadow-lg\"\n              style={{ backgroundColor: 'rgba(58, 122, 254, 0.1)' }}\n            >\n              <BookOpen className=\"w-8 h-8\" style={{ color: '#3A7AFE' }} />\n            </div>\n            <div className=\"flex-1\">\n              <h1 className=\"text-3xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100\">\n                Biblioteca Clínica ENDOIA\n              </h1>\n              <p className=\"text-zinc-500 dark:text-zinc-400 mt-2\">\n                Referencia rápida basada en guías oficiales (AAE/ESE 2025, IADT, etc.)\n              </p>\n            </div>\n          </div>\n\n          <div className=\"relative\">\n            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-zinc-400\" />\n            <Input\n              type=\"text\"\n              placeholder=\"Buscar en la biblioteca...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-12 h-12 text-base bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl border-zinc-200 dark:border-zinc-700 focus:ring-2\"\n              style={{\n                '--tw-ring-color': '#3A7AFE',\n              } as React.CSSProperties}\n            />\n          </div>\n        </div>\n\n        {showingSearchResults ? (\n          <div className=\"space-y-6 animate-in fade-in-0 duration-500\">\n            <div className=\"flex items-center gap-3\">\n              <div\n                className=\"px-4 py-2 rounded-full text-sm font-medium\"\n                style={{ backgroundColor: 'rgba(58, 122, 254, 0.1)', color: '#3A7AFE' }}\n              >\n                {displayItems.length} {displayItems.length === 1 ? 'resultado' : 'resultados'}\n              </div>\n              <button\n                onClick={() => setSearchQuery('')}\n                className=\"text-sm text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300 underline\"\n              >\n                Limpiar búsqueda\n              </button>\n            </div>\n            \n            <BibliotecaList items={displayItems} showCategoria={true} />\n          </div>\n        ) : (\n          <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as BibliotecaCategoria)}>\n            <div className=\"overflow-x-auto\">\n              <TabsList className=\"inline-flex w-auto h-auto p-1 bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg\">\n                {categorias.map((cat) => {\n                  const iconName = getCategoriaIcon(cat);\n                  const IconComponent = iconMap[iconName];\n                  \n                  return (\n                    <TabsTrigger\n                      key={cat}\n                      value={cat}\n                      className=\"gap-2 data-[state=active]:bg-white dark:data-[state=active]:bg-zinc-800 data-[state=active]:shadow-md px-4 py-2.5 rounded-lg transition-all\"\n                    >\n                      {IconComponent && <IconComponent className=\"w-4 h-4\" />}\n                      <span className=\"hidden sm:inline text-sm font-medium\">\n                        {getCategoriaLabel(cat).replace(/\\s*\\(.*?\\)\\s*/g, '')}\n                      </span>\n                      <span className=\"sm:hidden text-sm font-medium\">\n                        {getCategoriaLabel(cat).split(' ')[0]}\n                      </span>\n                    </TabsTrigger>\n                  );\n                })}\n              </TabsList>\n            </div>\n\n            {categorias.map((cat) => (\n              <TabsContent\n                key={cat}\n                value={cat}\n                className=\"mt-6 animate-in fade-in-0 duration-500\"\n              >\n                <div className=\"mb-6\">\n                  <h2 className=\"text-2xl font-semibold tracking-tight text-zinc-800 dark:text-zinc-100\">\n                    {getCategoriaLabel(cat)}\n                  </h2>\n                  <p className=\"text-sm text-zinc-500 dark:text-zinc-400 mt-1\">\n                    {getCategoryDescription(cat)}\n                  </p>\n                </div>\n                \n                <BibliotecaList items={currentCategoryItems} />\n              </TabsContent>\n            ))}\n          </Tabs>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction getCategoryDescription(categoria: BibliotecaCategoria): string {\n  const descriptions: Record<BibliotecaCategoria, string> = {\n    clasificacion: 'Sistema de diagnóstico pulpar y apical según consenso AAE/ESE 2025',\n    reabsorciones: 'Clasificación, diagnóstico y manejo de reabsorciones radiculares post-trauma según IADT 2024',\n    farmacologia: 'Protocolos farmacológicos basados en evidencia ADA/AAE 2024: analgesia, antibióticos y drenaje',\n    trauma: 'Protocolos de manejo de traumatismos dentoalveolares basados en IADT 2020',\n    urgencias: 'Guía de manejo de urgencias endodónticas y situaciones agudas',\n    algoritmos_dx: 'Algoritmos paso a paso para diagnóstico endodóntico sistemático',\n    algoritmos_tx: 'Árboles de decisión terapéutica según diagnóstico y factores clínicos',\n    recursos: 'Enlaces a guías oficiales y recursos de sociedades científicas',\n    faq: 'Preguntas frecuentes sobre práctica clínica endodóntica',\n  };\n  return descriptions[categoria];\n}\n","path":null,"size_bytes":7636,"size_tokens":null},"ENDOIA/client/src/components/CreateForm.tsx":{"content":"import { useState } from \"react\";\n// @ts-ignore - JS module\nimport { getDiagnosisAAE_ESE } from \"../lib/IA_AAE_ESE\";\nimport { enviarCasoNuevo } from \"../lib/api\";\n\nexport default function CreateForm() {\n  const [formData, setFormData] = useState<any>({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [diagnosis, setDiagnosis] = useState<any>(null);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\n    setFormData({ ...formData, [e.target.name]: e.target.value });\n  };\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    try {\n      const dx = getDiagnosisAAE_ESE(formData);\n      setDiagnosis(dx);\n      \n      const payload = { \n        ...formData, \n        ...dx,\n        clinicoEmail: formData.clinico_correo,\n        date: new Date().toISOString().split('T')[0]\n      };\n\n      const result = await enviarCasoNuevo(payload);\n\n      if (result.ok) {\n        alert(`Caso ${formData.case_id || \"registrado\"} correctamente`);\n        setFormData({});\n        (e.target as HTMLFormElement).reset();\n      } else {\n        alert(\"Error enviando caso: \" + (result.error || \"Error desconocido\"));\n      }\n    } catch (err: any) {\n      alert(\"Error enviando caso: \" + err.message);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div style={{ padding: \"20px\", maxWidth: \"600px\", margin: \"0 auto\" }}>\n      <h2 style={{ color: \"#1C56FF\", marginBottom: \"20px\" }}>\n        📋 Registrar nuevo caso ENDOIA\n      </h2>\n      \n      {diagnosis && (\n        <div style={{ \n          background: \"#e8f5e9\", \n          padding: \"15px\", \n          borderRadius: \"8px\", \n          marginBottom: \"20px\",\n          border: \"2px solid #4caf50\"\n        }}>\n          <h3 style={{ margin: \"0 0 10px 0\", color: \"#2e7d32\" }}>\n            🤖 Diagnóstico IA (AAE-ESE 2025)\n          </h3>\n          <p><strong>Pulpar:</strong> {diagnosis.AEDE_pulpar_IA}</p>\n          <p><strong>Apical:</strong> {diagnosis.AEDE_apical_IA}</p>\n        </div>\n      )}\n\n      <form onSubmit={handleSubmit} style={{ \n        display: \"flex\", \n        flexDirection: \"column\", \n        gap: \"15px\" \n      }}>\n\n        {/* ----------------------------- IDENTIFICACIÓN ----------------------------- */}\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Identificador del caso *\n          </label>\n          <input \n            name=\"case_id\" \n            placeholder=\"Ej: CASO_001\" \n            onChange={handleChange} \n            required \n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          />\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Correo del clínico *\n          </label>\n          <input \n            name=\"clinico_correo\" \n            type=\"email\"\n            placeholder=\"clinico@ejemplo.com\" \n            onChange={handleChange} \n            required \n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          />\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Diente (FDI) *\n          </label>\n          <input \n            name=\"tooth_fdi\" \n            placeholder=\"Ej: 26\" \n            onChange={handleChange} \n            required \n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          />\n        </div>\n\n        {/* ------------------------- SÍNTOMAS / DOLOR --------------------------- */}\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Tipo de dolor principal\n          </label>\n          <select \n            name=\"tipo_dolor\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"sin_dolor\">Sin dolor</option>\n            <option value=\"dolor_provocado_corto\">Dolor provocado de corta duración</option>\n            <option value=\"dolor_provocado_largo\">Dolor provocado de larga duración</option>\n            <option value=\"dolor_espontaneo\">Dolor espontáneo</option>\n            <option value=\"dolor_mal_localizado\">Dolor mal localizado / irradiado</option>\n            <option value=\"no_refiere\">No refiere / no sabe describir</option>\n          </select>\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Respuesta al frío\n          </label>\n          <select \n            name=\"thermal_cold_response\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"0\">Sin respuesta</option>\n            <option value=\"1\">Normal / leve</option>\n            <option value=\"2\">Exagerada</option>\n          </select>\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Duración dolor tras frío (segundos)\n          </label>\n          <input \n            type=\"number\" \n            name=\"lingering_pain_seconds\" \n            placeholder=\"0-60\"\n            onChange={handleChange} \n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          />\n        </div>\n\n        {/* ------------------------- HALLAZGOS CLÍNICOS -------------------------- */}\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Profundidad de caries\n          </label>\n          <select \n            name=\"depth_of_caries\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"no_aplica\">No aplica / diente tratado</option>\n            <option value=\"no_refiere\">No valorable</option>\n            <option value=\"superficial\">Esmaltaria / superficial</option>\n            <option value=\"media\">Dentinaria media</option>\n            <option value=\"profunda\">Dentinaria profunda</option>\n          </select>\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Profundidad de sondaje máxima (mm)\n          </label>\n          <input \n            type=\"number\" \n            name=\"sondaje_max_mm\" \n            min=\"0\" \n            max=\"12\"\n            placeholder=\"Ej: 6\"\n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          />\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Sangrado controlable\n          </label>\n          <select \n            name=\"sangrado_controlable\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"si\">Sí</option>\n            <option value=\"no\">No</option>\n            <option value=\"no_valorable\">No valorable</option>\n          </select>\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            ¿Se abrió cámara en esta cita?\n          </label>\n          <select \n            name=\"camara_abierta\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"si\">Sí</option>\n            <option value=\"no\">No</option>\n          </select>\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Pulpa expuesta\n          </label>\n          <select \n            name=\"pulpa_expuesta\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"si\">Sí</option>\n            <option value=\"no\">No</option>\n            <option value=\"no_valorable\">No valorable</option>\n          </select>\n        </div>\n\n        {/* ------------------------- HALLAZGOS RADIOLÓGICOS ------------------------ */}\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            PAI - Periapical Index (1-5)\n          </label>\n          <input \n            type=\"number\" \n            name=\"periapical_index_PAI_1_5\" \n            min=\"1\"\n            max=\"5\"\n            placeholder=\"1-5\"\n            onChange={handleChange} \n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          />\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            ¿Radiolucidez apical presente?\n          </label>\n          <select \n            name=\"radiolucency_yesno\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"1\">Sí</option>\n            <option value=\"0\">No</option>\n          </select>\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            ¿Dolor a percusión?\n          </label>\n          <select \n            name=\"percussion_pain_yesno\" \n            onChange={handleChange}\n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          >\n            <option value=\"\">Seleccione</option>\n            <option value=\"yes\">Sí</option>\n            <option value=\"no\">No</option>\n          </select>\n        </div>\n\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Ensanchamiento PDL (1-5)\n          </label>\n          <input \n            type=\"number\" \n            name=\"pdl_widening\" \n            min=\"1\"\n            max=\"5\"\n            placeholder=\"1-5\"\n            onChange={handleChange} \n            style={{ width: \"100%\", padding: \"8px\", borderRadius: \"4px\", border: \"1px solid #ccc\" }}\n          />\n        </div>\n\n        {/* --------------------------- NOTAS ----------------------------- */}\n        <div>\n          <label style={{ display: \"block\", marginBottom: \"5px\", fontWeight: \"bold\" }}>\n            Notas clínicas\n          </label>\n          <textarea \n            name=\"notes\" \n            onChange={handleChange}\n            rows={4}\n            placeholder=\"Observaciones adicionales...\"\n            style={{ \n              width: \"100%\", \n              padding: \"8px\", \n              borderRadius: \"4px\", \n              border: \"1px solid #ccc\",\n              fontFamily: \"inherit\"\n            }}\n          ></textarea>\n        </div>\n\n        {/* ------------------------ BOTÓN ----------------------------- */}\n\n        <button \n          type=\"submit\" \n          disabled={isSubmitting}\n          style={{ \n            padding: \"12px 24px\", \n            background: isSubmitting ? \"#ccc\" : \"#004aad\", \n            color: \"white\", \n            border: \"none\", \n            borderRadius: \"4px\", \n            cursor: isSubmitting ? \"not-allowed\" : \"pointer\",\n            fontSize: \"16px\",\n            fontWeight: \"bold\"\n          }}\n        >\n          {isSubmitting ? \"Enviando...\" : \"✅ Enviar caso\"}\n        </button>\n\n      </form>\n    </div>\n  );\n}\n","path":null,"size_bytes":12227,"size_tokens":null},"ENDOIA/client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"ENDOIA/client/src/pages/Tutor/HomeTutor.tsx":{"content":"export default function HomeTutor() {\n  return (\n    <div className=\"container mx-auto p-6\">\n      <h1 className=\"text-3xl font-bold\">Panel del Tutor</h1>\n    </div>\n  );\n}\n","path":null,"size_bytes":173,"size_tokens":null},"ENDOIA/postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"ENDOIA/client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"ENDOIA/client/src/components/clinico/HistorialDientes.tsx":{"content":"import { useState } from 'react';\nimport { ClinicoCase } from './types';\nimport { Button } from '@/components/ui/button';\nimport { ChevronDown, ChevronRight, Eye, Hash, ArrowRight } from 'lucide-react';\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\n\ninterface HistorialDientesProps {\n  casos: ClinicoCase[];\n  onVerDetalle?: (caso: ClinicoCase) => void;\n}\n\nexport function HistorialDientes({ casos, onVerDetalle }: HistorialDientesProps) {\n  const [expandedTeeth, setExpandedTeeth] = useState<Set<string>>(new Set());\n  \n  const groupedByTooth = new Map<string, ClinicoCase[]>();\n  \n  casos.forEach(caso => {\n    if (caso.tooth_fdi) {\n      const fdi = String(caso.tooth_fdi);\n      if (!groupedByTooth.has(fdi)) {\n        groupedByTooth.set(fdi, []);\n      }\n      groupedByTooth.get(fdi)!.push(caso);\n    }\n  });\n  \n  const sortedTeeth = Array.from(groupedByTooth.entries())\n    .sort((a, b) => b[1].length - a[1].length);\n  \n  const toggleTooth = (fdi: string) => {\n    const newExpanded = new Set(expandedTeeth);\n    if (newExpanded.has(fdi)) {\n      newExpanded.delete(fdi);\n    } else {\n      newExpanded.add(fdi);\n    }\n    setExpandedTeeth(newExpanded);\n  };\n\n  if (sortedTeeth.length === 0) {\n    return (\n      <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Hash className=\"w-5 h-5\" style={{ color: '#3A7AFE' }} />\n          <h3 className=\"text-lg font-semibold tracking-tight\">Historial de dientes tratados</h3>\n        </div>\n        <p className=\"text-sm text-zinc-400\">No hay casos con dientes registrados</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl rounded-xl shadow-lg shadow-black/10 p-6\">\n      <div className=\"flex items-center gap-2 mb-2\">\n        <Hash className=\"w-5 h-5\" style={{ color: '#3A7AFE' }} />\n        <h3 className=\"text-lg font-semibold tracking-tight\">Historial de dientes tratados</h3>\n      </div>\n      <p className=\"text-sm text-zinc-400 mb-6\">\n        {sortedTeeth.length} {sortedTeeth.length === 1 ? 'diente tratado' : 'dientes tratados'}\n      </p>\n      \n      <div className=\"space-y-3\">\n        {sortedTeeth.map(([fdi, casosDelDiente]) => {\n          const isExpanded = expandedTeeth.has(fdi);\n          return (\n            <Collapsible key={fdi} open={isExpanded} onOpenChange={() => toggleTooth(fdi)}>\n              <div className=\"bg-white/40 dark:bg-zinc-800/40 backdrop-blur-sm rounded-xl border border-zinc-200/50 dark:border-zinc-700/50 overflow-hidden transition-all duration-300 hover:shadow-md\">\n                <CollapsibleTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full justify-between p-5 h-auto hover:bg-zinc-100/50 dark:hover:bg-zinc-700/30 transition-all\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      {isExpanded ? (\n                        <ChevronDown className=\"w-4 h-4 transition-transform\" style={{ color: '#3A7AFE' }} />\n                      ) : (\n                        <ChevronRight className=\"w-4 h-4 transition-transform\" style={{ color: '#3A7AFE' }} />\n                      )}\n                      <Hash className=\"w-4 h-4\" style={{ color: '#A6A6A6' }} />\n                      <span className=\"font-semibold tracking-tight\">Diente {fdi}</span>\n                      <span className=\"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium\" style={{ backgroundColor: 'rgba(58, 122, 254, 0.1)', color: '#3A7AFE' }}>\n                        {casosDelDiente.length} {casosDelDiente.length === 1 ? 'caso' : 'casos'}\n                      </span>\n                    </div>\n                  </Button>\n                </CollapsibleTrigger>\n                \n                <CollapsibleContent className=\"transition-all duration-300\">\n                  <div className=\"border-t border-zinc-200/50 dark:border-zinc-700/50 divide-y divide-zinc-200/30 dark:divide-zinc-700/30\">\n                    {casosDelDiente.map(caso => (\n                      <div key={caso.case_id} className=\"p-4 flex items-center justify-between hover:bg-zinc-800/20 dark:hover:bg-zinc-700/20 transition-all group\">\n                        <div className=\"space-y-1.5 flex-1\">\n                          <p className=\"font-mono text-xs text-zinc-400\">{caso.case_id}</p>\n                          <p className=\"text-sm font-medium\">\n                            {caso.registro_fecha || caso.date || 'N/A'}\n                          </p>\n                          {(caso.tto_realizado || caso.tto_propuesto) && (\n                            <span className=\"inline-flex items-center rounded-full px-3 py-1 text-xs font-medium\" style={{ backgroundColor: 'rgba(46, 204, 113, 0.1)', color: '#2ECC71' }}>\n                              {caso.tto_realizado || caso.tto_propuesto}\n                            </span>\n                          )}\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => onVerDetalle?.(caso)}\n                          className=\"gap-2 opacity-70 hover:opacity-100 transition-opacity\"\n                        >\n                          <ArrowRight className=\"w-3 h-3\" />\n                          Ver detalles\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </CollapsibleContent>\n              </div>\n            </Collapsible>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"ENDOIA/client/src/pages/AboutEndoia.tsx":{"content":"export default function AboutEndoia() {\n  return (\n    <div style={{ padding: \"40px\", maxWidth: \"900px\", margin: \"0 auto\" }}>\n\n      <h1 style={{ fontSize: \"2.6rem\", textAlign: \"center\", color: \"#004AAD\" }}>\n        ENDOIA\n      </h1>\n      <p style={{ textAlign: \"center\", fontSize: \"1.2rem\", color: \"#333\" }}>\n        Diagnóstico endodóntico asistido por Inteligencia Artificial\n      </p>\n\n      <section style={{ marginTop: \"40px\" }}>\n        <h2 style={{ color: \"#004AAD\" }}>¿Qué es ENDOIA?</h2>\n        <p>\n          Plataforma creada por clínicos para unificar el diagnóstico endodóntico,\n          organizar radiografías y aplicar IA basada en AAE–ESE 2025.\n        </p>\n      </section>\n\n      <section style={{ marginTop: \"30px\" }}>\n        <h2 style={{ color: \"#004AAD\" }}>El problema</h2>\n        <ul>\n          <li>Variabilidad diagnóstica entre clínicos</li>\n          <li>Radiografías y datos dispersos</li>\n          <li>Dificultad para analizar grandes volúmenes</li>\n          <li>Falta de herramientas modernas y estandarizadas</li>\n        </ul>\n      </section>\n\n      <section style={{ marginTop: \"30px\" }}>\n        <h2 style={{ color: \"#004AAD\" }}>Qué ofrece hoy</h2>\n        <ul>\n          <li>🦷 Registro clínico estandarizado</li>\n          <li>🤖 Diagnóstico IA pulpar y apical</li>\n          <li>🖼 Subida de radiografías</li>\n          <li>📊 Base de datos estructurada</li>\n          <li>🔍 Visualización de casos</li>\n        </ul>\n      </section>\n\n      <section style={{ marginTop: \"30px\" }}>\n        <h2 style={{ color: \"#004AAD\" }}>Roadmap</h2>\n        <ul>\n          <li>🔥 Análisis radiográfico automático</li>\n          <li>🔥 Probabilidad de éxito del tratamiento (IA)\n            <br/><em>\"Ejemplo: 92% de éxito estimado\"</em>\n          </li>\n          <li>🔥 Seguimiento clínico 1–12 meses</li>\n          <li>🔥 Validación multicéntrica</li>\n          <li>🔥 Publicaciones científicas</li>\n          <li>🔥 Panel avanzado para clínicas</li>\n        </ul>\n      </section>\n\n      <section style={{ marginTop: \"30px\" }}>\n        <h2 style={{ color: \"#004AAD\" }}>Visión</h2>\n        <p>\n          Convertir ENDOIA en la herramienta estándar de diagnóstico endodóntico \n          asistido por IA para clínica, docencia e investigación.\n        </p>\n      </section>\n\n      <div style={{ textAlign: \"center\", marginTop: \"40px\" }}>\n        <a href=\"/clinico/registrar\" style={{\n          background: \"#004AAD\",\n          color: \"white\",\n          padding: \"12px 28px\",\n          borderRadius: \"8px\",\n          textDecoration: \"none\",\n          fontSize: \"1.1rem\",\n          fontWeight: \"bold\"\n        }}>\n          Registrar un caso\n        </a>\n      </div>\n\n    </div>\n  );\n}\n","path":null,"size_bytes":2773,"size_tokens":null},"replit.md":{"content":"# ENDOIA — Endodontic Diagnostic & Analytics Assistant\n\n## Overview\n\nENDOIA is an AI-powered diagnostic support tool for endodontic professionals. It assists in pulpal and apical diagnosis using the AAE-ESE 2025 classification system. The platform serves three user roles: clinicians (data entry and case management), tutors (validation without seeing AI diagnoses), and investigators (research analytics). Key features include case registration with clinical forms, AI-powered radiograph analysis using GPT-4o Vision, follow-up tracking, and a clinical reference library.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\nAdditional preferences:\n- Be concise and to the point\n- Provide clear architectural explanations over granular code details\n- Maintain established design patterns and technology stack\n- Understand and respect defined user roles and permissions\n- Discuss major changes before implementation, especially for core AI diagnostic logic or external integrations\n- Do not make changes to the `attached_assets/` folder\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript, bundled with Vite\n- **Styling**: Tailwind CSS with CSS variables for theming, supports light/dark modes\n- **UI Components**: shadcn/ui built on Radix UI primitives (located in `client/src/components/ui/`)\n- **Routing**: Wouter for client-side navigation\n- **State Management**: TanStack Query for server state, React Context for auth state\n- **Forms**: React Hook Form with Zod validation\n\n### Backend Architecture\n- **Runtime**: Node.js 20 with Express 4.x\n- **Language**: TypeScript with ESM modules\n- **API Pattern**: RESTful endpoints under `/api/` prefix\n- **Build**: esbuild for production bundling\n\n### Authentication & Authorization\n- **Provider**: Firebase Authentication with Google Sign-In\n- **Role System**: Three roles defined in `client/src/auth/roles.ts`:\n  - `clinico` (default) - Case registration and personal dashboard\n  - `tutor` - Case validation without AI diagnosis visibility\n  - `investigador` - Full research analytics access\n- **Route Protection**: `ProtectedRoute` component checks auth state and role permissions\n\n### Database\n- **Primary**: Supabase (PostgreSQL) with direct client-side connection via `@supabase/supabase-js`\n- **Schema**: Drizzle ORM for type-safe schema definition in `shared/schema.ts`\n- **Storage**: Supabase Storage bucket `radiographs` for X-ray images\n\n### AI Integration\n- **Vision Analysis**: OpenAI GPT-4o Vision for radiograph analysis\n- **Diagnostic Engine**: Custom AAE-ESE 2025 classification logic in `client/src/lib/IA_AAE_ESE_2025.ts`\n- **Endpoint**: `/api/vision-analyze` processes images server-side to protect API keys\n\n### PWA Configuration\n- **Plugin**: vite-plugin-pwa with auto-update service worker\n- **Manifest**: Configured for standalone display with custom icons\n- **Offline**: Workbox for caching static assets and Google Fonts\n\n## External Dependencies\n\n### Services\n- **Firebase**: Authentication (Google Sign-In), project ID configured via environment\n- **Supabase**: PostgreSQL database and file storage, requires `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`\n- **OpenAI**: GPT-4o Vision API for radiograph analysis, requires `OPENAI_API_KEY`\n\n### Key npm Packages\n- `@supabase/supabase-js` - Database client\n- `@tanstack/react-query` - Async state management\n- `drizzle-orm` / `drizzle-kit` - Database ORM and migrations\n- `recharts` - Dashboard charts and analytics\n- `openai` - OpenAI API client (server-side only)\n\n### Environment Variables Required\n```\nDATABASE_URL          # PostgreSQL connection string\nVITE_SUPABASE_URL     # Supabase project URL\nVITE_SUPABASE_ANON_KEY # Supabase anonymous key\nOPENAI_API_KEY        # OpenAI API key for vision analysis\nFIREBASE_PROJECT_ID   # Firebase project identifier\n```","path":null,"size_bytes":3863,"size_tokens":null},"ENDOIA/client/src/lib/IA_AAE_ESE.ts":{"content":"// IA_AAE_ESE.ts\n// Wrapper que conecta con el motor diagnóstico AAE-ESE 2025\n// Este archivo mantiene compatibilidad con componentes que usan getDiagnosisAAE_ESE()\n\nimport { diagnoseEndoAAE_ESE_2025, CaseData } from \"./IA_AAE_ESE_2025\";\n\n// Normalizar respuesta al frío a formato esperado por el motor\nfunction normalizeColdResponse(val: any): string {\n  if (!val) return \"normal\";\n  const s = String(val).toLowerCase().trim();\n  \n  if (s === \"0_no_responde\" || s === \"0\" || s === \"no_responde\" || s === \"none\" || s === \"ausente\" || s === \"no\") return \"none\";\n  if (s === \"2_aumentada\" || s === \"2\" || s === \"aumentada\" || s === \"increased\") return \"increased\";\n  if (s === \"1_normal\" || s === \"1\" || s === \"normal\") return \"normal\";\n  \n  return \"normal\";\n}\n\n// Normalizar sí/no a \"yes\"/\"no\"\nfunction normalizeYesNo(val: any): string {\n  if (!val) return \"no\";\n  const s = String(val).toLowerCase().trim();\n  if (s === \"1\" || s === \"yes\" || s === \"si\" || s === \"sí\" || s === \"true\") return \"yes\";\n  return \"no\";\n}\n\n// Normalizar profundidad de caries\nfunction normalizeDepthOfCaries(profundidad?: string): string {\n  if (!profundidad) return \"none\";\n  const p = profundidad.toLowerCase().trim();\n  \n  if (p === \"extrema\" || p === \"extreme\" || p === \"dentinaria_profunda\" || p === \"profunda\" || p === \"deep\") return \"deep\";\n  if (p === \"moderada\" || p === \"moderate\" || p === \"dentinaria_media\" || p === \"media\") return \"moderate\";\n  if (p === \"superficial\" || p === \"shallow\" || p === \"esmaltaria\") return \"shallow\";\n  if (p === \"no_aplica\" || p === \"no_refiere\") return \"none\";\n  \n  return \"none\";\n}\n\n// Normalizar tratamiento previo\nfunction normalizePreviousTreatment(val: any): string {\n  if (!val) return \"none\";\n  const s = String(val).toLowerCase().trim();\n  \n  if (s.includes(\"obtur\") || s === \"previously_obturated_rct\" || s === \"rct_completa\") return \"previously_obturated_rct\";\n  if (s.includes(\"inici\") || s === \"previously_initiated_rct\") return \"previously_initiated_rct\";\n  if (s.includes(\"regener\") || s === \"previous_regenerative\") return \"previous_regenerative\";\n  if (s.includes(\"indirect\") || s === \"vital_indirect_cap\") return \"vital_indirect_cap\";\n  if (s.includes(\"direct\") || s === \"vital_direct_cap\") return \"vital_direct_cap\";\n  if (s.includes(\"parcial\") || s.includes(\"partial\") || s === \"partial_pulpotomy\") return \"partial_pulpotomy\";\n  if (s.includes(\"pulpotomía completa\") || s.includes(\"full_pulpotomy\") || s.includes(\"pulpotomia_completa\")) return \"full_pulpotomy\";\n  if (s.includes(\"deep\") || s.includes(\"profunda\") || s === \"deep_restoration\") return \"deep_restoration\";\n  if (s.includes(\"small\") || s.includes(\"peque\") || s === \"small_restoration\") return \"small_restoration\";\n  \n  return \"none\";\n}\n\n// Normalizar historial de trauma\nfunction normalizeTraumaHistory(val: any): string {\n  if (!val) return \"\";\n  const s = String(val).toLowerCase().trim();\n  if (s === \"si\" || s === \"sí\" || s === \"yes\" || s === \"1\" || s === \"true\" || s.includes(\"trauma\")) return \"yes\";\n  return \"\";\n}\n\n// Coerción numérica\nfunction toNumberString(val: any): string | null {\n  if (val === null || val === undefined || val === \"\") return null;\n  const n = Number(val);\n  return Number.isFinite(n) ? String(n) : null;\n}\n\n// Estimar PAI basándose en radiolucidez y percusión\nfunction estimatePAI(radiolucidez: string, percusion: string): string {\n  const hasRadiolucency = normalizeYesNo(radiolucidez) === \"yes\";\n  const hasPercussion = normalizeYesNo(percusion) === \"yes\";\n  \n  if (hasRadiolucency) return hasPercussion ? \"4\" : \"3\";\n  if (hasPercussion) return \"2\";\n  return \"1\";\n}\n\n// Estimar ensanchamiento PDL\nfunction estimatePDLWidening(radiolucidez: string, percusion: string): string {\n  const hasRadiolucency = normalizeYesNo(radiolucidez) === \"yes\";\n  const hasPercussion = normalizeYesNo(percusion) === \"yes\";\n  \n  if (hasRadiolucency) return \"moderate\";\n  if (hasPercussion) return \"mild\";\n  return \"none\";\n}\n\nexport function getDiagnosisAAE_ESE(data: any) {\n  // Normalizar radiolucidez y percusión para estimaciones\n  const radiolucidez = data.radiolucency_yesno || data.radiolucidezApical || \"\";\n  const percusion = data.percussion_pain_yesno || data.percusionDolor || \"\";\n  \n  // Convertir y normalizar datos del formulario al formato CaseData\n  const caseData: CaseData = {\n    spontaneous_pain_yesno: normalizeYesNo(data.spontaneous_pain_yesno || data.dolorEspontaneo),\n    thermal_cold_response: normalizeColdResponse(data.thermal_cold_response || data.respuestaFrio),\n    lingering_pain_seconds: toNumberString(data.lingering_pain_seconds || data.lingeringSeg) || \"0\",\n    pain_to_heat: normalizeYesNo(data.pain_to_heat),\n    percussion_pain_yesno: normalizeYesNo(percusion),\n    apical_palpation_pain: normalizeYesNo(data.apical_palpation_pain || data.apicalPalpationPain),\n    sinus_tract_present: normalizeYesNo(data.sinus_tract_present || data.sinusTractPresent),\n    systemic_involvement: normalizeYesNo(data.systemic_involvement || data.systemicInvolvement),\n    depth_of_caries: normalizeDepthOfCaries(data.depth_of_caries || data.profundidadCaries),\n    tipo_dolor: data.tipo_dolor || \"sin_dolor\",\n    previous_treatment: normalizePreviousTreatment(data.previous_treatment || data.previousTreatment),\n    trauma_history: normalizeTraumaHistory(data.trauma_history),\n    periapical_index_pai_1_5: toNumberString(data.periapical_index_PAI_1_5 || data.periapical_index_pai_1_5) || estimatePAI(radiolucidez, percusion),\n    radiolucency_yesno: normalizeYesNo(radiolucidez),\n    pdl_widening: data.pdl_widening || estimatePDLWidening(radiolucidez, percusion),\n    vision_pai_baseline: toNumberString(data.vision_pai_baseline),\n    vision_pai_followup: toNumberString(data.vision_pai_followup),\n    vision_lesion_diam_mm_baseline: toNumberString(data.vision_lesion_diam_mm_baseline),\n    vision_lesion_diam_mm_followup: toNumberString(data.vision_lesion_diam_mm_followup),\n  };\n\n  // Llamar al motor nuevo AAE-ESE 2025\n  const result = diagnoseEndoAAE_ESE_2025(caseData);\n\n  // Devolver en el formato esperado por los componentes\n  return {\n    AEDE_pulpar_IA: result.pulpal,\n    AEDE_apical_IA: result.apical,\n    IA_flags: result.flags || [],\n  };\n}\n","path":null,"size_bytes":6201,"size_tokens":null}},"version":2}
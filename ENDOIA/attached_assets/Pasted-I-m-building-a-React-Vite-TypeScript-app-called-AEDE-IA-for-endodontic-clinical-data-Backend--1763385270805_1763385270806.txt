I’m building a React + Vite + TypeScript app called AEDE-IA for endodontic clinical data. Backend: • I already have multiple n8n webhooks working: • POST https://ague2206.app.n8n.cloud/webhook/create • POST https://ague2206.app.n8n.cloud/webhook/clinico/mis-casos • POST https://ague2206.app.n8n.cloud/webhook/tutor/pending • POST https://ague2206.app.n8n.cloud/webhook/tutor/label • POST https://ague2206.app.n8n.cloud/webhook/tutor/control Now I need to implement Google Login + Roles + Protected Routes. Tech stack: React + Vite + TypeScript. Firebase is already installed as a dependency, and I have my firebaseConfig ready. Please do the following, modifying the existing project structure (create files if they don’t exist): ⸻ 1) Create src/auth/roles.ts TypeScript file that: • Defines a union type: export type UserRole = 'clinico' | 'tutor' | 'investigador'; • Exports a mapping from email → role (with placeholder emails I will edit later): export const ROLE_BY_EMAIL: Record<string, UserRole> = { 'jennifer.endoia@gmail.com': 'tutor', 'segura.endoia@gmail.com': 'tutor', 'investigador.endoia@gmail.com': 'investigador', }; • Exports a helper: export function getRoleFromEmail(email: string | null | undefined): UserRole { if (!email) return 'clinico'; const lower = email.toLowerCase(); return ROLE_BY_EMAIL[lower] ?? 'clinico'; } ⸻ 2) Create src/auth/firebase.ts This file should: • Import and initialize Firebase using my config (leave placeholders, I will fill apiKey, authDomain, etc.) • Export: • auth • a function loginWithGoogle() that does signInWithPopup with a GoogleAuthProvider • a function logoutFirebase() • a function subscribeToAuthChanges(callback) that wraps onAuthStateChanged Use: import { initializeApp } from 'firebase/app'; import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, User } from 'firebase/auth'; ⸻ 3) Create src/auth/AuthContext.tsx React context that: • Keeps: • user: User | null • role: UserRole • loading: boolean • Provides methods: • login() → calls loginWithGoogle • logout() → calls logoutFirebase • On mount, subscribes to Firebase onAuthStateChanged, sets user + role using getRoleFromEmail. Export: • AuthProvider component • useAuth() hook Make sure it uses React.FC and proper typing. ⸻ 4) Create src/auth/ProtectedRoute.tsx If the project already uses react-router-dom, integrate this with it. If not, add react-router-dom and basic routing. ProtectedRoute should: • Use useAuth() • While loading → show “Cargando…” • If no user → redirect to /login • If user exists but role not in allow[] → show a simple “No tienes permiso para ver esta página.” • Otherwise, render children. Type: type Props = { children: React.ReactNode; allow: UserRole[]; }; Uses <Navigate /> from react-router-dom. ⸻ 5) Wrap the app with AuthProvider Modify the main entry (src/main.tsx or src/App.tsx, depending how the starter is set up): • Wrap the router with <AuthProvider>. • Make sure the routing is centralized in one place (e.g. App.tsx with <BrowserRouter>). ⸻ 6) Define routes for /login, /clinico, /tutor, /investigador Set up react-router-dom routes: • /login • /clinico • /tutor • /investigador Use ProtectedRoute like this: <Route path="/clinico" element={ <ProtectedRoute allow={['clinico', 'tutor', 'investigador']}> <ClinicoHome /> </ProtectedRoute> } /> <Route path="/tutor" element={ <ProtectedRoute allow={['tutor', 'investigador']}> <TutorPage /> </ProtectedRoute> } /> <Route path="/investigador" element={ <ProtectedRoute allow={['investigador']}> <InvestigatorDashboard /> </ProtectedRoute> } /> Create simple placeholder components if they don’t exist yet: • src/pages/LoginPage.tsx • src/pages/ClinicoHome.tsx • src/pages/TutorPage.tsx • src/pages/InvestigatorDashboard.tsx ⸻ 7) Implement LoginPage Component: • Uses useAuth() • If user is logged in: • show email • show role • show a button “Ir a mi panel” that redirects depending on role: • clinico → /clinico • tutor → /tutor • investigador → /investigador • If no user: • show button “Iniciar sesión con Google” that calls login() ⸻ 8) Navbar with dynamic options by role Create or modify a Navbar component: • Uses useAuth() • Shows: • If no user: • only “Login” • If user role = clinico: • “Registrar caso” → link to the create form route • “Mis casos” → /clinico • If user role = tutor: • “Registrar caso” • “Mis casos” • “Validar casos” → /tutor • If user role = investigador: • Todo lo anterior • “Dashboard” → /investigador • Add a “Cerrar sesión” button that calls logout() if user is logged in. Also, for now, implement a simple theme switch by role: • If role === ‘clinico’ → add class theme-dark to the root container • Else → add class theme-light Create basic CSS for .theme-dark and .theme-light (background, text colors). ⸻ Make sure the code compiles and TypeScript types are correct. Do not remove my existing code for forms and API calls; just integrate this auth/roles layer on top. ⸻
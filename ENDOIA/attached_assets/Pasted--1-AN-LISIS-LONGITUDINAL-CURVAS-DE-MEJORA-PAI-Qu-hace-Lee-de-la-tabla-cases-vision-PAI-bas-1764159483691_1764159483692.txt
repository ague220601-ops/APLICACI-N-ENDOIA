üü¶ 1) AN√ÅLISIS LONGITUDINAL ‚Äî CURVAS DE MEJORA PAI
Qu√© hace:

Lee de la tabla cases:

vision_PAI_baseline

vision_PAI_followup

Calcula la diferencia

Genera un dataset (baseline ‚Üí followup)

Permite graficarlo en una l√≠nea para mostrar ‚Äúmejor√≠a‚Äù

1.1 Funci√≥n en supabaseService.ts
export async function getLongitudinalPAI() {
  const { data, error } = await supabase
    .from("cases")
    .select("case_id, vision_PAI_baseline, vision_PAI_followup");

  if (error) throw error;

  // Convertir a formato usable para gr√°fica
  return data
    .filter(c => c.vision_PAI_baseline && c.vision_PAI_followup)
    .map(c => ({
      case_id: c.case_id,
      baseline: Number(c.vision_PAI_baseline),
      followup: Number(c.vision_PAI_followup),
      delta: Number(c.vision_PAI_baseline) - Number(c.vision_PAI_followup)
    }));
}

1.2 Componente React para gr√°fica de l√≠neas

Usando Recharts (funciona en Replit de sobra):

import { LineChart, Line, XAxis, YAxis, Tooltip, CartesianGrid } from "recharts";

export function GraficaPAI({ data }) {
  return (
    <LineChart width={600} height={300} data={data}>
      <CartesianGrid strokeDasharray="3 3" />
      <XAxis dataKey="case_id" />
      <YAxis domain={[0, 5]} />
      <Tooltip />
      <Line type="monotone" dataKey="baseline" stroke="#8884d8" name="PAI Baseline" />
      <Line type="monotone" dataKey="followup" stroke="#82ca9d" name="PAI Follow-up" />
    </LineChart>
  );
}

1.3 Insertar en el panel investigador
const [curveData, setCurveData] = useState([]);

useEffect(() => {
  getLongitudinalPAI().then(setCurveData);
}, []);

<GraficaPAI data={curveData} />


üî• Ya tienes curva PAI baseline ‚Üí followup para tu estudio.

üü© 2) C√ÅLCULO AUTOM√ÅTICO DE √âXITO RADIOL√ìGICO
Definici√≥n est√°ndar (ACEPTADA EN LITERATURA):
√âXITO = PAI baja + reducci√≥n de lesi√≥n o desaparici√≥n
FRACASO = PAI igual o mayor + lesi√≥n igual o mayor
PARCIAL = PAI baja pero a√∫n lesion residual


Vamos a integrarlo AUTOM√ÅTICAMENTE.

2.1 Funci√≥n backend (supabaseService.ts)
export async function calcularExitoRadiologico(caseId) {
  const { data, error } = await supabase
    .from("cases")
    .select("vision_PAI_baseline, vision_PAI_followup, vision_lesion_diam_mm_baseline, vision_lesion_diam_mm_followup")
    .eq("case_id", caseId)
    .single();

  if (error) throw error;

  const basePAI = Number(data.vision_PAI_baseline);
  const follPAI = Number(data.vision_PAI_followup);
  const baseL = Number(data.vision_lesion_diam_mm_baseline);
  const follL = Number(data.vision_lesion_diam_mm_followup);

  let resultado = "indeterminado";

  // --- √âxito completo
  if (follPAI <= 2 && follL < baseL && follL <= 1) {
    resultado = "exito";
  }

  // --- Curaci√≥n parcial
  else if (follPAI < basePAI && follL < baseL) {
    resultado = "parcial";
  }

  // --- Fracaso
  else if (follPAI >= basePAI || follL >= baseL) {
    resultado = "fracaso";
  }

  await supabase
    .from("cases")
    .update({ exito_radiologico_final: resultado })
    .eq("case_id", caseId);

  return resultado;
}

2.2 Bot√≥n en la ficha del caso
async function handleExito() {
  const res = await calcularExitoRadiologico(caso.case_id);
  alert("√âxito radiol√≥gico: " + res);
  refetch();
}

<button onClick={handleExito} className="btn-primary mt-3">
  Calcular √©xito radiol√≥gico
</button>


üî• Con un clic calcula el √©xito radiol√≥gico seg√∫n PAI + lesi√≥n mm.